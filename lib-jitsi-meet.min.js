!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.JitsiMeetJS=t():e.JitsiMeetJS=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=116)}([function(e,t){e.exports={ADD_ICE_CANDIDATE_FAILED:"xmpp.add_ice_candidate_failed",AUDIO_MUTED_BY_FOCUS:"xmpp.audio_muted_by_focus",AUTHENTICATION_REQUIRED:"xmpp.authentication_required",BRIDGE_DOWN:"xmpp.bridge_down",CALL_ACCEPTED:"xmpp.callaccepted.jingle",CALL_INCOMING:"xmpp.callincoming.jingle",CALL_ENDED:"xmpp.callended.jingle",CHAT_ERROR_RECEIVED:"xmpp.chat_error_received",CONFERENCE_PROPERTIES_CHANGED:"xmpp.conference_properties_changed",CONFERENCE_SETUP_FAILED:"xmpp.conference_setup_failed",CONNECTION_ESTABLISHED:"xmpp.connection.connected",CONNECTION_FAILED:"xmpp.connection.failed",CONNECTION_INTERRUPTED:"xmpp.connection.interrupted",CONNECTION_RESTORED:"xmpp.connection.restored",CONNECTION_ICE_FAILED:"xmpp.connection.ice.failed",DISPLAY_NAME_CHANGED:"xmpp.display_name_changed",EMUC_ROOM_ADDED:"xmpp.emuc_room_added",EMUC_ROOM_REMOVED:"xmpp.emuc_room_removed",ETHERPAD:"xmpp.etherpad",FOCUS_DISCONNECTED:"xmpp.focus_disconnected",FOCUS_LEFT:"xmpp.focus_left",GRACEFUL_SHUTDOWN:"xmpp.graceful_shutdown",ICE_RESTARTING:"rtc.ice_restarting",ICE_RESTART_SUCCESS:"rtc.ice_restart_success",JINGLE_ERROR:"xmpp.jingle_error",JINGLE_FATAL_ERROR:"xmpp.jingle_fatal_error",KICKED:"xmpp.kicked",LOCAL_ROLE_CHANGED:"xmpp.localrole_changed",MESSAGE_RECEIVED:"xmpp.message_received",PRIVATE_MESSAGE_RECEIVED:"xmpp.private_message_received",MUC_MEMBER_BOT_TYPE_CHANGED:"xmpp.muc_member_bot_type_changed",MUC_DESTROYED:"xmpp.muc_destroyed",MUC_JOINED:"xmpp.muc_joined",MUC_MEMBER_JOINED:"xmpp.muc_member_joined",MUC_MEMBER_LEFT:"xmpp.muc_member_left",MUC_LEFT:"xmpp.muc_left",MUC_ROLE_CHANGED:"xmpp.muc_role_changed",MUC_LOCK_CHANGED:"xmpp.muc_lock_changed",PARTICIPANT_AUDIO_MUTED:"xmpp.audio_muted",PARTICIPANT_VIDEO_MUTED:"xmpp.video_muted",PARTICIPANT_VIDEO_TYPE_CHANGED:"xmpp.video_type",PARTCIPANT_FEATURES_CHANGED:"xmpp.partcipant_features_changed",PASSWORD_REQUIRED:"xmpp.password_required",PEERCONNECTION_READY:"xmpp.peerconnection_ready",PHONE_NUMBER_CHANGED:"conference.phoneNumberChanged",PRESENCE_RECEIVED:"xmpp.presence_received",PRESENCE_STATUS:"xmpp.presence_status",PROMPT_FOR_LOGIN:"xmpp.prompt_for_login",READY_TO_JOIN:"xmpp.ready_to_join",RECORDER_STATE_CHANGED:"xmpp.recorderStateChanged",REMOTE_STATS:"xmpp.remote_stats",RESERVATION_ERROR:"xmpp.room_reservation_error",ROOM_CONNECT_ERROR:"xmpp.room_connect_error",ROOM_CONNECT_NOT_ALLOWED_ERROR:"xmpp.room_connect_error.not_allowed",ROOM_JOIN_ERROR:"xmpp.room_join_error",ROOM_MAX_USERS_ERROR:"xmpp.room_max_users_error",SENDING_CHAT_MESSAGE:"xmpp.sending_chat_message",SENDING_PRIVATE_CHAT_MESSAGE:"xmpp.sending_private_chat_message",SESSION_ACCEPT_TIMEOUT:"xmpp.session_accept_timeout",SPEAKER_STATS_RECEIVED:"xmpp.speaker_stats_received",START_MUTED_FROM_FOCUS:"xmpp.start_muted_from_focus",SUBJECT_CHANGED:"xmpp.subject_changed",SUSPEND_DETECTED:"xmpp.suspend_detected",TRANSCRIPTION_STATUS_CHANGED:"xmpp.transcription_status_changed",TRANSPORT_INFO:"xmpp.transportinfo.jingle",VIDEO_SIP_GW_AVAILABILITY_CHANGED:"xmpp.videoSIPGWAvailabilityChanged",VIDEO_SIP_GW_SESSION_STATE_CHANGED:"xmpp.videoSIPGWSessionStateChanged",ICE_CONNECTION_STATE_CHANGED:"xmpp.ice_connection_state_changed",JSON_MESSAGE_RECEIVED:"xmmp.json_message_received"}},function(e,t,n){var r,i,o;i=[],void 0===(o="function"==typeof(r=function(){
/**
 * @license almond 0.3.3 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/almond/LICENSE
 */
var t,n,r,i,o;return function(e){var i,o,a,s,c={},u={},l={},d={},f=Object.prototype.hasOwnProperty,p=[].slice,h=/\.js$/;function v(e,t){return f.call(e,t)}function m(e,t){var n,r,i,o,a,s,c,u,d,f,p,v=t&&t.split("/"),m=l.map,g=m&&m["*"]||{};if(e){for(a=(e=e.split("/")).length-1,l.nodeIdCompat&&h.test(e[a])&&(e[a]=e[a].replace(h,"")),"."===e[0].charAt(0)&&v&&(e=v.slice(0,v.length-1).concat(e)),d=0;d<e.length;d++)if("."===(p=e[d]))e.splice(d,1),d-=1;else if(".."===p){if(0===d||1===d&&".."===e[2]||".."===e[d-1])continue;d>0&&(e.splice(d-1,2),d-=2)}e=e.join("/")}if((v||g)&&m){for(d=(n=e.split("/")).length;d>0;d-=1){if(r=n.slice(0,d).join("/"),v)for(f=v.length;f>0;f-=1)if((i=m[v.slice(0,f).join("/")])&&(i=i[r])){o=i,s=d;break}if(o)break;!c&&g&&g[r]&&(c=g[r],u=d)}!o&&c&&(o=c,s=u),o&&(n.splice(0,s,o),e=n.join("/"))}return e}function g(t,n){return function(){var r=p.call(arguments,0);return"string"!=typeof r[0]&&1===r.length&&r.push(null),o.apply(e,r.concat([t,n]))}}function y(e){return function(t){c[e]=t}}function b(t){if(v(u,t)){var n=u[t];delete u[t],d[t]=!0,i.apply(e,n)}if(!v(c,t)&&!v(d,t))throw new Error("No "+t);return c[t]}function S(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function _(e){return e?S(e):[]}function E(e){return function(){return l&&l.config&&l.config[e]||{}}}a=function(e,t){var n,r,i=S(e),o=i[0],a=t[1];return e=i[1],o&&(n=b(o=m(o,a))),o?e=n&&n.normalize?n.normalize(e,(r=a,function(e){return m(e,r)})):m(e,a):(o=(i=S(e=m(e,a)))[0],e=i[1],o&&(n=b(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},s={require:function(e){return g(e)},exports:function(e){var t=c[e];return void 0!==t?t:c[e]={}},module:function(e){return{id:e,uri:"",exports:c[e],config:E(e)}}},i=function(t,n,r,i){var o,l,f,p,h,m,S,E=[],C=typeof r;if(m=_(i=i||t),"undefined"===C||"function"===C){for(n=!n.length&&r.length?["require","exports","module"]:n,h=0;h<n.length;h+=1)if("require"===(l=(p=a(n[h],m)).f))E[h]=s.require(t);else if("exports"===l)E[h]=s.exports(t),S=!0;else if("module"===l)o=E[h]=s.module(t);else if(v(c,l)||v(u,l)||v(d,l))E[h]=b(l);else{if(!p.p)throw new Error(t+" missing "+l);p.p.load(p.n,g(i,!0),y(l),{}),E[h]=c[l]}f=r?r.apply(c[t],E):void 0,t&&(o&&o.exports!==e&&o.exports!==c[t]?c[t]=o.exports:f===e&&S||(c[t]=f))}else t&&(c[t]=r)},t=n=o=function(t,n,r,c,u){if("string"==typeof t)return s[t]?s[t](n):b(a(t,_(n)).f);if(!t.splice){if((l=t).deps&&o(l.deps,l.callback),!n)return;n.splice?(t=n,n=r,r=null):t=e}return n=n||function(){},"function"==typeof r&&(r=c,c=u),c?i(e,t,n,r):setTimeout(function(){i(e,t,n,r)},4),o},o.config=function(e){return o(e)},t._defined=c,(r=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),v(c,e)||v(u,e)||(u[e]=[e,t,n])}).amd={jQuery:!0}}(),r("node_modules/almond/almond.js",function(){}),i=this,o=function(e){Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice,r=Array.prototype.concat,i=n.call(arguments,1);return function(){return t.apply(e||this,r.call(i,n.call(arguments,0)))}}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length,n=Number(arguments[1])||0;for((n=n<0?Math.ceil(n):Math.floor(n))<0&&(n+=t);n<t;n++)if(n in this&&this[n]===e)return n;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var n,r;if(null===this)throw new TypeError(" this is null or not defined");var i=Object(this),o=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(n=t),r=0;r<o;){var a;r in i&&(a=i[r],e.call(n,a,r,i)),r++}});var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.btoa||(e.btoa=function(e){var n,r,i,o,a,s,c,u="",l=0;do{o=(n=e.charCodeAt(l++))>>2,a=(3&n)<<4|(r=e.charCodeAt(l++))>>4,s=(15&r)<<2|(i=e.charCodeAt(l++))>>6,c=63&i,isNaN(r)?(a=(3&n)<<4,s=c=64):isNaN(i)&&(c=64),u=u+t.charAt(o)+t.charAt(a)+t.charAt(s)+t.charAt(c)}while(l<e.length);return u}),e.atob||(e.atob=function(e){var n,r,i,o,a,s,c="",u=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{n=t.indexOf(e.charAt(u++))<<2|(o=t.indexOf(e.charAt(u++)))>>4,r=(15&o)<<4|(a=t.indexOf(e.charAt(u++)))>>2,i=(3&a)<<6|(s=t.indexOf(e.charAt(u++))),c+=String.fromCharCode(n),64!==a&&(c+=String.fromCharCode(r)),64!==s&&(c+=String.fromCharCode(i))}while(u<e.length);return c})},"function"==typeof r&&r.amd?r("strophe-polyfill",[],function(){return o(i)}):o(i),function(t,n){"function"==typeof r&&r.amd?r("strophe-sha1",[],function(){return n()}):e.exports=n()}(0,function(){function e(e,r){e[r>>5]|=128<<24-r%32,e[15+(r+64>>9<<4)]=r;var a,s,c,u,l,d,f,p,h=new Array(80),v=1732584193,m=-271733879,g=-1732584194,y=271733878,b=-1009589776;for(a=0;a<e.length;a+=16){for(u=v,l=m,d=g,f=y,p=b,s=0;s<80;s++)h[s]=s<16?e[a+s]:o(h[s-3]^h[s-8]^h[s-14]^h[s-16],1),c=i(i(o(v,5),t(s,m,g,y)),i(i(b,h[s]),n(s))),b=y,y=g,g=o(m,30),m=v,v=c;v=i(v,u),m=i(m,l),g=i(g,d),y=i(y,f),b=i(b,p)}return[v,m,g,y,b]}function t(e,t,n,r){return e<20?t&n|~t&r:e<40?t^n^r:e<60?t&n|t&r|n&r:t^n^r}function n(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function r(t,n){var r=a(t);r.length>16&&(r=e(r,8*t.length));for(var i=new Array(16),o=new Array(16),s=0;s<16;s++)i[s]=909522486^r[s],o[s]=1549556828^r[s];var c=e(i.concat(a(n)),512+8*n.length);return e(o.concat(c),672)}function i(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function o(e,t){return e<<t|e>>>32-t}function a(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<24-n%32;return t}function s(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}function c(e){for(var t,n,r="",i=0;i<4*e.length;i+=3)for(t=(e[i>>2]>>8*(3-i%4)&255)<<16|(e[i+1>>2]>>8*(3-(i+1)%4)&255)<<8|e[i+2>>2]>>8*(3-(i+2)%4)&255,n=0;n<4;n++)8*i+6*n>32*e.length?r+="=":r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>6*(3-n)&63);return r}return{b64_hmac_sha1:function(e,t){return c(r(e,t))},b64_sha1:function(t){return c(e(a(t),8*t.length))},binb2str:s,core_hmac_sha1:r,str_hmac_sha1:function(e,t){return s(r(e,t))},str_sha1:function(t){return s(e(a(t),8*t.length))}}}),function(t,n){"function"==typeof r&&r.amd?r("strophe-md5",[],function(){return n()}):e.exports=n()}(0,function(){var e=function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n},t=function(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},n=function(t,n,r,i,o,a){return e((s=e(e(n,t),e(i,a)))<<(c=o)|s>>>32-c,r);var s,c},r=function(e,t,r,i,o,a,s){return n(t&r|~t&i,e,t,o,a,s)},i=function(e,t,r,i,o,a,s){return n(t&i|r&~i,e,t,o,a,s)},o=function(e,t,r,i,o,a,s){return n(t^r^i,e,t,o,a,s)},a=function(e,t,r,i,o,a,s){return n(r^(t|~i),e,t,o,a,s)},s=function(t,n){t[n>>5]|=128<<n%32,t[14+(n+64>>>9<<4)]=n;for(var s,c,u,l,d=1732584193,f=-271733879,p=-1732584194,h=271733878,v=0;v<t.length;v+=16)s=d,c=f,u=p,l=h,d=r(d,f,p,h,t[v+0],7,-680876936),h=r(h,d,f,p,t[v+1],12,-389564586),p=r(p,h,d,f,t[v+2],17,606105819),f=r(f,p,h,d,t[v+3],22,-1044525330),d=r(d,f,p,h,t[v+4],7,-176418897),h=r(h,d,f,p,t[v+5],12,1200080426),p=r(p,h,d,f,t[v+6],17,-1473231341),f=r(f,p,h,d,t[v+7],22,-45705983),d=r(d,f,p,h,t[v+8],7,1770035416),h=r(h,d,f,p,t[v+9],12,-1958414417),p=r(p,h,d,f,t[v+10],17,-42063),f=r(f,p,h,d,t[v+11],22,-1990404162),d=r(d,f,p,h,t[v+12],7,1804603682),h=r(h,d,f,p,t[v+13],12,-40341101),p=r(p,h,d,f,t[v+14],17,-1502002290),f=r(f,p,h,d,t[v+15],22,1236535329),d=i(d,f,p,h,t[v+1],5,-165796510),h=i(h,d,f,p,t[v+6],9,-1069501632),p=i(p,h,d,f,t[v+11],14,643717713),f=i(f,p,h,d,t[v+0],20,-373897302),d=i(d,f,p,h,t[v+5],5,-701558691),h=i(h,d,f,p,t[v+10],9,38016083),p=i(p,h,d,f,t[v+15],14,-660478335),f=i(f,p,h,d,t[v+4],20,-405537848),d=i(d,f,p,h,t[v+9],5,568446438),h=i(h,d,f,p,t[v+14],9,-1019803690),p=i(p,h,d,f,t[v+3],14,-187363961),f=i(f,p,h,d,t[v+8],20,1163531501),d=i(d,f,p,h,t[v+13],5,-1444681467),h=i(h,d,f,p,t[v+2],9,-51403784),p=i(p,h,d,f,t[v+7],14,1735328473),f=i(f,p,h,d,t[v+12],20,-1926607734),d=o(d,f,p,h,t[v+5],4,-378558),h=o(h,d,f,p,t[v+8],11,-2022574463),p=o(p,h,d,f,t[v+11],16,1839030562),f=o(f,p,h,d,t[v+14],23,-35309556),d=o(d,f,p,h,t[v+1],4,-1530992060),h=o(h,d,f,p,t[v+4],11,1272893353),p=o(p,h,d,f,t[v+7],16,-155497632),f=o(f,p,h,d,t[v+10],23,-1094730640),d=o(d,f,p,h,t[v+13],4,681279174),h=o(h,d,f,p,t[v+0],11,-358537222),p=o(p,h,d,f,t[v+3],16,-722521979),f=o(f,p,h,d,t[v+6],23,76029189),d=o(d,f,p,h,t[v+9],4,-640364487),h=o(h,d,f,p,t[v+12],11,-421815835),p=o(p,h,d,f,t[v+15],16,530742520),f=o(f,p,h,d,t[v+2],23,-995338651),d=a(d,f,p,h,t[v+0],6,-198630844),h=a(h,d,f,p,t[v+7],10,1126891415),p=a(p,h,d,f,t[v+14],15,-1416354905),f=a(f,p,h,d,t[v+5],21,-57434055),d=a(d,f,p,h,t[v+12],6,1700485571),h=a(h,d,f,p,t[v+3],10,-1894986606),p=a(p,h,d,f,t[v+10],15,-1051523),f=a(f,p,h,d,t[v+1],21,-2054922799),d=a(d,f,p,h,t[v+8],6,1873313359),h=a(h,d,f,p,t[v+15],10,-30611744),p=a(p,h,d,f,t[v+6],15,-1560198380),f=a(f,p,h,d,t[v+13],21,1309151649),d=a(d,f,p,h,t[v+4],6,-145523070),h=a(h,d,f,p,t[v+11],10,-1120210379),p=a(p,h,d,f,t[v+2],15,718787259),f=a(f,p,h,d,t[v+9],21,-343485551),d=e(d,s),f=e(f,c),p=e(p,u),h=e(h,l);return[d,f,p,h]};return{hexdigest:function(e){return function(e){for(var t="",n=0;n<4*e.length;n++)t+="0123456789abcdef".charAt(e[n>>2]>>n%4*8+4&15)+"0123456789abcdef".charAt(e[n>>2]>>n%4*8&15);return t}(s(t(e),8*e.length))},hash:function(e){return function(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}(s(t(e),8*e.length))}}}),function(t,n){"function"==typeof r&&r.amd?r("strophe-utils",[],function(){return n()}):e.exports=n()}(0,function(){return{utf16to8:function(e){var t,n,r="",i=e.length;for(t=0;t<i;t++)(n=e.charCodeAt(t))>=0&&n<=127?r+=e.charAt(t):n>2047?(r+=String.fromCharCode(224|n>>12&15),r+=String.fromCharCode(128|n>>6&63),r+=String.fromCharCode(128|n>>0&63)):(r+=String.fromCharCode(192|n>>6&31),r+=String.fromCharCode(128|n>>0&63));return r},addCookies:function(e){var t,n,r,i,o,a,s;for(t in e||{})o="",a="",s="",r="object"==typeof(n=e[t]),i=escape(unescape(r?n.value:n)),r&&(o=n.expires?";expires="+n.expires:"",a=n.domain?";domain="+n.domain:"",s=n.path?";path="+n.path:""),document.cookie=t+"="+i+o+a+s}}}),function(t,i){"function"==typeof r&&r.amd?r("strophe-core",["strophe-sha1","strophe-md5","strophe-utils"],function(){return i.apply(this,arguments)}):e.exports=i(n("./sha1"),n("./md5"),n("./utils"))}(0,function(e,t,n){var r;function i(e,t){return new r.Builder(e,t)}function o(e){return new r.Builder("iq",e)}function a(e){return new r.Builder("presence",e)}return(r={VERSION:"1.2.15",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(e){for(var t=0;t<r.XHTML.tags.length;t++)if(e===r.XHTML.tags[t])return!0;return!1},validAttribute:function(e,t){if(void 0!==r.XHTML.attributes[e]&&r.XHTML.attributes[e].length>0)for(var n=0;n<r.XHTML.attributes[e].length;n++)if(t===r.XHTML.attributes[e][n])return!0;return!1},validCSS:function(e){for(var t=0;t<r.XHTML.css.length;t++)if(e===r.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},ErrorCondition:{BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(e,t){r.NS[e]=t},forEachChild:function(e,t,n){var i,o;for(i=0;i<e.childNodes.length;i++)(o=e.childNodes[i]).nodeType!==r.ElementType.NORMAL||t&&!this.isTagEqual(o,t)||n(o)},isTagEqual:function(e,t){return e.tagName===t},_xmlGenerator:null,_makeGenerator:function(){var e;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(e=this._getIEXmlDom()).appendChild(e.createElement("strophe")):e=document.implementation.createDocument("jabber:client","strophe",null),e},xmlGenerator:function(){return r._xmlGenerator||(r._xmlGenerator=r._makeGenerator()),r._xmlGenerator},_getIEXmlDom:function(){for(var e=null,t=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<t.length&&null===e;n++)try{e=new ActiveXObject(t[n])}catch(t){e=null}return e},xmlElement:function(e){if(!e)return null;var t,n,i,o=r.xmlGenerator().createElement(e);for(t=1;t<arguments.length;t++){var a=arguments[t];if(a)if("string"==typeof a||"number"==typeof a)o.appendChild(r.xmlTextNode(a));else if("object"==typeof a&&"function"==typeof a.sort)for(n=0;n<a.length;n++){var s=a[n];"object"==typeof s&&"function"==typeof s.sort&&void 0!==s[1]&&null!==s[1]&&o.setAttribute(s[0],s[1])}else if("object"==typeof a)for(i in a)a.hasOwnProperty(i)&&void 0!==a[i]&&null!==a[i]&&o.setAttribute(i,a[i])}return o},xmlescape:function(e){return e=(e=(e=(e=(e=e.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")},xmlunescape:function(e){return e=(e=(e=(e=(e=e.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')},xmlTextNode:function(e){return r.xmlGenerator().createTextNode(e)},xmlHtmlNode:function(e){var t;return DOMParser?t=(new DOMParser).parseFromString(e,"text/xml"):((t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e)),t},getText:function(e){if(!e)return null;var t="";0===e.childNodes.length&&e.nodeType===r.ElementType.TEXT&&(t+=e.nodeValue);for(var n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType===r.ElementType.TEXT&&(t+=e.childNodes[n].nodeValue);return r.xmlescape(t)},copyElement:function(e){var t,n;if(e.nodeType===r.ElementType.NORMAL){for(n=r.xmlElement(e.tagName),t=0;t<e.attributes.length;t++)n.setAttribute(e.attributes[t].nodeName,e.attributes[t].value);for(t=0;t<e.childNodes.length;t++)n.appendChild(r.copyElement(e.childNodes[t]))}else e.nodeType===r.ElementType.TEXT&&(n=r.xmlGenerator().createTextNode(e.nodeValue));return n},createHtml:function(e){var t,n,i,o,a,s,c,u,l,d,f;if(e.nodeType===r.ElementType.NORMAL)if(o=e.nodeName.toLowerCase(),r.XHTML.validTag(o))try{for(n=r.xmlElement(o),t=0;t<r.XHTML.attributes[o].length;t++)if(a=r.XHTML.attributes[o][t],null!=(s=e.getAttribute(a))&&""!==s&&!1!==s&&0!==s)if("style"===a&&"object"==typeof s&&void 0!==s.cssText&&(s=s.cssText),"style"===a){for(c=[],u=s.split(";"),i=0;i<u.length;i++)d=(l=u[i].split(":"))[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),r.XHTML.validCSS(d)&&(f=l[1].replace(/^\s*/,"").replace(/\s*$/,""),c.push(d+": "+f));c.length>0&&(s=c.join("; "),n.setAttribute(a,s))}else n.setAttribute(a,s);for(t=0;t<e.childNodes.length;t++)n.appendChild(r.createHtml(e.childNodes[t]))}catch(e){n=r.xmlTextNode("")}else for(n=r.xmlGenerator().createDocumentFragment(),t=0;t<e.childNodes.length;t++)n.appendChild(r.createHtml(e.childNodes[t]));else if(e.nodeType===r.ElementType.FRAGMENT)for(n=r.xmlGenerator().createDocumentFragment(),t=0;t<e.childNodes.length;t++)n.appendChild(r.createHtml(e.childNodes[t]));else e.nodeType===r.ElementType.TEXT&&(n=r.xmlTextNode(e.nodeValue));return n},escapeNode:function(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(e){return e.indexOf("@")<0?null:e.split("@")[0]},getDomainFromJid:function(e){var t=r.getBareJidFromJid(e);if(t.indexOf("@")<0)return t;var n=t.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(e){var t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(e){return e?e.split("/")[0]:null},_handleError:function(e){void 0!==e.stack&&r.fatal(e.stack),e.sourceURL?r.fatal("error: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message):e.fileName?r.fatal("error: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message):r.fatal("error: "+e.message)},log:function(e,t){e===this.LogLevel.FATAL&&"object"==typeof window.console&&"function"==typeof window.console.error&&window.console.error(t)},debug:function(e){this.log(this.LogLevel.DEBUG,e)},info:function(e){this.log(this.LogLevel.INFO,e)},warn:function(e){this.log(this.LogLevel.WARN,e)},error:function(e){this.log(this.LogLevel.ERROR,e)},fatal:function(e){this.log(this.LogLevel.FATAL,e)},serialize:function(e){var t;if(!e)return null;"function"==typeof e.tree&&(e=e.tree());var n,i,o=e.nodeName;for(e.getAttribute("_realname")&&(o=e.getAttribute("_realname")),t="<"+o,n=0;n<e.attributes.length;n++)"_realname"!==e.attributes[n].nodeName&&(t+=" "+e.attributes[n].nodeName+"='"+r.xmlescape(e.attributes[n].value)+"'");if(e.childNodes.length>0){for(t+=">",n=0;n<e.childNodes.length;n++)switch((i=e.childNodes[n]).nodeType){case r.ElementType.NORMAL:t+=r.serialize(i);break;case r.ElementType.TEXT:t+=r.xmlescape(i.nodeValue);break;case r.ElementType.CDATA:t+="<![CDATA["+i.nodeValue+"]]>"}t+="</"+o+">"}else t+="/>";return t},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){r._connectionPlugins[e]=t}}).Builder=function(e,t){"presence"!==e&&"message"!==e&&"iq"!==e||(t&&!t.xmlns?t.xmlns=r.NS.CLIENT:t||(t={xmlns:r.NS.CLIENT})),this.nodeTree=r.xmlElement(e,t),this.node=this.nodeTree},r.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return r.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(e){for(var t in e)e.hasOwnProperty(t)&&(void 0===e[t]?this.node.removeAttribute(t):this.node.setAttribute(t,e[t]));return this},c:function(e,t,n){var i=r.xmlElement(e,t,n);return this.node.appendChild(i),"string"!=typeof n&&"number"!=typeof n&&(this.node=i),this},cnode:function(e){var t,n=r.xmlGenerator();try{t=void 0!==n.importNode}catch(e){t=!1}var i=t?n.importNode(e,!0):r.copyElement(e);return this.node.appendChild(i),this.node=i,this},t:function(e){var t=r.xmlTextNode(e);return this.node.appendChild(t),this},h:function(e){var t=document.createElement("body");t.innerHTML=e;for(var n=r.createHtml(t);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},r.Handler=function(e,t,n,i,o,a,s){this.handler=e,this.ns=t,this.name=n,this.type=i,this.id=o,this.options=s||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(r.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=a?r.getBareJidFromJid(a):null:this.from=a,this.user=!0},r.Handler.prototype={getNamespace:function(e){var t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t},namespaceMatch:function(e){var t=!1;if(!this.ns)return!0;var n=this;return r.forEachChild(e,null,function(e){n.getNamespace(e)===n.ns&&(t=!0)}),t=t||this.getNamespace(e)===this.ns},isMatch:function(e){var t=e.getAttribute("from");this.options.matchBareFromJid&&(t=r.getBareJidFromJid(t));var n=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!r.isTagEqual(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)},run:function(e){var t=null;try{t=this.handler(e)}catch(e){throw r._handleError(e),e}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},r.TimedHandler=function(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0},r.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},r.Connection=function(e,t){this.service=e,this.options=t||{};var i=this.options.protocol||"";for(var o in 0===e.indexOf("ws:")||0===e.indexOf("wss:")||0===i.indexOf("ws")?this._proto=new r.Websocket(this):this._proto=new r.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100),n.addCookies(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),r._connectionPlugins)if(r._connectionPlugins.hasOwnProperty(o)){var a=r._connectionPlugins[o],s=function(){};s.prototype=a,this[o]=new s,this[o].init(this)}},r.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});return"string"==typeof e||"number"==typeof e?t+":"+e:t+""},addProtocolErrorHandler:function(e,t,n){this.protocolErrorHandlers[e][t]=n},connect:function(e,t,n,i,o,a,s){this.jid=e,this.authzid=r.getBareJidFromJid(this.jid),this.authcid=s||r.getNodeFromJid(this.jid),this.pass=t,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=r.getDomainFromJid(this.jid),this._changeConnectStatus(r.Status.CONNECTING,null),this._proto._connect(i,o,a)},attach:function(e,t,n,i,o,a,s){if(!(this._proto instanceof r.Bosh))throw{name:"StropheSessionError",message:'The "attach" method can only be used with a BOSH connection.'};this._proto._attach(e,t,n,i,o,a,s)},restore:function(e,t,n,r,i){if(!this._sessionCachingSupported())throw{name:"StropheSessionError",message:'The "restore" method can only be used with a BOSH connection.'};this._proto._restore(e,t,n,r,i)},_sessionCachingSupported:function(){if(this._proto instanceof r.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1},xmlInput:function(e){},xmlOutput:function(e){},rawInput:function(e){},rawOutput:function(e){},nextValidRid:function(e){},send:function(e){if(null!==e){if("function"==typeof e.sort)for(var t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendPresence:function(e,t,n,r){var i=null,o=this;"function"==typeof e.tree&&(e=e.tree());var a=e.getAttribute("id");if(a||(a=this.getUniqueId("sendPresence"),e.setAttribute("id",a)),"function"==typeof t||"function"==typeof n){var s=this.addHandler(function(e){i&&o.deleteTimedHandler(i),"error"===e.getAttribute("type")?n&&n(e):t&&t(e)},null,"presence",null,a);r&&(i=this.addTimedHandler(r,function(){return o.deleteHandler(s),n&&n(null),!1}))}return this.send(e),a},sendIQ:function(e,t,n,r){var i=null,o=this;"function"==typeof e.tree&&(e=e.tree());var a=e.getAttribute("id");if(a||(a=this.getUniqueId("sendIQ"),e.setAttribute("id",a)),"function"==typeof t||"function"==typeof n){var s=this.addHandler(function(e){i&&o.deleteTimedHandler(i);var r=e.getAttribute("type");if("result"===r)t&&t(e);else{if("error"!==r)throw{name:"StropheError",message:"Got bad IQ type of "+r};n&&n(e)}},null,"iq",["error","result"],a);r&&(i=this.addTimedHandler(r,function(){return o.deleteHandler(s),n&&n(null),!1}))}return this.send(e),a},_queueData:function(e){if(null===e||!e.tagName||!e.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(e)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100)},addTimedHandler:function(e,t){var n=new r.TimedHandler(e,t);return this.addTimeds.push(n),n},deleteTimedHandler:function(e){this.removeTimeds.push(e)},addHandler:function(e,t,n,i,o,a,s){var c=new r.Handler(e,t,n,i,o,a,s);return this.addHandlers.push(c),c},deleteHandler:function(e){this.removeHandlers.push(e);var t=this.addHandlers.indexOf(e);t>=0&&this.addHandlers.splice(t,1)},registerSASLMechanisms:function(e){this.mechanisms={},(e=e||[r.SASLAnonymous,r.SASLExternal,r.SASLMD5,r.SASLOAuthBearer,r.SASLXOAuth2,r.SASLPlain,r.SASLSHA1]).forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(e){this.mechanisms[e.prototype.name]=e},disconnect:function(e){if(this._changeConnectStatus(r.Status.DISCONNECTING,e),r.info("Disconnect was called because: "+e),this.connected){var t=!1;this.disconnecting=!0,this.authenticated&&(t=a({xmlns:r.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(t)}else r.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()},_changeConnectStatus:function(e,t,n){for(var i in r._connectionPlugins)if(r._connectionPlugins.hasOwnProperty(i)){var o=this[i];if(o.statusChanged)try{o.statusChanged(e,t)}catch(e){r.error(i+" plugin caused an exception changing status: "+e)}}if(this.connect_callback)try{this.connect_callback(e,t,n)}catch(e){r._handleError(e),r.error("User connection callback caused an exception: "+e)}},_doDisconnect:function(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),r.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(r.Status.DISCONNECTED,e),this.connected=!1},_dataRecv:function(e,t){r.info("_dataRecv called");var n=this._proto._reqToData(e);if(null!==n){var i,o;for(this.xmlInput!==r.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==r.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(r.serialize(n)));this.removeHandlers.length>0;)o=this.removeHandlers.pop(),(i=this.handlers.indexOf(o))>=0&&this.handlers.splice(i,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())this._doDisconnect();else{var a,s,c=n.getAttribute("type");if(null!==c&&"terminate"===c){if(this.disconnecting)return;return a=n.getAttribute("condition"),s=n.getElementsByTagName("conflict"),null!==a?("remote-stream-error"===a&&s.length>0&&(a="conflict"),this._changeConnectStatus(r.Status.CONNFAIL,a)):this._changeConnectStatus(r.Status.CONNFAIL,r.ErrorCondition.UNKOWN_REASON),void this._doDisconnect(a)}var u=this;r.forEachChild(n,null,function(e){var t,n;for(n=u.handlers,u.handlers=[],t=0;t<n.length;t++){var i=n[t];try{!i.isMatch(e)||!u.authenticated&&i.user?u.handlers.push(i):i.run(e)&&u.handlers.push(i)}catch(e){r.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}}})}}},mechanisms:{},_no_auth_received:function(e){r.error("Server did not offer a supported authentication mechanism"),this._changeConnectStatus(r.Status.CONNFAIL,r.ErrorCondition.NO_AUTH_MECH),e&&e.call(this),this._doDisconnect()},_connect_cb:function(e,t,n){var i;r.info("_connect_cb was called"),this.connected=!0;try{i=this._proto._reqToData(e)}catch(e){if("badformat"!==e)throw e;this._changeConnectStatus(r.Status.CONNFAIL,r.ErrorCondition.BAD_FORMAT),this._doDisconnect(r.ErrorCondition.BAD_FORMAT)}if(i&&(this.xmlInput!==r.Connection.prototype.xmlInput&&(i.nodeName===this._proto.strip&&i.childNodes.length?this.xmlInput(i.childNodes[0]):this.xmlInput(i)),this.rawInput!==r.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(r.serialize(i))),this._proto._connect_cb(i)!==r.Status.CONNFAIL))if(i.getElementsByTagNameNS?i.getElementsByTagNameNS(r.NS.STREAM,"features").length>0:i.getElementsByTagName("stream:features").length>0||i.getElementsByTagName("features").length>0){var o,a,s=[],c=i.getElementsByTagName("mechanism");if(c.length>0)for(o=0;o<c.length;o++)a=r.getText(c[o]),this.mechanisms[a]&&s.push(this.mechanisms[a]);0!==s.length||0!==i.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(s):this._no_auth_received(t)}else this._no_auth_received(t)},sortMechanismsByPriority:function(e){var t,n,r,i;for(t=0;t<e.length-1;++t){for(r=t,n=t+1;n<e.length;++n)e[n].prototype.priority>e[r].prototype.priority&&(r=n);r!==t&&(i=e[t],e[t]=e[r],e[r]=i)}return e},_attemptSASLAuth:function(e){e=this.sortMechanismsByPriority(e||[]);var t=0,n=!1;for(t=0;t<e.length;++t)if(e[t].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new e[t],this._sasl_mechanism.onStart(this);var o=i("auth",{xmlns:r.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var a=this._sasl_mechanism.onChallenge(this,null);o.t(btoa(a))}this.send(o.tree()),n=!0;break}return n},_attemptLegacyAuth:function(){null===r.getNodeFromJid(this.jid)?(this._changeConnectStatus(r.Status.CONNFAIL,r.ErrorCondition.MISSING_JID_NODE),this.disconnect(r.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus(r.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(o({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:r.NS.AUTH}).c("username",{}).t(r.getNodeFromJid(this.jid)).tree()))},authenticate:function(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()},_sasl_challenge_cb:function(e){var t=atob(r.getText(e)),n=this._sasl_mechanism.onChallenge(this,t),o=i("response",{xmlns:r.NS.SASL});return""!==n&&o.t(btoa(n)),this.send(o.tree()),!0},_auth1_cb:function(e){var t=o({type:"set",id:"_auth_2"}).c("query",{xmlns:r.NS.AUTH}).c("username",{}).t(r.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return r.getResourceFromJid(this.jid)||(this.jid=r.getBareJidFromJid(this.jid)+"/strophe"),t.up().c("resource",{}).t(r.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1},_sasl_success_cb:function(e){if(this._sasl_data["server-signature"]){var t,n=atob(r.getText(e)).match(/([a-z]+)=([^,]+)(,|$)/);if("v"===n[1]&&(t=n[2]),t!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}r.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var i=[],o=function(e,t){for(;e.length;)this.deleteHandler(e.pop());return this._sasl_auth1_cb.bind(this)(t),!1};return i.push(this._addSysHandler(function(e){o.bind(this)(i,e)}.bind(this),null,"stream:features",null,null)),i.push(this._addSysHandler(function(e){o.bind(this)(i,e)}.bind(this),r.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(e){var t,n;for(this.features=e,t=0;t<e.childNodes.length;t++)"bind"===(n=e.childNodes[t]).nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(r.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var i=r.getResourceFromJid(this.jid);return i?this.send(o({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:r.NS.BIND}).c("resource",{}).t(i).tree()):this.send(o({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:r.NS.BIND}).tree()),!1},_sasl_bind_cb:function(e){var t;if("error"===e.getAttribute("type"))return r.info("SASL binding failed."),e.getElementsByTagName("conflict").length>0&&(t=r.ErrorCondition.CONFLICT),this._changeConnectStatus(r.Status.AUTHFAIL,t,e),!1;var n,i=e.getElementsByTagName("bind");if(!(i.length>0))return r.info("SASL binding failed."),this._changeConnectStatus(r.Status.AUTHFAIL,null,e),!1;(n=i[0].getElementsByTagName("jid")).length>0&&(this.jid=r.getText(n[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(o({type:"set",id:"_session_auth_2"}).c("session",{xmlns:r.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(r.Status.CONNECTED,null)))},_sasl_session_cb:function(e){if("result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(r.Status.CONNECTED,null);else if("error"===e.getAttribute("type"))return r.info("Session creation failed."),this._changeConnectStatus(r.Status.AUTHFAIL,null,e),!1;return!1},_sasl_failure_cb:function(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(r.Status.AUTHFAIL,null,e),!1},_auth2_cb:function(e){return"result"===e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(r.Status.CONNECTED,null)):"error"===e.getAttribute("type")&&(this._changeConnectStatus(r.Status.AUTHFAIL,null,e),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(e,t){var n=new r.TimedHandler(e,t);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(e,t,n,i,o){var a=new r.Handler(e,t,n,i,o);return a.user=!1,this.addHandlers.push(a),a},_onDisconnectTimeout:function(){return r.info("_onDisconnectTimeout was called"),this._changeConnectStatus(r.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var e,t,n;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)t=this.removeTimeds.pop(),(e=this.timedHandlers.indexOf(t))>=0&&this.timedHandlers.splice(e,1);var r=(new Date).getTime();for(n=[],e=0;e<this.timedHandlers.length;e++)t=this.timedHandlers[e],!this.authenticated&&t.user||(t.lastCalled+t.period-r<=0?t.run()&&n.push(t):n.push(t));this.timedHandlers=n,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100))}},r.SASLMechanism=function(e,t,n){this.name=e,this.isClientFirst=t,this.priority=n},r.SASLMechanism.prototype={test:function(e){return!0},onStart:function(e){this._connection=e},onChallenge:function(e,t){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},r.SASLAnonymous=function(){},r.SASLAnonymous.prototype=new r.SASLMechanism("ANONYMOUS",!1,20),r.SASLAnonymous.prototype.test=function(e){return null===e.authcid},r.SASLPlain=function(){},r.SASLPlain.prototype=new r.SASLMechanism("PLAIN",!0,50),r.SASLPlain.prototype.test=function(e){return null!==e.authcid},r.SASLPlain.prototype.onChallenge=function(e){var t=e.authzid;return t+="\0",t+=e.authcid,t+="\0",t+=e.pass,n.utf16to8(t)},r.SASLSHA1=function(){},r.SASLSHA1.prototype=new r.SASLMechanism("SCRAM-SHA-1",!0,70),r.SASLSHA1.prototype.test=function(e){return null!==e.authcid},r.SASLSHA1.prototype.onChallenge=function(r,i,o){var a=o||t.hexdigest(1234567890*Math.random()),s="n="+n.utf16to8(r.authcid);return s+=",r=",s+=a,r._sasl_data.cnonce=a,r._sasl_data["client-first-message-bare"]=s,s="n,,"+s,this.onChallenge=function(t,r){for(var i,o,a,s,c,u,l,d,f,p,h,v,m="c=biws,",g=t._sasl_data["client-first-message-bare"]+","+r+",",y=t._sasl_data.cnonce,b=/([a-z]+)=([^,]+)(,|$)/;r.match(b);){var S=r.match(b);switch(r=r.replace(S[0],""),S[1]){case"r":i=S[2];break;case"s":o=S[2];break;case"i":a=S[2]}}if(i.substr(0,y.length)!==y)return t._sasl_data={},t._sasl_failure_cb();for(g+=m+="r="+i,o=atob(o),o+="\0\0\0",f=n.utf16to8(t.pass),s=u=e.core_hmac_sha1(f,o),l=1;l<a;l++){for(c=e.core_hmac_sha1(f,e.binb2str(u)),d=0;d<5;d++)s[d]^=c[d];u=c}for(s=e.binb2str(s),p=e.core_hmac_sha1(s,"Client Key"),h=e.str_hmac_sha1(s,"Server Key"),v=e.core_hmac_sha1(e.str_sha1(e.binb2str(p)),g),t._sasl_data["server-signature"]=e.b64_hmac_sha1(h,g),d=0;d<5;d++)p[d]^=v[d];return m+=",p="+btoa(e.binb2str(p))}.bind(this),s},r.SASLMD5=function(){},r.SASLMD5.prototype=new r.SASLMechanism("DIGEST-MD5",!1,60),r.SASLMD5.prototype.test=function(e){return null!==e.authcid},r.SASLMD5.prototype._quote=function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},r.SASLMD5.prototype.onChallenge=function(e,r,i){for(var o,a=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,s=i||t.hexdigest(""+1234567890*Math.random()),c="",u=null,l="";r.match(a);)switch(o=r.match(a),r=r.replace(o[0],""),o[2]=o[2].replace(/^"(.+)"$/,"$1"),o[1]){case"realm":c=o[2];break;case"nonce":l=o[2];break;case"qop":o[2];break;case"host":u=o[2]}var d=e.servtype+"/"+e.domain;null!==u&&(d=d+"/"+u);var f=n.utf16to8(e.authcid+":"+c+":"+this._connection.pass),p=t.hash(f)+":"+l+":"+s,h="AUTHENTICATE:"+d,v="";return v+="charset=utf-8,",v+="username="+this._quote(n.utf16to8(e.authcid))+",",v+="realm="+this._quote(c)+",",v+="nonce="+this._quote(l)+",",v+="nc=00000001,",v+="cnonce="+this._quote(s)+",",v+="digest-uri="+this._quote(d)+",",v+="response="+t.hexdigest(t.hexdigest(p)+":"+l+":00000001:"+s+":auth:"+t.hexdigest(h))+",",v+="qop=auth",this.onChallenge=function(){return""},v},r.SASLOAuthBearer=function(){},r.SASLOAuthBearer.prototype=new r.SASLMechanism("OAUTHBEARER",!0,40),r.SASLOAuthBearer.prototype.test=function(e){return null!==e.pass},r.SASLOAuthBearer.prototype.onChallenge=function(e){var t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="",t+="auth=Bearer ",t+=e.pass,t+="",t+="",n.utf16to8(t)},r.SASLExternal=function(){},r.SASLExternal.prototype=new r.SASLMechanism("EXTERNAL",!0,10),r.SASLExternal.prototype.onChallenge=function(e){return e.authcid===e.authzid?"":e.authzid},r.SASLXOAuth2=function(){},r.SASLXOAuth2.prototype=new r.SASLMechanism("X-OAUTH2",!0,30),r.SASLXOAuth2.prototype.test=function(e){return null!==e.pass},r.SASLXOAuth2.prototype.onChallenge=function(e){var t="\0";return null!==e.authcid&&(t+=e.authzid),t+="\0",t+=e.pass,n.utf16to8(t)},{Strophe:r,$build:i,$iq:o,$msg:function(e){return new r.Builder("message",e)},$pres:a,SHA1:e,MD5:t,b64_hmac_sha1:e.b64_hmac_sha1,b64_sha1:e.b64_sha1,str_hmac_sha1:e.str_hmac_sha1,str_sha1:e.str_sha1}}),function(t,i){if("function"==typeof r&&r.amd)r("strophe-bosh",["strophe-core"],function(e){return i(e.Strophe,e.$build)});else{var o=n("./core");e.exports=i(o.Strophe,o.$build)}}(0,function(e,t){return e.Request=function(t,n,r,i){this.id=++e._requestId,this.xmlData=t,this.data=e.serialize(t),this.origFunc=n,this.func=n,this.rid=r,this.date=NaN,this.sends=i||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()},e.Request.prototype={getResponse:function(){var t=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if("parsererror"===(t=this.xhr.responseXML.documentElement).tagName)throw e.error("invalid response received"),e.error("responseText: "+this.xhr.responseText),e.error("responseXML: "+e.serialize(this.xhr.responseXML)),"parsererror"}else if(this.xhr.responseText){if(e.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),!(t=(new DOMParser).parseFromString(this.xhr.responseText,"application/xml").documentElement))throw new Error("Parsing produced null node");if(t.querySelector("parsererror"))throw e.error("invalid response received: "+t.querySelector("parsererror").textContent),e.error("responseText: "+this.xhr.responseText),"badformat"}return t},_newXHR:function(){var e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest).overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8"):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},e.Bosh=function(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.lastResponseHeaders=null,this._requests=[]},e.Bosh.prototype={strip:null,_buildBody:function(){var n=t("body",{rid:this.rid++,xmlns:e.NS.HTTPBIND});return null!==this.sid&&n.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),n},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(t,n,r){this.wait=t||this.wait,this.hold=n||this.hold,this.errors=0;var i=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":e.NS.BOSH});r&&i.attrs({route:r});var o=this._conn._connect_cb;this._requests.push(new e.Request(i.tree(),this._onRequestStateChange.bind(this,o.bind(this._conn)),i.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(t,n,r,i,o,a,s){this._conn.jid=t,this.sid=n,this.rid=r,this._conn.connect_callback=i,this._conn.domain=e.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=o||this.wait,this.hold=a||this.hold,this.window=s||this.window,this._conn._changeConnectStatus(e.Status.ATTACHED,null)},_restore:function(t,n,r,i,o){var a=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(null!=a&&a.rid&&a.sid&&a.jid&&(null==t||e.getBareJidFromJid(a.jid)===e.getBareJidFromJid(t)||null===e.getNodeFromJid(t)&&e.getDomainFromJid(a.jid)===t)))throw{name:"StropheSessionError",message:"_restore: no restoreable session."};this._conn.restored=!0,this._attach(a.jid,a.sid,a.rid,n,r,i,o)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(t){var n,r,i=t.getAttribute("type");if(null!==i&&"terminate"===i)return n=t.getAttribute("condition"),e.error("BOSH-Connection failed: "+n),r=t.getElementsByTagName("conflict"),null!==n?("remote-stream-error"===n&&r.length>0&&(n="conflict"),this._conn._changeConnectStatus(e.Status.CONNFAIL,n)):this._conn._changeConnectStatus(e.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(n),e.Status.CONNFAIL;this.sid||(this.sid=t.getAttribute("sid"));var o=t.getAttribute("requests");o&&(this.window=parseInt(o,10));var a=t.getAttribute("hold");a&&(this.hold=parseInt(a,10));var s=t.getAttribute("wait");s&&(this.wait=parseInt(s,10));var c=t.getAttribute("inactivity");c&&(this.inactivity=parseInt(c,10))},_disconnect:function(e){this._sendTerminate(e)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(e){var t,n=this._getRequestStatus(e);(t=this._conn.protocolErrorHandlers.HTTP[n])&&t.call(this,n)},_hitError:function(t){this.errors++,e.warn("request errored, status: "+t+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(var e;this._requests.length>0;)(e=this._requests.pop()).abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}},_onIdle:function(){var t=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===t.length&&!this._conn.disconnecting&&(e.info("no requests during idle cycle, sending blank request"),t.push(null)),!this._conn.paused){if(this._requests.length<2&&t.length>0){for(var n=this._buildBody(),r=0;r<t.length;r++)null!==t[r]&&("restart"===t[r]?n.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":e.NS.BOSH}):n.cnode(t[r]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new e.Request(n.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),n.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var i=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(e.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),i>Math.floor(e.TIMEOUT*this.wait)&&(e.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(e.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_getRequestStatus:function(t,n){var r;if(4===t.xhr.readyState)try{r=t.xhr.status}catch(t){e.error("Caught an error while retrieving a request's status, reqStatus: "+r)}return void 0===r&&(r="number"==typeof n?n:0),r},_onRequestStateChange:function(t,n){if(e.debug("request id "+n.id+"."+n.sends+" state changed to "+n.xhr.readyState),n.abort)n.abort=!1;else if(4===n.xhr.readyState){var r=this._getRequestStatus(n);if(this.lastResponseHeaders=n.xhr.getAllResponseHeaders(),this.disconnecting&&r>=400)return this._hitError(r),void this._callProtocolErrorHandlers(n);var i=r>0&&r<500,o=n.sends>this._conn.maxRetries;if((i||o)&&(this._removeRequest(n),e.debug("request id "+n.id+" should now be removed")),200===r){var a=this._requests[0]===n;(this._requests[1]===n||a&&this._requests.length>0&&this._requests[0].age()>Math.floor(e.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(n.rid)+1),e.debug("request id "+n.id+"."+n.sends+" got 200"),t(n),this.errors=0}else 0===r||r>=400&&r<600||r>=12e3?(e.error("request id "+n.id+"."+n.sends+" error "+r+" happened"),this._hitError(r),this._callProtocolErrorHandlers(n),r>=400&&r<500&&(this._conn._changeConnectStatus(e.Status.DISCONNECTING,null),this._conn._doDisconnect())):e.error("request id "+n.id+"."+n.sends+" error "+r+" happened");i||o?o&&!this._conn.connected&&this._conn._changeConnectStatus(e.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}},_processRequest:function(t){var n=this,r=this._requests[t],i=this._getRequestStatus(r,-1);if(r.sends>this._conn.maxRetries)this._conn._onDisconnectTimeout();else{var o=r.age(),a=!isNaN(o)&&o>Math.floor(e.TIMEOUT*this.wait),s=null!==r.dead&&r.timeDead()>Math.floor(e.SECONDARY_TIMEOUT*this.wait),c=4===r.xhr.readyState&&(i<1||i>=500);if((a||s||c)&&(s&&e.error("Request "+this._requests[t].id+" timed out (secondary), restarting"),r.abort=!0,r.xhr.abort(),r.xhr.onreadystatechange=function(){},this._requests[t]=new e.Request(r.xmlData,r.origFunc,r.rid,r.sends),r=this._requests[t]),0===r.xhr.readyState){e.debug("request id "+r.id+"."+r.sends+" posting");try{var u=this._conn.options.contentType||"text/xml; charset=utf-8";r.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==r.xhr.setRequestHeader&&r.xhr.setRequestHeader("Content-Type",u),this._conn.options.withCredentials&&(r.xhr.withCredentials=!0)}catch(t){return e.error("XHR open failed: "+t.toString()),this._conn.connected||this._conn._changeConnectStatus(e.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var l=function(){if(r.date=new Date,n._conn.options.customHeaders){var e=n._conn.options.customHeaders;for(var t in e)e.hasOwnProperty(t)&&r.xhr.setRequestHeader(t,e[t])}r.xhr.send(r.data)};if(r.sends>1){var d=1e3*Math.min(Math.floor(e.TIMEOUT*this.wait),Math.pow(r.sends,3));setTimeout(function(){l()},d)}else l();r.sends++,this._conn.xmlOutput!==e.Connection.prototype.xmlOutput&&(r.xmlData.nodeName===this.strip&&r.xmlData.childNodes.length?this._conn.xmlOutput(r.xmlData.childNodes[0]):this._conn.xmlOutput(r.xmlData)),this._conn.rawOutput!==e.Connection.prototype.rawOutput&&this._conn.rawOutput(r.data)}else e.debug("_processRequest: "+(0===t?"first":"second")+" request has readyState of "+r.xhr.readyState)}},_removeRequest:function(t){var n;for(e.debug("removing request"),n=this._requests.length-1;n>=0;n--)t===this._requests[n]&&this._requests.splice(n,1);t.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(e){var t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)},_reqToData:function(e){try{return e.getResponse()}catch(e){if("parsererror"!==e)throw e;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(t){e.info("_sendTerminate was called");var n=this._buildBody().attrs({type:"terminate"});t&&n.cnode(t.tree());var r=new e.Request(n.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),n.tree().getAttribute("rid"));this._requests.push(r),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?e.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):e.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},e}),function(t,i){if("function"==typeof r&&r.amd)r("strophe-websocket",["strophe-core"],function(e){return i(e.Strophe,e.$build)});else{var o=n("./core");e.exports=i(o.Strophe,o.$build)}}(0,function(e,t){return e.Websocket=function(e){this._conn=e,this.strip="wrapper";var t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){var n="";"ws"===e.options.protocol&&"https:"!==window.location.protocol?n+="ws":n+="wss",n+="://"+window.location.host,0!==t.indexOf("/")?n+=window.location.pathname+t:n+=t,e.service=n}},e.Websocket.prototype={_buildStream:function(){return t("open",{xmlns:e.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(t,n){var r;if(0===(r=t.getElementsByTagNameNS?t.getElementsByTagNameNS(e.NS.STREAM,"error"):t.getElementsByTagName("stream:error")).length)return!1;for(var i=r[0],o="",a="",s=0;s<i.childNodes.length;s++){var c=i.childNodes[s];if("urn:ietf:params:xml:ns:xmpp-streams"!==c.getAttribute("xmlns"))break;"text"===c.nodeName?a=c.textContent:o=c.nodeName}var u="WebSocket stream error: ";return u+=o||"unknown",a&&(u+=" - "+a),e.error(u),this._conn._changeConnectStatus(n,o),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(t){if(this._check_streamerror(t,e.Status.CONNFAIL))return e.Status.CONNFAIL},_handleStreamStart:function(t){var n=!1,r=t.getAttribute("xmlns");"string"!=typeof r?n="Missing xmlns in <open />":r!==e.NS.FRAMING&&(n="Wrong xmlns in <open />: "+r);var i=t.getAttribute("version");return"string"!=typeof i?n="Missing version in <open />":"1.0"!==i&&(n="Wrong version in <open />: "+i),!n||(this._conn._changeConnectStatus(e.Status.CONNFAIL,n),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(t){if(0===t.data.indexOf("<open ")||0===t.data.indexOf("<?xml")){var n=t.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===n)return;var r=(new DOMParser).parseFromString(n,"text/xml").documentElement;this._conn.xmlInput(r),this._conn.rawInput(t.data),this._handleStreamStart(r)&&this._connect_cb(r)}else if(0===t.data.indexOf("<close ")){this._conn.rawInput(t.data),this._conn.xmlInput(t);var i=t.getAttribute("see-other-uri");i?(this._conn._changeConnectStatus(e.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=i,this._connect()):(this._conn._changeConnectStatus(e.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect())}else{var o=this._streamWrap(t.data),a=(new DOMParser).parseFromString(o,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(a,null,t.data)}},_disconnect:function(n){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){n&&this._conn.send(n);var r=t("close",{xmlns:e.NS.FRAMING});this._conn.xmlOutput(r.tree());var i=e.serialize(r);this._conn.rawOutput(i);try{this.socket.send(i)}catch(t){e.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){e.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(e){return"<wrapper>"+e+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.onerror=null,this.socket.close()}catch(e){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(t){this._conn.connected&&!this._conn.disconnecting?(e.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):t&&1006===t.code&&!this._conn.connected&&this.socket?(e.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(e.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):e.info("Websocket closed")},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(t){e.error("Websocket error "+t),this._conn._changeConnectStatus(e.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var t=this._conn._data;if(t.length>0&&!this._conn.paused){for(var n=0;n<t.length;n++){var r,i;null!==t[n]&&(r="restart"===t[n]?this._buildStream().tree():t[n],i=e.serialize(r),this._conn.xmlOutput(r),this._conn.rawOutput(i),this.socket.send(i))}this._conn._data=[]}},_onMessage:function(t){var n,r,i='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(t.data===i)return this._conn.rawInput(i),this._conn.xmlInput(t),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===t.data.search("<open ")){if(n=(new DOMParser).parseFromString(t.data,"text/xml").documentElement,!this._handleStreamStart(n))return}else r=this._streamWrap(t.data),n=(new DOMParser).parseFromString(r,"text/xml").documentElement;return this._check_streamerror(n,e.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===n.firstChild.nodeName&&"unavailable"===n.firstChild.getAttribute("type")?(this._conn.xmlInput(n),void this._conn.rawInput(e.serialize(n))):void this._conn._dataRecv(n,t.data)},_onOpen:function(){e.info("Websocket open");var t=this._buildStream();this._conn.xmlOutput(t.tree());var n=e.serialize(t);this._conn.rawOutput(n),this.socket.send(n)},_reqToData:function(e){return e},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}},e}),function(t){if("function"==typeof r&&r.amd)r("strophe",["strophe-core","strophe-bosh","strophe-websocket"],function(e){return e});else{var i=n("./core");n("./bosh"),n("./websocket"),e.exports=i}}(),n(["strophe-polyfill"]),n("strophe")})?r.apply(t,i):r)||(e.exports=o)},function(e,t,n){"use strict";n.r(t),n.d(t,"AUTH_STATUS_CHANGED",function(){return r}),n.d(t,"AVATAR_CHANGED",function(){return i}),n.d(t,"BEFORE_STATISTICS_DISPOSED",function(){return o}),n.d(t,"CONFERENCE_ERROR",function(){return a}),n.d(t,"CONFERENCE_FAILED",function(){return s}),n.d(t,"CONFERENCE_JOINED",function(){return c}),n.d(t,"CONFERENCE_LEFT",function(){return u}),n.d(t,"CONNECTION_ESTABLISHED",function(){return l}),n.d(t,"CONNECTION_INTERRUPTED",function(){return d}),n.d(t,"CONNECTION_RESTORED",function(){return f}),n.d(t,"DATA_CHANNEL_OPENED",function(){return p}),n.d(t,"DISPLAY_NAME_CHANGED",function(){return h}),n.d(t,"DOMINANT_SPEAKER_CHANGED",function(){return v}),n.d(t,"DTMF_SUPPORT_CHANGED",function(){return m}),n.d(t,"ENDPOINT_MESSAGE_RECEIVED",function(){return g}),n.d(t,"JVB121_STATUS",function(){return y}),n.d(t,"KICKED",function(){return b}),n.d(t,"LAST_N_ENDPOINTS_CHANGED",function(){return S}),n.d(t,"LOCK_STATE_CHANGED",function(){return _}),n.d(t,"SERVER_REGION_CHANGED",function(){return E}),n.d(t,"MESSAGE_RECEIVED",function(){return C}),n.d(t,"PRIVATE_MESSAGE_RECEIVED",function(){return T}),n.d(t,"PARTICIPANT_CONN_STATUS_CHANGED",function(){return w}),n.d(t,"PARTCIPANT_FEATURES_CHANGED",function(){return k}),n.d(t,"PARTICIPANT_PROPERTY_CHANGED",function(){return R}),n.d(t,"P2P_STATUS",function(){return P}),n.d(t,"PHONE_NUMBER_CHANGED",function(){return I}),n.d(t,"PROPERTIES_CHANGED",function(){return O}),n.d(t,"RECORDER_STATE_CHANGED",function(){return A}),n.d(t,"VIDEO_SIP_GW_AVAILABILITY_CHANGED",function(){return M}),n.d(t,"VIDEO_SIP_GW_SESSION_STATE_CHANGED",function(){return D}),n.d(t,"START_MUTED_POLICY_CHANGED",function(){return N}),n.d(t,"STARTED_MUTED",function(){return x}),n.d(t,"SUBJECT_CHANGED",function(){return L}),n.d(t,"SUSPEND_DETECTED",function(){return j}),n.d(t,"TALK_WHILE_MUTED",function(){return F}),n.d(t,"TRACK_ADDED",function(){return U}),n.d(t,"TRACK_AUDIO_LEVEL_CHANGED",function(){return H}),n.d(t,"TRACK_MUTE_CHANGED",function(){return B}),n.d(t,"TRACK_REMOVED",function(){return G}),n.d(t,"TRANSCRIPTION_STATUS_CHANGED",function(){return J}),n.d(t,"USER_JOINED",function(){return V}),n.d(t,"USER_LEFT",function(){return W}),n.d(t,"USER_ROLE_CHANGED",function(){return q}),n.d(t,"USER_STATUS_CHANGED",function(){return K}),n.d(t,"BOT_TYPE_CHANGED",function(){return z});var r="conference.auth_status_changed",i="conference.avatarChanged",o="conference.beforeStatisticsDisposed",a="conference.error",s="conference.failed",c="conference.joined",u="conference.left",l="conference.connectionEstablished",d="conference.connectionInterrupted",f="conference.connectionRestored",p="conference.dataChannelOpened",h="conference.displayNameChanged",v="conference.dominantSpeaker",m="conference.dtmfSupportChanged",g="conference.endpoint_message_received",y="conference.jvb121Status",b="conference.kicked",S="conference.lastNEndpointsChanged",_="conference.lock_state_changed",E="conference.server_region_changed",C="conference.messageReceived",T="conference.privateMessageReceived",w="conference.participant_conn_status_changed",k="conference.partcipant_features_changed",R="conference.participant_property_changed",P="conference.p2pStatus",I="conference.phoneNumberChanged",O="conference.propertiesChanged",A="conference.recorderStateChanged",M="conference.videoSIPGWAvailabilityChanged",D="conference.videoSIPGWSessionStateChanged",N="conference.start_muted_policy_changed",x="conference.started_muted",L="conference.subjectChanged",j="conference.suspendDetected",F="conference.talk_while_muted",U="conference.trackAdded",H="conference.audioLevelsChanged",B="conference.trackMuteChanged",G="conference.trackRemoved",J="conference.transcriptionStatusChanged",V="conference.userJoined",W="conference.userLeft",q="conference.roleChanged",K="conference.statusChanged",z="conference.bot_type_changed"},function(e,t,n){"use strict";var r=n(74);t.a=new r.a},function(e,t,n){var r=n(63),i=n(118),o={},a=[],s=r.levels.TRACE;e.exports={addGlobalTransport:function(e){r.addGlobalTransport(e)},removeGlobalTransport:function(e){r.removeGlobalTransport(e)},getLogger:function(e,t,n){var i=new r(s,e,t,n);return e?(o[e]=o[e]||[],o[e].push(i)):a.push(i),i},setLogLevelById:function(e,t){for(var n=t?o[t]||[]:a,r=0;r<n.length;r++)n[r].setLevel(e)},setLogLevel:function(e){s=e;for(var t=0;t<a.length;t++)a[t].setLevel(e);for(var n in o){var r=o[n]||[];for(t=0;t<r.length;t++)r[t].setLevel(e)}},levels:r.levels,LogCollector:i}},function(e,t,n){"use strict";(function(e){var r=n(4),i=n(36),o=n.n(i),a=n(3);function s(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var c=Object(r.getLogger)(e),u={filterSpecialChars:function(e){return e?e.replace(/[\\\/\{,\}\+]/g,""):e},iceparams:function(e,t){var n,r,i=null;return(r=u.findLine(e,"a=ice-ufrag:",t))&&(n=u.findLine(e,"a=ice-pwd:",t))&&(i={ufrag:u.parseICEUfrag(r),pwd:u.parseICEPwd(n)}),i},parseICEUfrag:function(e){return e.substring(12)},buildICEUfrag:function(e){return"a=ice-ufrag:".concat(e)},parseICEPwd:function(e){return e.substring(10)},buildICEPwd:function(e){return"a=ice-pwd:".concat(e)},parseMID:function(e){return e.substring(6)},parseMLine:function(e){var t={},n=e.substring(2).split(" ");return t.media=n.shift(),t.port=n.shift(),t.proto=n.shift(),""===n[n.length-1]&&n.pop(),t.fmt=n,t},buildMLine:function(e){return"m=".concat(e.media," ").concat(e.port," ").concat(e.proto," ").concat(e.fmt.join(" "))},parseRTPMap:function(e){var t={},n=e.substring(9).split(" ");return t.id=n.shift(),n=n[0].split("/"),t.name=n.shift(),t.clockrate=n.shift(),t.channels=n.length?n.shift():"1",t},parseSCTPMap:function(e){var t=e.substring(10).split(" ");return[t[0],t[1],t.length>2?t[2]:null]},buildRTPMap:function(e){var t="a=rtpmap:".concat(e.getAttribute("id")," ").concat(e.getAttribute("name"),"/").concat(e.getAttribute("clockrate"));return e.getAttribute("channels")&&"1"!==e.getAttribute("channels")&&(t+="/".concat(e.getAttribute("channels"))),t},parseCrypto:function(e){var t={},n=e.substring(9).split(" ");return t.tag=n.shift(),t["crypto-suite"]=n.shift(),t["key-params"]=n.shift(),n.length&&(t["session-params"]=n.join(" ")),t},parseFingerprint:function(e){var t={},n=e.substring(14).split(" ");return t.hash=n.shift(),t.fingerprint=n.shift(),t},parseFmtp:function(e){var t=[],n=e.split(" ");n.shift(),n=n.join(" ").split(";");for(var r=0;r<n.length;r++){for(var i=n[r].split("=")[0];i.length&&" "===i[0];)i=i.substring(1);var o=n[r].split("=")[1];i&&o?t.push({name:i,value:o}):i&&t.push({name:"",value:i})}return t},parseICECandidate:function(e){var t={},n=e.split(" ");t.foundation=n[0].substring(12),t.component=n[1],t.protocol=n[2].toLowerCase(),t.priority=n[3],t.ip=n[4],t.port=n[5],t.type=n[7],t.generation=0;for(var r=8;r<n.length;r+=2)switch(n[r]){case"raddr":t["rel-addr"]=n[r+1];break;case"rport":t["rel-port"]=n[r+1];break;case"generation":t.generation=n[r+1];break;case"tcptype":t.tcptype=n[r+1];break;default:c.log('parseICECandidate not translating "'.concat(n[r],'" = "').concat(n[r+1],'"'))}return t.network="1",t.id=Math.random().toString(36).substr(2,10),t},buildICECandidate:function(e){var t=["a=candidate:".concat(e.foundation),e.component,e.protocol,e.priority,e.ip,e.port,"typ",e.type].join(" ");switch(t+=" ",e.type){case"srflx":case"prflx":case"relay":e.hasOwnAttribute("rel-addr")&&e.hasOwnAttribute("rel-port")&&(t+="raddr",t+=" ",t+=e["rel-addr"],t+=" ",t+="rport",t+=" ",t+=e["rel-port"],t+=" ")}return e.hasOwnAttribute("tcptype")&&(t+="tcptype",t+=" ",t+=e.tcptype,t+=" "),t+="generation",t+=" ",t+=e.hasOwnAttribute("generation")?e.generation:"0"},parseSSRC:function(e){for(var t=new Map,n=e.split("\r\n"),r=0;r<n.length;r++)if("a=ssrc:"===n[r].substring(0,7)){var i=n[r].split("a=ssrc:")[1].split(" ")[0];t.get(i)||t.set(i,[]),t.get(i).push(n[r])}return t},parseRTCPFB:function(e){var t=e.substr(10).split(" "),n={};return n.pt=t.shift(),n.type=t.shift(),n.params=t,n},parseExtmap:function(e){var t=e.substr(9).split(" "),n={};return n.value=t.shift(),-1===n.value.indexOf("/")?n.direction="both":(n.direction=n.value.substr(n.value.indexOf("/")+1),n.value=n.value.substr(0,n.value.indexOf("/"))),n.uri=t.shift(),n.params=t,n},findLine:function(e,t,n){for(var r=e.split("\r\n"),i=0;i<r.length;i++)if(r[i].substring(0,t.length)===t)return r[i];if(!n)return!1;r=n.split("\r\n");for(var o=0;o<r.length;o++)if(r[o].substring(0,t.length)===t)return r[o];return!1},findLines:function(e,t,n){for(var r=e.split("\r\n"),i=[],o=0;o<r.length;o++)r[o].substring(0,t.length)===t&&i.push(r[o]);if(i.length||!n)return i;r=n.split("\r\n");for(var a=0;a<r.length;a++)r[a].substring(0,t.length)===t&&i.push(r[a]);return i},candidateToJingle:function(e){if(0===e.indexOf("candidate:"))e="a=".concat(e);else if("a=candidate:"!==e.substring(0,12))return c.log("parseCandidate called with a line that is not a candidate line"),c.log(e),null;"\r\n"===e.substring(e.length-2)&&(e=e.substring(0,e.length-2));var t={},n=e.split(" ");if("typ"!==n[6])return c.log("did not find typ in the right place"),c.log(e),null;t.foundation=n[0].substring(12),t.component=n[1],t.protocol=n[2].toLowerCase(),t.priority=n[3],t.ip=n[4],t.port=n[5],t.type=n[7],t.generation="0";for(var r=8;r<n.length;r+=2)switch(n[r]){case"raddr":t["rel-addr"]=n[r+1];break;case"rport":t["rel-port"]=n[r+1];break;case"generation":t.generation=n[r+1];break;case"tcptype":t.tcptype=n[r+1];break;default:c.log('not translating "'.concat(n[r],'" = "').concat(n[r+1],'"'))}return t.network="1",t.id=Math.random().toString(36).substr(2,10),t},candidateFromJingle:function(e){var t="a=candidate:";t+=e.getAttribute("foundation"),t+=" ",t+=e.getAttribute("component"),t+=" ";var n=e.getAttribute("protocol");switch(a.a.isFirefox()&&"ssltcp"===n.toLowerCase()&&(n="tcp"),t+=n,t+=" ",t+=e.getAttribute("priority"),t+=" ",t+=e.getAttribute("ip"),t+=" ",t+=e.getAttribute("port"),t+=" ",t+="typ",t+=" ".concat(e.getAttribute("type")),t+=" ",e.getAttribute("type")){case"srflx":case"prflx":case"relay":e.getAttribute("rel-addr")&&e.getAttribute("rel-port")&&(t+="raddr",t+=" ",t+=e.getAttribute("rel-addr"),t+=" ",t+="rport",t+=" ",t+=e.getAttribute("rel-port"),t+=" ")}return"tcp"===n.toLowerCase()&&(t+="tcptype",t+=" ",t+=e.getAttribute("tcptype"),t+=" "),t+="generation",t+=" ",t+=e.getAttribute("generation")||"0","".concat(t,"\r\n")},parsePrimaryVideoSsrc:function(e){var t=e.ssrcs.map(function(e){return e.id}).filter(function(e,t,n){return n.indexOf(e)===t}).length,n=e.ssrcGroups&&e.ssrcGroups.length||0;if(!(t>1&&0===n)){var r=null;if(1===t)r=e.ssrcs[0].id;else if(2===t){var i=e.ssrcGroups.find(function(e){return"FID"===e.semantics});i&&(r=i.ssrcs.split(" ")[0])}else if(t>=3){var o=e.ssrcGroups.find(function(e){return"SIM"===e.semantics});o&&(r=o.ssrcs.split(" ")[0])}return r}},generateSsrc:function(){return o.a.randomInt(1,4294967295)},getSsrcAttribute:function(e,t,n){for(var r=0;r<e.ssrcs.length;++r){var i=e.ssrcs[r];if(i.id===t&&i.attribute===n)return i.value}},parseGroupSsrcs:function(e){return e.ssrcs.split(" ").map(function(e){return parseInt(e,10)})},getMedia:function(e,t){return e.media.find(function(e){return e.type===t})},getUfrag:function(e){var t=e.split("\n").filter(function(e){return e.startsWith("a=ice-ufrag:")});if(t.length>0)return t[0].substr("a=ice-ufrag:".length)},preferVideoCodec:function(e,t){var n=null;if(e&&t){for(var r=0;r<e.rtp.length;++r){var i=e.rtp[r];if(i.codec&&i.codec.toLowerCase()===t.toLowerCase()){n=i.payload;break}}if(n){var o=e.payloads.toString().split(" ").map(function(e){return parseInt(e,10)}),a=o.indexOf(n);o.splice(a,1),o.unshift(n),e.payloads=o.join(" ")}}},stripVideoCodec:function(e,t){if(e&&t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,c=e.rtp[Symbol.iterator]();!(r=(a=c.next()).done);r=!0){var u=a.value;u.codec&&u.codec.toLowerCase()===t.toLowerCase()&&n.push(u.payload)}}catch(e){i=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(i)throw o}}if(n.length>0){var l=n.map(function(e){return"apt=".concat(e)}),d=e.fmtp.filter(function(e){return-1!==l.indexOf(e.config)});n.push.apply(n,s(d.map(function(e){return e.payload})));var f=e.payloads.toString().split(" ").map(Number).filter(function(e){return-1===n.indexOf(e)});0===f.length?(e.port=0,e.direction="inactive",e.payloads="*"):e.payloads=f.join(" "),e.rtp=e.rtp.filter(function(e){return-1!==f.indexOf(e.payload)}),e.fmtp=e.fmtp.filter(function(e){return-1!==f.indexOf(e.payload)}),e.rtcpFb&&(e.rtcpFb=e.rtcpFb.filter(function(e){return-1!==f.indexOf(e.payload)}))}}}};t.a=u}).call(this,"modules/xmpp/SDPUtil.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return _});var r=n(29),i=n.n(r),o=n(7),a=n(73),s=n(32),c=n(51),u=n(77),l=n(3),d=n(25),f=n(52),p=n.n(f),h=n(15),v=n(23);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var g,y=n(4).getLogger(e),b=!1;function S(e){if(!s.a.isBackendInitialized()){var t=d.a.callStatsUserName;s.a.initBackend({callStatsID:e.callStatsID,callStatsSecret:e.callStatsSecret,userName:e.swapUserNameAndAlias?e.callStatsAliasName:t,aliasName:e.swapUserNameAndAlias?t:e.callStatsAliasName,applicationName:e.applicationName,getWiFiStatsMethod:e.getWiFiStatsMethod})||y.error("CallStats Backend initialization failed bad")}}function _(e,t){this.rtpStatsMap=new Map,this.eventEmitter=new i.a,this.xmpp=e,this.options=t||{},this.callStatsIntegrationEnabled=this.options.callStatsID&&this.options.callStatsSecret&&!0!==_.disableThirdPartyRequests,this.callStatsIntegrationEnabled&&(l.a.isReactNative()?S(this.options):function(e){b||(p.a.loadScript(e.customScriptUrl||"https://api.callstats.io/static/callstats-ws.min.js",!0,!0,void 0,function(){return S(e)}),b=!0)}(this.options),this.options.callStatsConfIDNamespace||y.warn('"callStatsConfIDNamespace" is not defined')),this.callsStatsInstances=new Map,_.instances.add(this)}_.init=function(e){_.audioLevelsEnabled=!e.disableAudioLevels,"number"==typeof e.audioLevelsInterval&&(_.audioLevelsInterval=e.audioLevelsInterval),_.disableThirdPartyRequests=e.disableThirdPartyRequests},_.audioLevelsEnabled=!1,_.audioLevelsInterval=200,_.disableThirdPartyRequests=!1,_.analytics=a.a,Object.defineProperty(_,"instances",{get:function(){return g||(g=new Set),g}}),_.prototype.startRemoteStats=function(e){this.stopRemoteStats(e);try{var t=new u.a(e,_.audioLevelsInterval,2e3,this.eventEmitter);t.start(_.audioLevelsEnabled),this.rtpStatsMap.set(e.id,t)}catch(e){y.error("Failed to start collecting remote statistics: ".concat(e))}},_.localStats=[],_.startLocalStats=function(e,t){if(_.audioLevelsEnabled){var n=new c.a(e,_.audioLevelsInterval,t);this.localStats.push(n),n.start()}},_.prototype.addAudioLevelListener=function(e){_.audioLevelsEnabled&&this.eventEmitter.on(v.a,e)},_.prototype.removeAudioLevelListener=function(e){_.audioLevelsEnabled&&this.eventEmitter.removeListener(v.a,e)},_.prototype.addBeforeDisposedListener=function(e){this.eventEmitter.on(v.b,e)},_.prototype.removeBeforeDisposedListener=function(e){this.eventEmitter.removeListener(v.b,e)},_.prototype.addConnectionStatsListener=function(e){this.eventEmitter.on(v.d,e)},_.prototype.removeConnectionStatsListener=function(e){this.eventEmitter.removeListener(v.d,e)},_.prototype.addByteSentStatsListener=function(e){this.eventEmitter.on(v.c,e)},_.prototype.removeByteSentStatsListener=function(e){this.eventEmitter.removeListener(v.c,e)},_.prototype.dispose=function(){try{this.callsStatsInstances.size||this.eventEmitter.emit(v.b);var e=!0,t=!1,n=void 0;try{for(var r,i=this.callsStatsInstances.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;this.stopCallStats(o.tpc)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}var a=!0,s=!1,c=void 0;try{for(var u,l=this.rtpStatsMap.keys()[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var d=u.value;this._stopRemoteStats(d)}}catch(e){s=!0,c=e}finally{try{a||null==l.return||l.return()}finally{if(s)throw c}}this.eventEmitter&&this.eventEmitter.removeAllListeners()}finally{_.instances.delete(this)}},_.stopLocalStats=function(e){if(_.audioLevelsEnabled)for(var t=0;t<_.localStats.length;t++)if(_.localStats[t].stream===e){_.localStats.splice(t,1)[0].stop();break}},_.prototype._stopRemoteStats=function(e){var t=this.rtpStatsMap.get(e);t&&(t.stop(),this.rtpStatsMap.delete(e))},_.prototype.stopRemoteStats=function(e){this._stopRemoteStats(e.id)},_.prototype.startCallStats=function(e,t){if(this.callStatsIntegrationEnabled)if(this.callsStatsInstances.has(e.id))y.error("CallStats instance for ${tpc} exists already");else{y.info("Starting CallStats for ".concat(e,"..."));var n=new s.a(e,{confID:this._getCallStatsConfID(),remoteUserID:t});this.callsStatsInstances.set(e.id,n)}},_._getAllCallStatsInstances=function(){var e=new Set,t=!0,n=!1,r=void 0;try{for(var i,o=_.instances[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value,s=!0,c=!1,u=void 0;try{for(var l,d=a.callsStatsInstances.values()[Symbol.iterator]();!(s=(l=d.next()).done);s=!0){var f=l.value;e.add(f)}}catch(e){c=!0,u=e}finally{try{s||null==d.return||d.return()}finally{if(c)throw u}}}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}return e},_.prototype._getCallStatsConfID=function(){return this.options.callStatsConfIDNamespace?"".concat(this.options.callStatsConfIDNamespace,"/").concat(this.options.roomName):this.options.roomName},_.prototype.stopCallStats=function(e){var t=this.callsStatsInstances.get(e.id);t&&(1===this.callsStatsInstances.size&&this.eventEmitter.emit(v.b),this.callsStatsInstances.delete(e.id),t.sendTerminateEvent())},_.prototype.isCallstatsEnabled=function(){return this.callStatsIntegrationEnabled},_.prototype.sendConnectionResumeOrHoldEvent=function(e,t){var n=this.callsStatsInstances.get(e.id);n&&n.sendResumeOrHoldEvent(t)},_.prototype.sendIceConnectionFailedEvent=function(e){var t=this.callsStatsInstances.get(e.id);t&&t.sendIceConnectionFailedEvent()},_.prototype.sendMuteEvent=function(e,t,n){var r=e&&this.callsStatsInstances.get(e.id);s.a.sendMuteEvent(t,n,r)},_.prototype.sendScreenSharingEvent=function(e,t){var n=!0,r=!1,i=void 0;try{for(var o,a=this.callsStatsInstances.values()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){o.value.sendScreenSharingEvent(e,t)}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}},_.prototype.sendDominantSpeakerEvent=function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=this.callsStatsInstances.values()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){i.value.sendDominantSpeakerEvent()}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}this.xmpp.sendDominantSpeakerEvent(e)},_.sendActiveDeviceListEvent=function(e){var t=_._getAllCallStatsInstances();if(t.size){var n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var c=o.value;s.a.sendActiveDeviceListEvent(e,c)}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}}else s.a.sendActiveDeviceListEvent(e,null)},_.prototype.associateStreamWithVideoTag=function(e,t,n,r,i,o){var a=this.callsStatsInstances.get(e.id);a&&a.associateStreamWithVideoTag(t,n,r,i,o)},_.sendGetUserMediaFailed=function(e){var t=e instanceof h.a?function(e){var t=new Error;return t.stack=e.stack,t.name=(e.name||"Unknown error")+(e.gum&&e.gum.error&&e.gum.error.name?" - ".concat(e.gum.error.name):""),t.constraintName=e.gum&&e.gum.constraints?JSON.stringify(e.gum.constraints):"",t.message=e.message,t}(e):e,n=_._getAllCallStatsInstances();if(n.size){var r=!0,i=!1,o=void 0;try{for(var a,c=n[Symbol.iterator]();!(r=(a=c.next()).done);r=!0){var u=a.value;s.a.sendGetUserMediaFailed(t,u)}}catch(e){i=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(i)throw o}}}else s.a.sendGetUserMediaFailed(t,null)},_.prototype.sendCreateOfferFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendCreateOfferFailed(e)},_.prototype.sendCreateAnswerFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendCreateAnswerFailed(e)},_.prototype.sendSetLocalDescFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendSetLocalDescFailed(e)},_.prototype.sendSetRemoteDescFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendSetRemoteDescFailed(e)},_.prototype.sendAddIceCandidateFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendAddIceCandidateFailed(e)},_.sendLog=function(e){var t=new Set,n=!0,r=!1,i=void 0;try{for(var o,a=_.instances[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var c=o.value;c.callsStatsInstances.size&&t.add(c.callsStatsInstances.values().next().value)}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}if(t.size){var u=!0,l=!1,d=void 0;try{for(var f,p=t[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){var h=f.value;s.a.sendApplicationLog(e,h)}}catch(e){l=!0,d=e}finally{try{u||null==p.return||p.return()}finally{if(l)throw d}}}else s.a.sendApplicationLog(e,null)},_.prototype.sendFeedback=function(e,t){s.a.sendFeedback(this._getCallStatsConfID(),e,t),_.analytics.sendEvent(o.m,{rating:e,comment:t})},_.LOCAL_JID=n(124).LOCAL_JID,_.reportGlobalError=function(e){e instanceof h.a&&e.gum?_.sendGetUserMediaFailed(e):_.sendLog(e)},_.sendAnalyticsAndLog=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e?(t="object"===m(e)?e:{name:e,properties:n},y.log(JSON.stringify(t)),this.analytics.sendEvent(e,n)):y.warn("No event or event name given.")},_.sendAnalytics=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.analytics.sendEvent(e,t)}}).call(this,"modules/statistics/statistics.js")},function(e,t,n){"use strict";function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){i(e,t,n[t])})}return e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"r",function(){return o}),n.d(t,"s",function(){return a}),n.d(t,"t",function(){return s}),n.d(t,"u",function(){return c}),n.d(t,"a",function(){return u}),n.d(t,"b",function(){return l}),n.d(t,"c",function(){return d}),n.d(t,"d",function(){return f}),n.d(t,"e",function(){return p}),n.d(t,"f",function(){return h}),n.d(t,"g",function(){return v}),n.d(t,"h",function(){return m}),n.d(t,"i",function(){return g}),n.d(t,"j",function(){return y}),n.d(t,"k",function(){return b}),n.d(t,"l",function(){return S}),n.d(t,"m",function(){return _}),n.d(t,"n",function(){return E}),n.d(t,"o",function(){return C}),n.d(t,"p",function(){return T}),n.d(t,"q",function(){return w}),n.d(t,"v",function(){return k}),n.d(t,"w",function(){return R}),n.d(t,"x",function(){return P}),n.d(t,"y",function(){return I}),n.d(t,"z",function(){return O}),n.d(t,"A",function(){return A}),n.d(t,"B",function(){return M}),n.d(t,"C",function(){return D}),n.d(t,"D",function(){return N}),n.d(t,"E",function(){return x}),n.d(t,"F",function(){return L}),n.d(t,"G",function(){return j}),n.d(t,"H",function(){return F});var o="operational",a="page",s="track",c="ui",u="restart",l="session-accept.timeout",d="session-initiate.received",f="session-initiate.timeout",p="terminate",h="transport-replace.received",v="transport-replace.success",m="established",g="failed",y="switch.to.jvb",b="available.device",S="connection.disconnected",_="feedback",E="ice.duration",C="ice.establishment.duration.diff",T="ice.state.changed",w="track.unmuted",k=function(){return{action:"bridge.down",actionSubject:"bridge.down",type:o}},R=function(e,t,n){return{type:o,action:"connection.failed",attributes:r({error_type:e,error_message:t},n)}},P=function(e,t){var n="connection.stage.reached";return{action:n,actionSubject:e,attributes:t,source:n,type:o}},I=function(e,t,n){return{attributes:{participant_id:e,region:t,rtt:n},name:"e2e_rtt",type:o}},O=function(){return{action:"focus.left",actionSubject:"focus.left",type:o}},A=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{type:o,source:"get.user.media",action:e,attributes:t}},M=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{type:o,action:e,source:"jingle",attributes:t}},D=function(e){return{attributes:{media_type:e},action:"track.no.data.from.source",type:o}},N=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{type:o,action:e,source:"p2p",attributes:t}},x=function(){return{type:o,action:"remotely.muted"}},L=function(e){return{type:o,action:"rtp.stats",attributes:e}},j=function(e){return{type:o,action:"rtt.by.region",attributes:e}},F=function(e){return P("ttfm",e)}},function(e,t){e.exports={CREATE_ANSWER_FAILED:"rtc.create_answer_failed",CREATE_OFFER_FAILED:"rtc.create_offer_failed",DATA_CHANNEL_OPEN:"rtc.data_channel_open",ENDPOINT_CONN_STATUS_CHANGED:"rtc.endpoint_conn_status_changed",DOMINANT_SPEAKER_CHANGED:"rtc.dominant_speaker_changed",LASTN_ENDPOINT_CHANGED:"rtc.lastn_endpoint_changed",GRANTED_PERMISSIONS:"rtc.granted_permissions",IS_SELECTED_CHANGED:"rtc.is_selected_change",LASTN_VALUE_CHANGED:"rtc.lastn_value_changed",LOCAL_TRACK_SSRC_UPDATED:"rtc.local_track_ssrc_updated",TRACK_ATTACHED:"rtc.track_attached",REMOTE_TRACK_ADDED:"rtc.remote_track_added",REMOTE_TRACK_MUTE:"rtc.remote_track_mute",REMOTE_TRACK_REMOVED:"rtc.remote_track_removed",REMOTE_TRACK_UNMUTE:"rtc.remote_track_unmute",SET_LOCAL_DESCRIPTION_FAILED:"rtc.set_local_description_failed",SET_REMOTE_DESCRIPTION_FAILED:"rtc.set_remote_description_failed",AUDIO_OUTPUT_DEVICE_CHANGED:"rtc.audio_output_device_changed",DEVICE_LIST_CHANGED:"rtc.device_list_changed",DEVICE_LIST_AVAILABLE:"rtc.device_list_available",ENDPOINT_MESSAGE_RECEIVED:"rtc.endpoint_message_received",LOCAL_UFRAG_CHANGED:"rtc.local_ufrag_changed",REMOTE_UFRAG_CHANGED:"rtc.remote_ufrag_changed"}},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i});var r="audio",i="video"},function(e,t){var n=[],r=window.onerror;var i=window.onunhandledrejection;window.onerror=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.forEach(function(e){return e.apply(void 0,t)}),r&&r.apply(void 0,t)},window.onunhandledrejection=function(e){n.forEach(function(t){return t(null,null,null,null,e.reason)}),i&&i(e)};var o={addHandler:function(e){n.push(e)},callErrorHandler:function(e){var t=window.onerror;t&&t(null,null,null,null,e)},callUnhandledRejectionHandler:function(e){var t=window.onunhandledrejection;t&&t(e)}};e.exports=o},function(e,t,n){"use strict";(function(e){var r=n(7),i=n(41),o=n.n(i),a=n(29),s=n.n(a),c=n(4),u=n(10),l=n.n(u),d=n(15),f=n(24),p=n(9),h=n(30),v=n.n(h),m=n(3),g=n(8),y=n.n(g),b=n(97),S=n(39),_=n(5),E=n(6),C=n(14),T=n.n(C);function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function R(e,t){return!t||"object"!==w(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function I(e,t){return(I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){A(e,t,n[t])})}return e}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var M=Object(c.getLogger)(e);m.a.usesAdapter()&&n(132);var D,N,x=new s.a,L=["audio","video"],j={video:{aspectRatio:16/9,height:{ideal:720,max:720,min:240}}},F=5,U="default",H=!1,B=!1,G=!1,J=!1,V=!1,W=!1,q=document.createElement("audio"),K=void 0!==q.setSinkId;function z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={audio:!1,video:!1},r=m.a.isFirefox()||m.a.isEdge()||m.a.isReactNative();if(e.indexOf("video")>=0){if(n.video={mandatory:{},optional:[]},t.cameraDeviceId)r&&(n.video.deviceId=t.cameraDeviceId),n.video.mandatory.sourceId=t.cameraDeviceId;else{var i=t.facingMode||o.a.USER;r&&(n.video.facingMode=i),n.video.optional.push({facingMode:i})}(t.minFps||t.maxFps||t.fps)&&((t.minFps||t.fps)&&(t.minFps=t.minFps||t.fps,n.video.mandatory.minFrameRate=t.minFps),t.maxFps&&(n.video.mandatory.maxFrameRate=t.maxFps)),function(e,t,n){v.a[n]&&(t&&(e.video.width={ideal:v.a[n].width},e.video.height={ideal:v.a[n].height}),e.video.mandatory.minWidth=v.a[n].width,e.video.mandatory.minHeight=v.a[n].height),e.video.mandatory.minWidth&&(e.video.mandatory.maxWidth=e.video.mandatory.minWidth),e.video.mandatory.minHeight&&(e.video.mandatory.maxHeight=e.video.mandatory.minHeight)}(n,r,t.resolution)}if(e.indexOf("audio")>=0&&(m.a.isReactNative()?n.audio=!0:m.a.isFirefox()?t.micDeviceId?n.audio={mandatory:{},deviceId:t.micDeviceId,optional:[{sourceId:t.micDeviceId}]}:n.audio=!0:(n.audio={mandatory:{},optional:[]},t.micDeviceId&&(r&&(n.audio.deviceId=t.micDeviceId),n.audio.optional.push({sourceId:t.micDeviceId})),n.audio.optional.push({echoCancellation:!G&&!B},{googEchoCancellation:!G&&!B},{googAutoGainControl:!V&&!B},{googNoiseSuppression:!J&&!B},{googHighpassFilter:!W&&!B},{googNoiseSuppression2:!J&&!B},{googEchoCancellation2:!G&&!B},{googAutoGainControl2:!V&&!B}))),e.indexOf("screen")>=0)if(m.a.isChrome())n.video={mandatory:$(O({},t,{source:"screen"})),optional:[]};else if(m.a.isFirefox())n.video={mozMediaSource:"window",mediaSource:"window",frameRate:t.frameRate||{min:F,max:F}};else{var a="'screen' WebRTC media source is supported only in Chrome and Firefox";l.a.callErrorHandler(new Error(a)),M.error(a)}return e.indexOf("desktop")>=0&&(n.video={mandatory:$(O({},t,{source:"desktop"})),optional:[]}),t.bandwidth&&(n.video||(n.video={mandatory:{},optional:[]}),n.video.optional.push({bandwidth:t.bandwidth})),m.a.isFirefox()&&t.firefox_fake_device&&(n.fake=!0),n}function Q(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=JSON.parse(JSON.stringify(t.constraints||j));if(e.indexOf("video")>=0)if(n.video||(n.video={}),t.cameraDeviceId)n.video.deviceId=t.cameraDeviceId;else{var r=t.facingMode||o.a.USER;n.video.facingMode=r}else n.video=!1;return e.indexOf("audio")>=0?(n.audio&&"boolean"!=typeof n.audio||(n.audio={}),n.audio.optional||(n.audio.optional=[]),n.audio.optional.push({sourceId:t.micDeviceId},{echoCancellation:!G&&!B},{googEchoCancellation:!G&&!B},{googAutoGainControl:!V&&!B},{googNoiseSuppression:!J&&!B},{googHighpassFilter:!W&&!B},{googNoiseSuppression2:!J&&!B},{googEchoCancellation2:!G&&!B},{googAutoGainControl2:!V&&!B})):n.audio=!1,e.indexOf("desktop")>=0&&(n.video&&"boolean"!=typeof n.video||(n.video={}),n.video={mandatory:$(O({},t,{source:"desktop"}))}),n}function $(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.desktopStream,n=e.frameRate,r=void 0===n?{min:F,max:F}:n,i=r.max,o=r.min,a={chromeMediaSource:e.source,maxWidth:window.screen.width,maxHeight:window.screen.height};return"number"==typeof o&&(a.minFrameRate=o),"number"==typeof i&&(a.maxFrameRate=i),void 0!==t&&(a.chromeMediaSourceId=t),a}function X(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={frameRate:F},n=e.desktopSharingFrameRate;return n&&n.max&&(t.frameRate=n.max),t}function Y(e,t){var n=t&&t.getAudioTracks().length>0,r=t&&t.getVideoTracks().length>0,i={};-1!==e.indexOf("video")&&(i.video=r),-1!==e.indexOf("audio")&&(i.audio=n),x.emit(y.a.GRANTED_PERMISSIONS,i)}function Z(e){var t=e.filter(function(e){return"audioinput"===e.kind}).length,n=e.filter(function(e){return"audiooutput"===e.kind}).length,i=e.filter(function(e){return"videoinput"===e.kind}).length,o=e.filter(function(e){return"videooutput"===e.kind}).length;e.forEach(function(e){var a={audio_input_device_count:t,audio_output_device_count:n,video_input_device_count:i,video_output_device_count:o,device_id:e.deviceId,device_group_id:e.groupId,device_kind:e.kind,device_label:e.label};E.a.sendAnalytics(r.k,a)})}function ee(e,t){var n,r="srcObject";(r in e||(r="mozSrcObject")in e||(r=null),r)?e[r]=t:(t&&((n=t.jitsiObjectURL)||(t.jitsiObjectURL=n=URL.createObjectURL(t))),e.src=n||"")}var te=new(function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),R(this,P(t).call(this,x))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&I(e,t)}(t,f["a"]),n=t,(r=[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("boolean"==typeof t.disableAEC&&(G=t.disableAEC,M.info("Disable AEC: ".concat(G))),"boolean"==typeof t.disableNS&&(J=t.disableNS,M.info("Disable NS: ".concat(J))),"boolean"==typeof t.disableAP&&(B=t.disableAP,M.info("Disable AP: ".concat(B))),"boolean"==typeof t.disableAGC&&(V=t.disableAGC,M.info("Disable AGC: ".concat(V))),"boolean"==typeof t.disableHPF&&(W=t.disableHPF,M.info("Disable HPF: ".concat(W))),D=void 0,window.clearInterval(N),N=void 0,this.enumerateDevices=function(){if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)return function(e){navigator.mediaDevices.enumerateDevices().then(e,function(){return e([])})}}(),m.a.usesNewGumFlow())this.RTCPeerConnectionType=RTCPeerConnection,this.attachMediaStream=ne(function(e,t){e&&(e.srcObject=t)}),this.getStreamID=function(e){return e.id},this.getTrackID=function(e){return e.id};else if(m.a.isChromiumBased()||m.a.isReactNative())this.RTCPeerConnectionType=RTCPeerConnection,this.attachMediaStream=ne(function(e,t){return ee(e,t),e}),this.getStreamID=function(e){var t=e.id;return"number"==typeof t?t:_.a.filterSpecialChars(t)},this.getTrackID=function(e){return e.id},MediaStream.prototype.getVideoTracks||(MediaStream.prototype.getVideoTracks=function(){return this.videoTracks}),MediaStream.prototype.getAudioTracks||(MediaStream.prototype.getAudioTracks=function(){return this.audioTracks});else{if(!m.a.isEdge()){var n="Endpoint does not appear to be WebRTC-capable";throw M.error(n),new Error(n)}this.RTCPeerConnectionType=b.a,this.attachMediaStream=ne(function(e,t){ee(e,t)}),this.getStreamID=function(e){var t=e.jitsiRemoteId||e.id;return _.a.filterSpecialChars(t)},this.getTrackID=function(e){return e.jitsiRemoteId||e.id}}this._initPCConstraints(t),S.a.init(t,this.getUserMediaWithConstraints.bind(this)),this.isDeviceListAvailable()&&this.enumerateDevices(function(t){D=t.splice(0),M.debug("Available devices: ",D),Z(D),x.emit(y.a.DEVICE_LIST_AVAILABLE,D);var n=function(){return e.enumerateDevices(function(e){var t;(function(e){return e.length!==D.length||e.map(t).sort().join("")!==D.map(t).sort().join("");function t(e){return JSON.stringify({kind:e.kind,deviceId:e.deviceId,groupId:e.groupId,label:e.label,facing:e.facing})}})(e)&&(D=(t=e).slice(0),M.info("list of media devices has changed:",D),Z(D),x.emit(y.a.DEVICE_LIST_CHANGED,t))})};m.a.supportsDeviceChangeEvent()?navigator.mediaDevices.addEventListener("devicechange",n):N=window.setInterval(n,3e3)})}},{key:"_initPCConstraints",value:function(e){m.a.isFirefox()?this.pcConstraints={}:(m.a.isChromiumBased()||m.a.isReactNative())&&(this.pcConstraints={optional:[{googHighStartBitrate:0},{googPayloadPadding:!0},{googScreencastMinBitrate:400},{googCpuOveruseDetection:!0},{googCpuOveruseEncodeUsage:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85}]},e.useIPv6&&this.pcConstraints.optional.push({googIPv6:!0}),this.p2pPcConstraints=JSON.parse(JSON.stringify(this.pcConstraints)),e.disableSuspendVideo||this.pcConstraints.optional.push({googSuspendBelowMinBitrate:!0}),this.p2pPcConstraints.optional.push({googSuspendBelowMinBitrate:!0})),this.p2pPcConstraints=this.p2pPcConstraints||this.pcConstraints}},{key:"getUserMediaWithConstraints",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=z(e,t);return M.info("Get media constraints",n),new Promise(function(t,r){navigator.mediaDevices.getUserMedia(n).then(function(n){M.log("onUserMediaSuccess"),Y(e,n),t(n)}).catch(function(t){M.warn("Failed to get access to local media. "+" ".concat(t," ").concat(n," ")),Y(e,void 0),r(new d.a(t,n,e))})})}},{key:"_newGetUserMediaWithConstraints",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(n,r){navigator.mediaDevices.getUserMedia(t).then(function(t){M.log("onUserMediaSuccess"),Y(e,t),n(t)}).catch(function(n){M.warn("Failed to get access to local media. "+" ".concat(n," ").concat(t," ")),Y(e,void 0),r(new d.a(n,t,e))})})}},{key:"_newGetDesktopMedia",value:function(e){if(!S.a.isSupported()||!m.a.supportsVideo())return Promise.reject(new Error("Desktop sharing is not supported!"));var t=e.desktopSharingExtensionExternalInstallation,n=e.desktopSharingSources,r=e.gumOptions;return new Promise(function(i,o){S.a.obtainStream(O({},t,{desktopSharingSources:n,gumOptions:r,trackOptions:X(e)}),function(e){i(e)},function(e){o(e)})})}},{key:"obtainAudioAndVideoPermissions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.devices=e.devices||L.concat(),e.resolution=e.resolution||720,e.devices.includes("desktop")&&!S.a.isSupported()?Promise.reject(new Error("Desktop sharing is not supported!")):(m.a.supportsMediaStreamConstructor()?this._getAudioAndVideoStreams(e):this._getAudioAndVideoStreamsSeparately(e)).then(function(t){return function(e,t){var n,r,i,o=[];if(e){var a=e.audioVideo;if(a){var s=a.getAudioTracks();if(s.length){n=new MediaStream;for(var c=0;c<s.length;c++)n.addTrack(s[c])}var u=a.getVideoTracks();if(u.length){i=new MediaStream;for(var l=0;l<u.length;l++)i.addTrack(u[l])}}else n=e.audio,i=e.video;r=e.desktop}if(r){var d=r,f=d.stream,h=d.sourceId,v=d.sourceType;o.push({stream:f,sourceId:h,sourceType:v,track:f.getVideoTracks()[0],mediaType:p.b,videoType:T.a.DESKTOP})}return n&&o.push({stream:n,track:n.getAudioTracks()[0],mediaType:p.a,videoType:null}),i&&o.push({stream:i,track:i.getVideoTracks()[0],mediaType:p.b,videoType:T.a.CAMERA,resolution:t}),o}(t,e.resolution)})}},{key:"_getAudioAndVideoStreams",value:function(e){var t=this,n=e.devices.includes("desktop");return e.devices=e.devices.filter(function(e){return"desktop"!==e}),(e.devices.length?this.getUserMediaWithConstraints(e.devices,e):Promise.resolve(null)).then(function(n){var r=t._getMissingTracks(e.devices,n);return r.length?(t.stopMediaStream(n),t.getUserMediaWithConstraints(r,e).then(function(){return Promise.reject(new d.a({name:"UnknownError"},z(e.devices,e),r))})):n}).then(function(r){if(!n)return{audioVideo:r};if(e.desktopSharingSourceDevice)throw t.stopMediaStream(r),new Error("Using a camera as screenshare source isnot supported on this browser.");return new Promise(function(n,i){S.a.obtainStream(t._parseDesktopSharingOptions(e),function(e){return n({audioVideo:r,desktop:e})},function(e){r&&t.stopMediaStream(r),i(e)})})})}},{key:"_getMissingTracks",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=[],r=e.includes("audio"),i=t&&t.getAudioTracks().length>0;r&&!i&&n.push("audio");var o=e.includes("video"),a=t&&t.getVideoTracks().length>0;return o&&!a&&n.push("video"),n}},{key:"_getAudioAndVideoStreamsSeparately",value:function(e){var t=this;return new Promise(function(n,r){!function e(t){if(!t.options.devices||0===t.options.devices.length)return t.successCallback(t.streams||{});var n=t.options.devices.splice(0,1);t.deviceGUM[n](t.options).then(function(r){t.streams=t.streams||{},t.streams[n]=r,e(t)},function(e){Object.keys(t.streams).forEach(function(e){return te.stopMediaStream(t.streams[e])}),M.error("failed to obtain ".concat(n," stream - stop"),e),t.errorCallback(e)})}({options:e,streams:{},successCallback:n,errorCallback:r,deviceGUM:{audio:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.getUserMediaWithConstraints.apply(t,[["audio"]].concat(n))},video:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.getUserMediaWithConstraints.apply(t,[["video"]].concat(n))},desktop:function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S.a.obtainStream.apply(S.a,[t._parseDesktopSharingOptions(e)].concat(r))}}})})}},{key:"_parseDesktopSharingOptions",value:function(e){return O({},e.desktopSharingExtensionExternalInstallation,{desktopSharingSources:e.desktopSharingSources,gumOptions:{frameRate:e.desktopSharingFrameRate},trackOptions:X(e)})}},{key:"newObtainAudioAndVideoPermissions",value:function(e){var t=this;M.info("Using the new gUM flow");var n=[],r=function(){if(!(-1!==(e.devices||[]).indexOf("desktop")))return Promise.resolve();var t=e.desktopSharingExtensionExternalInstallation,n=e.desktopSharingSourceDevice,r=e.desktopSharingSources,i=e.desktopSharingFrameRate;if(n){var o=D&&D.find(function(e){return"videoinput"===e.kind&&(e.deviceId===n||e.label===n)}),a=["video"],s=Q(a,{options:e});return s.video.deviceId={exact:o&&o.deviceId||n},this._newGetUserMediaWithConstraints(a,s).then(function(e){return{stream:e}})}return this._newGetDesktopMedia({desktopSharingExtensionExternalInstallation:t,desktopSharingSources:r,gumOptions:{frameRate:i}})}.bind(this),i=function(){var t=(e.devices||["audio","video"]).filter(function(e){return"audio"===e||"video"===e&&m.a.supportsVideo()});if(!t.length)return Promise.resolve();var n=Q(t,e);return M.info("Got media constraints: ",n),this._newGetUserMediaWithConstraints(t,n)}.bind(this);return r().then(function(e){if(e){var t=e.stream,r=e.sourceId,i=e.sourceType;n.push({stream:t,sourceId:r,sourceType:i,track:t.getVideoTracks()[0],videoType:T.a.DESKTOP})}}).then(i).then(function(e){if(e){var t=e.getAudioTracks();if(t.length){var r=new MediaStream(t);n.push({stream:r,track:r.getAudioTracks()[0]})}var i=e.getVideoTracks();if(i.length){var o=new MediaStream(i);n.push({stream:o,track:o.getVideoTracks()[0],videoType:T.a.CAMERA})}}}).then(function(){return n}).catch(function(e){return n.forEach(function(e){var n=e.stream;t.stopMediaStream(n)}),Promise.reject(e)})}},{key:"isDeviceListAvailable",value:function(){return Boolean(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)}},{key:"isDeviceChangeAvailable",value:function(e){return"output"===e||"audiooutput"===e?K:m.a.isChromiumBased()||m.a.isFirefox()||m.a.isEdge()}},{key:"stopMediaStream",value:function(e){e.getTracks().forEach(function(e){e.stop&&e.stop()}),e.stop&&e.stop(),e.release&&e.release();var t=e.jitsiObjectURL;t&&(delete e.jitsiObjectURL,URL.revokeObjectURL(t))}},{key:"isDesktopSharingEnabled",value:function(){return S.a.isSupported()}},{key:"setAudioOutputDevice",value:function(e){return this.isDeviceChangeAvailable("output")?q.setSinkId(e).then(function(){U=e,H=!0,M.log("Audio output device set to ".concat(e)),x.emit(y.a.AUDIO_OUTPUT_DEVICE_CHANGED,e)}):Promise.reject(new Error("Audio output device change is not supported"))}},{key:"getAudioOutputDevice",value:function(){return U}},{key:"getCurrentlyAvailableMediaDevices",value:function(){return D}},{key:"getEventDataForActiveDevice",value:function(e){var t=[],n={deviceId:e.deviceId,kind:e.kind,label:e.label,groupId:e.groupId};return t.push(n),{deviceList:t}}},{key:"setSuspendVideo",value:function(e,t){e.optional||(e.optional=[]),e.optional=e.optional.filter(function(e){return!e.hasOwnProperty("googSuspendBelowMinBitrate")}),t&&e.optional.push({googSuspendBelowMinBitrate:"true"})}}])&&k(n.prototype,r),i&&k(n,i),t}());function ne(e){return function(t,n){var r=e.apply(te,arguments);return n&&te.isDeviceChangeAvailable("output")&&n.getAudioTracks&&n.getAudioTracks().length&&H&&t.setSinkId(te.getAudioOutputDevice()).catch(function(e){var n=new d.a(e,null,["audiooutput"]);l.a.callUnhandledRejectionHandler({promise:this,reason:n}),M.warn("Failed to set audio output device for the element. Default audio output device will be used instead",t,n)}),r}}t.a=te}).call(this,"modules/RTC/RTCUtils.js")},function(e,t,n){"use strict";n.r(t),n.d(t,"CHROME_EXTENSION_GENERIC_ERROR",function(){return r}),n.d(t,"CHROME_EXTENSION_INSTALLATION_ERROR",function(){return i}),n.d(t,"CHROME_EXTENSION_USER_GESTURE_REQUIRED",function(){return o}),n.d(t,"CHROME_EXTENSION_USER_CANCELED",function(){return a}),n.d(t,"CONSTRAINT_FAILED",function(){return s}),n.d(t,"ELECTRON_DESKTOP_PICKER_ERROR",function(){return c}),n.d(t,"ELECTRON_DESKTOP_PICKER_NOT_FOUND",function(){return u}),n.d(t,"FIREFOX_EXTENSION_NEEDED",function(){return l}),n.d(t,"GENERAL",function(){return d}),n.d(t,"NOT_FOUND",function(){return f}),n.d(t,"PERMISSION_DENIED",function(){return p}),n.d(t,"TRACK_IS_DISPOSED",function(){return h}),n.d(t,"TRACK_NO_STREAM_FOUND",function(){return v}),n.d(t,"UNSUPPORTED_RESOLUTION",function(){return m}),n.d(t,"NO_DATA_FROM_SOURCE",function(){return g});var r="gum.chrome_extension_generic_error",i="gum.chrome_extension_installation_error",o="gum.chrome_extension_user_gesture_required",a="gum.chrome_extension_user_canceled",s="gum.constraint_failed",c="gum.electron_desktop_picker_error",u="gum.electron_desktop_picker_not_found",l="gum.firefox_extension_needed",d="gum.general",f="gum.not_found",p="gum.permission_denied",h="track.track_is_disposed",v="track.no_stream_found",m="gum.unsupported_resolution",g="track.no_data_from_source"},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return M});var r=n(4),i=n(96),o=n(10),a=n.n(o),s=n(2),c=n(60),u=n(15),l=n(12),d=n(24),f=n(56),p=n(9),h=n(3),v=n(8),m=n.n(v),g=n(11),y=n(6),b=n(98),S=n(14),_=n.n(S);function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var P=Object(r.getLogger)(e),I=0,O=0;function A(e,t){var n=[],r=null;return e.forEach(function(e){e.mediaType===p.a?r=t.micDeviceId:e.videoType===_.a.CAMERA&&(r=t.cameraDeviceId),O=Object(f.a)(O);var i=new c.a(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){R(e,t,n[t])})}return e}({},e,{deviceId:r,facingMode:t.facingMode,rtcId:O}));n.push(i)}),n}var M=function(e){function t(e){var n,r,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,i=T(t).call(this),(n=!i||"object"!==E(i)&&"function"!=typeof i?k(r):i).conference=e,n.peerConnections=new Map,n.localTracks=[],n.options=o,n._channel=null,n._channelOpen=!1,n._lastN=-1,n._lastNEndpoints=null,n._maxFrameHeight=void 0,n._pinnedEndpoint=null,n._selectedEndpoints=[],n._lastNChangeListener=n._onLastNChanged.bind(k(k(n))),g.a.isDeviceChangeAvailable("output")&&(g.a.addListener(m.a.AUDIO_OUTPUT_DEVICE_CHANGED,function(e){return n._updateAudioOutputForAudioTracks(e)}),g.a.addListener(m.a.DEVICE_LIST_CHANGED,function(){return n._updateAudioOutputForAudioTracks(g.a.getAudioOutputDevice())})),n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,d["a"]),n=t,o=[{key:"obtainAudioAndVideoPermissions",value:function(e){var t=h.a.usesNewGumFlow();return(t?g.a.newObtainAudioAndVideoPermissions(e):g.a.obtainAudioAndVideoPermissions(e)).then(function(n){var r=t?function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(e){var t=e.sourceId,n=e.sourceType,r=e.stream,i=e.track,o=e.videoType,a=i.getSettings(),s=a.deviceId,u=a.facingMode;return O=Object(f.a)(O),new c.a({deviceId:s,facingMode:u,mediaType:i.kind,rtcId:O,sourceId:t,sourceType:n,stream:r,track:i,videoType:o||null})})}(n):A(n,e);return r.some(function(e){return!e._isReceivingData()})?Promise.reject(new u.a(l.NO_DATA_FROM_SOURCE)):r})}},{key:"addListener",value:function(e,t){g.a.addListener(e,t)}},{key:"removeListener",value:function(e,t){g.a.removeListener(e,t)}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.options=e,g.a.init(this.options)}},{key:"getPCConstraints",value:function(e){var t=e?g.a.p2pPcConstraints:g.a.pcConstraints;return t?JSON.parse(JSON.stringify(t)):{}}},{key:"attachMediaStream",value:function(e,t){return g.a.attachMediaStream(e,t)}},{key:"getStreamID",value:function(e){return g.a.getStreamID(e)}},{key:"getTrackID",value:function(e){return g.a.getTrackID(e)}},{key:"isDeviceListAvailable",value:function(){return g.a.isDeviceListAvailable()}},{key:"isDeviceChangeAvailable",value:function(e){return g.a.isDeviceChangeAvailable(e)}},{key:"isWebRtcSupported",value:function(){return h.a.isSupported()}},{key:"getAudioOutputDevice",value:function(){return g.a.getAudioOutputDevice()}},{key:"getCurrentlyAvailableMediaDevices",value:function(){return g.a.getCurrentlyAvailableMediaDevices()}},{key:"getEventDataForActiveDevice",value:function(e){return g.a.getEventDataForActiveDevice(e)}},{key:"setAudioOutputDevice",value:function(e){return g.a.setAudioOutputDevice(e)}},{key:"isUserStream",value:function(e){return t.isUserStreamById(g.a.getStreamID(e))}},{key:"isUserStreamById",value:function(e){return e&&"mixedmslabel"!==e&&"default"!==e}},{key:"enumerateDevices",value:function(e){g.a.enumerateDevices(e)}},{key:"stopMediaStream",value:function(e){g.a.stopMediaStream(e)}},{key:"isDesktopSharingEnabled",value:function(){return g.a.isDesktopSharingEnabled()}}],(r=[{key:"initializeBridgeChannel",value:function(e,t){var n=this;this._channel=new i.a(e,t,this.eventEmitter),this._channelOpenListener=function(){n._channelOpen=!0;try{n._channel.sendPinnedEndpointMessage(n._pinnedEndpoint),n._channel.sendSelectedEndpointsMessage(n._selectedEndpoints),void 0!==n._maxFrameHeight&&n._channel.sendReceiverVideoConstraintMessage(n._maxFrameHeight)}catch(e){a.a.callErrorHandler(e),P.error("Cannot send selected(".concat(n._selectedEndpoint,")")+"pinned(".concat(n._pinnedEndpoint,")")+"frameHeight(".concat(n._maxFrameHeight,") endpoint message"),e)}n.removeListener(m.a.DATA_CHANNEL_OPEN,n._channelOpenListener),n._channelOpenListener=null,-1!==n._lastN&&n._channel.sendSetLastNMessage(n._lastN)},this.addListener(m.a.DATA_CHANNEL_OPEN,this._channelOpenListener),this.addListener(m.a.LASTN_ENDPOINT_CHANGED,this._lastNChangeListener)}},{key:"_onLastNChanged",value:function(){var e,t,n=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=this._lastNEndpoints||[];this._lastNEndpoints=r,e=i.filter(function(e){return!n.isInLastN(e)}),t=r.filter(function(e){return-1===i.indexOf(e)}),this.conference.eventEmitter.emit(s.LAST_N_ENDPOINTS_CHANGED,e,t)}},{key:"onCallEnded",value:function(){this._channel&&(this._channel&&"websocket"===this._channel.mode&&this._channel.close(),this._channel=null,this._channelOpen=!1)}},{key:"setReceiverVideoConstraint",value:function(e){this._maxFrameHeight=e,this._channel&&this._channelOpen&&this._channel.sendReceiverVideoConstraintMessage(e)}},{key:"selectEndpoints",value:function(e){this._selectedEndpoints=e,this._channel&&this._channelOpen&&this._channel.sendSelectedEndpointsMessage(e)}},{key:"pinEndpoint",value:function(e){this._pinnedEndpoint=e,this._channel&&this._channelOpen&&this._channel.sendPinnedEndpointMessage(e)}},{key:"createPeerConnection",value:function(e,n,r,i){var o=t.getPCConstraints(r);void 0!==i.abtestSuspendVideo&&(g.a.setSuspendVideo(o,i.abtestSuspendVideo),y.a.analytics.addPermanentProperties({abtestSuspendVideo:i.abtestSuspendVideo})),h.a.supportsSdpSemantics()&&(n.sdpSemantics="plan-b"),I=Object(f.a)(I);var a=new b.a(this,I,e,n,o,r,i);return this.peerConnections.set(a.id,a),a}},{key:"_removePeerConnection",value:function(e){var t=e.id;return!!this.peerConnections.has(t)&&(this.peerConnections.delete(t),!0)}},{key:"addLocalTrack",value:function(e){if(!e)throw new Error("track must not be null nor undefined");this.localTracks.push(e),e.conference=this.conference}},{key:"getLastN",value:function(){return this._lastN}},{key:"getLocalVideoTrack",value:function(){var e=this.getLocalTracks(p.b);return e.length?e[0]:void 0}},{key:"getLocalAudioTrack",value:function(){var e=this.getLocalTracks(p.a);return e.length?e[0]:void 0}},{key:"getLocalTracks",value:function(e){var t=this.localTracks.slice();return void 0!==e&&(t=t.filter(function(t){return t.getType()===e})),t}},{key:"getRemoteTracks",value:function(e){var t=[],n=!0,r=!1,i=void 0;try{for(var o,a=this.peerConnections.values()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value.getRemoteTracks(void 0,e);s&&(t=t.concat(s))}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return t}},{key:"setAudioMute",value:function(e){var t=[];return this.getLocalTracks(p.a).forEach(function(n){t.push(e?n.mute():n.unmute())}),Promise.all(t)}},{key:"removeLocalTrack",value:function(e){var t=this.localTracks.indexOf(e);-1!==t&&this.localTracks.splice(t,1)}},{key:"removeRemoteTracks",value:function(e){var t=[],n=!0,r=!1,i=void 0;try{for(var o,a=this.peerConnections.values()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value.removeRemoteTracks(e);t=t.concat(s)}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return P.debug("Removed remote tracks for ".concat(e)+" count: ".concat(t.length)),t}},{key:"closeBridgeChannel",value:function(){this._channel&&(this._channel.close(),this._channelOpen=!1,this.removeListener(m.a.LASTN_ENDPOINT_CHANGED,this._lastNChangeListener))}},{key:"setAudioLevel",value:function(e,t,n,r){var i=e.getTrackBySSRC(t);i&&(i.isAudioTrack()?(i.isLocal()!==r&&P.error("".concat(i," was expected to ").concat(r?"be":"not be"," local")),i.setAudioLevel(n,e)):P.warn("Received audio level for non-audio track: ".concat(t)))}},{key:"sendChannelMessage",value:function(e,t){if(!this._channel)throw new Error("Channel support is disabled!");this._channel.sendMessage(e,t)}},{key:"setLastN",value:function(e){this._lastN!==e&&(this._lastN=e,this._channel&&this._channelOpen&&this._channel.sendSetLastNMessage(e),this.eventEmitter.emit(m.a.LASTN_VALUE_CHANGED,e))}},{key:"isInLastN",value:function(e){return!this._lastNEndpoints||this._lastNEndpoints.indexOf(e)>-1}},{key:"_updateAudioOutputForAudioTracks",value:function(e){var t=this.getRemoteTracks(p.a),n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){o.value.setAudioOutput(e)}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}}}])&&C(n.prototype,r),o&&C(n,o),t}()}).call(this,"modules/RTC/RTC.js")},function(e,t){e.exports={CAMERA:"camera",DESKTOP:"desktop"}},function(e,t,n){"use strict";var r=n(12);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o={};function a(e,t,n){if("object"===i(e)&&void 0!==e.name)switch(this.gum={error:e,constraints:t,devices:n&&Array.isArray(n)?n.slice(0):void 0},e.name){case"NotAllowedError":case"PermissionDeniedError":case"SecurityError":this.name=r.PERMISSION_DENIED,this.message=o[this.name]+(this.gum.devices||[]).join(", ");break;case"DevicesNotFoundError":case"NotFoundError":this.name=r.NOT_FOUND,this.message=o[this.name]+(this.gum.devices||[]).join(", ");break;case"ConstraintNotSatisfiedError":case"OverconstrainedError":var a=e.constraintName||e.constraint;t&&t.video&&(!n||n.indexOf("video")>-1)&&("minWidth"===a||"maxWidth"===a||"minHeight"===a||"maxHeight"===a||"width"===a||"height"===a||"deviceId"===a)?(this.name=r.UNSUPPORTED_RESOLUTION,this.message=o[this.name]+function(e,t){if(t&&t.video&&t.video.mandatory)switch(e){case"width":return t.video.mandatory.minWidth;case"height":return t.video.mandatory.minHeight;default:return t.video.mandatory[e]||""}return""}(a,t)):(this.name=r.CONSTRAINT_FAILED,this.message=o[this.name]+e.constraintName);break;default:this.name=r.GENERAL,this.message=e.message||o[this.name]}else{if("string"!=typeof e)throw new Error("Invalid arguments");o[e]?(this.name=e,this.message=t||o[e]):this.message=e}this.stack=e.stack||(new Error).stack}o[r.UNSUPPORTED_RESOLUTION]="Video resolution is not supported: ",o[r.CHROME_EXTENSION_INSTALLATION_ERROR]="Failed to install Chrome extension",o[r.CHROME_EXTENSION_USER_GESTURE_REQUIRED]="Failed to install Chrome extension - installations can only be initiated by a user gesture.",o[r.CHROME_EXTENSION_USER_CANCELED]="User canceled Chrome's screen sharing prompt",o[r.CHROME_EXTENSION_GENERIC_ERROR]="Unknown error from Chrome extension",o[r.ELECTRON_DESKTOP_PICKER_ERROR]="Unkown error from desktop picker",o[r.ELECTRON_DESKTOP_PICKER_NOT_FOUND]="Failed to detect desktop picker",o[r.GENERAL]="Generic getUserMedia error",o[r.PERMISSION_DENIED]="User denied permission to use device(s): ",o[r.NOT_FOUND]="Requested device(s) was/were not found: ",o[r.CONSTRAINT_FAILED]="Constraint could not be satisfied: ",o[r.TRACK_IS_DISPOSED]="Track has been already disposed",o[r.TRACK_NO_STREAM_FOUND]="Track does not have an associated Media Stream",o[r.NO_DATA_FROM_SOURCE]="The track has stopped receiving data from it's source",a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,t.a=a},function(e,t,n){var r=n(130),i=n(131);t.write=i,t.parse=r.parse,t.parseFmtpConfig=r.parseFmtpConfig,t.parseParams=r.parseParams,t.parsePayloads=r.parsePayloads,t.parseRemoteCandidates=r.parseRemoteCandidates,t.parseImageAttributes=r.parseImageAttributes,t.parseSimulcastStreamList=r.parseSimulcastStreamList},function(e,t,n){"use strict";n.r(t),n.d(t,"LOCAL_TRACK_STOPPED",function(){return r}),n.d(t,"TRACK_AUDIO_LEVEL_CHANGED",function(){return i}),n.d(t,"TRACK_AUDIO_OUTPUT_CHANGED",function(){return o}),n.d(t,"TRACK_MUTE_CHANGED",function(){return a}),n.d(t,"TRACK_VIDEOTYPE_CHANGED",function(){return s}),n.d(t,"NO_DATA_FROM_SOURCE",function(){return c});var r="track.stopped",i="track.audioLevelsChanged",o="track.audioOutputChanged",a="track.trackMuteChanged",s="track.videoTypeChanged",c="track.no_data_from_source"},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(5);function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function o(e){for(var t=e.split("\r\nm="),n=1,r=t.length;n<r;n++){var i="m=".concat(t[n]);n!==r-1&&(i+="\r\n"),t[n]=i}var o="".concat(t.shift(),"\r\n");this.media=t,this.raw=o+t.join(""),this.session=o}o.prototype.failICE=!1,o.prototype.removeTcpCandidates=!1,o.prototype.removeUdpCandidates=!1,o.prototype.getMediaSsrcMap=function(){for(var e,t=this,n={},i=function(i){e=r.a.findLines(t.media[i],"a=ssrc:");var o={mediaindex:i,mid:r.a.parseMID(r.a.findLine(t.media[i],"a=mid:")),ssrcs:{},ssrcGroups:[]};n[i]=o,e.forEach(function(e){var t=e.substring(7).split(" ")[0];o.ssrcs[t]||(o.ssrcs[t]={ssrc:t,lines:[]}),o.ssrcs[t].lines.push(e)}),(e=r.a.findLines(t.media[i],"a=ssrc-group:")).forEach(function(e){var t=e.indexOf(" "),n=e.substr(0,t).substr(13),r=e.substr(14+n.length).split(" ");r.length&&o.ssrcGroups.push({semantics:n,ssrcs:r})})},o=0;o<t.media.length;o++)i(o);return n},o.prototype.containsSSRC=function(e){var t=this.getMediaSsrcMap(),n=!1;return Object.keys(t).forEach(function(r){n||t[r].ssrcs[e]&&(n=!0)}),n},o.prototype.mangle=function(){var e,t,n,i,o,a;for(e=0;e<this.media.length;e++)if((n=this.media[e].split("\r\n")).pop(),"audio"===(i=r.a.parseMLine(n.shift())).media){for(o="",i.fmt.length=0,t=0;t<n.length;t++){if("a=rtpmap:"===n[t].substr(0,9)){if("CN"===(a=r.a.parseRTPMap(n[t])).name||"ISAC"===a.name)continue;i.fmt.push(a.id)}o+="".concat(n[t],"\r\n")}this.media[e]="".concat(r.a.buildMLine(i),"\r\n").concat(o)}this.raw=this.session+this.media.join("")},o.prototype.removeSessionLines=function(e){var t=this,n=r.a.findLines(this.session,e);return n.forEach(function(e){t.session=t.session.replace("".concat(e,"\r\n"),"")}),this.raw=this.session+this.media.join(""),n},o.prototype.removeMediaLines=function(e,t){var n=this,i=r.a.findLines(this.media[e],t);return i.forEach(function(t){n.media[e]=n.media[e].replace("".concat(t,"\r\n"),"")}),this.raw=this.session+this.media.join(""),i},o.prototype.toJingle=function(e,t){var n,o,a,s,c,u,l,d;if((s=r.a.findLines(this.session,"a=group:")).length)for(n=0;n<s.length;n++){var f=(d=s[n].split(" ")).shift().substr(8);for(e.c("group",{xmlns:"urn:xmpp:jingle:apps:grouping:0",semantics:f}),o=0;o<d.length;o++)e.c("content",{name:d[o]}).up();e.up()}for(n=0;n<this.media.length;n++)if("audio"===(c=r.a.parseMLine(this.media[n].split("\r\n")[0])).media||"video"===c.media||"application"===c.media){var p=r.a.findLine(this.media[n],"a=ssrc:");l=!!p&&p.substring(7).split(" ")[0],e.c("content",{creator:t,name:c.media});var h=r.a.findLine(this.media[n],"a=mid:");if(h){var v=r.a.parseMID(h);e.attrs({name:v})}if(r.a.findLine(this.media[n],"a=rtpmap:").length){for(e.c("description",{xmlns:"urn:xmpp:jingle:apps:rtp:1",media:c.media}),l&&e.attrs({ssrc:l}),o=0;o<c.fmt.length;o++){u=r.a.findLine(this.media[n],"a=rtpmap:".concat(c.fmt[o])),e.c("payload-type",r.a.parseRTPMap(u));var m=r.a.findLine(this.media[n],"a=fmtp:".concat(c.fmt[o]));if(m)for(d=r.a.parseFmtp(m),a=0;a<d.length;a++)e.c("parameter",d[a]).up();this.rtcpFbToJingle(n,e,c.fmt[o]),e.up()}var g=r.a.findLines(this.media[n],"a=crypto:",this.session);if(g.length&&(e.c("encryption",{required:1}),g.forEach(function(t){return e.c("crypto",r.a.parseCrypto(t)).up()}),e.up()),l){var y=r.a.parseSSRC(this.media[n]),b=!0,S=!1,_=void 0;try{for(var E,C=y[Symbol.iterator]();!(b=(E=C.next()).done);b=!0){var T=i(E.value,2),w=T[0],k=T[1];e.c("source",{ssrc:w,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),k.forEach(function(t){var n=t.indexOf(" "),i=t.substr(n+1);if(e.c("parameter"),-1===i.indexOf(":"))e.attrs({name:i});else{var o=i.split(":",2)[0];e.attrs({name:o});var a=i.split(":",2)[1];a=r.a.filterSpecialChars(a),e.attrs({value:a})}e.up()}),e.up()}}catch(e){S=!0,_=e}finally{try{b||null==C.return||C.return()}finally{if(S)throw _}}r.a.findLines(this.media[n],"a=ssrc-group:").forEach(function(t){var n=t.indexOf(" "),r=t.substr(0,n).substr(13),i=t.substr(14+r.length).split(" ");i.length&&(e.c("ssrc-group",{semantics:r,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),i.forEach(function(t){return e.c("source",{ssrc:t}).up()}),e.up())})}var R=r.a.findLines(this.media[n],"a=rid");if(R.length){var P=R.map(function(e){return e.split(":")[1]}).map(function(e){return e.split(" ")[0]});P.forEach(function(t){e.c("source",{rid:t,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),e.up()}),r.a.findLine(this.media[n],"a=simulcast")&&(e.c("rid-group",{semantics:"SIM",xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),P.forEach(function(t){e.c("source",{rid:t}).up()}),e.up())}if(r.a.findLine(this.media[n],"a=rtcp-mux")&&e.c("rtcp-mux").up(),this.rtcpFbToJingle(n,e,"*"),(s=r.a.findLines(this.media[n],"a=extmap:")).length)for(o=0;o<s.length;o++){if(d=r.a.parseExtmap(s[o]),e.c("rtp-hdrext",{xmlns:"urn:xmpp:jingle:apps:rtp:rtp-hdrext:0",uri:d.uri,id:d.value}),d.hasOwnProperty("direction"))switch(d.direction){case"sendonly":e.attrs({senders:"responder"});break;case"recvonly":e.attrs({senders:"initiator"});break;case"sendrecv":e.attrs({senders:"both"});break;case"inactive":e.attrs({senders:"none"})}e.up()}e.up()}this.transportToJingle(n,e);var I=this.media[n];r.a.findLine(I,"a=sendrecv",this.session)?e.attrs({senders:"both"}):r.a.findLine(I,"a=sendonly",this.session)?e.attrs({senders:"initiator"}):r.a.findLine(I,"a=recvonly",this.session)?e.attrs({senders:"responder"}):r.a.findLine(I,"a=inactive",this.session)&&e.attrs({senders:"none"}),"0"===c.port&&e.attrs({senders:"rejected"}),e.up()}return e.up(),e},o.prototype.transportToJingle=function(e,t){var n,i=this;t.c("transport");var o=r.a.findLine(this.media[e],"a=sctpmap:",i.session);if(o){var a=r.a.parseSCTPMap(o);t.c("sctpmap",{xmlns:"urn:xmpp:jingle:transports:dtls-sctp:1",number:a[0],protocol:a[1]}),a.length>2&&t.attrs({streams:a[2]}),t.up()}if(r.a.findLines(this.media[e],"a=fingerprint:",this.session).forEach(function(o){(n=r.a.parseFingerprint(o)).xmlns="urn:xmpp:jingle:apps:dtls:0",t.c("fingerprint").t(n.fingerprint),delete n.fingerprint,(o=r.a.findLine(i.media[e],"a=setup:",i.session))&&(n.setup=o.substr(8)),t.attrs(n),t.up()}),n=r.a.iceparams(this.media[e],this.session)){n.xmlns="urn:xmpp:jingle:transports:ice-udp:1",t.attrs(n);var s=r.a.findLines(this.media[e],"a=candidate:",this.session);s.length&&s.forEach(function(e){var n=r.a.candidateToJingle(e);i.failICE&&(n.ip="1.1.1.1");var o=n&&"string"==typeof n.protocol?n.protocol.toLowerCase():"";i.removeTcpCandidates&&("tcp"===o||"ssltcp"===o)||i.removeUdpCandidates&&"udp"===o||t.c("candidate",n).up()})}t.up()},o.prototype.rtcpFbToJingle=function(e,t,n){r.a.findLines(this.media[e],"a=rtcp-fb:".concat(n)).forEach(function(e){var n=r.a.parseRTCPFB(e);"trr-int"===n.type?(t.c("rtcp-fb-trr-int",{xmlns:"urn:xmpp:jingle:apps:rtp:rtcp-fb:0",value:n.params[0]}),t.up()):(t.c("rtcp-fb",{xmlns:"urn:xmpp:jingle:apps:rtp:rtcp-fb:0",type:n.type}),n.params.length>0&&t.attrs({subtype:n.params[0]}),t.up())})},o.prototype.rtcpFbFromJingle=function(e,t){var n="",r=e.find('>rtcp-fb-trr-int[xmlns="urn:xmpp:jingle:apps:rtp:rtcp-fb:0"]');return r.length&&(n+="a=rtcp-fb:* trr-int ",r.attr("value")?n+=r.attr("value"):n+="0",n+="\r\n"),(r=e.find('>rtcp-fb[xmlns="urn:xmpp:jingle:apps:rtp:rtcp-fb:0"]')).each(function(){n+="a=rtcp-fb:".concat(t," ").concat($(this).attr("type")),$(this).attr("subtype")&&(n+=" ".concat($(this).attr("subtype"))),n+="\r\n"}),n},o.prototype.fromJingle=function(e){var t=this;this.raw="v=0\r\no=- 1923518516 2 IN IP4 0.0.0.0\r\ns=-\r\nt=0 0\r\n";var n=$(e).find('>group[xmlns="urn:xmpp:jingle:apps:grouping:0"]');n.length&&n.each(function(e,n){var r=$(n).find(">content").map(function(e,t){return t.getAttribute("name")}).get();r.length>0&&(t.raw+="a=group:".concat(n.getAttribute("semantics")||n.getAttribute("type")," ").concat(r.join(" "),"\r\n"))}),this.session=this.raw,e.find(">content").each(function(){var e=t.jingle2media($(this));t.media.push(e)}),this.raw=this.session+this.media.join("")},o.prototype.jingle2media=function(e){var t=e.find("description"),n="",i=this,o=e.find('>transport>sctpmap[xmlns="urn:xmpp:jingle:transports:dtls-sctp:1"]'),a={media:t.attr("media"),port:"1"};if("rejected"===e.attr("senders")&&(a.port="0"),e.find(">transport>fingerprint").length||t.find("encryption").length?a.proto=o.length?"DTLS/SCTP":"RTP/SAVPF":a.proto="RTP/AVPF",o.length){n+="m=application ".concat(a.port," DTLS/SCTP ").concat(o.attr("number"),"\r\n"),n+="a=sctpmap:".concat(o.attr("number")," ").concat(o.attr("protocol"));var s=o.attr("streams");n+=s?" ".concat(s,"\r\n"):"\r\n"}else a.fmt=t.find("payload-type").map(function(){return this.getAttribute("id")}).get(),n+="".concat(r.a.buildMLine(a),"\r\n");switch(n+="c=IN IP4 0.0.0.0\r\n",o.length||(n+="a=rtcp:1 IN IP4 0.0.0.0\r\n"),(a=e.find('>transport[xmlns="urn:xmpp:jingle:transports:ice-udp:1"]')).length&&(a.attr("ufrag")&&(n+="".concat(r.a.buildICEUfrag(a.attr("ufrag")),"\r\n")),a.attr("pwd")&&(n+="".concat(r.a.buildICEPwd(a.attr("pwd")),"\r\n")),a.find(">fingerprint").each(function(){n+="a=fingerprint:".concat(this.getAttribute("hash")),n+=" ".concat($(this).text()),n+="\r\n",this.getAttribute("setup")&&(n+="a=setup:".concat(this.getAttribute("setup"),"\r\n"))})),e.attr("senders")){case"initiator":n+="a=sendonly\r\n";break;case"responder":n+="a=recvonly\r\n";break;case"none":n+="a=inactive\r\n";break;case"both":n+="a=sendrecv\r\n"}return n+="a=mid:".concat(e.attr("name"),"\r\n"),t.find("rtcp-mux").length&&(n+="a=rtcp-mux\r\n"),t.find("encryption").length&&t.find("encryption>crypto").each(function(){n+="a=crypto:".concat(this.getAttribute("tag")),n+=" ".concat(this.getAttribute("crypto-suite")),n+=" ".concat(this.getAttribute("key-params")),this.getAttribute("session-params")&&(n+=" ".concat(this.getAttribute("session-params"))),n+="\r\n"}),t.find("payload-type").each(function(){n+="".concat(r.a.buildRTPMap(this),"\r\n"),$(this).find(">parameter").length&&(n+="a=fmtp:".concat(this.getAttribute("id")," "),n+=$(this).find("parameter").map(function(){var e=this.getAttribute("name");return(e?"".concat(e,"="):"")+this.getAttribute("value")}).get().join("; "),n+="\r\n"),n+=i.rtcpFbFromJingle($(this),this.getAttribute("id"))}),n+=i.rtcpFbFromJingle(t,"*"),(a=t.find('>rtp-hdrext[xmlns="urn:xmpp:jingle:apps:rtp:rtp-hdrext:0"]')).each(function(){n+="a=extmap:".concat(this.getAttribute("id")," ").concat(this.getAttribute("uri"),"\r\n")}),e.find('>transport[xmlns="urn:xmpp:jingle:transports:ice-udp:1"]>candidate').each(function(){var e=this.getAttribute("protocol");e="string"==typeof e?e.toLowerCase():"",i.removeTcpCandidates&&("tcp"===e||"ssltcp"===e)||i.removeUdpCandidates&&"udp"===e||(i.failICE&&this.setAttribute("ip","1.1.1.1"),n+=r.a.candidateFromJingle(this))}),e.find('description>ssrc-group[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each(function(){var e=this.getAttribute("semantics"),t=$(this).find(">source").map(function(){return this.getAttribute("ssrc")}).get();t.length&&(n+="a=ssrc-group:".concat(e," ").concat(t.join(" "),"\r\n"))}),(a=e.find('description>source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]')).each(function(){var e=this.getAttribute("ssrc");$(this).find(">parameter").each(function(){var t=this.getAttribute("name"),i=this.getAttribute("value");i=r.a.filterSpecialChars(i),n+="a=ssrc:".concat(e," ").concat(t),i&&i.length&&(n+=":".concat(i)),n+="\r\n"})}),n}},function(e,t,n){"use strict";var r={};n.r(r),n.d(r,"CHROME",function(){return a}),n.d(r,"OPERA",function(){return s}),n.d(r,"FIREFOX",function(){return c}),n.d(r,"INTERNET_EXPLORER",function(){return u}),n.d(r,"EDGE",function(){return l}),n.d(r,"SAFARI",function(){return d}),n.d(r,"NWJS",function(){return f}),n.d(r,"ELECTRON",function(){return p}),n.d(r,"REACT_NATIVE",function(){return h}),n.d(r,"UNKNOWN",function(){return v});var i=n(47),o=n.n(i),a="chrome",s="opera",c="firefox",u="iexplorer",l="edge",d="safari",f="nwjs",p="electron",h="react-native",v="unknown";function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g={Chrome:a,Chromium:a,Opera:s,Firefox:c,"Internet Explorer":u,"Microsoft Edge":l,Safari:d};function y(){var e=navigator.userAgent;if(e.match(/Electron/)){var t=e.match(/Electron\/([\d.]+)/)[1];return{name:p,version:t}}}function b(){var e=navigator.userAgent;if(e.match(/JitsiMeetNW/)){var t=e.match(/JitsiMeetNW\/([\d.]+)/)[1];return{name:f,version:t}}}function S(){var e,t,n=navigator.userAgent.match(/\b(react[ \t_-]*native)(?:\/(\S+))?/i);if(n||"ReactNative"===navigator.product)return n&&n.length>2&&(t=n[1],e=n[2]),t||(t="react-native"),e||(e="unknown"),{name:h,version:e}}function _(){for(var e,t=[S,y,b],n=0;n<t.length;n++)if(e=t[n]())return e;var r=o.a.name,i=o.a.version;return r in g?{name:g[r],version:i}:(e=function(){var e=navigator.userAgent;if(Boolean(window.chrome)&&!e.match(/Edge/)&&e.match(/Chrome/)){var t=e.match(/Chrome\/([\d.]+)/)[1];return{name:a,version:t}}}())||{name:v,version:void 0}}var E,C,T,w=function(){function e(t){var n,r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),void 0===t){var i=_();n=i.name,r=i.version}else t.name in g?(n=g[t.name],r=t.version):(n=v,r=void 0);this._name=n,this._version=r}var t,n,r;return t=e,(n=[{key:"getName",value:function(){return this._name}},{key:"isChrome",value:function(){return this._name===a}},{key:"isOpera",value:function(){return this._name===s}},{key:"isFirefox",value:function(){return this._name===c}},{key:"isIExplorer",value:function(){return this._name===u}},{key:"isEdge",value:function(){return this._name===l}},{key:"isSafari",value:function(){return this._name===d}},{key:"isNWJS",value:function(){return this._name===f}},{key:"isElectron",value:function(){return this._name===p}},{key:"isReactNative",value:function(){return this._name===h}},{key:"getVersion",value:function(){return this._version}},{key:"compareVersion",value:function(e){if(this._version)return o.a.compareVersions([String(e),this._version])}},{key:"isVersionGreaterThan",value:function(e){return-1===this.compareVersion(e)}},{key:"isVersionLessThan",value:function(e){return 1===this.compareVersion(e)}},{key:"isVersionEqualTo",value:function(e){return 0===this.compareVersion(e)}}])&&m(t.prototype,n),r&&m(t,r),e}();E=w,C="compareVersions",T=o.a.compareVersions,C in E?Object.defineProperty(E,C,{value:T,enumerable:!0,configurable:!0,writable:!0}):E[C]=T;n(75);n.d(t,"a",function(){return w}),n.d(t,"b",function(){return r})},function(e,t,n){"use strict";n.r(t),n.d(t,"STATUS_AVAILABLE",function(){return r}),n.d(t,"STATUS_UNDEFINED",function(){return i}),n.d(t,"STATUS_BUSY",function(){return o}),n.d(t,"STATE_ON",function(){return a}),n.d(t,"STATE_OFF",function(){return s}),n.d(t,"STATE_PENDING",function(){return c}),n.d(t,"STATE_RETRYING",function(){return u}),n.d(t,"STATE_FAILED",function(){return l}),n.d(t,"ERROR_NO_CONNECTION",function(){return d}),n.d(t,"ERROR_SESSION_EXISTS",function(){return f});var r="available",i="undefined",o="busy",a="on",s="off",c="pending",u="retrying",l="failed",d="error_no_connection",f="error_session_already_exists"},function(e,t,n){"use strict";n.r(t),n.d(t,"AUTHENTICATION_REQUIRED",function(){return r}),n.d(t,"CHAT_ERROR",function(){return i}),n.d(t,"CONFERENCE_DESTROYED",function(){return o}),n.d(t,"CONFERENCE_MAX_USERS",function(){return a}),n.d(t,"CONNECTION_ERROR",function(){return s}),n.d(t,"NOT_ALLOWED_ERROR",function(){return c}),n.d(t,"FOCUS_DISCONNECTED",function(){return u}),n.d(t,"FOCUS_LEFT",function(){return l}),n.d(t,"GRACEFUL_SHUTDOWN",function(){return d}),n.d(t,"INCOMPATIBLE_SERVER_VERSIONS",function(){return f}),n.d(t,"JINGLE_FATAL_ERROR",function(){return p}),n.d(t,"PASSWORD_NOT_SUPPORTED",function(){return h}),n.d(t,"PASSWORD_REQUIRED",function(){return v}),n.d(t,"RESERVATION_ERROR",function(){return m}),n.d(t,"SETUP_FAILED",function(){return g}),n.d(t,"VIDEOBRIDGE_NOT_AVAILABLE",function(){return y});var r="conference.authenticationRequired",i="conference.chatError",o="conference.destroyed",a="conference.max_users",s="conference.connectionError",c="conference.connectionError.notAllowed",u="conference.focusDisconnected",l="conference.focusLeft",d="conference.gracefulShutdown",f="conference.incompatible_server_versions",p="conference.jingleFatalError",h="conference.passwordNotSupported",v="conference.passwordRequired",m="conference.reservationError",g="conference.setup_failed",y="conference.videobridgeNotAvailable"},function(e,t,n){"use strict";n.r(t),n.d(t,"CONNECTION_DISCONNECTED",function(){return r}),n.d(t,"CONNECTION_ESTABLISHED",function(){return i}),n.d(t,"CONNECTION_FAILED",function(){return o}),n.d(t,"WRONG_STATE",function(){return a});var r="connection.connectionDisconnected",i="connection.connectionEstablished",o="connection.connectionFailed",a="connection.wrongState"},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i}),n.d(t,"c",function(){return o}),n.d(t,"d",function(){return a});var r="statistics.audioLevel",i="statistics.before_disposed",o="statistics.byte_sent_stats",a="statistics.connectionstats"},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(29),i=n.n(r);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new i.a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.eventEmitter=t,this.addEventListener=this.on=this.addListener,this.removeEventListener=this.off=this.removeListener}var t,n,r;return t=e,(n=[{key:"addListener",value:function(e,t){this.eventEmitter.addListener(e,t)}},{key:"removeListener",value:function(e,t){this.eventEmitter.removeListener(e,t)}}])&&o(t.prototype,n),r&&o(t,r),e}()},function(e,t,n){"use strict";(function(e){var r,i,o=n(4),a=n(76),s=n.n(a),c=Object(o.getLogger)(e);function u(){var e;try{e=(window||this).localStorage}catch(e){c.error(e)}return e}function l(){return"".concat(Math.random().toString(16),"000000000").substr(2,8)}t.a={get callStatsUserName(){if(!r){var e=u();e&&(r=e.getItem("callStatsUserName")),r||(t=s.a.generateUsername(),c.log("generated callstats uid",t),r=t,e&&e.setItem("callStatsUserName",r))}var t;return r},get machineId(){if(!i){var e=u();e&&(i=e.getItem("jitsiMeetId")),i||(t=l()+l()+l()+l(),c.log("generated id",t),i=t,e&&e.setItem("jitsiMeetId",i))}var t;return i},get sessionId(){var e=u();return e?e.getItem("sessionId"):void 0},set sessionId(e){var t=u();t&&(e?t.setItem("sessionId",e):t.removeItem("sessionId"))}}}).call(this,"modules/settings/Settings.js")},function(e,t,n){"use strict";n.d(t,"a",function(){return o}),n.d(t,"b",function(){return a}),n.d(t,"c",function(){return s}),n.d(t,"d",function(){return c}),n.d(t,"e",function(){return u}),n.d(t,"f",function(){return l}),n.d(t,"g",function(){return d});var r=n(16),i=n.n(r);function o(e){var t=new Map,n=[],r=!0,o=!1,a=void 0;try{for(var s,c=e.media[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){var u=s.value,l=u.type;if("audio"===l||"video"===l){var d=!0,f=!1,p=void 0;try{for(var h,v=u.rtp[Symbol.iterator]();!(d=(h=v.next()).done);d=!0){var m=h.value,g={clockRate:m.rate,kind:l,mimeType:"".concat(l,"/").concat(m.codec),name:m.codec,numChannels:m.encoding||1,parameters:{},preferredPayloadType:m.payload,rtcpFeedback:[]};t.set(g.preferredPayloadType,g)}}catch(e){f=!0,p=e}finally{try{d||null==v.return||v.return()}finally{if(f)throw p}}var y=!0,b=!1,S=void 0;try{for(var _,E=(u.fmtp||[])[Symbol.iterator]();!(y=(_=E.next()).done);y=!0){var C=_.value,T=i.a.parseFmtpConfig(C.config),w=t.get(C.payload);w&&(w.parameters=T)}}catch(e){b=!0,S=e}finally{try{y||null==E.return||E.return()}finally{if(b)throw S}}var k=!0,R=!1,P=void 0;try{for(var I,O=(u.rtcpFb||[])[Symbol.iterator]();!(k=(I=O.next()).done);k=!0){var A=I.value,M=t.get(A.payload);M&&M.rtcpFeedback.push({parameter:A.subtype||"",type:A.type})}}catch(e){R=!0,P=e}finally{try{k||null==O.return||O.return()}finally{if(R)throw P}}var D=!0,N=!1,x=void 0;try{for(var L,j=function(){var e=L.value,t=e.value,r=e.uri,i={kind:l,uri:r,preferredId:t};n.find(function(e){return i.kind===e.kind&&i.uri===e.uri})||n.push(i)},F=(u.ext||[])[Symbol.iterator]();!(D=(L=F.next()).done);D=!0)j()}catch(e){N=!0,x=e}finally{try{D||null==F.return||F.return()}finally{if(N)throw x}}}}}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return{codecs:Array.from(t.values()),fecMechanisms:[],headerExtensions:n}}function a(e){var t,n=f(e),r=n.fingerprint||e.fingerprint;switch(n.setup){case"active":t="client";break;case"passive":t="server";break;case"actpass":t="auto"}return{role:t,fingerprints:[{algorithm:r.type,value:r.hash}]}}function s(e){var t=f(e),n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t.candidates[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value;if(1===c.component){var u={foundation:c.foundation,ip:c.ip,port:c.port,priority:c.priority,protocol:c.transport.toLowerCase(),type:c.type};n.push(u)}}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}function c(e){var t=f(e),n=t.iceUfrag,r=t.icePwd;return{icelite:"ice-lite"===e.icelite,password:r,usernameFragment:n}}function u(e){var t=new Map,n=!0,r=!1,i=void 0;try{for(var o,a=e.media[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;t.set(s.mid,s.type)}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return t}function l(e){var t=new Map,n=new Map,r=new Set,i=!0,o=!1,a=void 0;try{for(var s,c=e.media[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value,l=u.type;if("audio"===l||"video"===l){var d=!0,f=!1,p=void 0;try{for(var h,v=(u.ssrcGroups||[])[Symbol.iterator]();!(d=(h=v.next()).done);d=!0){var m=h.value;if("FID"===m.semantics){var g=m.ssrcs.split(" ").map(function(e){return Number(e)}),y=g[0],b=g[1];n.set(y,b),r.add(b)}}}catch(e){f=!0,p=e}finally{try{d||null==v.return||v.return()}finally{if(f)throw p}}var S=!0,_=!1,E=void 0;try{for(var C,T=(u.ssrcs||[])[Symbol.iterator]();!(S=(C=T.next()).done);S=!0){var w=C.value,k=w.id;if(!r.has(k)){var R=t.get(k);switch(R||(R={kind:l,rtxSsrc:n.get(k),ssrc:k},t.set(k,R)),w.attribute){case"cname":R.cname=w.value;break;case"msid":var P=w.value.split(" "),I=P[0],O=P[1];R.streamId=I,R.trackId=O;break;case"mslabel":var A=w.value;R.streamId=A;break;case"label":var M=w.value;R.trackId=M}}}}catch(e){_=!0,E=e}finally{try{S||null==T.return||T.return()}finally{if(_)throw E}}}}}catch(e){o=!0,a=e}finally{try{i||null==c.return||c.return()}finally{if(o)throw a}}return t}function d(e){var t=RTCRtpReceiver.getCapabilities(),n={codecs:[],fecMechanisms:[],headerExtensions:[]},r=new Map,i=!0,o=!1,a=void 0;try{for(var s,c=function(){var e=s.value,i=e.name.toLowerCase();if("rtx"===i)return r.set(e.parameters.apt,e.preferredPayloadType),"continue";var o=t.codecs.find(function(t){return t.name.toLowerCase()===i&&t.kind===e.kind&&t.clockRate===e.clockRate});if(!o)return"continue";for(var a={clockRate:o.clockRate,kind:o.kind,mimeType:"".concat(o.kind,"/").concat(o.name),name:o.name,numChannels:o.numChannels||1,parameters:{},preferredPayloadType:e.preferredPayloadType,rtcpFeedback:[]},c=Object.keys(e.parameters),u=0;u<c.length;u++)for(var l=c[u],d=e.parameters[l],f=Object.keys(o.parameters),p=0;p<f.length;p++){var h=f[p],v=o.parameters[h];if(h===l&&v===d){a.parameters[h]=v;break}}var m=!0,g=!1,y=void 0;try{for(var b,S=function(){var e=b.value,t=o.rtcpFeedback.find(function(t){return t.type===e.type&&t.parameter===e.parameter});t&&a.rtcpFeedback.push(t)},_=e.rtcpFeedback[Symbol.iterator]();!(m=(b=_.next()).done);m=!0)S()}catch(e){g=!0,y=e}finally{try{m||null==_.return||_.return()}finally{if(g)throw y}}n.codecs.push(a)},u=e.codecs[Symbol.iterator]();!(i=(s=u.next()).done);i=!0)c()}catch(e){o=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}var l=!0,d=!1,f=void 0;try{for(var p,h=n.codecs[Symbol.iterator]();!(l=(p=h.next()).done);l=!0){var v=p.value,m=v.preferredPayloadType;if(r.has(m)){var g={clockRate:v.clockRate,kind:v.kind,mimeType:"".concat(v.kind,"/rtx"),name:"rtx",parameters:{apt:m},preferredPayloadType:r.get(m),rtcpFeedback:[]};n.codecs.push(g)}}}catch(e){d=!0,f=e}finally{try{l||null==h.return||h.return()}finally{if(d)throw f}}var y=!0,b=!1,S=void 0;try{for(var _,E=function(){var e=_.value,r=t.headerExtensions.find(function(t){return t.kind===e.kind&&t.uri===e.uri});if(r){var i={kind:r.kind,preferredEncrypt:Boolean(e.preferredEncrypt),preferredId:e.preferredId,uri:r.uri};n.headerExtensions.push(i)}},C=e.headerExtensions[Symbol.iterator]();!(y=(_=C.next()).done);y=!0)E()}catch(e){b=!0,S=e}finally{try{y||null==C.return||C.return()}finally{if(b)throw S}}var T=!0,w=!1,k=void 0;try{for(var R,P=function(){var e=R.value,r=t.fecMechanisms.find(function(t){return t===e});r&&n.fecMechanisms.push(r)},I=e.fecMechanisms[Symbol.iterator]();!(T=(R=I.next()).done);T=!0)P()}catch(e){w=!0,k=e}finally{try{T||null==I.return||I.return()}finally{if(w)throw k}}return n}function f(e){return e.media.find(function(e){return e.iceUfrag&&0!==e.port})}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o(e){var t="function"==typeof Map?new Map:void 0;return(o=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return a(e,arguments,c(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s(r,e)})(e)}function a(e,t,n){return(a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&s(i,n.prototype),i}).apply(null,arguments)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n.d(t,"a",function(){return l});var u,l=(u="InvalidStateError",function(e){function t(e){var n,o,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,n=!(a=c(t).call(this,e))||"object"!==r(a)&&"function"!=typeof a?i(o):a,Object.defineProperty(i(i(n)),"name",{value:u}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,o(Error)),t}())},function(e,t,n){"use strict";n.d(t,"b",function(){return s}),n.d(t,"c",function(){return c}),n.d(t,"a",function(){return d});var r=n(16);function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function s(e){return parseInt(e.ssrcs.split(" ")[0],10)}function c(e){return parseInt(e.ssrcs.split(" ")[1],10)}function u(e){return e.ssrcs?e.ssrcs.map(function(e){return e.id}).filter(function(e,t,n){return n.indexOf(e)===t}).length:0}var l=function(){function e(t){if(i(this,e),!t)throw new Error("mLine is undefined");this.mLine=t}return a(e,[{key:"getSSRCAttrValue",value:function(e,t){var n=this.ssrcs.find(function(n){return n.id===e&&n.attribute===t});return n&&n.value}},{key:"removeSSRC",value:function(e){this.mLine.ssrcs&&this.mLine.ssrcs.length&&(this.mLine.ssrcs=this.mLine.ssrcs.filter(function(t){return t.id!==e}))}},{key:"addSSRCAttribute",value:function(e){this.ssrcs.push(e)}},{key:"findGroup",value:function(e,t){return this.ssrcGroups.find(function(n){return n.semantics===e&&(!t||t===n.ssrcs)})}},{key:"findGroups",value:function(e){return this.ssrcGroups.filter(function(t){return t.semantics===e})}},{key:"findGroupByPrimarySSRC",value:function(e,t){return this.ssrcGroups.find(function(n){return n.semantics===e&&s(n)===t})}},{key:"findSSRCByMSID",value:function(e){return this.ssrcs.find(function(t){return"msid"===t.attribute&&(null===e||t.value===e)})}},{key:"getSSRCCount",value:function(){return u(this.mLine)}},{key:"containsAnySSRCGroups",value:function(){return void 0!==this.mLine.ssrcGroups}},{key:"getPrimaryVideoSsrc",value:function(){var e=this.mLine.type;if("video"!==e)throw new Error("getPrimarySsrc doesn't work with '".concat(e,"'"));if(1===u(this.mLine))return this.mLine.ssrcs[0].id;if(this.mLine.ssrcGroups){var t=this.findGroup("SIM");if(t)return s(t);var n=this.findGroup("FID");if(n)return s(n);var r=this.findGroup("FEC-FR");if(r)return s(r)}}},{key:"getRtxSSRC",value:function(e){var t=this.findGroupByPrimarySSRC("FID",e);return t&&c(t)}},{key:"getSSRCs",value:function(){return this.ssrcs.map(function(e){return e.id}).filter(function(e,t,n){return n.indexOf(e)===t})}},{key:"getPrimaryVideoSSRCs",value:function(){var e=this.mLine.type;if("video"!==e)throw new Error("getPrimaryVideoSSRCs doesn't work with ".concat(e));var t=this.getSSRCs(),n=!0,r=!1,i=void 0;try{for(var o,a=this.ssrcGroups[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if("FID"===s.semantics||"FEC-FR"===s.semantics){var u=c(s);t.splice(t.indexOf(u),1)}}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return t}},{key:"dumpSSRCGroups",value:function(){return JSON.stringify(this.mLine.ssrcGroups)}},{key:"removeGroupsWithSSRC",value:function(e){this.mLine.ssrcGroups&&(this.mLine.ssrcGroups=this.mLine.ssrcGroups.filter(function(t){return-1===t.ssrcs.indexOf("".concat(e))}))}},{key:"removeGroupsBySemantics",value:function(e){this.mLine.ssrcGroups&&(this.mLine.ssrcGroups=this.mLine.ssrcGroups.filter(function(t){return t.semantics!==e}))}},{key:"replaceSSRC",value:function(e,t){this.mLine.ssrcs&&this.mLine.ssrcs.forEach(function(n){n.id===e&&(n.id=t)})}},{key:"addSSRCGroup",value:function(e){this.ssrcGroups.push(e)}},{key:"ssrcs",get:function(){return this.mLine.ssrcs||(this.mLine.ssrcs=[]),this.mLine.ssrcs},set:function(e){this.mLine.ssrcs=e}},{key:"direction",get:function(){return this.mLine.direction},set:function(e){this.mLine.direction=e}},{key:"ssrcGroups",get:function(){return this.mLine.ssrcGroups||(this.mLine.ssrcGroups=[]),this.mLine.ssrcGroups},set:function(e){this.mLine.ssrcGroups=e}}]),e}(),d=function(){function e(t){i(this,e),this.parsedSDP=r.parse(t)}return a(e,[{key:"selectMedia",value:function(e){var t=this.parsedSDP.media.find(function(t){return t.type===e});return t?new l(t):null}},{key:"toRawSDP",value:function(){return r.write(this.parsedSDP)}}]),e}()},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,a,s,c,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(o(n=this._events[e]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(i(n))for(s=Array.prototype.slice.call(arguments,1),a=(u=n.slice()).length,c=0;c<a;c++)u[c].apply(this,s);return!0},n.prototype.addListener=function(e,t){var a;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(a=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&a>0&&this._events[e].length>a&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){if(!r(t))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},n.prototype.removeListener=function(e,t){var n,o,a,s;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(a=(n=this._events[e]).length,o=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(n)){for(s=a;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){o=s;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t){e.exports={1080:{width:1920,height:1080,order:7},fullhd:{width:1920,height:1080,order:7},720:{width:1280,height:720,order:6},hd:{width:1280,height:720,order:6},960:{width:960,height:720,order:5},360:{width:640,height:360,order:4},640:{width:640,height:480,order:3},vga:{width:640,height:480,order:3},180:{width:320,height:180,order:2},320:{width:320,height:240,order:1}}},function(e,t,n){"use strict";n.d(t,"c",function(){return r}),n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o});var r="pending",i="active",o="ended"},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return M});var r=n(3),i=n(10),o=n.n(i);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}var c,u=n(4).getLogger(e),l="createOffer",d="createAnswer",f="setLocalDescription",p="setRemoteDescription",h="addIceCandidate",v="getUserMedia",m="iceConnectionFailure",g="applicationLog",y="fabricHold",b="fabricResume",S="audioMute",_="audioUnmute",E="videoPause",C="videoResume",T="screenShareStart",w="screenShareStop",k="dominantSpeaker",R="activeDeviceList",P="jitsi",I="error",O="event",A="mstWithUserID",M=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.confID=n.confID,this.tpc=t,this.peerconnection=t.peerconnection,this.remoteUserID=n.remoteUserID||P,this.hasFabric=!1,e.fabrics.add(this),e.backendInitialized&&(this._addNewFabric(),1===e.fabrics.size&&e._emptyReportQueue(this))}return s(e,null,[{key:"_addNewFabricCallback",value:function(t,n){e.backend&&"success"!==t&&u.error("Monitoring status: ".concat(t," msg: ").concat(n))}},{key:"_initCallback",value:function(t,n){if(u.log("CallStats Status: err=".concat(t," msg=").concat(n)),"success"===t){e.backendInitialized=!0;var r=!1,i=null,o=!0,a=!1,s=void 0;try{for(var c,l=e.fabrics.values()[Symbol.iterator]();!(o=(c=l.next()).done);o=!0){var d=c.value;d.hasFabric||(u.debug("addNewFabric - initCallback"),d._addNewFabric()&&(r=!0,i||(i=d)))}}catch(e){a=!0,s=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw s}}r&&e._emptyReportQueue(i)}}},{key:"_emptyReportQueue",value:function(t){var n=t.confID,r=t.peerconnection,i=!0,o=!1,a=void 0;try{for(var s,c=e.reportsQueue[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;if(u.type===I){var l=u.data;e._reportError(t,l.type,l.error,l.pc||r)}else if(u.type===O){var d=u.data;e.backend.sendFabricEvent(u.pc||r,d.event,n,d.eventData)}else if(u.type===A){var f=u.data;e.backend.associateMstWithUserID(u.pc||r,f.callStatsId,n,f.ssrc,f.usageLabel,f.containerId)}}}catch(e){o=!0,a=e}finally{try{i||null==c.return||c.return()}finally{if(o)throw a}}e.reportsQueue.length=0}},{key:"_reportError",value:function(t,n,r,i){var o=r;o||(u.warn("No error is passed!"),o=new Error("Unknown error")),e.backendInitialized&&t?e.backend.reportError(i,t.confID,n,o):e.reportsQueue.push({type:I,data:{error:o,pc:i,type:n}})}},{key:"_reportEvent",value:function(t,n,r){var i=t&&t.peerconnection,o=t&&t.confID;e.backendInitialized&&t?e.backend.sendFabricEvent(i,n,o,r):e.reportsQueue.push({confID:o,pc:i,type:O,data:{event:n,eventData:r}})}},{key:"_traceAndCatchBackendCalls",value:function(e){for(var t=["associateMstWithUserID","sendFabricEvent","sendUserFeedback"],n=function(){var n=t[i],r=e[n];e[n]=function(){try{for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return r.apply(e,n)}catch(e){o.a.callErrorHandler(e)}}},i=0;i<t.length;i++)n();for(var a=["associateMstWithUserID","sendFabricEvent","sendUserFeedback"],s=function(){var t=a[c],n=e[t];e[t]=function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];u.debug(t,i),n.apply(e,i)}},c=0;c<a.length;c++)s();var l=e.reportError;e.reportError=function(t,n,i){for(var a=arguments.length,s=new Array(a>3?a-3:0),c=3;c<a;c++)s[c-3]=arguments[c];i===g?r.a.isReactNative()||console&&console.debug("reportError",t,n,i):u.debug.apply(u,["reportError",t,n,i].concat(s));try{l.call.apply(l,[e,t,n,i].concat(s))}catch(e){i===g?console&&console.error("reportError",e):o.a.callErrorHandler(e)}}}},{key:"initBackend",value:function(t){if(e.backend)throw new Error("CallStats backend has been initialized already!");try{var i,a=r.a.isReactNative()?n(122):callstats;e.backend=new a,e._traceAndCatchBackendCalls(e.backend),e.userID={aliasName:t.aliasName,userName:t.userName},e.callStatsID=t.callStatsID,e.callStatsSecret=t.callStatsSecret,t.applicationName&&(i={applicationVersion:"".concat(t.applicationName," (").concat(r.a.getName(),")")}),e.backend.initialize(e.callStatsID,e.callStatsSecret,e.userID,e._initCallback,void 0,i);var s=t.getWiFiStatsMethod;return s&&(e.backend.attachWifiStatsHandler(s),s().then(function(e){e&&u.info("Reported wifi addresses:",JSON.parse(e).addresses)}).catch(function(){})),!0}catch(t){return o.a.callErrorHandler(t),e.backend=null,u.error(t),!1}}},{key:"isBackendInitialized",value:function(){return Boolean(e.backend)}},{key:"sendActiveDeviceListEvent",value:function(t,n){e._reportEvent(n,R,t)}},{key:"sendApplicationLog",value:function(t,n){try{e._reportError(n,g,t,n&&n.peerconnection)}catch(e){console&&"function"==typeof console.error&&console.error("sendApplicationLog failed",e)}}},{key:"sendFeedback",value:function(t,n,r){e.backend?e.backend.sendUserFeedback(t,{userID:e.userID,overall:n,comment:r}):u.error("Failed to submit feedback to CallStats - no backend")}},{key:"sendGetUserMediaFailed",value:function(t,n){e._reportError(n,v,t,null)}},{key:"sendMuteEvent",value:function(t,n,r){var i;i="video"===n?t?E:C:t?S:_,e._reportEvent(r,i)}},{key:"fabrics",get:function(){return c||(c=new Set),c}}]),s(e,[{key:"_addNewFabric",value:function(){u.info("addNewFabric",this.remoteUserID);try{var t={remoteEndpointType:this.tpc.isP2P?e.backend.endpointType.peer:e.backend.endpointType.server},n=e.backend.addNewFabric(this.peerconnection,this.remoteUserID,e.backend.fabricUsage.multiplex,this.confID,t,e._addNewFabricCallback);this.hasFabric=!0;var r="success"===n.status;return r||u.error("callstats fabric not initilized",n.message),r}catch(e){return o.a.callErrorHandler(e),!1}}},{key:"associateStreamWithVideoTag",value:function(t,n,r,i,o){if(e.backend){var a=n?e.userID:r;e.backendInitialized?e.backend.associateMstWithUserID(this.peerconnection,a,this.confID,t,i,o):e.reportsQueue.push({type:A,pc:this.peerconnection,data:{callStatsId:a,containerId:o,ssrc:t,usageLabel:i}})}}},{key:"sendDominantSpeakerEvent",value:function(){e._reportEvent(this,k)}},{key:"sendTerminateEvent",value:function(){e.backendInitialized&&e.backend.sendFabricEvent(this.peerconnection,e.backend.fabricEvent.fabricTerminated,this.confID),e.fabrics.delete(this)}},{key:"sendIceConnectionFailedEvent",value:function(){e._reportError(this,m,null,this.peerconnection)}},{key:"sendCreateOfferFailed",value:function(t){e._reportError(this,l,t,this.peerconnection)}},{key:"sendCreateAnswerFailed",value:function(t){e._reportError(this,d,t,this.peerconnection)}},{key:"sendResumeOrHoldEvent",value:function(t){e._reportEvent(this,t?b:y)}},{key:"sendScreenSharingEvent",value:function(t,n){var r;n&&(r={ssrc:n}),e._reportEvent(this,t?T:w,r)}},{key:"sendSetLocalDescFailed",value:function(t){e._reportError(this,f,t,this.peerconnection)}},{key:"sendSetRemoteDescFailed",value:function(t){e._reportError(this,p,t,this.peerconnection)}},{key:"sendAddIceCandidateFailed",value:function(t){e._reportError(this,h,t,this.peerconnection)}}]),e}();M.backend=null,M.reportsQueue=[],M.backendInitialized=!1,M.callStatsID=null,M.callStatsSecret=null,M.userID=null}).call(this,"modules/statistics/CallStats.js")},function(e,t,n){"use strict";n.r(t),n.d(t,"LOCAL_STATS_UPDATED",function(){return r}),n.d(t,"REMOTE_STATS_UPDATED",function(){return i});var r="cq.local_stats_updated",i="cq.remote_stats_updated"},function(e,t,n){e.exports={EventTarget:n(128),Event:n(129)}},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var r=n(24);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return function e(){u(this,e)}}();return function(t){function n(){var e,t;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=a(this,(e=s(n)).call.apply(e,[this].concat(i)))).connection=null,t}var r,i,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(n,e),r=n,(i=[{key:"init",value:function(e){this.connection=e}}])&&o(r.prototype,i),l&&o(r,l),n}()}t.b=l();var d=l(r.a)},function(e,t){var n="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function r(e,t){return Math.floor(Math.random()*(t-e+1))+e}function i(e){return e[r(0,e.length-1)]}var o={randomHexDigit:function(){return i("0123456789abcdef")},randomHexString:function(e){for(var t="";e--;)t+=this.randomHexDigit();return t},randomElement:i,randomAlphanumStr:function(e){for(var t="",r=0;r<e;r+=1)t+=i(n);return t},randomInt:r};e.exports=o},function(e,t,n){"use strict";n.r(t),n.d(t,"CONNECTION_DROPPED_ERROR",function(){return r}),n.d(t,"OTHER_ERROR",function(){return i}),n.d(t,"PASSWORD_REQUIRED",function(){return o}),n.d(t,"SERVER_ERROR",function(){return a});var r="connection.droppedError",i="connection.otherError",o="connection.passwordRequired",a="connection.serverError"},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i});var r="signaling.peerMuted",i="signaling.peerVideoType"},function(e,t,n){"use strict";(function(e){var r=n(15),i=n(12),o=n(3);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=n(4).getLogger(e),c=n(10),u=!1,l=!1,d=null,f={intChromeExtPromise:null,obtainStream:null,init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{desktopSharingChromeDisabled:!1,desktopSharingChromeExtId:null,desktopSharingFirefoxDisabled:!1},t=arguments.length>1?arguments[1]:void 0;this.options=e,d=t,this.obtainStream=this._createObtainStreamMethod(e),this.obtainStream||s.info("Desktop sharing disabled")},_createObtainStreamMethod:function(e){var t=this;return o.a.isNWJS()?function(e,t,n){window.JitsiMeetNW.obtainDesktopStream(t,function(e,t){var o;o=e&&"InvalidStateError"===e.name?new r.a(i.CHROME_EXTENSION_USER_CANCELED):new r.a(e,t,["desktop"]),"function"==typeof n&&n(o)})}:o.a.isElectron()?this.obtainScreenOnElectron:o.a.isChrome()||o.a.isOpera()?o.a.supportsGetDisplayMedia()&&!e.desktopSharingChromeDisabled?this.obtainScreenFromGetDisplayMedia:e.desktopSharingChromeDisabled||!e.desktopSharingChromeExtId?null:(s.info("Using Chrome extension for desktop sharing"),this.intChromeExtPromise=function(e){return function(e){0===$("link[rel=chrome-webstore-item]").length&&$("head").append('<link rel="chrome-webstore-item">'),$("link[rel=chrome-webstore-item]").attr("href",p(e))}(e),new Promise(function(t){h(function(e,n){u=e,l=n,s.info("Chrome extension installed: ".concat(u," updateRequired: ").concat(l)),t()},e)})}(e).then(function(){t.intChromeExtPromise=null}),this.obtainScreenFromExtension):o.a.isFirefox()?e.desktopSharingFirefoxDisabled?null:"http:"===window.location.protocol?(s.log("Screen sharing is not supported over HTTP. Use of HTTPS is required."),null):this.obtainScreenOnFirefox:o.a.isEdge()&&o.a.supportsGetDisplayMedia()?this.obtainScreenFromGetDisplayMedia:(s.log("Screen sharing not supported by the current browser: ",o.a.getName()),null)},isSupported:function(){return null!==this.obtainStream},obtainScreenOnFirefox:function(e,t,n){!function(e,t,n){d(["screen"],e).then(function(e){return t({stream:e})},n)}(e.gumOptions,t,n)},obtainScreenOnElectron:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;if(window.JitsiMeetScreenObtainer&&window.JitsiMeetScreenObtainer.openDesktopPicker){var o=e.desktopSharingSources,a=e.gumOptions;window.JitsiMeetScreenObtainer.openDesktopPicker({desktopSharingSources:o||this.options.desktopSharingChromeSources},function(e,r){return v({response:{streamId:e,streamType:r},gumOptions:a},t,n)},function(e){return n(new r.a(i.ELECTRON_DESKTOP_PICKER_ERROR,e))})}else n(new r.a(i.ELECTRON_DESKTOP_PICKER_NOT_FOUND))},obtainScreenFromExtension:function(e,t,n){var o=this;if(null===this.intChromeExtPromise){var a=this.options,c=a.desktopSharingChromeExtId,d=a.desktopSharingChromeSources,f=e.gumOptions,p={desktopSharingChromeExtId:c,desktopSharingChromeSources:e.desktopSharingSources||d,gumOptions:f};u?function(e,t,n){var o=e.desktopSharingChromeSources,a=e.desktopSharingChromeExtId,c=e.gumOptions;chrome.runtime.sendMessage(a,{getStream:!0,sources:o},function(e){if(e)s.log("Response from extension: ",e),v({response:e,gumOptions:c},t,n);else{var o=chrome.runtime.lastError;n(o instanceof Error?o:new r.a(i.CHROME_EXTENSION_GENERIC_ERROR,o))}})}(p,t,n):(l&&alert("Jitsi Desktop Streamer requires update. Changes will take effect after next Chrome restart."),this.handleExternalInstall(e,t,n))}else this.intChromeExtPromise.then(function(){o.obtainScreenFromExtension(e,t,n)})},handleExternalInstall:function(e,t,n,r){var i=p(this.options);e.listener("waitingForExtension",i),this.checkForChromeExtensionOnInterval(e,t,n,r)},checkForChromeExtensionOnInterval:function(e,t,n){var o=this;!1!==e.checkAgain()?function(e,t,n){if(0===n)return Promise.reject();return new Promise(function(r,i){var o=n,a=window.setInterval(function(){h(function(e){e?(window.clearInterval(a),r()):0===--o&&(i(),window.clearInterval(a))},e)},t)})}(this.options,e.interval,1).then(function(){u=!0,e.listener("extensionFound"),o.obtainScreenFromExtension(e,t,n)}).catch(function(){o.checkForChromeExtensionOnInterval(e,t,n)}):n(new r.a(i.CHROME_EXTENSION_INSTALLATION_ERROR))},obtainScreenFromGetDisplayMedia:function(e,t,n){(navigator.getDisplayMedia?navigator.getDisplayMedia.bind(navigator):navigator.mediaDevices.getDisplayMedia.bind(navigator.mediaDevices))({video:!0}).then(function(n){(n&&n.getTracks()&&n.getTracks().length>0?n.getTracks()[0].applyConstraints(e.trackOptions):Promise.resolve()).then(function(){return t({stream:n,sourceId:n.id})})}).catch(function(){return n(new r.a(i.CHROME_EXTENSION_USER_CANCELED))})}};function p(e){return"https://chrome.google.com/webstore/detail/".concat(e.desktopSharingChromeExtId)}function h(e,t){"undefined"!=typeof chrome&&chrome&&chrome.runtime?chrome.runtime.sendMessage(t.desktopSharingChromeExtId,{getVersion:!0},function(n){if(!n||!n.version)return s.warn("Extension not installed?: ",chrome.runtime.lastError),void e(!1,!1);var r=n.version;s.log("Extension version is: ".concat(r));var i=function(e,t){try{for(var n=e.split("."),r=t.split("."),i=Math.max(n.length,r.length),o=0;o<i;o++){var a=0,u=0;if(o<n.length&&(a=parseInt(n[o],10)),o<r.length&&(u=parseInt(r[o],10)),isNaN(a)||isNaN(u))return!0;if(a!==u)return a>u}return!1}catch(e){return c.callErrorHandler(e),s.error("Failed to parse extension version",e),!0}}(t.desktopSharingChromeMinExtVersion,r);e(!i,i)}):e(!1,!1)}function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{response:{},gumOptions:{}},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,o=e.response||{},s=o.streamId,c=o.streamType,u=o.error;if(s){var l=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}({desktopStream:s},e.gumOptions);d(["desktop"],l).then(function(e){return t({stream:e,sourceId:s,sourceType:c})},n)}else{if(""===s)return void n(new r.a(i.CHROME_EXTENSION_USER_CANCELED));n(new r.a(i.CHROME_EXTENSION_GENERIC_ERROR,u))}}t.a=f}).call(this,"modules/RTC/ScreenObtainer.js")},function(e,t,n){"use strict";var r=!0,i=!0,o={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(r=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(i=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(r)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){i&&console.warn(e+" is deprecated, please use "+t+" instead.")},extractVersion:function(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)},detectBrowser:function(e){var t=e&&e.navigator,n={browser:null,version:null};if(void 0===e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=this.extractVersion(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)if(e.webkitRTCPeerConnection)n.browser="chrome",n.version=this.extractVersion(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!t.userAgent.match(/Version\/(\d+).(\d+)/))return n.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",n;n.browser="safari",n.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=this.extractVersion(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!t.mediaDevices||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return n}};e.exports={log:o.log,deprecated:o.deprecated,disableLog:o.disableLog,disableWarnings:o.disableWarnings,extractVersion:o.extractVersion,shimCreateObjectURL:o.shimCreateObjectURL,detectBrowser:o.detectBrowser.bind(o)}},function(e,t){e.exports={ENVIRONMENT:"environment",USER:"user"}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return P}),n.d(t,"b",function(){return I});var r=n(4),i=n(1),o=(n(125),n(36)),a=n.n(o),s=n(37),c=n(22),u=n(3),l=n(80),d=n(83),f=n(89),p=n(90),h=n(91),v=n(92),m=n(24),g=n(93),y=n(10),b=n.n(y),S=n(0),_=n.n(S);function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var R=Object(r.getLogger)(e);var P="type",I=function(e){function t(e,n){var r,o,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(r=!(a=T(t).call(this))||"object"!==E(a)&&"function"!=typeof a?k(o):a).connection=null,r.disconnectInProgress=!1,r.connectionTimes={},r.options=e,r.token=n,r.authenticatedUser=!1,r._initStrophePlugins(k(k(r))),r.connection=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/http-bind";e&&(t+="".concat(-1===t.indexOf("?")?"?":"&","token=").concat(e));var n=new i.Strophe.Connection(t);return n.maxRetries=3,n}(n,e.bosh),r.caps=new g.a(r.connection,r.options.clientNode),r.initFeaturesList(),$(window).on("beforeunload unload",r.disconnect.bind(k(k(r)))),r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,m["a"]),n=t,(r=[{key:"initFeaturesList",value:function(){this.caps.addFeature("urn:xmpp:jingle:1"),this.caps.addFeature("urn:xmpp:jingle:apps:rtp:1"),this.caps.addFeature("urn:xmpp:jingle:transports:ice-udp:1"),this.caps.addFeature("urn:xmpp:jingle:apps:dtls:0"),this.caps.addFeature("urn:xmpp:jingle:transports:dtls-sctp:1"),this.caps.addFeature("urn:xmpp:jingle:apps:rtp:audio"),this.caps.addFeature("urn:xmpp:jingle:apps:rtp:video"),!this.options.disableRtx&&u.a.supportsRtx()&&this.caps.addFeature("urn:ietf:rfc:4588"),this.caps.addFeature("urn:ietf:rfc:5761"),this.caps.addFeature("urn:ietf:rfc:5888"),u.a.isChrome()&&!1!==this.options.enableLipSync&&(R.info("Lip-sync enabled !"),this.caps.addFeature("http://jitsi.org/meet/lipsync")),this.connection.rayo&&this.caps.addFeature("urn:xmpp:rayo:client:1")}},{key:"getConnection",value:function(){return this.connection}},{key:"connectionHandler",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,o=window.performance.now(),a=i.Strophe.getStatusString(n).toLowerCase();if(this.connectionTimes[a]=o,R.log("(TIME) Strophe ".concat(a).concat(r?"[".concat(r,"]"):"",":\t"),o),n===i.Strophe.Status.CONNECTED||n===i.Strophe.Status.ATTACHED){(this.options.useStunTurn||this.options.p2p&&this.options.p2p.useStunTurn)&&this.connection.jingle.getStunAndTurnCredentials(),R.info("My Jabber ID: ".concat(this.connection.jid));var u=this.connection.domain;this.caps.getFeaturesAndIdentities(u).then(function(t){var n=t.features,r=t.identities;n.has(i.Strophe.NS.PING)?e.connection.ping.startInterval(u):R.warn("Ping NOT supported by ".concat(u)),r.forEach(function(t){"speakerstats"===t.type&&(e.speakerStatsComponentAddress=t.name,e.connection.addHandler(e._onPrivateMessage.bind(e),null,"message",null,null))})}).catch(function(e){var t="Feature discovery error";b.a.callErrorHandler(new Error("".concat(t,": ").concat(e))),R.error(t,e)}),t.password&&(this.authenticatedUser=!0),this.connection&&this.connection.connected&&i.Strophe.getResourceFromJid(this.connection.jid)&&this.eventEmitter.emit(c.CONNECTION_ESTABLISHED,i.Strophe.getResourceFromJid(this.connection.jid))}else if(n===i.Strophe.Status.CONNFAIL)"x-strophe-bad-non-anon-jid"===r?this.anonymousConnectionFailed=!0:this.connectionFailed=!0,this.lastErrorMsg=r,"giving-up"===r&&this.eventEmitter.emit(c.CONNECTION_FAILED,s.OTHER_ERROR,r);else if(n===i.Strophe.Status.DISCONNECTED){this.connection.ping.stopInterval();var l=this.disconnectInProgress,d=r||this.lastErrorMsg;if(this.disconnectInProgress=!1,this.anonymousConnectionFailed)this.eventEmitter.emit(c.CONNECTION_FAILED,s.PASSWORD_REQUIRED);else if(this.connectionFailed)this.eventEmitter.emit(c.CONNECTION_FAILED,s.OTHER_ERROR,d,void 0,this._getConnectionFailedReasonDetails());else if(l)this.eventEmitter.emit(c.CONNECTION_DISCONNECTED,d);else{R.error("XMPP connection dropped!");var f=i.Strophe.getLastErrorStatus();f>=500&&f<600?this.eventEmitter.emit(c.CONNECTION_FAILED,s.SERVER_ERROR,d||"server-error"):this.eventEmitter.emit(c.CONNECTION_FAILED,s.CONNECTION_DROPPED_ERROR,d||"connection-dropped-error")}}else n===i.Strophe.Status.AUTHFAIL&&this.eventEmitter.emit(c.CONNECTION_FAILED,s.PASSWORD_REQUIRED,r,t)}},{key:"_connect",value:function(e,t){this.anonymousConnectionFailed=!1,this.connectionFailed=!1,this.lastErrorMsg=void 0,this.connection.connect(e,t,this.connectionHandler.bind(this,{jid:e,password:t}))}},{key:"attach",value:function(e){var t=this.connectionTimes.attaching=window.performance.now();R.log("(TIME) Strophe Attaching\t:".concat(t)),this.connection.attach(e.jid,e.sid,parseInt(e.rid,10)+1,this.connectionHandler.bind(this,{jid:e.jid,password:e.password}))}},{key:"connect",value:function(e,t){if(!e){var n=this.options.hosts,r=n.anonymousdomain,i=n.domain,o=r||i,a=window.location;if(r){var s=a&&a.search;(s&&-1!==s.indexOf("login=true")||this.token)&&(o=i)}e=o||a&&a.hostname}return this._connect(e,t)}},{key:"createRoom",value:function(e,t){var n=i.Strophe.getNodeFromJid(this.connection.jid),r="".concat(e,"@").concat(this.options.hosts.muc,"/"),o=t.useNicks&&t.nick?t.nick:null;return o?n=t.nick:this.authenticatedUser||(n=n.substr(0,8)),(this.authenticatedUser||null!==o)&&(n+="-".concat(a.a.randomHexString(6))),r+=n,this.connection.emuc.createRoom(r,null,t)}},{key:"getJingleLog",value:function(){var e=this.connection.jingle;return e?e.getLog():{}}},{key:"getXmppLog",value:function(){return(this.connection.logger||{}).log||null}},{key:"dial",value:function(){var e;(e=this.connection.rayo).dial.apply(e,arguments)}},{key:"setMute",value:function(e,t){this.connection.moderate.setMute(e,t)}},{key:"eject",value:function(e){this.connection.moderate.eject(e)}},{key:"getSessions",value:function(){return this.connection.jingle.sessions}},{key:"disconnect",value:function(e){if(!this.disconnectInProgress&&this.connection){if(this.disconnectInProgress=!0,this.connection.flush(),null!=e){var t=e.type;"beforeunload"!==t&&"unload"!==t||(this.connection.options.sync=!0)}this.connection.disconnect(),!0!==this.connection.options.sync&&this.connection.flush()}else this.eventEmitter.emit(c.WRONG_STATE)}},{key:"_initStrophePlugins",value:function(){var e={jvb:{iceServers:[]},p2p:{iceServers:[]}},t=this.options.p2p&&this.options.p2p.stunServers||[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"}];Array.isArray(t)&&(R.info("P2P STUN servers: ",t),e.p2p.iceServers=t),this.options.p2p&&this.options.p2p.iceTransportPolicy&&(R.info("P2P ICE transport policy: ",this.options.p2p.iceTransportPolicy),e.p2p.iceTransportPolicy=this.options.p2p.iceTransportPolicy),Object(l.a)(this),Object(d.a)(this,this.eventEmitter,e),Object(f.a)(),Object(p.a)(this),Object(h.a)(),Object(v.a)()}},{key:"_getConnectionFailedReasonDetails",value:function(){var e={};if(this.options.deploymentInfo&&this.options.deploymentInfo.shard&&this.connection._proto&&this.connection._proto.lastResponseHeaders){var t=this.connection._proto.lastResponseHeaders.trim().split(/[\r\n]+/),n={};t.forEach(function(e){var t=e.split(": "),r=t.shift(),i=t.join(": ");n[r]=i}),e.shard_changed=this.options.deploymentInfo.shard!==n["x-jitsi-shard"]}return e.suspend_time=this.connection.ping.getPingSuspendTime(),e}},{key:"sendDominantSpeakerEvent",value:function(e){if(this.speakerStatsComponentAddress&&e){var t=Object(i.$msg)({to:this.speakerStatsComponentAddress});t.c("speakerstats",{xmlns:"http://jitsi.org/jitmeet",room:e}).up(),this.connection.send(t)}}},{key:"tryParseJSONAndVerify",value:function(e){try{var t=JSON.parse(e);if(t&&"object"===E(t)){var n=t[P];if(void 0!==n)return t;R.debug("parsing valid json but does not have correct structure","topic: ",n)}}catch(e){return!1}return!1}},{key:"_onPrivateMessage",value:function(e){var t=e.getAttribute("from");if(this.speakerStatsComponentAddress&&t===this.speakerStatsComponentAddress){var n=$(e).find(">json-message").text(),r=this.tryParseJSONAndVerify(n);return r&&"speakerstats"===r[P]&&r.users&&this.eventEmitter.emit(_.a.SPEAKER_STATS_RECEIVED,r.users),!0}}}])&&C(n.prototype,r),o&&C(n,o),t}()}).call(this,"modules/xmpp/xmpp.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return m}),n.d(t,"b",function(){return g});var r=n(4),i=n(2),o=n(17),a=n(9),s=n(3),c=n(8),u=n.n(c),l=n(6);function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,n){return t&&d(e.prototype,t),n&&d(e,n),e}var p=Object(r.getLogger)(e),h=500,v=2e3,m={ACTIVE:"active",INACTIVE:"inactive",INTERRUPTED:"interrupted",RESTORING:"restoring"},g=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.rtc=t,this.conference=n,this.trackTimers={},this.connStatusFromJvb={},this.outOfLastNTimeout="number"==typeof r.outOfLastNTimeout?r.outOfLastNTimeout:h,this.rtcMuteTimeout="number"==typeof r.rtcMuteTimeout?r.rtcMuteTimeout:v,this.rtcMutedTimestamp={},p.info("RtcMuteTimeout set to: ".concat(this.rtcMuteTimeout)),this.enteredLastNTimestamp=new Map,this.restoringTimers=new Map}return f(e,null,[{key:"_getNewStateForJvbMode",value:function(e,t,n,r,i){return e?r?m.ACTIVE:s.a.supportsVideoMuteOnConnInterrupted()?i?t?n?m.INTERRUPTED:m.RESTORING:m.INACTIVE:m.ACTIVE:t?m.ACTIVE:m.INACTIVE:m.INTERRUPTED}},{key:"_getNewStateForP2PMode",value:function(e,t){return s.a.supportsVideoMuteOnConnInterrupted()?e||!t?m.ACTIVE:m.INTERRUPTED:m.ACTIVE}}]),f(e,[{key:"_getVideoFrozenTimeout",value:function(e){return this.rtc.isInLastN(e)?this.rtcMuteTimeout:this.outOfLastNTimeout}},{key:"init",value:function(){this._onEndpointConnStatusChanged=this.onEndpointConnStatusChanged.bind(this),this.rtc.addListener(u.a.ENDPOINT_CONN_STATUS_CHANGED,this._onEndpointConnStatusChanged),this._onP2PStatus=this.refreshConnectionStatusForAll.bind(this),this.conference.on(i.P2P_STATUS,this._onP2PStatus),s.a.supportsVideoMuteOnConnInterrupted()&&(this._onTrackRtcMuted=this.onTrackRtcMuted.bind(this),this.rtc.addListener(u.a.REMOTE_TRACK_MUTE,this._onTrackRtcMuted),this._onTrackRtcUnmuted=this.onTrackRtcUnmuted.bind(this),this.rtc.addListener(u.a.REMOTE_TRACK_UNMUTE,this._onTrackRtcUnmuted),this._onRemoteTrackAdded=this.onRemoteTrackAdded.bind(this),this.conference.on(i.TRACK_ADDED,this._onRemoteTrackAdded),this._onRemoteTrackRemoved=this.onRemoteTrackRemoved.bind(this),this.conference.on(i.TRACK_REMOVED,this._onRemoteTrackRemoved),this._onSignallingMuteChanged=this.onSignallingMuteChanged.bind(this)),this._onLastNChanged=this._onLastNChanged.bind(this),this.conference.on(i.LAST_N_ENDPOINTS_CHANGED,this._onLastNChanged),this._onLastNValueChanged=this.refreshConnectionStatusForAll.bind(this),this.rtc.on(u.a.LASTN_VALUE_CHANGED,this._onLastNValueChanged)}},{key:"dispose",value:function(){this.rtc.removeListener(u.a.ENDPOINT_CONN_STATUS_CHANGED,this._onEndpointConnStatusChanged),s.a.supportsVideoMuteOnConnInterrupted()&&(this.rtc.removeListener(u.a.REMOTE_TRACK_MUTE,this._onTrackRtcMuted),this.rtc.removeListener(u.a.REMOTE_TRACK_UNMUTE,this._onTrackRtcUnmuted),this.conference.off(i.TRACK_ADDED,this._onRemoteTrackAdded),this.conference.off(i.TRACK_REMOVED,this._onRemoteTrackRemoved)),this.conference.off(i.LAST_N_ENDPOINTS_CHANGED,this._onLastNChanged),this.rtc.removeListener(u.a.LASTN_VALUE_CHANGED,this._onLastNValueChanged),this.conference.off(i.P2P_STATUS,this._onP2PStatus);for(var e=Object.keys(this.trackTimers),t=0;t<e.length;t++){var n=e[t];this.clearTimeout(n),this.clearRtcMutedTimestamp(n)}this.connStatusFromJvb={}}},{key:"onEndpointConnStatusChanged",value:function(e,t){p.debug("Detector RTCEvents.ENDPOINT_CONN_STATUS_CHANGED(".concat(Date.now(),"): ").concat(e,": ").concat(t)),e!==this.conference.myUserId()&&(this.connStatusFromJvb[e]=t,this.figureOutConnectionStatus(e))}},{key:"_changeConnectionStatus",value:function(e,t){if(e.getConnectionStatus()!==t){var n=e.getId();e._setConnectionStatus(t),p.debug("Emit endpoint conn status(".concat(Date.now(),") ").concat(n,": ").concat(t)),l.a.sendLog(JSON.stringify({id:"peer.conn.status",participant:n,status:t})),this.conference.eventEmitter.emit(i.PARTICIPANT_CONN_STATUS_CHANGED,n,t)}}},{key:"clearTimeout",value:function(e){this.trackTimers[e]&&(window.clearTimeout(this.trackTimers[e]),this.trackTimers[e]=null)}},{key:"clearRtcMutedTimestamp",value:function(e){this.rtcMutedTimestamp[e]=null}},{key:"onRemoteTrackAdded",value:function(e){e.isLocal()||e.getType()!==a.b||(p.debug("Detector on remote track added for: ".concat(e.getParticipantId())),e.on(o.TRACK_MUTE_CHANGED,this._onSignallingMuteChanged))}},{key:"onRemoteTrackRemoved",value:function(e){if(!e.isLocal()&&e.getType()===a.b){var t=e.getParticipantId();p.debug("Detector on remote track removed: ".concat(t)),e.off(o.TRACK_MUTE_CHANGED,this._onSignallingMuteChanged),this.clearTimeout(t),this.clearRtcMutedTimestamp(t),this.figureOutConnectionStatus(t)}}},{key:"isVideoTrackFrozen",value:function(e){if(!s.a.supportsVideoMuteOnConnInterrupted())return!1;var t=e.getId(),n=e.hasAnyVideoTrackWebRTCMuted(),r=this.rtcMutedTimestamp[t],i=this._getVideoFrozenTimeout(t);return n&&"number"==typeof r&&Date.now()-r>=i}},{key:"refreshConnectionStatusForAll",value:function(){var e=this.conference.getParticipants(),t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this.figureOutConnectionStatus(a.getId())}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"figureOutConnectionStatus",value:function(t){var n=this.conference.getParticipantById(t);if(n){var r=this.conference.isP2PActive(),i=this._isRestoringTimedout(t),o=0===this.rtc.getLastN(),a=n.isVideoMuted()||o,s=this.isVideoTrackFrozen(n),c=this.rtc.isInLastN(t),u=this.connStatusFromJvb[t];"boolean"!=typeof u&&(p.debug("Assuming connection active by JVB - no notification"),u=!0);var l=r?e._getNewStateForP2PMode(a,s):e._getNewStateForJvbMode(u,c,i,a,s);l!==m.RESTORING&&this._clearRestoringTimer(t),p.debug("Figure out conn status for ".concat(t,", is video muted: ").concat(a," is active(jvb): ").concat(u," video track frozen: ").concat(s," p2p mode: ").concat(r," is in last N: ").concat(c," currentStatus => newStatus: ").concat(n.getConnectionStatus()," => ").concat(l)),this._changeConnectionStatus(n,l)}else p.warn("figure out conn status - no participant for: ".concat(t))}},{key:"_onLastNChanged",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=Date.now();p.debug("leaving/entering lastN",e,t,n);var r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value;this.enteredLastNTimestamp.delete(c),this._clearRestoringTimer(c),this.figureOutConnectionStatus(c)}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}var u=!0,l=!1,d=void 0;try{for(var f,h=t[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var v=f.value;this.enteredLastNTimestamp.set(v,n),this.figureOutConnectionStatus(v)}}catch(e){l=!0,d=e}finally{try{u||null==h.return||h.return()}finally{if(l)throw d}}}},{key:"_clearRestoringTimer",value:function(e){var t=this.restoringTimers.get(e);t&&(clearTimeout(t),this.restoringTimers.delete(e))}},{key:"_isRestoringTimedout",value:function(e){var t=this,n=this.enteredLastNTimestamp.get(e);return!!(n&&Date.now()-n>=5e3)||(this.restoringTimers.get(e)||this.restoringTimers.set(e,setTimeout(function(){return t.figureOutConnectionStatus(e)},5e3)),!1)}},{key:"onTrackRtcMuted",value:function(e){var t=this,n=e.getParticipantId(),r=this.conference.getParticipantById(n);if(p.debug("Detector track RTC muted: ".concat(n),Date.now()),r){if(this.rtcMutedTimestamp[n]=Date.now(),!r.isVideoMuted()){this.clearTimeout(n);var i=this._getVideoFrozenTimeout(n);this.trackTimers[n]=window.setTimeout(function(){p.debug("Set RTC mute timeout for: ".concat(n,"                     of ").concat(i," ms")),t.clearTimeout(n),t.figureOutConnectionStatus(n)},i)}}else p.error("No participant for id: ".concat(n))}},{key:"onTrackRtcUnmuted",value:function(e){var t=e.getParticipantId();p.debug("Detector track RTC unmuted: ".concat(t),Date.now()),this.clearTimeout(t),this.clearRtcMutedTimestamp(t),this.figureOutConnectionStatus(t)}},{key:"onSignallingMuteChanged",value:function(e){var t=e.getParticipantId();p.debug("Detector on track signalling mute changed: ".concat(t),e.isMuted()),this.figureOutConnectionStatus(t)}}]),e}()}).call(this,"modules/connectivity/ParticipantConnectionStatus.js")},function(e,t,n){"use strict";t.a={getFocusRecordingUpdate:function(e){var t=e&&e.getElementsByTagName("jibri-recording-status")[0];if(t)return{error:t.getAttribute("failure_reason"),recordingMode:t.getAttribute("recording_mode"),sessionID:t.getAttribute("session_id"),status:t.getAttribute("status")}},getHiddenDomainUpdate:function(e){var t=e.getElementsByTagName("live-stream-view-url")[0],n=t&&t.textContent,r=e.getElementsByTagName("mode")[0],i=r&&r.textContent&&r.textContent.toLowerCase(),o=e.getElementsByTagName("session_id")[0];return{liveStreamViewURL:n,mode:i,sessionID:o&&o.textContent}},getSessionIdFromIq:function(e){var t=e&&e.getElementsByTagName("jibri")[0];return t&&t.getAttribute("session_id")},getSessionId:function(e){var t=e.getElementsByTagName("session_id")[0];return t&&t.textContent},isFromFocus:function(e){return e.getAttribute("from").includes("focus")}}},function(e,t,n){"use strict";n.r(t),n.d(t,"DEVICE_LIST_CHANGED",function(){return r}),n.d(t,"PERMISSION_PROMPT_IS_SHOWN",function(){return i});var r="mediaDevices.devicechange",i="mediaDevices.permissionPromptIsShown"},function(e,t,n){var r;r=function(){var e=!0;function t(t){function n(e){var n=t.match(e);return n&&n.length>1&&n[1]||""}function r(e){var n=t.match(e);return n&&n.length>1&&n[2]||""}var i,o=n(/(ipod|iphone|ipad)/i).toLowerCase(),a=!/like android/i.test(t)&&/android/i.test(t),s=/nexus\s*[0-6]\s*/i.test(t),c=!s&&/nexus\s*[0-9]+/i.test(t),u=/CrOS/.test(t),l=/silk/i.test(t),d=/sailfish/i.test(t),f=/tizen/i.test(t),p=/(web|hpw)os/i.test(t),h=/windows phone/i.test(t),v=(/SamsungBrowser/i.test(t),!h&&/windows/i.test(t)),m=!o&&!l&&/macintosh/i.test(t),g=!a&&!d&&!f&&!p&&/linux/i.test(t),y=r(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),b=n(/version\/(\d+(\.\d+)?)/i),S=/tablet/i.test(t)&&!/tablet pc/i.test(t),_=!S&&/[^-]mobi/i.test(t),E=/xbox/i.test(t);/opera/i.test(t)?i={name:"Opera",opera:e,version:b||n(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(t)?i={name:"Opera",opera:e,version:n(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||b}:/SamsungBrowser/i.test(t)?i={name:"Samsung Internet for Android",samsungBrowser:e,version:b||n(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(t)?i={name:"Opera Coast",coast:e,version:b||n(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(t)?i={name:"Yandex Browser",yandexbrowser:e,version:b||n(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(t)?i={name:"UC Browser",ucbrowser:e,version:n(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(t)?i={name:"Maxthon",maxthon:e,version:n(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(t)?i={name:"Epiphany",epiphany:e,version:n(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(t)?i={name:"Puffin",puffin:e,version:n(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(t)?i={name:"Sleipnir",sleipnir:e,version:n(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(t)?i={name:"K-Meleon",kMeleon:e,version:n(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:h?(i={name:"Windows Phone",osname:"Windows Phone",windowsphone:e},y?(i.msedge=e,i.version=y):(i.msie=e,i.version=n(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(t)?i={name:"Internet Explorer",msie:e,version:n(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:u?i={name:"Chrome",osname:"Chrome OS",chromeos:e,chromeBook:e,chrome:e,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(t)?i={name:"Microsoft Edge",msedge:e,version:y}:/vivaldi/i.test(t)?i={name:"Vivaldi",vivaldi:e,version:n(/vivaldi\/(\d+(\.\d+)?)/i)||b}:d?i={name:"Sailfish",osname:"Sailfish OS",sailfish:e,version:n(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?i={name:"SeaMonkey",seamonkey:e,version:n(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(t)?(i={name:"Firefox",firefox:e,version:n(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(i.firefoxos=e,i.osname="Firefox OS")):l?i={name:"Amazon Silk",silk:e,version:n(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(t)?i={name:"PhantomJS",phantom:e,version:n(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(t)?i={name:"SlimerJS",slimer:e,version:n(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?i={name:"BlackBerry",osname:"BlackBerry OS",blackberry:e,version:b||n(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:p?(i={name:"WebOS",osname:"WebOS",webos:e,version:b||n(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(i.touchpad=e)):/bada/i.test(t)?i={name:"Bada",osname:"Bada",bada:e,version:n(/dolfin\/(\d+(\.\d+)?)/i)}:f?i={name:"Tizen",osname:"Tizen",tizen:e,version:n(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||b}:/qupzilla/i.test(t)?i={name:"QupZilla",qupzilla:e,version:n(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||b}:/chromium/i.test(t)?i={name:"Chromium",chromium:e,version:n(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||b}:/chrome|crios|crmo/i.test(t)?i={name:"Chrome",chrome:e,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:a?i={name:"Android",version:b}:/safari|applewebkit/i.test(t)?(i={name:"Safari",safari:e},b&&(i.version=b)):o?(i={name:"iphone"==o?"iPhone":"ipad"==o?"iPad":"iPod"},b&&(i.version=b)):i=/googlebot/i.test(t)?{name:"Googlebot",googlebot:e,version:n(/googlebot\/(\d+(\.\d+))/i)||b}:{name:n(/^(.*)\/(.*) /),version:r(/^(.*)\/(.*) /)},!i.msedge&&/(apple)?webkit/i.test(t)?(/(apple)?webkit\/537\.36/i.test(t)?(i.name=i.name||"Blink",i.blink=e):(i.name=i.name||"Webkit",i.webkit=e),!i.version&&b&&(i.version=b)):!i.opera&&/gecko\//i.test(t)&&(i.name=i.name||"Gecko",i.gecko=e,i.version=i.version||n(/gecko\/(\d+(\.\d+)?)/i)),i.windowsphone||!a&&!i.silk?!i.windowsphone&&o?(i[o]=e,i.ios=e,i.osname="iOS"):m?(i.mac=e,i.osname="macOS"):E?(i.xbox=e,i.osname="Xbox"):v?(i.windows=e,i.osname="Windows"):g&&(i.linux=e,i.osname="Linux"):(i.android=e,i.osname="Android");var C="";i.windows?C=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}(n(/Windows ((NT|XP)( \d\d?.\d)?)/i)):i.windowsphone?C=n(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):i.mac?C=(C=n(/Mac OS X (\d+([_\.\s]\d+)*)/i)).replace(/[_\s]/g,"."):o?C=(C=n(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):a?C=n(/android[ \/-](\d+(\.\d+)*)/i):i.webos?C=n(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):i.blackberry?C=n(/rim\stablet\sos\s(\d+(\.\d+)*)/i):i.bada?C=n(/bada\/(\d+(\.\d+)*)/i):i.tizen&&(C=n(/tizen[\/\s](\d+(\.\d+)*)/i)),C&&(i.osversion=C);var T=!i.windows&&C.split(".")[0];return S||c||"ipad"==o||a&&(3==T||T>=4&&!_)||i.silk?i.tablet=e:(_||"iphone"==o||"ipod"==o||a||s||i.blackberry||i.webos||i.bada)&&(i.mobile=e),i.msedge||i.msie&&i.version>=10||i.yandexbrowser&&i.version>=15||i.vivaldi&&i.version>=1||i.chrome&&i.version>=20||i.samsungBrowser&&i.version>=4||i.firefox&&i.version>=20||i.safari&&i.version>=6||i.opera&&i.version>=10||i.ios&&i.osversion&&i.osversion.split(".")[0]>=6||i.blackberry&&i.version>=10.1||i.chromium&&i.version>=20?i.a=e:i.msie&&i.version<10||i.chrome&&i.version<20||i.firefox&&i.version<20||i.safari&&i.version<6||i.opera&&i.version<10||i.ios&&i.osversion&&i.osversion.split(".")[0]<6||i.chromium&&i.version<20?i.c=e:i.x=e,i}var n=t("undefined"!=typeof navigator&&navigator.userAgent||"");function r(e){return e.split(".").length}function i(e,t){var n,r=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(n=0;n<e.length;n++)r.push(t(e[n]));return r}function o(e){for(var t=Math.max(r(e[0]),r(e[1])),n=i(e,function(e){var n=t-r(e);return i((e+=new Array(n+1).join(".0")).split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});--t>=0;){if(n[0][t]>n[1][t])return 1;if(n[0][t]!==n[1][t])return-1;if(0===t)return 0}}function a(e,r,i){var a=n;"string"==typeof r&&(i=r,r=void 0),void 0===r&&(r=!1),i&&(a=t(i));var s=""+a.version;for(var c in e)if(e.hasOwnProperty(c)&&a[c]){if("string"!=typeof e[c])throw new Error("Browser version in the minVersion map should be a string: "+c+": "+String(e));return o([s,e[c]])<0}return r}return n.test=function(e){for(var t=0;t<e.length;++t){var r=e[t];if("string"==typeof r&&r in n)return!0}return!1},n.isUnsupportedBrowser=a,n.compareVersions=o,n.check=function(e,t,n){return!a(e,t,n)},n._detect=t,n.detect=t,n},e.exports?e.exports=r():n(120)("bowser",r)},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(5);function i(e,t){if(!t)return!1;if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]instanceof Array&&t[n]instanceof Array){if(!e[n].equals(t[n]))return!1}else if(e[n]!==t[n])return!1;return!0}function o(e,t){if(this.mySDP=e,this.otherSDP=t,!e)throw new Error('"mySDP" is undefined!');if(!t)throw new Error('"otherSDP" is undefined!')}o.prototype.getNewMedia=function(){var e=this.mySDP.getMediaSsrcMap(),t=this.otherSDP.getMediaSsrcMap(),n={};return Object.keys(t).forEach(function(r){var o=e[r],a=t[r];o||!a?(Object.keys(a.ssrcs).forEach(function(e){if(-1===Object.keys(o.ssrcs).indexOf(e))n[r]||(n[r]={mediaindex:a.mediaindex,mid:a.mid,ssrcs:{},ssrcGroups:[]}),n[r].ssrcs[e]=a.ssrcs[e];else if(a.ssrcs[e].lines&&o.ssrcs[e].lines){void 0!==o.ssrcs[e].lines.find(function(e){return-1!==e.indexOf("msid")})!==(void 0!==a.ssrcs[e].lines.find(function(e){return-1!==e.indexOf("msid")}))&&(n[r]||(n[r]={mediaindex:a.mediaindex,mid:a.mid,ssrcs:{},ssrcGroups:[]}),n[r].ssrcs[e]=a.ssrcs[e])}}),a.ssrcGroups.forEach(function(e){for(var t=!1,s=0;s<o.ssrcGroups.length;s++){var c=o.ssrcGroups[s];if(e.semantics===c.semantics&&i(e.ssrcs,c.ssrcs)){t=!0;break}}t||(n[r]||(n[r]={mediaindex:a.mediaindex,mid:a.mid,ssrcs:{},ssrcGroups:[]}),n[r].ssrcGroups.push(e))})):n[r]=a}),n},o.prototype.toJingle=function(e){var t=this.getNewMedia(),n=!1;return Object.keys(t).forEach(function(i){n=!0;var o=t[i];e.c("content",{name:o.mid}),e.c("description",{xmlns:"urn:xmpp:jingle:apps:rtp:1",media:o.mid}),Object.keys(o.ssrcs).forEach(function(t){var n=o.ssrcs[t];e.c("source",{xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),e.attrs({ssrc:n.ssrc}),n.lines.forEach(function(t){var n=t.indexOf(" "),i=t.substr(n+1);if(e.c("parameter"),-1===i.indexOf(":"))e.attrs({name:i});else{var o=i.split(":",2),a=o[0],s=r.a.filterSpecialChars(o[1]);e.attrs({name:a}),e.attrs({value:s})}e.up()}),e.up()}),o.ssrcGroups.forEach(function(t){t.ssrcs.length&&(e.c("ssrc-group",{semantics:t.semantics,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),t.ssrcs.forEach(function(t){e.c("source",{ssrc:t}).up()}),e.up())}),e.up(),e.up()}),n}},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var c,u=[],l=!1,d=-1;function f(){l&&c&&(l=!1,c.length?u=c.concat(u):d=-1,u.length&&p())}function p(){if(!l){var e=s(f);l=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function v(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new h(e,t)),1!==u.length||l||s(p)},h.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";n.r(t),n.d(t,"E2E_RTT_CHANGED",function(){return r});var r="e2eping.e2e_rtt_changed"},function(e,t,n){"use strict";n.d(t,"a",function(){return i});window.AudioContext=window.AudioContext||window.webkitAudioContext;var r=null;function i(e,t,n){this.stream=e,this.intervalId=null,this.intervalMilis=t,this.audioLevel=0,this.callback=n}window.AudioContext&&(r=new AudioContext).suspend&&r.suspend(),i.prototype.start=function(){if(i.isLocalStatsSupported()){r.resume();var e=r.createAnalyser();e.smoothingTimeConstant=.8,e.fftSize=2048,r.createMediaStreamSource(this.stream).connect(e);var t=this;this.intervalId=setInterval(function(){var n=new Uint8Array(e.frequencyBinCount);e.getByteTimeDomainData(n);var r,i,o,a,s=function(e){for(var t=0,n=e.length,r=0;r<n;r++)t<e[r]&&(t=e[r]);return parseFloat(((t-127)/128).toFixed(3))}(n);s!==t.audioLevel&&(t.audioLevel=(r=s,i=t.audioLevel,o=0,o=(a=i-r)>.2?i-.2:a<-.4?i+.4:r,parseFloat(o.toFixed(3))),t.callback(t.audioLevel))},this.intervalMilis)}},i.prototype.stop=function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)},i.isLocalStatsSupported=function(){return Boolean(r)}},function(e,t,n){var r=n(123),i={loadScript:function(e,t,n,i,o,a){var s=document,c=s.createElement("script"),u=s.getElementsByTagName("script")[0];if(c.async=t,i){var l=r();if(l){var d=l.src,f=d.substring(0,d.lastIndexOf("/")+1);d&&f&&(e=f+e)}}o&&(c.onload=o),a&&(c.onerror=a),c.src=e,n?u.parentNode.insertBefore(c,u):u.parentNode.appendChild(c)}};e.exports=i},function(e,t,n){"use strict";n.r(t),n.d(t,"ON",function(){return r}),n.d(t,"OFF",function(){return i});var r="on",i="off"},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return g});var r=n(29),i=n.n(r),o=n(4),a=n(17),s=n(9),c=n(11);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=Object(o.getLogger)(e),v={track_mute:"onmute",track_unmute:"onunmute",track_ended:"onended"};function m(e,t){e.oninactive=t}var g=function(e){function t(e,n,r,i,o,a){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=d(this,f(t).call(this))).addEventListener=s.addListener,s.removeEventListener=s.off=s.removeListener,s.containers=[],s.conference=e,s.audioLevel=-1,s.type=o,s.track=r,s.videoType=a,s.handlers=new Map,s.disposed=!1,s._streamInactiveHandler=i,s._setStream(n),s}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,i.a),n=t,(r=[{key:"_setHandler",value:function(e,t){if(v.hasOwnProperty(e)){if(t?this.handlers.set(e,t):this.handlers.delete(e),this.stream){var n=!0,r=!1,i=void 0;try{for(var o,a=this.stream.getVideoTracks()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){o.value[v[e]]=t}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}}}else h.error("Invalid handler type ".concat(e))}},{key:"_unregisterHandlers",value:function(){if(this.stream){var e=!0,t=!1,n=void 0;try{for(var r,i=this.handlers.keys()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value,a=!0,s=!1,c=void 0;try{for(var u,l=this.stream.getVideoTracks()[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){u.value[v[o]]=void 0}}catch(e){s=!0,c=e}finally{try{a||null==l.return||l.return()}finally{if(s)throw c}}}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}this._streamInactiveHandler&&m(this.stream,void 0)}else h.warn("".concat(this,": unable to unregister handlers - no stream object"))}},{key:"_setStream",value:function(e){if(this.stream!==e&&(this.stream=e,this.stream)){var t=!0,n=!1,r=void 0;try{for(var i,o=this.handlers.keys()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this._setHandler(a,this.handlers.get(a))}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}this._streamInactiveHandler&&m(this.stream,this._streamInactiveHandler)}}},{key:"getType",value:function(){return this.type}},{key:"isAudioTrack",value:function(){return this.getType()===s.a}},{key:"isWebRTCTrackMuted",value:function(){return this.track&&this.track.muted}},{key:"isVideoTrack",value:function(){return this.getType()===s.b}},{key:"isLocal",value:function(){throw new Error("Not implemented by subclass")}},{key:"getOriginalStream",value:function(){return this.stream}},{key:"getStreamId",value:function(){return this.stream?this.stream.id:null}},{key:"getTrack",value:function(){return this.track}},{key:"getTrackId",value:function(){return this.track?this.track.id:null}},{key:"getUsageLabel",value:function(){return this.isAudioTrack()?"mic":this.videoType?this.videoType:"default"}},{key:"_maybeFireTrackAttached",value:function(e){this.conference&&e&&this.conference._onTrackAttach(this,e)}},{key:"attach",value:function(e){this.stream&&c.a.attachMediaStream(e,this.stream),this.containers.push(e),this._maybeFireTrackAttached(e),this._attachTTFMTracker(e)}},{key:"detach",value:function(e){for(var t=this.containers,n=t.length-1;n>=0;--n){var r=t[n];e||c.a.attachMediaStream(r,null),e&&r!==e||t.splice(n,1)}e&&c.a.attachMediaStream(e,null)}},{key:"_attachTTFMTracker",value:function(e){}},{key:"dispose",value:function(){return this.removeAllListeners(),this.disposed=!0,Promise.resolve()}},{key:"isScreenSharing",value:function(){}},{key:"getId",value:function(){return this.stream?c.a.getStreamID(this.stream):null}},{key:"isActive",value:function(){return void 0===this.stream.active||this.stream.active}},{key:"setAudioLevel",value:function(e,t){this.audioLevel!==e&&(this.audioLevel=e,this.emit(a.TRACK_AUDIO_LEVEL_CHANGED,e,t))}},{key:"getMSID",value:function(){var e=this.getStreamId(),t=this.getTrackId();return e&&t?"".concat(e," ").concat(t):null}},{key:"setAudioOutput",value:function(e){var t=this;return c.a.isDeviceChangeAvailable("output")?this.isVideoTrack()?Promise.resolve():Promise.all(this.containers.map(function(t){return t.setSinkId(e).catch(function(e){throw h.warn("Failed to change audio output device on element. Default or previously set audio output device will be used.",t,e),e})})).then(function(){t.emit(a.TRACK_AUDIO_OUTPUT_CHANGED,e)}):Promise.reject(new Error("Audio output device change is not supported"))}}])&&l(n.prototype,r),o&&l(n,o),t}()}).call(this,"modules/RTC/JitsiTrack.js")},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(16),i=n.n(r);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(t){switch(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._sdp=null,this._sdpObject=null,this._type=null,t.type){case"offer":case"answer":break;default:throw new TypeError('invalid type "'.concat(t.type,'"'))}if(this._type=t.type,"string"==typeof t.sdp){this._sdp=t.sdp;try{this._sdpObject=i.a.parse(t.sdp)}catch(e){throw new Error("invalid sdp: ".concat(e))}}else{if("object"!==o(t._sdpObject))throw new TypeError("invalid sdp or _sdpObject");this._sdpObject=t._sdpObject;try{this._sdp=i.a.write(t._sdpObject)}catch(e){throw new Error("invalid sdp object: ".concat(e))}}}var t,n,r;return t=e,(n=[{key:"toJSON",value:function(){return{sdp:this._sdp,type:this._type}}},{key:"sdp",get:function(){return this._sdp},set:function(e){try{this._sdpObject=i.a.parse(e)}catch(e){throw new Error("invalid sdp: ".concat(e))}this._sdp=e}},{key:"sdpObject",get:function(){return this._sdpObject}},{key:"type",get:function(){return this._type}}])&&a(t.prototype,n),r&&a(t,r),e}()},function(e,t,n){"use strict";function r(e){var t=e;return e>=Number.MAX_SAFE_INTEGER&&(t=0),t+1}n.d(t,"a",function(){return r})},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._userId=t,this.setDisplayName(n),this._isLocalStats=r||!1,this.setDominantSpeaker(!1),this.totalDominantSpeakerTime=0,this._dominantSpeakerStart=0,this._hasLeft=!1}var t,r,i;return t=e,(r=[{key:"getUserId",value:function(){return this._userId}},{key:"getDisplayName",value:function(){return this.displayName}},{key:"setDisplayName",value:function(e){this.displayName=e}},{key:"isLocalStats",value:function(){return this._isLocalStats}},{key:"isDominantSpeaker",value:function(){return this._dominantSpeakerStart>0}},{key:"setDominantSpeaker",value:function(e){if(!this.isDominantSpeaker()&&e)this._dominantSpeakerStart=Date.now();else if(this.isDominantSpeaker()&&!e){var t=Date.now()-this._dominantSpeakerStart;this.totalDominantSpeakerTime+=t,this._dominantSpeakerStart=0}}},{key:"getTotalDominantSpeakerTime",value:function(){var e=this.totalDominantSpeakerTime;return this.isDominantSpeaker()&&(e+=Date.now()-this._dominantSpeakerStart),e}},{key:"hasLeft",value:function(){return this._hasLeft}},{key:"markAsHasLeft",value:function(){this._hasLeft=!0,this.setDominantSpeaker(!1)}}])&&n(t.prototype,r),i&&n(t,i),e}();e.exports=r},function(e,t){e.exports={IDENTITY_UPDATED:"authentication.identity_updated"}},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return I});var r=n(7),i=n(84),o=n.n(i),a=n(4),s=n(1),c=n(85),u=n(86),l=n(31),d=n(18),f=n(48),p=n(5),h=n(87),v=n(8),m=n.n(v),g=n(6),y=n(0),b=n.n(y),S=n(10),_=n.n(S);function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t,n){return t&&T(e.prototype,t),n&&T(e,n),e}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var P=Object(a.getLogger)(e),I=function(e){function t(e,n,r,i,a,s,c,u){var l,d,f;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),d=this,(l=!(f=C(t).call(this,e,n,r,i,a,s,u))||"object"!==E(f)&&"function"!=typeof f?R(d):f)._iceCheckingStartedTimestamp=null,l._gatheringStartedTimestamp=null,l._localVideoActive=!0,l._remoteVideoActive=!0,l._gatheringReported=!1,l.lasticecandidate=!1,l.closed=!1,l.isP2P=c,l.signalingLayer=new h.a,l.modificationQueue=o.a.queue(l._processQueueTasks.bind(R(R(l))),1),l.wasConnected=!1,l.establishmentDuration=void 0,l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(t,u["a"]),w(t,null,[{key:"parseVideoSenders",value:function(e){var t=e.find('>content[name="video"]');if(t.length){var n=t[0].getAttribute("senders");if("both"===n||"initiator"===n||"responder"===n||"none"===n)return n}return null}}]),w(t,[{key:"_assertNotEnded",value:function(e){return this.state!==l.b||(P.log("The session has ended - cancelling action: ".concat(e)),!1)}},{key:"doInitialize",value:function(e){var t=this;this.failICE=Boolean(e.failICE),this.lasticecandidate=!1,this.options=e,this.isReconnect=!1,this.wasstable=!1,this.webrtcIceUdpDisable=Boolean(e.webrtcIceUdpDisable),this.webrtcIceTcpDisable=Boolean(e.webrtcIceTcpDisable);var n={disableRtx:e.disableRtx};if(e.gatherStats&&(n.maxstats=300),this.isP2P){n.disableSimulcast=!0,n.disableH264=e.p2p&&e.p2p.disableH264,n.preferH264=e.p2p&&e.p2p.preferH264;var i=this._abtestSuspendVideoEnabled(e);void 0!==i&&(n.abtestSuspendVideo=i)}else n.disableSimulcast=e.disableSimulcast||e.preferH264&&!e.disableH264,n.preferH264=e.preferH264,n.enableFirefoxSimulcast=e.testing&&e.testing.enableFirefoxSimulcast,n.enableLayerSuspension=e.enableLayerSuspension;this.peerconnection=this.rtc.createPeerConnection(this.signalingLayer,this.iceConfig,this.isP2P,n),this.peerconnection.onicecandidate=function(e){if(e){var n=e.candidate,i=window.performance.now();if(n){null===t._gatheringStartedTimestamp&&(t._gatheringStartedTimestamp=i);var o=n.protocol;if("string"==typeof o)if("tcp"===(o=o.toLowerCase())||"ssltcp"===o){if(t.webrtcIceTcpDisable)return}else if("udp"===o&&t.webrtcIceUdpDisable)return}else t._gatheringReported||(g.a.sendAnalytics(r.n,{phase:"gathering",value:i-t._gatheringStartedTimestamp,p2p:t.isP2P,initiator:t.isInitiator}),t._gatheringReported=!0);t.sendIceCandidate(n)}},this.peerconnection.onsignalingstatechange=function(){t.peerconnection&&("stable"===t.peerconnection.signalingState?t.wasstable=!0:"closed"!==t.peerconnection.signalingState&&"closed"!==t.peerconnection.connectionState||t.closed||t.room.eventEmitter.emit(b.a.SUSPEND_DETECTED,t))},this.peerconnection.oniceconnectionstatechange=function(){if(t.peerconnection&&t._assertNotEnded("oniceconnectionstatechange")){var e=window.performance.now();switch(t.isP2P||(t.room.connectionTimes["ice.state.".concat(t.peerconnection.iceConnectionState)]=e),P.log("(TIME) ICE ".concat(t.peerconnection.iceConnectionState)+" P2P? ".concat(t.isP2P,":\t"),e),g.a.sendAnalytics(r.p,{p2p:t.isP2P,state:t.peerconnection.iceConnectionState,signaling_state:t.peerconnection.signalingState,reconnect:t.isReconnect,value:e}),t.room.eventEmitter.emit(b.a.ICE_CONNECTION_STATE_CHANGED,t,t.peerconnection.iceConnectionState),t.peerconnection.iceConnectionState){case"checking":t._iceCheckingStartedTimestamp=e;break;case"connected":if("stable"===t.peerconnection.signalingState&&t.isReconnect&&t.room.eventEmitter.emit(b.a.CONNECTION_RESTORED,t),!t.wasConnected&&t.wasstable){g.a.sendAnalytics(r.n,{phase:"checking",value:e-t._iceCheckingStartedTimestamp,p2p:t.isP2P,initiator:t.isInitiator});var n=Math.min(t._iceCheckingStartedTimestamp,t._gatheringStartedTimestamp);t.establishmentDuration=e-n,g.a.sendAnalytics(r.n,{phase:"establishment",value:t.establishmentDuration,p2p:t.isP2P,initiator:t.isInitiator}),t.wasConnected=!0,t.room.eventEmitter.emit(b.a.CONNECTION_ESTABLISHED,t)}t.isReconnect=!1;break;case"disconnected":if(t.closed)break;t.isReconnect=!0,t.wasstable&&t.room.eventEmitter.emit(b.a.CONNECTION_INTERRUPTED,t);break;case"failed":t.room.eventEmitter.emit(b.a.CONNECTION_ICE_FAILED,t),t.room.eventEmitter.emit(b.a.CONFERENCE_SETUP_FAILED,t,new Error("ICE fail"))}}},this.peerconnection.onnegotiationneeded=function(){t.room.eventEmitter.emit(b.a.PEERCONNECTION_READY,t)},this.signalingLayer.setChatRoom(this.room),!this.isP2P&&e.enableLayerSuspension&&this.rtc.addListener(m.a.IS_SELECTED_CHANGED,function(e){t.peerconnection.setIsSelected(e),P.info("Doing local O/A due to IS_SELECTED_CHANGED event"),t.modificationQueue.push(function(e){t._renegotiate().then(e).catch(e)})})}},{key:"sendIceCandidate",value:function(e){var t=this,n=new d.a(this.peerconnection.localDescription.sdp);if(e&&!this.lasticecandidate){var r=p.a.iceparams(n.media[e.sdpMLineIndex],n.session),i=p.a.candidateToJingle(e.candidate);if(!r||!i){return _.a.callErrorHandler(new Error("failed to get ice && jcand")),void P.error("failed to get ice && jcand")}r.xmlns="urn:xmpp:jingle:transports:ice-udp:1",this.usedrip?(0===this.dripContainer.length&&setTimeout(function(){0!==t.dripContainer.length&&(t.sendIceCandidates(t.dripContainer),t.dripContainer=[])},20),this.dripContainer.push(e)):this.sendIceCandidates([e])}else P.log("sendIceCandidate: last candidate."),this.lasticecandidate=!0}},{key:"sendIceCandidates",value:function(e){var t=this;if(this._assertNotEnded("sendIceCandidates")){P.log("sendIceCandidates",e);for(var n=Object(s.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"transport-info",initiator:this.initiatorJid,sid:this.sid}),r=new d.a(this.peerconnection.localDescription.sdp),i=function(i){var o=e.filter(function(e){return e.sdpMLineIndex===i}),a=p.a.parseMLine(r.media[i].split("\r\n")[0]);if(o.length>0){var s=p.a.iceparams(r.media[i],r.session);s.xmlns="urn:xmpp:jingle:transports:ice-udp:1",n.c("content",{creator:t.initiatorJid===t.localJid?"initiator":"responder",name:o[0].sdpMid?o[0].sdpMid:a.media}).c("transport",s);for(var c=0;c<o.length;c++){var u=p.a.candidateToJingle(o[c].candidate);t.failICE&&(u.ip="1.1.1.1"),n.c("candidate",u).up()}var l=p.a.findLine(r.media[i],"a=fingerprint:",r.session);if(l){var d=p.a.parseFingerprint(l);d.required=!0,n.c("fingerprint",{xmlns:"urn:xmpp:jingle:apps:dtls:0"}).t(d.fingerprint),delete d.fingerprint,n.attrs(d),n.up()}n.up(),n.up()}},o=0;o<r.media.length;o++)i(o);this.connection.sendIQ(n,null,this.newJingleErrorHandler(n),1e4)}}},{key:"addIceCandidates",value:function(e){var t=this;if("closed"!==this.peerconnection.signalingState){var n=[];if(e.find(">content>transport>candidate").each(function(e,t){var r=p.a.candidateFromJingle(t);r=r.replace("\r\n","").replace("a=","");var i=new RTCIceCandidate({sdpMLineIndex:0,sdpMid:"",candidate:r});n.push(i)}),n.length){P.debug("Queued add (".concat(n.length,") ICE candidates task...")),this.modificationQueue.push(function(e){for(var r=0;r<n.length;r++){var i=n[r];t.peerconnection.addIceCandidate(i).then(function(){return P.debug("addIceCandidate ok!")},function(e){return P.error("addIceCandidate failed!",e)})}e()})}else P.error("No ICE candidates to add ?",e[0]&&e[0].outerHTML)}else P.warn("Ignored add ICE candidate when in closed state")}},{key:"readSsrcInfo",value:function(e){var t=this;$(e).find('>description>source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each(function(e,n){var r=Number(n.getAttribute("ssrc"));t.isP2P?t.signalingLayer.setSSRCOwner(r,s.Strophe.getResourceFromJid(t.remoteJid)):$(n).find('>ssrc-info[xmlns="http://jitsi.org/jitmeet"]').each(function(e,n){var i=n.getAttribute("owner");i&&i.length&&(isNaN(r)||r<0?P.warn("Invalid SSRC ".concat(r," value received")+" for ".concat(i)):t.signalingLayer.setSSRCOwner(r,s.Strophe.getResourceFromJid(i)))})})}},{key:"generateRecvonlySsrc",value:function(){this.peerconnection?this.peerconnection.generateRecvonlySsrc():P.error("Unable to generate recvonly SSRC - no peerconnection")}},{key:"acceptOffer",value:function(e,t,n,r){var i=this;this.setOfferAnswerCycle(e,function(){i.sendSessionAccept(t,n)},n,r)}},{key:"invite",value:function(e){var t=this;if(!this.isInitiator)throw new Error("Trying to invite from the responder session");this.modificationQueue.push(function(n){var r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value;t.peerconnection.addTrack(c)}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}t.peerconnection.createOffer(t.mediaConstraints).then(function(e){t.peerconnection.setLocalDescription(e).then(function(){t.sendSessionInitiate(t.peerconnection.localDescription.sdp),n()},function(t){P.error("Failed to set local SDP",t,e),n(t)})},function(e){P.error("Failed to create an offer",e,t.mediaConstraints),n(e)})},function(e){e?P.error("invite error",e):P.debug("invite executed - OK")})}},{key:"sendSessionInitiate",value:function(e){var t=Object(s.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-initiate",initiator:this.initiatorJid,sid:this.sid});new d.a(e).toJingle(t,this.isInitiator?"initiator":"responder"),t=t.tree(),P.info("Session-initiate: ",t),this.connection.sendIQ(t,function(){P.info('Got RESULT for "session-initiate"')},function(e){P.error('"session-initiate" error',e)},1e4)}},{key:"setAnswer",value:function(e){if(!this.isInitiator)throw new Error("Trying to set an answer on the responder session");this.setOfferAnswerCycle(e,function(){P.info("setAnswer - succeeded")},function(e){P.error("setAnswer failed: ",e)})}},{key:"setOfferAnswerCycle",value:function(e,t,n,r){var i=this;this.modificationQueue.push(function(t){if(r){var n=!0,o=!1,a=void 0;try{for(var s,c=r[Symbol.iterator]();!(n=(s=c.next()).done);n=!0){var u=s.value;i.peerconnection.addTrack(u)}}catch(e){o=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}}var f=i._processNewJingleOfferIq(e),p=i.peerconnection.localDescription.sdp;i._renegotiate(f.raw).then(function(){if(i.state===l.c&&(i.state=l.a,i.isP2P&&!i._localVideoActive&&i.sendContentModify(i._localVideoActive)),p){var e=new d.a(i.peerconnection.localDescription.sdp);i.notifyMySSRCUpdate(new d.a(p),e)}t()},function(e){P.error("Error renegotiating after setting new remote ".concat(i.isInitiator?"answer: ":"offer: ").concat(e),f),i._onJingleFatalError(e),t(e)})},function(e){e?n(e):t()})}},{key:"replaceTransport",value:function(e,t,n){var r=this;this.room.eventEmitter.emit(b.a.ICE_RESTARTING,this);var i=e.clone();e.find(">content[name='data']").attr("senders","rejected"),e.find(">content>description>source").remove(),e.find(">content>description>ssrc-group").remove(),this.setOfferAnswerCycle(e,function(){r.setOfferAnswerCycle(i,function(){var e=new d.a(r.peerconnection.localDescription.sdp);r.sendTransportAccept(e,t,n),r.room.eventEmitter.emit(b.a.ICE_RESTART_SUCCESS,r,i)},n)},n)}},{key:"sendSessionAccept",value:function(e,t){var n=this,r=new d.a(this.peerconnection.localDescription.sdp),i=Object(s.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-accept",initiator:this.initiatorJid,responder:this.responderJid,sid:this.sid});this.webrtcIceTcpDisable&&(r.removeTcpCandidates=!0),this.webrtcIceUdpDisable&&(r.removeUdpCandidates=!0),this.failICE&&(r.failICE=!0),r.toJingle(i,this.initiatorJid===this.localJid?"initiator":"responder",null),i=i.tree(),P.info("Sending session-accept",i),this.connection.sendIQ(i,e,this.newJingleErrorHandler(i,function(e){t(e),n.room.eventEmitter.emit(b.a.SESSION_ACCEPT_TIMEOUT,n)}),1e4)}},{key:"sendContentModify",value:function(e){var t=e?"both":"none",n=Object(s.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"content-modify",initiator:this.initiatorJid,sid:this.sid}).c("content",{name:"video",senders:t});P.info("Sending content-modify, video senders: ".concat(t)),this.connection.sendIQ(n,null,this.newJingleErrorHandler(n),1e4)}},{key:"sendTransportAccept",value:function(e,t,n){var r=this,i=Object(s.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"transport-accept",initiator:this.initiatorJid,sid:this.sid});e.media.forEach(function(t,n){var o=p.a.parseMLine(t.split("\r\n")[0]);i.c("content",{creator:r.initiatorJid===r.localJid?"initiator":"responder",name:o.media}),e.transportToJingle(n,i),i.up()}),i=i.tree(),P.info("Sending transport-accept: ",i),this.connection.sendIQ(i,t,this.newJingleErrorHandler(i,n),1e4)}},{key:"sendTransportReject",value:function(e,t){var n=Object(s.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"transport-reject",initiator:this.initiatorJid,sid:this.sid});n=n.tree(),P.info("Sending 'transport-reject",n),this.connection.sendIQ(n,e,this.newJingleErrorHandler(n,t),1e4)}},{key:"terminate",value:function(e,t,n){if(this.state!==l.b){if(!n||Boolean(n.sendSessionTerminate)){var r=Object(s.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-terminate",initiator:this.initiatorJid,sid:this.sid}).c("reason").c(n&&n.reason||"success");n&&n.reasonDescription&&r.up().c("text").t(n.reasonDescription),r=r.tree(),P.info("Sending session-terminate",r),this.connection.sendIQ(r,e,this.newJingleErrorHandler(r,t),1e4)}else P.info("Skipped sending session-terminate for ".concat(this));this.connection.jingle.terminate(this.sid)}}},{key:"onTerminated",value:function(e,t){this.state=l.b,this.establishmentDuration=void 0,P.info("Session terminated ".concat(this),e,t),this.close()}},{key:"_parseSsrcInfoFromSourceAdd",value:function(e,t){var n=[];return $(e).each(function(e,r){var i=$(r).attr("name"),o="";$(r).find('ssrc-group[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each(function(){var e=this.getAttribute("semantics"),t=$(this).find(">source").map(function(){return this.getAttribute("ssrc")}).get();t.length&&(o+="a=ssrc-group:".concat(e," ").concat(t.join(" "),"\r\n"))}),$(r).find('source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each(function(){var e=$(this).attr("ssrc");t.containsSSRC(e)?P.warn("Source-add request for existing SSRC: ".concat(e)):$(this).find(">parameter").each(function(){o+="a=ssrc:".concat(e," ").concat($(this).attr("name")),$(this).attr("value")&&$(this).attr("value").length&&(o+=":".concat($(this).attr("value"))),o+="\r\n"})}),t.media.forEach(function(e,t){p.a.findLine(e,"a=mid:".concat(i))&&(n[t]||(n[t]=""),n[t]+=o)})}),n}},{key:"addRemoteStream",value:function(e){this._addOrRemoveRemoteStream(!0,e)}},{key:"removeRemoteStream",value:function(e){this._addOrRemoveRemoteStream(!1,e)}},{key:"_addOrRemoveRemoteStream",value:function(e,t){var n=this,r=e?"addRemoteStream":"removeRemoteStream";e&&this.readSsrcInfo(t);this.modificationQueue.push(function(i){if(!n.peerconnection.localDescription||!n.peerconnection.localDescription.sdp){var o="".concat(r," - localDescription not ready yet");return P.error(o),void i(o)}P.log("Processing ".concat(r)),P.log("ICE connection state: ",n.peerconnection.iceConnectionState);var a=new d.a(n.peerconnection.localDescription.sdp),s=new d.a(n.peerconnection.remoteDescription.sdp),c=e?n._parseSsrcInfoFromSourceAdd(t,s):n._parseSsrcInfoFromSourceRemove(t,s),u=e?n._processRemoteAddSource(c):n._processRemoteRemoveSource(c);n._renegotiate(u.raw).then(function(){var e=new d.a(n.peerconnection.localDescription.sdp);P.log("".concat(r," - OK, SDPs: "),a,e),n.notifyMySSRCUpdate(a,e),i()},function(e){P.error("".concat(r," failed:"),e),i(e)})})}},{key:"_processQueueTasks",value:function(e,t){e(t)}},{key:"_processNewJingleOfferIq",value:function(e){var t=new d.a("");return this.webrtcIceTcpDisable&&(t.removeTcpCandidates=!0),this.webrtcIceUdpDisable&&(t.removeUdpCandidates=!0),this.failICE&&(t.failICE=!0),t.fromJingle(e),this.readSsrcInfo($(e).find(">content")),t}},{key:"_processRemoteRemoveSource",value:function(e){var t=new d.a(this.peerconnection.remoteDescription.sdp);return e.forEach(function(e,n){(e=e.split("\r\n")).pop(),e.forEach(function(e){t.media[n]=t.media[n].replace("".concat(e,"\r\n"),"")})}),t.raw=t.session+t.media.join(""),t}},{key:"_processRemoteAddSource",value:function(e){var t=new d.a(this.peerconnection.remoteDescription.sdp);return e.forEach(function(e,n){t.media[n]+=e}),t.raw=t.session+t.media.join(""),t}},{key:"_renegotiate",value:function(e){if("closed"===this.peerconnection.signalingState)return Promise.reject("Attempted to renegotiate in state closed");var t=e||this.peerconnection.remoteDescription.sdp;if(!t)return Promise.reject("Can not renegotiate without remote description,"+"- current state: ".concat(this.state));var n=new RTCSessionDescription({type:this.isInitiator?"answer":"offer",sdp:t});return this.isInitiator?this._initiatorRenegotiate(n):this._responderRenegotiate(n)}},{key:"_responderRenegotiate",value:function(e){var t=this;return P.debug("Renegotiate: setting remote description"),this.peerconnection.setRemoteDescription(e).then(function(){return P.debug("Renegotiate: creating answer"),t.peerconnection.createAnswer(t.mediaConstraints).then(function(e){return P.debug("Renegotiate: setting local description"),t.peerconnection.setLocalDescription(e)})})}},{key:"_initiatorRenegotiate",value:function(e){var t=this;return"have-local-offer"===this.peerconnection.signalingState?(P.debug("Renegotiate: setting remote description"),this.peerconnection.setRemoteDescription(e).then(function(){return t._initiatorRenegotiate(e)})):(P.debug("Renegotiate: creating offer"),this.peerconnection.createOffer(this.mediaConstraints).then(function(n){return P.debug("Renegotiate: setting local description"),t.peerconnection.setLocalDescription(n).then(function(){return P.debug("Renegotiate: setting remote description"),t.peerconnection.setRemoteDescription(e)})}))}},{key:"replaceTrack",value:function(e,t){var n=this,r=function(r){if("closed"===n.peerconnection.signalingState||"closed"===n.peerconnection.connectionState||n.closed)r();else{var i=n.peerconnection.localDescription.sdp;!e&&t&&t.isVideoTrack()?n.peerconnection.clearRecvonlySsrc():e&&e.isVideoTrack()&&!t&&(n.peerconnection.clearRecvonlySsrc(),n.peerconnection.generateRecvonlySsrc()),n.peerconnection.replaceTrack(e,t).then(function(o){o&&(e||t)&&n.state===l.a?n._renegotiate().then(function(){var e=new d.a(n.peerconnection.localDescription.sdp);n.notifyMySSRCUpdate(new d.a(i),e),r()},r):r()})}};return new Promise(function(e,t){n.modificationQueue.push(r,function(n){n?(P.error("Replace track error:",n),t(n)):(P.info("Replace track done!"),e())})})}},{key:"_parseSsrcInfoFromSourceRemove",value:function(e,t){var n=[];return $(e).each(function(e,r){var i=$(r).attr("name"),o="";$(r).find('ssrc-group[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each(function(){var e=this.getAttribute("semantics"),t=$(this).find(">source").map(function(){return this.getAttribute("ssrc")}).get();t.length&&(o+="a=ssrc-group:".concat(e," ").concat(t.join(" "),"\r\n"))});var a=[];$(r).find('source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each(function(){var e=$(this).attr("ssrc");a.push(e)}),t.media.forEach(function(e,t){p.a.findLine(e,"a=mid:".concat(i))&&(n[t]||(n[t]=""),a.forEach(function(r){var i=p.a.findLines(e,"a=ssrc:".concat(r));i.length&&(n[t]+="".concat(i.join("\r\n"),"\r\n"))}),n[t]+=o)})}),n}},{key:"_verifyNoSSRCChanged",value:function(e,t){var n=new d.a(this.peerconnection.localDescription.sdp),r=new f.a(t,n),i=r.getNewMedia();if(Object.keys(i).length)return P.error("".concat(this," - some SSRC were added on ").concat(e),i),!1;var o=(r=new f.a(n,t)).getNewMedia();return!Object.keys(o).length||(P.error("".concat(this," - some SSRCs were removed on ").concat(e),o),!1)}},{key:"addTrackAsUnmute",value:function(e){return this._addRemoveTrackAsMuteUnmute(!1,e)}},{key:"removeTrackAsMute",value:function(e){return this._addRemoveTrackAsMuteUnmute(!0,e)}},{key:"_addRemoveTrackAsMuteUnmute",value:function(e,t){var n=this;if(!t)return Promise.reject('invalid "track" argument value');var r=e?"removeTrackMute":"addTrackUnmute",i=function(i){var o=n.peerconnection;if(o){var a=o.localDescription.sdp;(e?o.removeTrackMute.bind(o,t):o.addTrackUnmute.bind(o,t))()?a&&o.remoteDescription.sdp?n._renegotiate().then(function(){n._verifyNoSSRCChanged(r,new d.a(a)),i()},i):i():i("".concat(r," failed!"))}else i("Error:  tried ".concat(r," track with no active peer")+"connection")};return new Promise(function(e,t){n.modificationQueue.push(i,function(n){n?t(n):e()})})}},{key:"setMediaTransferActive",value:function(e,t){var n=this;if(!this.peerconnection)return Promise.reject('Can not modify transfer active state, before "initialize" is called');var r=e?"audio active":"audio inactive",i=t?"video active":"video inactive";P.info("Queued make ".concat(i,", ").concat(r," task..."));var o=function(r){var i=n.state===l.a,o=n.peerconnection.setAudioTransferActive(e);n._localVideoActive!==t&&(n._localVideoActive=t,n.isP2P&&i&&n.sendContentModify(t));var a=n.peerconnection.setVideoTransferActive(n._localVideoActive&&n._remoteVideoActive);i&&(o||a)?n._renegotiate().then(r,r):r()};return new Promise(function(e,t){n.modificationQueue.push(o,function(n){n?t(n):e()})})}},{key:"modifyContents",value:function(e){var n=this,r=t.parseVideoSenders(e);if(null!==r){P.debug("".concat(this,' queued "content-modify" task')+'(video senders="'.concat(r,'")')),this.modificationQueue.push(function(e){n._assertNotEnded("content-modify")&&n._modifyRemoteVideoActive(r)?n._renegotiate().then(e,e):e()},function(e){e&&P.error('"content-modify" failed',e)})}else P.error("".concat(this,' - failed to parse video "senders" attribute in')+'"content-modify" action')}},{key:"_modifyRemoteVideoActive",value:function(e){var t="both"===e||"initiator"===e&&this.isInitiator||"responder"===e&&!this.isInitiator;return t!==this._remoteVideoActive&&(P.debug("".concat(this," new remote video active: ").concat(t)),this._remoteVideoActive=t),this.peerconnection.setVideoTransferActive(this._localVideoActive&&this._remoteVideoActive)}},{key:"notifyMySSRCUpdate",value:function(e,t){if(this.state===l.a){var n=new f.a(t,e),r=Object(s.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"source-remove",initiator:this.initiatorJid,sid:this.sid});n.toJingle(r)?(P.info("Sending source-remove",r.tree()),this.connection.sendIQ(r,null,this.newJingleErrorHandler(r),1e4)):P.log("removal not necessary"),n=new f.a(e,t);var i=Object(s.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"source-add",initiator:this.initiatorJid,sid:this.sid});n.toJingle(i)?(P.info("Sending source-add",i.tree()),this.connection.sendIQ(i,null,this.newJingleErrorHandler(i),1e4)):P.log("addition not necessary")}else P.warn("Skipping SSRC update in '".concat(this.state," ' state."))}},{key:"newJingleErrorHandler",value:function(e,t){var n=this;return function(e){var r={},i=$(e).find("error");if(i.length){r.code=i.attr("code");var o=$(e).find("error :first");o.length&&(r.reason=o[0].tagName);var a=i.find(">text");a.length&&(r.msg=a.text())}e||(r.reason="timeout"),r.session=n.toString(),t?t(r):n.state===l.b&&"item-not-found"===r.reason?P.debug("Jingle error: ".concat(JSON.stringify(r))):_.a.callErrorHandler(new Error("Jingle error: ".concat(JSON.stringify(r))))}}},{key:"_onJingleFatalError",value:function(e){this.room&&(this.room.eventEmitter.emit(b.a.CONFERENCE_SETUP_FAILED,this,e),this.room.eventEmitter.emit(b.a.JINGLE_FATAL_ERROR,this,e))}},{key:"getIceConnectionState",value:function(){return this.peerconnection.iceConnectionState}},{key:"close",value:function(){this.closed=!0,this.signalingLayer.setChatRoom(null),this.peerconnection&&(this.peerconnection.signalingState&&"closed"!==this.peerconnection.signalingState||this.peerconnection.connectionState&&"closed"!==this.peerconnection.connectionState)&&this.peerconnection.close()}},{key:"toString",value:function(){return"JingleSessionPC[p2p=".concat(this.isP2P,",")+"initiator=".concat(this.isInitiator,",sid=").concat(this.sid,"]")}},{key:"_abtestSuspendVideoEnabled",value:function(e){var t=e.abTesting;if(t&&t.enableSuspendVideoTest){var n=this._getInitiatorJid();return Object(c.integerHash)(n)%2==0}}}]),t}()}).call(this,"modules/xmpp/JingleSessionPC.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return k});var r=n(4),i=n(54),o=n(15),a=n(12),s=n(17),c=n(3),u=n(11),l=n(41),d=n.n(l),f=n(9),p=n(8),h=n.n(p),v=n(14),m=n.n(v),g=n(7),y=n(6);function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _(e,t,n){return(_="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=E(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var w=Object(r.getLogger)(e),k=function(e){function t(e){var n,r,i,o=e.deviceId,a=e.facingMode,l=e.mediaType,d=e.resolution,f=e.rtcId,p=e.sourceId,v=e.sourceType,m=e.stream,g=e.track,y=e.videoType;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,i=E(t).call(this,null,m,g,function(){return n.emit(s.LOCAL_TRACK_STOPPED)},l,y),(n=!i||"object"!==b(i)&&"function"!=typeof i?T(r):i).rtcId=f,n.sourceId=p,n.sourceType=v,c.a.usesNewGumFlow()?(n.resolution=g.getSettings().height,n._constraints=g.getConstraints()):n.resolution=c.a.isFirefox()?null:d,n.deviceId=o,n._prevSetMuted=Promise.resolve(),n._facingMode=a,n._trackEnded=!1,n._hasSentData=!1,n._testDataSent=!0,n._realDeviceId=""===n.deviceId?void 0:n.deviceId,n._noDataFromSourceTimeout=null,n._onDeviceListChanged=function(e){n._setRealDeviceIdFromDeviceList(e),void 0!==n.getTrack().readyState||void 0===n._realDeviceId||e.find(function(e){return e.deviceId===n._realDeviceId})||(n._trackEnded=!0)},n.isAudioTrack()&&u.a.isDeviceChangeAvailable("output")&&(n._onAudioOutputDeviceChanged=n.setAudioOutput.bind(T(T(n))),u.a.addListener(h.a.AUDIO_OUTPUT_DEVICE_CHANGED,n._onAudioOutputDeviceChanged)),u.a.addListener(h.a.DEVICE_LIST_CHANGED,n._onDeviceListChanged),n._initNoDataFromSourceHandlers(),n}var n,r,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(t,i["a"]),n=t,(r=[{key:"isEnded",value:function(){return"ended"===this.getTrack().readyState||this._trackEnded}},{key:"_initNoDataFromSourceHandlers",value:function(){var e=this;if(this.isVideoTrack()&&this.videoType===m.a.CAMERA){var t=this._onNoDataFromSourceError.bind(this);this._setHandler("track_mute",function(){if(e._checkForCameraIssues()){var n=window.performance.now();e._noDataFromSourceTimeout=setTimeout(t,3e3),e._setHandler("track_unmute",function(){e._clearNoDataFromSourceMuteResources(),y.a.sendAnalyticsAndLog(g.q,{media_type:e.getType(),track_type:"local",value:window.performance.now()-n})})}}),this._setHandler("track_ended",t)}}},{key:"_clearNoDataFromSourceMuteResources",value:function(){this._noDataFromSourceTimeout&&(clearTimeout(this._noDataFromSourceTimeout),this._noDataFromSourceTimeout=null),this._setHandler("track_unmute",void 0)}},{key:"_onNoDataFromSourceError",value:function(){this._clearNoDataFromSourceMuteResources(),this._checkForCameraIssues()&&this._fireNoDataFromSourceEvent()}},{key:"_fireNoDataFromSourceEvent",value:function(){this.emit(s.NO_DATA_FROM_SOURCE),y.a.sendAnalytics(Object(g.C)(this.getType()));var e={name:s.NO_DATA_FROM_SOURCE};this.isAudioTrack()&&(e.isReceivingData=this._isReceivingData()),y.a.sendLog(JSON.stringify(e))}},{key:"_setRealDeviceIdFromDeviceList",value:function(e){var t=this.getTrack(),n=e.find(function(e){return e.kind==="".concat(t.kind,"input")&&e.label===t.label});n&&(this._realDeviceId=n.deviceId)}},{key:"_setStream",value:function(e){_(E(t.prototype),"_setStream",this).call(this,e),e?(this.storedMSID=this.getMSID(),w.debug("Setting new MSID: ".concat(this.storedMSID," on ").concat(this))):w.debug("Setting 'null' stream on ".concat(this))}},{key:"mute",value:function(){return this._queueSetMuted(!0)}},{key:"unmute",value:function(){return this._queueSetMuted(!1)}},{key:"_queueSetMuted",value:function(e){var t=this._setMuted.bind(this,e);return this._prevSetMuted=this._prevSetMuted.then(t,t),this._prevSetMuted}},{key:"_setMuted",value:function(e){var t=this;if(this.isMuted()===e)return Promise.resolve();if(this.disposed)return Promise.reject(new o.a(a.TRACK_IS_DISPOSED));var n=Promise.resolve(),r=function(){return w.info("Mute ".concat(t,": ").concat(e))};if(this.isAudioTrack()||this.videoType===m.a.DESKTOP||!c.a.doesVideoMuteByStreamRemove())r(),this.track&&(this.track.enabled=!e);else if(e)n=new Promise(function(e,n){r(),t._removeStreamFromConferenceAsMute(function(){t._unregisterHandlers(),t._stopStream(),t._setStream(null),e()},n)});else{r();var i={cameraDeviceId:this.getDeviceId(),devices:[f.b],facingMode:this.getCameraFacingMode()};c.a.usesNewGumFlow()?n=u.a.newObtainAudioAndVideoPermissions(Object.assign({},i,{constraints:{video:this._constraints}})):(this.resolution&&(i.resolution=this.resolution),n=u.a.obtainAudioAndVideoPermissions(i)),n.then(function(e){var n=t.getType(),r=c.a.usesNewGumFlow()?e.find(function(e){return e.track.kind===n}):e.find(function(e){return e.mediaType===n});if(!r)throw new o.a(a.TRACK_NO_STREAM_FOUND);return t._setStream(r.stream),t.track=r.track,t.videoType!==r.videoType&&(w.warn("".concat(t,": video type has changed after unmute!"),t.videoType,r.videoType),t.videoType=r.videoType),t.containers.map(function(e){return u.a.attachMediaStream(e,t.stream)}),t._addStreamToConferenceAsUnmute()})}return n.then(function(){return t._sendMuteStatus(e)}).then(function(){return t.emit(s.TRACK_MUTE_CHANGED,t)})}},{key:"_addStreamToConferenceAsUnmute",value:function(){var e=this;return this.conference?new Promise(function(t,n){e.conference._addLocalTrackAsUnmute(e).then(t,function(e){return n(new Error(e))})}):Promise.resolve()}},{key:"_removeStreamFromConferenceAsMute",value:function(e,t){this.conference?this.conference._removeLocalTrackAsMute(this).then(e,function(e){return t(new Error(e))}):e()}},{key:"_sendMuteStatus",value:function(e){var t=this;return this.conference&&this.conference.room?new Promise(function(n){t.conference.room[t.isAudioTrack()?"setAudioMute":"setVideoMute"](e,n)}):Promise.resolve()}},{key:"dispose",value:function(){var e=this,n=Promise.resolve();return this.conference&&(n=this.conference.removeTrack(this)),this.stream&&(this._stopStream(),this.detach()),u.a.removeListener(h.a.DEVICE_LIST_CHANGED,this._onDeviceListChanged),this._onAudioOutputDeviceChanged&&u.a.removeListener(h.a.AUDIO_OUTPUT_DEVICE_CHANGED,this._onAudioOutputDeviceChanged),n.then(function(){return _(E(t.prototype),"dispose",e).call(e)})}},{key:"isMuted",value:function(){return!this.stream||(!(!this.isVideoTrack()||this.isActive())||(!this.track||!this.track.enabled))}},{key:"_setConference",value:function(e){this.conference=e;for(var t=0;t<this.containers.length;t++)this._maybeFireTrackAttached(this.containers[t])}},{key:"isLocal",value:function(){return!0}},{key:"getDeviceId",value:function(){return this._realDeviceId||this.deviceId}},{key:"getParticipantId",value:function(){return this.conference&&this.conference.myUserId()}},{key:"_onByteSentStatsReceived",value:function(e,t){var n=this;t>0&&(this._hasSentData=!0);var r=e.getConnectionState();this._testDataSent&&"connected"===r&&(setTimeout(function(){n._hasSentData||(w.warn("".concat(n," 'bytes sent' <= 0:                         ").concat(n._bytesSent)),n._fireNoDataFromSourceEvent())},3e3),this._testDataSent=!1)}},{key:"getCameraFacingMode",value:function(){if(this.isVideoTrack()&&this.videoType===m.a.CAMERA){var e;try{e=this.track.getSettings()}catch(e){}return e&&"facingMode"in e?e.facingMode:void 0!==this._facingMode?this._facingMode:d.a.USER}}},{key:"_stopStream",value:function(){this._stopStreamInProgress=!0;try{u.a.stopMediaStream(this.stream)}finally{this._stopStreamInProgress=!1}}},{key:"_switchCamera",value:function(){this.isVideoTrack()&&this.videoType===m.a.CAMERA&&"function"==typeof this.track._switchCamera&&(this.track._switchCamera(),this._facingMode=this._facingMode===d.a.ENVIRONMENT?d.a.USER:d.a.ENVIRONMENT)}},{key:"_checkForCameraIssues",value:function(){return!(!this.isVideoTrack()||this._stopStreamInProgress||this.videoType===m.a.DESKTOP)&&!this._isReceivingData()}},{key:"_isReceivingData",value:function(){return!!this.stream&&this.stream.getTracks().some(function(e){return!("readyState"in e&&"live"!==e.readyState||"muted"in e&&!0===e.muted)})}},{key:"toString",value:function(){return"LocalTrack[".concat(this.rtcId,",").concat(this.getType(),"]")}}])&&S(n.prototype,r),l&&S(n,l),t}()}).call(this,"modules/RTC/JitsiLocalTrack.js")},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(1),i=n(45);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._connection=t.connection,this._mode=t.mode,this._setSessionID(t.sessionID),this.setStatus(t.status)}var t,n,a;return t=e,(n=[{key:"getError",value:function(){return this._error}},{key:"getID",value:function(){return this._sessionID}},{key:"getLiveStreamViewURL",value:function(){return this._liveStreamViewURL}},{key:"getStatus",value:function(){return this._status}},{key:"getMode",value:function(){return this._mode}},{key:"setError",value:function(e){this._error=e}},{key:"setLiveStreamViewURL",value:function(e){this._liveStreamViewURL=e}},{key:"setStatus",value:function(e){this._status=e}},{key:"start",value:function(e){var t=this,n=e.appData,r=e.broadcastId,o=e.focusMucJid,a=e.streamId;return new Promise(function(e,s){t._connection.sendIQ(t._createIQ({action:"start",appData:n,focusMucJid:o,broadcastId:r,streamId:a}),function(n){t.setStatus("pending"),t._setSessionID(i.a.getSessionIdFromIq(n)),e()},function(e){t._setErrorFromIq(e),s(e)})})}},{key:"stop",value:function(e){var t=this,n=e.focusMucJid;return new Promise(function(e,r){t._connection.sendIQ(t._createIQ({action:"stop",focusMucJid:n}),e,r)})}},{key:"_createIQ",value:function(e){var t=e.action,n=e.appData,i=e.broadcastId,o=e.focusMucJid,a=e.streamId;return Object(r.$iq)({to:o,type:"set"}).c("jibri",{xmlns:"http://jitsi.org/protocol/jibri",action:t,app_data:n,recording_mode:this._mode,streamid:a,you_tube_broadcast_id:i}).up()}},{key:"_setErrorFromIq",value:function(e){var t=e.getElementsByTagName("error")[0];this.setError(t.children[0].tagName)}},{key:"_setSessionID",value:function(e){this._sessionID=e}}])&&o(t.prototype,n),a&&o(t,a),e}()},function(e,t,n){"use strict";var r=n(29),i=n.n(r),o=n(9),a=n(3),s=n(13),c=n(8),u=n.n(c),l=n(6),d=n(46);function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._eventEmitter=new i.a,this._grantedPermissions={},s.a.addListener(u.a.DEVICE_LIST_CHANGED,function(e){return t._eventEmitter.emit(d.DEVICE_LIST_CHANGED,e)}),s.a.addListener(u.a.DEVICE_LIST_AVAILABLE,function(e){return t._logOutputDevice(t.getAudioOutputDevice(),e)}),s.a.addListener(u.a.GRANTED_PERMISSIONS,function(e){return t._handleGrantedPermissions(e)}),this._permissionsApiSupported=new Promise(function(e){navigator.permissions?navigator.permissions.query({name:"camera "}).then(function(){return e(!0)},function(){return e(!1)}):e(!1)})}var t,n,r;return t=e,(n=[{key:"_handleGrantedPermissions",value:function(e){this._grantedPermissions=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){f(e,t,n[t])})}return e}({},this._grantedPermissions,e)}},{key:"_logOutputDevice",value:function(e,t){var n=t.find(function(t){return"audiooutput"===t.kind&&t.deviceId===e});n&&l.a.sendActiveDeviceListEvent(s.a.getEventDataForActiveDevice(n))}},{key:"enumerateDevices",value:function(e){s.a.enumerateDevices(e)}},{key:"isDeviceListAvailable",value:function(){return s.a.isDeviceListAvailable()}},{key:"isDeviceChangeAvailable",value:function(e){return s.a.isDeviceChangeAvailable(e)}},{key:"isDevicePermissionGranted",value:function(e){var t=this;return new Promise(function(n){e in t._grantedPermissions?n(t._grantedPermissions[e]):t._permissionsApiSupported.then(function(t){if(t){var r=[];switch(e){case o.b:r.push(navigator.permissions.query({name:"camera"}));break;case o.a:r.push(navigator.permissions.query({name:"microphone"}));break;default:r.push(navigator.permissions.query({name:"camera"})),r.push(navigator.permissions.query({name:"microphone"}))}Promise.all(r).then(function(e){return n(e.every(Boolean))},function(){return n(!1)})}else n(!1)})})}},{key:"isMultipleAudioInputSupported",value:function(){return!a.a.isFirefox()}},{key:"getAudioOutputDevice",value:function(){return s.a.getAudioOutputDevice()}},{key:"setAudioOutputDevice",value:function(e){var t=s.a.getCurrentlyAvailableMediaDevices();return t&&t.length>0&&this._logOutputDevice(e,s.a.getCurrentlyAvailableMediaDevices()),s.a.setAudioOutputDevice(e)}},{key:"addEventListener",value:function(e,t){this._eventEmitter.addListener(e,t)}},{key:"removeEventListener",value:function(e,t){this._eventEmitter.removeListener(e,t)}},{key:"emitEvent",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this._eventEmitter).emit.apply(t,[e].concat(r))}},{key:"supportsVideo",value:function(){return a.a.supportsVideo()}}])&&p(t.prototype,n),r&&p(t,r),e}();t.a=new h},function(e,t){var n={trace:0,debug:1,info:2,log:3,warn:4,error:5};o.consoleTransport=console;var r=[o.consoleTransport];function i(){var e=arguments[0],t=arguments[1],i=Array.prototype.slice.call(arguments,2);if(!(n[t]<e.level))for(var o=function(){var e={methodName:"",fileLocation:"",line:null,column:null},t=new Error,n=t.stack?t.stack.split("\n"):[];if(!n||n.length<1)return e;var r=null;return n[3]&&(r=n[3].match(/\s*at\s*(.+?)\s*\((\S*)\s*:(\d*)\s*:(\d*)\)/)),!r||r.length<=4?(0===n[2].indexOf("log@")?e.methodName=n[3].substr(0,n[3].indexOf("@")):e.methodName=n[2].substr(0,n[2].indexOf("@")),e):(e.methodName=r[1],e.fileLocation=r[2],e.line=r[3],e.column=r[4],e)}(),a=r.concat(e.transports),s=0;s<a.length;s++){var c=a[s],u=c[t];u&&"function"==typeof u&&u.bind(c,e.id?"["+e.id+"]":"","<"+o.methodName+">: ").apply(c,i)}}function o(e,t,r,o){this.id=t,this.format=o,this.transports=r,this.transports||(this.transports=[]),this.level=n[e];for(var a=Object.keys(n),s=0;s<a.length;s++)this[a[s]]=i.bind(null,this,a[s])}o.addGlobalTransport=function(e){-1===r.indexOf(e)&&r.push(e)},o.removeGlobalTransport=function(e){var t=r.indexOf(e);-1!==t&&r.splice(t,1)},o.prototype.setLevel=function(e){this.level=n[e]},e.exports=o,o.levels={TRACE:"trace",DEBUG:"debug",INFO:"info",LOG:"log",WARN:"warn",ERROR:"error"}},function(e,t){var n=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach(function(e){n[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},function(e,t,n){"use strict";var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},r.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){var t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},r.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),e.ufrag&&(t.push("ufrag"),t.push(e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.numChannels=3===t.length?parseInt(t[2],10):1,n},r.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){r.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},r.getIceParameters=function(e,t){var n=r.splitLines(e);return{usernameFragment:(n=n.concat(r.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var o=n[i],a=r.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=r.parseRtpMap(a),c=r.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=c.length?r.parseFmtp(c[0]):{},s.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(r.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))}),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(e){n+=r.writeExtmap(e)}),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,u=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:t}};n.push(r),o&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:t,mechanism:a?"red+ulpfec":"red"},n.push(r))}}),0===n.length&&c&&n.push({ssrc:c});var l=r.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=l})),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=r.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var i=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t){var n=void 0!==t?t:2;return"v=0\r\no=thisisadapterortc "+(e||r.generateSessionId())+" "+n+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},e.exports=r},function(e,t,n){var r=n(149),i="audio/webm",o="audio/ogg",a=function(e){this.track=e,this.recorder=null,this.data=null,this.name=null,this.startTime=null};function s(e){if(void 0===e.recorder)throw new Error("Passed an object to startRecorder which is not a TrackRecorder object");e.recorder.start(),e.startTime=new Date}function c(e){if(void 0===e.recorder)throw new Error("Passed an object to stopRecorder which is not a TrackRecorder object");e.recorder.stop()}function u(){if(MediaRecorder.isTypeSupported(i))return i;if(MediaRecorder.isTypeSupported(o))return o;throw new Error("unable to create a MediaRecorder with the right mimetype!")}function l(e){this.recorders=[],this.fileType=u(),this.isRecording=!1,this.jitsiConference=e}l.determineCorrectFileType=u,l.prototype.addTrack=function(e){if(e.isAudioTrack()){var t=this.instantiateTrackRecorder(e);this.recorders.push(t),this.updateNames(),this.isRecording&&s(t)}},l.prototype.instantiateTrackRecorder=function(e){var t=new a(e),n=t.track.getOriginalStream(),r=function(){if("undefined"!=typeof MediaStream)return new MediaStream;throw new Error("cannot create a clean mediaStream")}();return n.getAudioTracks().forEach(function(e){return r.addTrack(e)}),t.recorder=new MediaRecorder(r,{mimeType:this.fileType}),t.data=[],t.recorder.ondataavailable=function(e){e.data.size>0&&t.data.push(e.data)},t},l.prototype.removeTrack=function(e){if(!e.isVideoTrack()){var t,n=this.recorders;for(t=0;t<n.length;t++)if(n[t].track.getParticipantId()===e.getParticipantId()){var r=n[t];this.isRecording?c(r):n.splice(t,1)}this.updateNames()}},l.prototype.updateNames=function(){var e=this.jitsiConference;this.recorders.forEach(function(t){if(t.track.isLocal())t.name="the transcriber";else{var n=t.track.getParticipantId(),r=e.getParticipantById(n).getDisplayName();"undefined"!==r&&(t.name=r)}})},l.prototype.start=function(){if(this.isRecording)throw new Error("audiorecorder is already recording");this.isRecording=!0,this.recorders.forEach(function(e){return s(e)}),console.log("Started the recording of the audio. There are currently ".concat(this.recorders.length," recorders active."))},l.prototype.stop=function(){this.isRecording=!1,this.recorders.forEach(function(e){return c(e)}),console.log("stopped recording")},l.prototype.download=function(){var e=this;this.recorders.forEach(function(t){var n=new Blob(t.data,{type:e.fileType}),r=URL.createObjectURL(n),i=document.createElement("a");document.body.appendChild(i),i.style="display: none",i.href=r,i.download="test.".concat(e.fileType.split("/")[1]),i.click(),window.URL.revokeObjectURL(r)})},l.prototype.getRecordingResults=function(){var e=this;if(this.isRecording)throw new Error("cannot get blobs because the AudioRecorder is still recording!");this.updateNames();var t=[];return this.recorders.forEach(function(n){return t.push(new r(new Blob(n.data,{type:e.fileType}),n.name,n.startTime))}),t},l.prototype.getFileType=function(){return this.fileType},e.exports=l},function(e,t){e.exports={getTokenAuthUrl:function(e,t,n){return"string"!=typeof e?null:e.replace("{room}",t).replace("{roleUpgrade}",!0===n)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n(7),i=n(69),o=n(22),a=n(6),s=n(43);function c(e,t,n){this.appID=e,this.token=t,this.options=n,this.xmpp=new s.b(n,t),this.addEventListener(o.CONNECTION_FAILED,function(e,t,n,i){a.a.sendAnalyticsAndLog(Object(r.w)(e,t,i))}),this.addEventListener(o.CONNECTION_DISCONNECTED,function(e){e&&a.a.sendAnalytics(r.l,{message:e}),a.a.sendLog(JSON.stringify({id:r.l,msg:e}))})}c.prototype.connect=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.xmpp.connect(e.id,e.password)},c.prototype.attach=function(e){this.xmpp.attach(e)},c.prototype.disconnect=function(){var e;(e=this.xmpp).disconnect.apply(e,arguments)},c.prototype.setToken=function(e){this.token=e},c.prototype.initJitsiConference=function(e,t){return new i.a({name:e,config:t,connection:this})},c.prototype.addEventListener=function(e,t){this.xmpp.addListener(e,t)},c.prototype.removeEventListener=function(e,t){this.xmpp.removeListener(e,t)},c.prototype.getConnectionTimes=function(){return this.xmpp.connectionTimes},c.prototype.addFeature=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.xmpp.caps.addFeature(e,t)},c.prototype.removeFeature=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.xmpp.caps.removeFeature(e,t)}},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return z});var r=n(1),i=n(29),o=n.n(i),a=n(4),s=n(70),c=n.n(s),u=n(21),l=n(71),d=n(2),f=n(78),p=n(15),h=n(12),v=n(17),m=n(79),g=n(94),y=n.n(g),b=n(95),S=n(13),_=n(103),E=n(3),C=n(104),T=n(44),w=n(105),k=n(106),R=n(107),P=n(108),I=n(109),O=n(110),A=n(6),M=n(111),D=n.n(M),N=n(10),x=n.n(N),L=n(112),j=n(113),F=n(20),U=n(43),H=n(9),B=n(8),G=n(14),J=n.n(G),V=n(7),W=n(0);function q(e){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var K=Object(a.getLogger)(e);function z(e){if(!e.name||e.name.toLowerCase()!==e.name){var t="Invalid conference name (no conference name passed or it contains invalid characters like capital letters)!";throw K.error(t),new Error(t)}this.eventEmitter=new o.a,this.options=e,this.eventManager=new l.a(this),this.participants={},this._init(e),this.componentsVersions=new L.a(this),this.jvbJingleSession=null,this.lastDominantSpeaker=null,this.dtmfManager=null,this.somebodySupportsDTMF=!1,this.authEnabled=!1,this.startAudioMuted=!1,this.startVideoMuted=!1,this.startMutedPolicy={audio:!1,video:!1},this.isMutedByFocus=!1,this.wasStopped=!1,this.properties={},this.connectionQuality=new C.a(this,this.eventEmitter,e),this.avgRtpStatsReporter=new I.a(this,e.config.avgRtpStatsN||15),this.isJvbConnectionInterrupted=!1,this.speakerStatsCollector=new O.a(this),this.deferredStartP2PTask=null;var n=parseInt(e.config.p2p&&e.config.p2p.backToP2PDelay,10);this.backToP2PDelay=isNaN(n)?5:n,K.info("backToP2PDelay: ".concat(this.backToP2PDelay)),this.isP2PConnectionInterrupted=!1,this.p2p=!1,this.p2pJingleSession=null,this.videoSIPGWHandler=new j.a(this.room),this.recordingManager=new R.a(this.room)}z.prototype.constructor=z,z.prototype._init=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.connection&&(this.connection=t.connection,this.xmpp=this.connection.xmpp,this.eventManager.setupXMPPListeners());var n=this.options.config;if(this.room=this.xmpp.createRoom(this.options.name,n),this._onIceConnectionInterrupted=this._onIceConnectionInterrupted.bind(this),this.room.addListener(W.CONNECTION_INTERRUPTED,this._onIceConnectionInterrupted),this._onIceConnectionRestored=this._onIceConnectionRestored.bind(this),this.room.addListener(W.CONNECTION_RESTORED,this._onIceConnectionRestored),this._onIceConnectionEstablished=this._onIceConnectionEstablished.bind(this),this.room.addListener(W.CONNECTION_ESTABLISHED,this._onIceConnectionEstablished),this._updateProperties=this._updateProperties.bind(this),this.room.addListener(W.CONFERENCE_PROPERTIES_CHANGED,this._updateProperties),this.rttMonitor=new P.a(n.rttMonitor||{}),this.e2eping=new w.a(this,n,function(t,n){try{e.sendMessage(t,n,!0)}catch(e){K.warn("Failed to send a ping request or response.")}}),this.rtc||(this.rtc=new S.a(this,t),this.eventManager.setupRTCListeners()),this.participantConnectionStatus=new T.b(this.rtc,this,{rtcMuteTimeout:n._peerConnStatusRtcMuteTimeout,outOfLastNTimeout:n._peerConnStatusOutOfLastNTimeout}),this.participantConnectionStatus.init(),!this.statistics){var r=window.location,i=this.myUserId();n.enableDisplayNameInStats&&n.displayName&&(i=n.displayName),this.statistics=new A.a(this.xmpp,{callStatsAliasName:i,callStatsConfIDNamespace:n.callStatsConfIDNamespace||r&&r.hostname||n.hosts&&n.hosts.domain,customScriptUrl:n.callStatsCustomScriptUrl,callStatsID:n.callStatsID,callStatsSecret:n.callStatsSecret,roomName:this.options.name,swapUserNameAndAlias:n.enableStatsID,applicationName:n.applicationName,getWiFiStatsMethod:n.getWiFiStatsMethod})}this.eventManager.setupChatRoomListeners(),this.eventManager.setupStatisticsListeners(),n.enableTalkWhileMuted&&new _.a(this,function(){return e.eventEmitter.emit(d.TALK_WHILE_MUTED)}),"channelLastN"in n&&this.setLastN(n.channelLastN),this.jvb121Status=new k.a(this),this.p2pDominantSpeakerDetection=new b.a(this),n&&n.deploymentInfo&&n.deploymentInfo.userRegion&&this.setLocalParticipantProperty("region",n.deploymentInfo.userRegion)},z.prototype.join=function(e){var t=this;this.room&&this.room.join(e).then(function(){return t._maybeSetSITimeout()})},z.prototype.authenticateAndUpgradeRole=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return m.a.apply(this,t)},z.prototype.isJoined=function(){return this.room&&this.room.joined},z.prototype.isP2PEnabled=function(){return Boolean(this.options.config.p2p&&this.options.config.p2p.enabled)||void 0===this.options.config.p2p},z.prototype.isP2PTestModeEnabled=function(){return Boolean(this.options.config.testing&&this.options.config.testing.p2pTestMode)},z.prototype.leave=function(){var e=this;if(this.participantConnectionStatus&&(this.participantConnectionStatus.dispose(),this.participantConnectionStatus=null),this.avgRtpStatsReporter&&(this.avgRtpStatsReporter.dispose(),this.avgRtpStatsReporter=null),this.rttMonitor&&(this.rttMonitor.stop(),this.rttMonitor=null),this.e2eping&&(this.e2eping.stop(),this.e2eping=null),this.getLocalTracks().forEach(function(t){return e.onLocalTrackRemoved(t)}),this.rtc.closeBridgeChannel(),this.statistics&&this.statistics.dispose(),this.jvbJingleSession&&(this.jvbJingleSession.close(),this.jvbJingleSession=null),this.p2pJingleSession&&(this.p2pJingleSession.close(),this.p2pJingleSession=null),this.room){var t=this.room;return t.removeListener(W.CONNECTION_INTERRUPTED,this._onIceConnectionInterrupted),t.removeListener(W.CONNECTION_RESTORED,this._onIceConnectionRestored),t.removeListener(W.CONNECTION_ESTABLISHED,this._onIceConnectionEstablished),t.removeListener(W.CONFERENCE_PROPERTIES_CHANGED,this._updateProperties),this.room=null,t.leave().catch(function(t){throw e.getParticipants().forEach(function(t){return e.onMemberLeft(t.getJid())}),t})}return Promise.reject(new Error("The conference is has been already left"))},z.prototype.getName=function(){return this.options.name},z.prototype.getConnection=function(){return this.connection},z.prototype.isAuthEnabled=function(){return this.authEnabled},z.prototype.isLoggedIn=function(){return Boolean(this.authIdentity)},z.prototype.getAuthLogin=function(){return this.authIdentity},z.prototype.isExternalAuthEnabled=function(){return this.room&&this.room.moderator.isExternalAuthEnabled()},z.prototype.getExternalAuthUrl=function(e){var t=this;return new Promise(function(n,r){t.isExternalAuthEnabled()?e?t.room.moderator.getPopupLoginUrl(n,r):t.room.moderator.getLoginUrl(n,r):r()})},z.prototype.getLocalTracks=function(e){var t=[];return this.rtc&&(t=this.rtc.getLocalTracks(e)),t},z.prototype.getLocalAudioTrack=function(){return this.rtc?this.rtc.getLocalAudioTrack():null},z.prototype.getLocalVideoTrack=function(){return this.rtc?this.rtc.getLocalVideoTrack():null},z.prototype.on=function(e,t){this.eventEmitter&&this.eventEmitter.on(e,t)},z.prototype.off=function(e,t){this.eventEmitter&&this.eventEmitter.removeListener(e,t)},z.prototype.addEventListener=z.prototype.on,z.prototype.removeEventListener=z.prototype.off,z.prototype.addCommandListener=function(e,t){this.room&&this.room.addPresenceListener(e,t)},z.prototype.removeCommandListener=function(e){this.room&&this.room.removePresenceListener(e)},z.prototype.sendTextMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"body";this.room&&this.room.sendMessage(e,t)},z.prototype.sendPrivateTextMessage=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"body";this.room&&this.room.sendPrivateMessage(e,t,n)},z.prototype.sendCommand=function(e,t){this.room?(this.room.addToPresence(e,t),this.room.sendPresence()):K.warn("Not sending a command, room not initialized.")},z.prototype.sendCommandOnce=function(e,t){this.sendCommand(e,t),this.removeCommand(e)},z.prototype.removeCommand=function(e){this.room&&this.room.removeFromPresence(e)},z.prototype.setDisplayName=function(e){this.room&&(this.room.removeFromPresence("nick"),this.room.addToPresence("nick",{attributes:{xmlns:"http://jabber.org/protocol/nick"},value:e}),this.room.sendPresence())},z.prototype.setSubject=function(e){this.room&&this.isModerator()&&this.room.setSubject(e)},z.prototype.getTranscriber=function(){if(void 0===this.transcriber){this.transcriber=new D.a;var e=this.getLocalTracks(H.a),t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this.transcriber.addTrack(a)}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}var s=this.rtc.getRemoteTracks(H.a),c=!0,u=!1,l=void 0;try{for(var d,f=s[Symbol.iterator]();!(c=(d=f.next()).done);c=!0){var p=d.value;this.transcriber.addTrack(p)}}catch(e){u=!0,l=e}finally{try{c||null==f.return||f.return()}finally{if(u)throw l}}}return this.transcriber},z.prototype.getTranscriptionStatus=function(){return this.room.transcriptionStatus},z.prototype.addTrack=function(e){if(e.isVideoTrack()){var t=this.rtc.getLocalVideoTrack();if(t)return e===t?Promise.resolve(e):Promise.reject(new Error("cannot add second video track to the conference"))}return this.replaceTrack(null,e)},z.prototype._fireAudioLevelChangeEvent=function(e,t){var n=this.getActivePeerConnection();t&&n!==t||this.eventEmitter.emit(d.TRACK_AUDIO_LEVEL_CHANGED,this.myUserId(),e)},z.prototype._fireMuteChangeEvent=function(e){this.isMutedByFocus&&e.isAudioTrack()&&!e.isMuted()&&(this.isMutedByFocus=!1,this.room.muteParticipant(this.room.myroomjid,!1)),this.eventEmitter.emit(d.TRACK_MUTE_CHANGED,e)},z.prototype.onLocalTrackRemoved=function(e){e._setConference(null),this.rtc.removeLocalTrack(e),e.removeEventListener(v.TRACK_MUTE_CHANGED,e.muteHandler),e.removeEventListener(v.TRACK_AUDIO_LEVEL_CHANGED,e.audioLevelHandler),e.isVideoTrack()&&e.videoType===J.a.DESKTOP&&this.statistics.sendScreenSharingEvent(!1),this.eventEmitter.emit(d.TRACK_REMOVED,e)},z.prototype.removeTrack=function(e){return this.replaceTrack(e,null)},z.prototype.replaceTrack=function(e,t){var n=this;return e&&e.disposed?Promise.reject(new p.a(h.TRACK_IS_DISPOSED)):t&&t.disposed?Promise.reject(new p.a(h.TRACK_IS_DISPOSED)):this._doReplaceTrack(e,t).then(function(){return e&&n.onLocalTrackRemoved(e),t&&n._setupNewTrack(t),Promise.resolve()},function(e){return Promise.reject(new Error(e))})},z.prototype._doReplaceTrack=function(e,t){var n=[];return this.jvbJingleSession?n.push(this.jvbJingleSession.replaceTrack(e,t)):K.info("_doReplaceTrack - no JVB JingleSession"),this.p2pJingleSession?n.push(this.p2pJingleSession.replaceTrack(e,t)):K.info("_doReplaceTrack - no P2P JingleSession"),Promise.all(n)},z.prototype._setupNewTrack=function(e){if(e.isAudioTrack()||e.isVideoTrack()&&e.videoType!==J.a.DESKTOP){var t=S.a.getCurrentlyAvailableMediaDevices().find(function(t){return t.kind==="".concat(e.getTrack().kind,"input")&&t.label===e.getTrack().label});t&&A.a.sendActiveDeviceListEvent(S.a.getEventDataForActiveDevice(t))}e.isVideoTrack()&&(this.removeCommand("videoType"),this.sendCommand("videoType",{value:e.videoType,attributes:{xmlns:"http://jitsi.org/jitmeet/video"}})),this.rtc.addLocalTrack(e),e.isAudioTrack()?this.room.setAudioMute(e.isMuted()):this.room.setVideoMute(e.isMuted()),e.muteHandler=this._fireMuteChangeEvent.bind(this,e),e.audioLevelHandler=this._fireAudioLevelChangeEvent.bind(this),e.addEventListener(v.TRACK_MUTE_CHANGED,e.muteHandler),e.addEventListener(v.TRACK_AUDIO_LEVEL_CHANGED,e.audioLevelHandler),e._setConference(this),this.eventEmitter.emit(d.TRACK_ADDED,e)},z.prototype._addLocalTrackAsUnmute=function(e){var t=[];return this.jvbJingleSession?t.push(this.jvbJingleSession.addTrackAsUnmute(e)):K.info("Add local MediaStream as unmute - no JVB Jingle session started yet"),this.p2pJingleSession?t.push(this.p2pJingleSession.addTrackAsUnmute(e)):K.info("Add local MediaStream as unmute - no P2P Jingle session started yet"),Promise.all(t)},z.prototype._removeLocalTrackAsMute=function(e){var t=[];return this.jvbJingleSession?t.push(this.jvbJingleSession.removeTrackAsMute(e)):K.info("Remove local MediaStream - no JVB JingleSession started yet"),this.p2pJingleSession?t.push(this.p2pJingleSession.removeTrackAsMute(e)):K.info("Remove local MediaStream - no P2P JingleSession started yet"),Promise.all(t)},z.prototype.getRole=function(){return this.room.role},z.prototype.isModerator=function(){return this.room?this.room.isModerator():null},z.prototype.lock=function(e){var t=this;return this.isModerator()?new Promise(function(n,r){t.room.lockRoom(e||"",function(){return n()},function(e){return r(e)},function(){return r(u.PASSWORD_NOT_SUPPORTED)})}):Promise.reject()},z.prototype.unlock=function(){return this.lock()},z.prototype.selectParticipant=function(e){this.selectParticipants([e])},z.prototype.selectParticipants=function(e){if(!Array.isArray(e))throw new Error("Invalid argument; participantIds must be an array.");this.rtc.selectEndpoints(e)},z.prototype.pinParticipant=function(e){this.rtc.pinEndpoint(e)},z.prototype.getLastN=function(){return this.rtc.getLastN()},z.prototype.setLastN=function(e){if(!Number.isInteger(e)&&!Number.parseInt(e,10))throw new Error("Invalid value for lastN: ".concat(e));var t=Number(e);if(t<-1)throw new RangeError("lastN cannot be smaller than -1");if(this.rtc.setLastN(t),this.p2pJingleSession){var n=0!==t;this.p2pJingleSession.setMediaTransferActive(!0,n).catch(function(e){K.error("Failed to adjust video transfer status (".concat(n,")"),e)})}},z.prototype.isInLastN=function(e){return this.rtc.isInLastN(e)},z.prototype.getParticipants=function(){return Object.keys(this.participants).map(function(e){return this.participants[e]},this)},z.prototype.getParticipantCount=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getParticipants();return e||(t=t.filter(function(e){return!e.isHidden()})),t.length+1},z.prototype.getParticipantById=function(e){return this.participants[e]},z.prototype.kickParticipant=function(e){var t=this.getParticipantById(e);t&&this.room.kick(t.getJid())},z.prototype._maybeClearSITimeout=function(){this._sessionInitiateTimeout&&(this.jvbJingleSession||this.getParticipantCount()<2)&&(window.clearTimeout(this._sessionInitiateTimeout),this._sessionInitiateTimeout=null)},z.prototype._maybeSetSITimeout=function(){var e=this;!this.jvbJingleSession&&this.getParticipantCount()>=2&&!this._sessionInitiateTimeout&&(this._sessionInitiateTimeout=window.setTimeout(function(){e._sessionInitiateTimeout=null,A.a.sendAnalytics(Object(V.B)(V.d,{p2p:!1,value:5e3}))},5e3))},z.prototype.muteParticipant=function(e){var t=this.getParticipantById(e);t&&this.room.muteParticipant(t.getJid(),!0)},z.prototype.onMemberJoined=function(e,t,n,i,o,a,s,c){var u=this,l=r.Strophe.getResourceFromJid(e);if("focus"!==l&&this.myUserId()!==l){var p=new f.a(e,this,t,i,o,a);p._role=n,p._botType=c,this.participants[l]=p,this.eventEmitter.emit(d.USER_JOINED,l,p),this.xmpp.caps.getFeatures(e).then(function(e){p._supportsDTMF=e.has("urn:xmpp:jingle:dtmf:0"),u.updateDTMFSupport()},function(t){return K.warn("Failed to discover features of ".concat(e),t)}),this._maybeStartOrStopP2P(),this._maybeSetSITimeout()}},z.prototype._onMemberBotTypeChanged=function(e,t){var n=this.getParticipants().find(function(t){return t.getJid()===e});if(n){n._botType=t;var i=r.Strophe.getResourceFromJid(e);this.eventEmitter.emit(d.BOT_TYPE_CHANGED,i,t)}n._botType||this._maybeStartOrStopP2P()},z.prototype.onMemberLeft=function(e){var t=this,n=r.Strophe.getResourceFromJid(e);if("focus"!==n&&this.myUserId()!==n){var i=this.participants[n];delete this.participants[n],this.rtc.removeRemoteTracks(n).forEach(function(e){return t.eventEmitter.emit(d.TRACK_REMOVED,e)}),i&&this.eventEmitter.emit(d.USER_LEFT,n,i),this._maybeStartOrStopP2P(!0),this._maybeClearSITimeout()}},z.prototype.onLocalRoleChanged=function(e){this.eventEmitter.emit(d.USER_ROLE_CHANGED,this.myUserId(),e),this._maybeStartOrStopP2P()},z.prototype.onUserRoleChanged=function(e,t){var n=r.Strophe.getResourceFromJid(e),i=this.getParticipantById(n);i&&(i._role=t,this.eventEmitter.emit(d.USER_ROLE_CHANGED,n,t))},z.prototype.onDisplayNameChanged=function(e,t){var n=r.Strophe.getResourceFromJid(e),i=this.getParticipantById(n);i&&i._displayName!==t&&(i._displayName=t,this.eventEmitter.emit(d.DISPLAY_NAME_CHANGED,n,t))},z.prototype.onRemoteTrackAdded=function(e){var t=this;if(!e.isP2P||this.isP2PActive())if(e.isP2P||!this.isP2PActive()){var n=e.getParticipantId(),r=this.getParticipantById(n);if(r){r._tracks.push(e),this.transcriber&&this.transcriber.addTrack(e);var i=this.eventEmitter;e.addEventListener(v.TRACK_MUTE_CHANGED,function(){return i.emit(d.TRACK_MUTE_CHANGED,e)}),e.addEventListener(v.TRACK_AUDIO_LEVEL_CHANGED,function(e,r){t.getActivePeerConnection()===r&&i.emit(d.TRACK_AUDIO_LEVEL_CHANGED,n,e)}),i.emit(d.TRACK_ADDED,e)}else K.error("No participant found for id: ".concat(n))}else K.info("Trying to add remote JVB track, when in P2P - IGNORED");else K.info("Trying to add remote P2P track, when not in P2P - IGNORED")},z.prototype.onCallAccepted=function(e,t){this.p2pJingleSession===e&&(K.info("P2P setAnswer"),this.p2pJingleSession.setAnswer(t))},z.prototype.onTransportInfo=function(e,t){this.p2pJingleSession===e&&(K.info("P2P addIceCandidates"),this.p2pJingleSession.addIceCandidates(t))},z.prototype.onRemoteTrackRemoved=function(e){var t=this;this.getParticipants().forEach(function(n){for(var r=n.getTracks(),i=0;i<r.length;i++)if(r[i]===e){n._tracks.splice(i,1),t.eventEmitter.emit(d.TRACK_REMOVED,e),t.transcriber&&t.transcriber.removeTrack(e);break}},this)},z.prototype._onIncomingCallP2P=function(e,t){var n;"moderator"!==this.room.getMemberRole(e.remoteJid)?n={reason:"security-error",reasonDescription:"Only focus can start new sessions",errorMsg:"Rejecting session-initiate from non-focus and"+"non-moderator user: ".concat(e.remoteJid)}:E.a.supportsP2P()?this.isP2PEnabled()||this.isP2PTestModeEnabled()?this.p2pJingleSession&&(n={reason:"busy",reasonDescription:"P2P already in progress",errorMsg:'Duplicated P2P "session-initiate"'}):n={reason:"decline",reasonDescription:"P2P disabled",errorMsg:"P2P mode disabled in the configuration"}:n={reason:"unsupported-applications",reasonDescription:"P2P not supported",errorMsg:"This client does not support P2P connections"},n?this._rejectIncomingCall(e,n):this._acceptP2PIncomingCall(e,t)},z.prototype.onIncomingCall=function(e,t,n){if(e.isP2P)this._onIncomingCallP2P(e,t);else{if(!this.room.isFocus(e.remoteJid)){var r="Rejecting session-initiate from non-focus.";return void this._rejectIncomingCall(e,{reason:"security-error",reasonDescription:r,errorMsg:r})}this._acceptJvbIncomingCall(e,t,n)}},z.prototype._acceptJvbIncomingCall=function(e,t,n){var r=this;this.jvbJingleSession=e,this.room.connectionTimes["session.initiate"]=n,this.wasStopped&&A.a.sendAnalyticsAndLog(Object(V.B)(V.a,{p2p:!1}));var i=$(t).find('>server-region[xmlns="http://jitsi.org/protocol/focus"]').attr("region");this.eventEmitter.emit(d.SERVER_REGION_CHANGED,i),this._maybeClearSITimeout(),A.a.sendAnalytics(Object(V.B)(V.c,{p2p:!1,value:n}));try{e.initialize(this.room,this.rtc,this.options.config)}catch(e){x.a.callErrorHandler(e)}this._setBridgeChannel(t,e.peerconnection);try{e.acceptOffer(t,function(){r.isP2PActive()&&r.jvbJingleSession&&r._suspendMediaTransferForJvbConnection()},function(e){x.a.callErrorHandler(e),K.error("Failed to accept incoming Jingle session",e)},this.getLocalTracks()),K.info("Starting CallStats for JVB connection..."),this.statistics.startCallStats(this.jvbJingleSession.peerconnection,"jitsi"),this.statistics.startRemoteStats(this.jvbJingleSession.peerconnection)}catch(e){x.a.callErrorHandler(e),K.error(e)}},z.prototype._setBridgeChannel=function(e,t){var n,r=null,i=$(e).find(">content>transport>web-socket").first();switch(1===i.length&&(r=i[0].getAttribute("url")),this.options.config.openBridgeChannel){case"datachannel":case!0:case void 0:n="datachannel";break;case"websocket":n="websocket"}"datachannel"!==n||E.a.supportsDataChannels()||(n="websocket"),"datachannel"===n?this.rtc.initializeBridgeChannel(t,null):"websocket"===n&&r&&this.rtc.initializeBridgeChannel(null,r)},z.prototype._rejectIncomingCall=function(e,t){t&&t.errorMsg&&x.a.callErrorHandler(new Error(t.errorMsg)),e.terminate(null,function(e){K.warn("An error occurred while trying to terminate invalid Jingle session",e)},{reason:t&&t.reason,reasonDescription:t&&t.reasonDescription,sendSessionTerminate:!0})},z.prototype.onCallEnded=function(e,t,n){K.info("Call ended: ".concat(t," - ").concat(n," P2P ?").concat(e.isP2P)),e===this.jvbJingleSession?(this.wasStopped=!0,A.a.sendAnalytics(Object(V.B)(V.e,{p2p:!1})),this.statistics&&(this.statistics.stopRemoteStats(this.jvbJingleSession.peerconnection),K.info("Stopping JVB CallStats"),this.statistics.stopCallStats(this.jvbJingleSession.peerconnection)),this.jvbJingleSession=null,this.rtc.onCallEnded()):e===this.p2pJingleSession?("decline"===t&&"force JVB121"===n?(K.info("In forced JVB 121 mode..."),A.a.analytics.addPermanentProperties({forceJvb121:!0})):"connectivity-error"===t&&"ICE FAILED"===n&&A.a.analytics.addPermanentProperties({p2pFailed:!0}),this._stopP2PSession()):K.error("Received onCallEnded for invalid session",e.sid,e.remoteJid,t,n)},z.prototype.onSuspendDetected=function(e){e.isP2P||(this.leave(),this.eventEmitter.emit(d.SUSPEND_DETECTED))},z.prototype.updateDTMFSupport=function(){for(var e=!1,t=this.getParticipants(),n=0;n<t.length;n+=1)if(t[n].supportsDTMF()){e=!0;break}e!==this.somebodySupportsDTMF&&(this.somebodySupportsDTMF=e,this.eventEmitter.emit(d.DTMF_SUPPORT_CHANGED,e))},z.prototype.isDTMFSupported=function(){return this.somebodySupportsDTMF},z.prototype.myUserId=function(){return this.room&&this.room.myroomjid?r.Strophe.getResourceFromJid(this.room.myroomjid):null},z.prototype.sendTones=function(e,t,n){if(!this.dtmfManager){var r=this.getActivePeerConnection();if(!r)return void K.warn("cannot sendTones: no peer connection");var i=this.getLocalAudioTrack();if(!i)return void K.warn("cannot sendTones: no local audio stream");this.dtmfManager=new y.a(i,r)}this.dtmfManager.sendTones(e,t,n)},z.prototype.startRecording=function(e){return this.room?this.recordingManager.startRecording(e):Promise.reject(new Error("The conference is not created yet!"))},z.prototype.stopRecording=function(e){return this.room?this.recordingManager.stopRecording(e):Promise.reject(new Error("The conference is not created yet!"))},z.prototype.isSIPCallingSupported=function(){return!!this.room&&this.room.isSIPCallingSupported()},z.prototype.dial=function(e){return this.room?this.room.dial(e):new Promise(function(e,t){t(new Error("The conference is not created yet!"))})},z.prototype.hangup=function(){return this.room?this.room.hangup():new Promise(function(e,t){t(new Error("The conference is not created yet!"))})},z.prototype.startTranscriber=function(){return this.dial("jitsi_meet_transcribe")},z.prototype.stopTranscriber=z.prototype.hangup,z.prototype.getPhoneNumber=function(){return this.room?this.room.getPhoneNumber():null},z.prototype.getPhonePin=function(){return this.room?this.room.getPhonePin():null},z.prototype.getActivePeerConnection=function(){return this.isP2PActive()?this.p2pJingleSession.peerconnection:this.jvbJingleSession?this.jvbJingleSession.peerconnection:null},z.prototype.getConnectionState=function(){var e=this.getActivePeerConnection();return e?e.getConnectionState():null},z.prototype.setStartMutedPolicy=function(e){this.isModerator()&&(this.startMutedPolicy=e,this.room.removeFromPresence("startmuted"),this.room.addToPresence("startmuted",{attributes:{audio:e.audio,video:e.video,xmlns:"http://jitsi.org/jitmeet/start-muted"}}),this.room.sendPresence())},z.prototype.getStartMutedPolicy=function(){return this.startMutedPolicy},z.prototype.isStartAudioMuted=function(){return this.startAudioMuted},z.prototype.isStartVideoMuted=function(){return this.startVideoMuted},z.prototype.getLogs=function(){var e=this.xmpp.getJingleLog(),t={};t.time=new Date,t.url=window.location.href,t.ua=navigator.userAgent;var n=this.xmpp.getXmppLog();return n&&(t.xmpp=n),e.metadata=t,e},z.prototype.getConnectionTimes=function(){return this.room.connectionTimes},z.prototype.setLocalParticipantProperty=function(e,t){this.sendCommand("jitsi_participant_".concat(e),{value:t})},z.prototype.removeLocalParticipantProperty=function(e){this.removeCommand("jitsi_participant_".concat(e)),this.room.sendPresence()},z.prototype.getLocalParticipantProperty=function(e){var t=this.room.presMap.nodes.find(function(t){return t.tagName==="jitsi_participant_".concat(e)});return t?t.value:void 0},z.prototype.sendFeedback=function(e,t){this.statistics.sendFeedback(e,t)},z.prototype.isCallstatsEnabled=function(){return this.statistics.isCallstatsEnabled()},z.prototype._onTrackAttach=function(e,t){var n=e.isLocal(),r=null,i=e.isP2P,o=i?e.getParticipantId():"jitsi",a=i?this.p2pJingleSession&&this.p2pJingleSession.peerconnection:this.jvbJingleSession&&this.jvbJingleSession.peerconnection;n?a&&(r=a.getLocalSSRC(e)):r=e.getSSRC(),t.id&&r&&a&&this.statistics.associateStreamWithVideoTag(a,r,n,o,e.getUsageLabel(),t.id)},z.prototype.sendApplicationLog=function(e){A.a.sendLog(e)},z.prototype._isFocus=function(e){return this.room?this.room.isFocus(e):null},z.prototype._fireIncompatibleVersionsEvent=function(){this.eventEmitter.emit(d.CONFERENCE_FAILED,u.INCOMPATIBLE_SERVER_VERSIONS)},z.prototype.sendEndpointMessage=function(e,t){this.rtc.sendChannelMessage(e,t)},z.prototype.broadcastEndpointMessage=function(e){this.sendEndpointMessage("",e)},z.prototype.sendMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=q(e);if("object"===r||!n&&"string"===r)if(n)this.sendEndpointMessage(t,e);else{var i=e,o="body";if("object"===r){o="json-message",i.hasOwnProperty(U.a)||(i[U.a]="");try{i=JSON.stringify(i)}catch(e){return void K.error("Can not send a message, stringify failed: ",e)}}t?this.sendPrivateTextMessage(t,i,o):this.sendTextMessage(i,o)}else K.error("Can not send a message of type ".concat(r))},z.prototype.isConnectionInterrupted=function(){return this.isP2PActive()?this.isP2PConnectionInterrupted:this.isJvbConnectionInterrupted},z.prototype._onIceConnectionInterrupted=function(e){e.isP2P?this.isP2PConnectionInterrupted=!0:this.isJvbConnectionInterrupted=!0,e.isP2P===this.isP2PActive()&&this.eventEmitter.emit(d.CONNECTION_INTERRUPTED)},z.prototype._onIceConnectionFailed=function(e){e.isP2P&&(A.a.analytics.addPermanentProperties({p2pFailed:!0}),this.p2pJingleSession&&A.a.sendAnalyticsAndLog(Object(V.D)(V.i,{initiator:this.p2pJingleSession.isInitiator})),this._stopP2PSession("connectivity-error","ICE FAILED"))},z.prototype._onIceConnectionRestored=function(e){e.isP2P?this.isP2PConnectionInterrupted=!1:this.isJvbConnectionInterrupted=!1,e.isP2P===this.isP2PActive()&&this.eventEmitter.emit(d.CONNECTION_RESTORED)},z.prototype._acceptP2PIncomingCall=function(e,t){this.isP2PConnectionInterrupted=!1,this.p2pJingleSession=e,this.p2pJingleSession.initialize(this.room,this.rtc,this.options.config),K.info("Starting CallStats for P2P connection...");var n=r.Strophe.getResourceFromJid(this.p2pJingleSession.remoteJid);if(this.options.config.enableStatsID){var i=this.participants[n];i&&(n=i.getStatsID()||n)}this.statistics.startCallStats(this.p2pJingleSession.peerconnection,n);var o=this.getLocalTracks();this.p2pJingleSession.acceptOffer(t,function(){K.debug('Got RESULT for P2P "session-accept"')},function(e){K.error("Failed to accept incoming P2P Jingle session",e)},o)},z.prototype._addRemoteJVBTracks=function(){this._addRemoteTracks("JVB",this.jvbJingleSession.peerconnection.getRemoteTracks())},z.prototype._addRemoteP2PTracks=function(){this._addRemoteTracks("P2P",this.p2pJingleSession.peerconnection.getRemoteTracks())},z.prototype._addRemoteTracks=function(e,t){var n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;K.info("Adding remote ".concat(e," track: ").concat(s)),this.rtc.eventEmitter.emit(B.REMOTE_TRACK_ADDED,s)}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}},z.prototype._onIceConnectionEstablished=function(e){null!==this.p2pJingleSession&&(this.p2pEstablishmentDuration=this.p2pJingleSession.establishmentDuration),null!==this.jvbJingleSession&&(this.jvbEstablishmentDuration=this.jvbJingleSession.establishmentDuration);var t=!1,n=this.options.config.forceJVB121Ratio;if(e.isP2P?this.p2pJingleSession!==e?(K.error("CONNECTION_ESTABLISHED - wrong P2P session instance ?!"),t=!0):!e.isInitiator&&"number"==typeof n&&Math.random()<n&&(K.info("Forcing JVB 121 mode (ratio=".concat(n,")...")),A.a.analytics.addPermanentProperties({forceJvb121:!0}),this._stopP2PSession("decline","force JVB121"),t=!0):t=!0,!isNaN(this.p2pEstablishmentDuration)&&!isNaN(this.jvbEstablishmentDuration)){var r=this.p2pEstablishmentDuration-this.jvbEstablishmentDuration;A.a.sendAnalytics(V.o,{value:r})}e.isP2P===this.isP2PActive()&&this.eventEmitter.emit(d.CONNECTION_ESTABLISHED),t||(this._setP2PStatus(!0),this.jvbJingleSession?this._removeRemoteJVBTracks():K.info("Not removing remote JVB tracks - no session yet"),this._addRemoteP2PTracks(),this.jvbJingleSession&&this._suspendMediaTransferForJvbConnection(),K.info("Starting remote stats with p2p connection"),this.statistics.startRemoteStats(this.p2pJingleSession.peerconnection),A.a.sendAnalyticsAndLog(Object(V.D)(V.h,{initiator:this.p2pJingleSession.isInitiator})))},z.prototype._updateProperties=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!c()(e,this.properties);if(this.properties=e,t){this.eventEmitter.emit(d.PROPERTIES_CHANGED,this.properties);["bridge-count","created-ms","octo-enabled"].forEach(function(t){void 0!==e[t]&&A.a.analytics.addPermanentProperties(function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},t.replace("-","_"),e[t]))})}},z.prototype.getProperty=function(e){return this.properties[e]},z.prototype._maybeClearDeferredStartP2P=function(){this.deferredStartP2PTask&&(K.info("Cleared deferred start P2P task"),clearTimeout(this.deferredStartP2PTask),this.deferredStartP2PTask=null)},z.prototype._removeRemoteJVBTracks=function(){this._removeRemoteTracks("JVB",this.jvbJingleSession.peerconnection.getRemoteTracks())},z.prototype._removeRemoteP2PTracks=function(){this._removeRemoteTracks("P2P",this.p2pJingleSession.peerconnection.getRemoteTracks())},z.prototype._removeRemoteTracks=function(e,t){var n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;K.info("Removing remote ".concat(e," track: ").concat(s)),this.rtc.eventEmitter.emit(B.REMOTE_TRACK_REMOVED,s)}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}},z.prototype._resumeMediaTransferForJvbConnection=function(){K.info("Resuming media transfer over the JVB connection..."),this.jvbJingleSession.setMediaTransferActive(!0,!0).then(function(){K.info("Resumed media transfer over the JVB connection!")},function(e){K.error("Failed to resume media transfer over the JVB connection:",e)})},z.prototype._setP2PStatus=function(e){if(this.p2p!==e){if(this.p2p=e,e){K.info("Peer to peer connection established!"),A.a.analytics.addPermanentProperties({p2pFailed:!1,forceJvb121:!1});var t=0!==this.rtc.getLastN();this.p2pJingleSession.setMediaTransferActive(!0,t).catch(function(e){K.error("Failed to sync up P2P video transfer status"+"(".concat(t,")"),e)})}else K.info("Peer to peer connection closed!");this.jvbJingleSession&&this.statistics.sendConnectionResumeOrHoldEvent(this.jvbJingleSession.peerconnection,!e),this.dtmfManager=null,this.eventEmitter.emit(d.P2P_STATUS,this,this.p2p),this.eventEmitter.emit(this.isConnectionInterrupted()?d.CONNECTION_INTERRUPTED:d.CONNECTION_RESTORED)}else K.debug("Called _setP2PStatus with the same status: ".concat(e))},z.prototype._startP2PSession=function(e){if(this._maybeClearDeferredStartP2P(),this.p2pJingleSession)K.error("P2P session already started!");else{this.isP2PConnectionInterrupted=!1,this.p2pJingleSession=this.xmpp.connection.jingle.newP2PJingleSession(this.room.myroomjid,e),K.info("Created new P2P JingleSession",this.room.myroomjid,e),this.p2pJingleSession.initialize(this.room,this.rtc,this.options.config),K.info("Starting CallStats for P2P connection...");var t=r.Strophe.getResourceFromJid(this.p2pJingleSession.remoteJid);if(this.options.config.enableStatsID){var n=this.participants[t];n&&(t=n.getStatsID()||t)}this.statistics.startCallStats(this.p2pJingleSession.peerconnection,t);var i=this.getLocalTracks();this.p2pJingleSession.invite(i)}},z.prototype._suspendMediaTransferForJvbConnection=function(){K.info("Suspending media transfer over the JVB connection..."),this.jvbJingleSession.setMediaTransferActive(!1,!1).then(function(){K.info("Suspended media transfer over the JVB connection !")},function(e){K.error("Failed to suspend media transfer over the JVB connection:",e)})},z.prototype._maybeStartOrStopP2P=function(e){if(E.a.supportsP2P()&&this.isP2PEnabled()&&!this.isP2PTestModeEnabled()){var t=this.getParticipants(),n=t.length,r=this.isModerator(),i=void 0!==t.find(function(e){return"poltergeist"===e._botType}),o=1===n&&!i;if(K.debug("P2P? isModerator: ".concat(r,", peerCount: ").concat(n,", hasBotPeer: ").concat(i," => ").concat(o)),!o&&this.deferredStartP2PTask&&this._maybeClearDeferredStartP2P(),r&&!this.p2pJingleSession&&o){var a=n&&t[0];if(r&&"moderator"===a.getRole()){var s=this.myUserId(),c=a.getId();if(s>c)return void K.debug("Everyone's a moderator - the other peer should start P2P",s,c);if(s===c)return void K.error("The same IDs ? ",s,c)}var u=a.getJid();if(e){if(this.deferredStartP2PTask)return void K.error("Deferred start P2P task's been set already!");K.info("Will start P2P with: ".concat(u," after ").concat(this.backToP2PDelay," seconds...")),this.deferredStartP2PTask=setTimeout(this._startP2PSession.bind(this,u),1e3*this.backToP2PDelay)}else K.info("Will start P2P with: ".concat(u)),this._startP2PSession(u)}else this.p2pJingleSession&&!o&&(K.info("Will stop P2P with: ".concat(this.p2pJingleSession.remoteJid)),this.p2pJingleSession.isInitiator&&n>1&&A.a.sendAnalyticsAndLog(Object(V.D)(V.j)),this._stopP2PSession())}else K.info("Auto P2P disabled")},z.prototype._stopP2PSession=function(e,t){if(this.p2pJingleSession){var n=this.isP2PActive();n&&(this.jvbJingleSession&&this._resumeMediaTransferForJvbConnection(),this._removeRemoteP2PTracks()),K.info("Stopping remote stats for P2P connection"),this.statistics.stopRemoteStats(this.p2pJingleSession.peerconnection),K.info("Stopping CallStats for P2P connection"),this.statistics.stopCallStats(this.p2pJingleSession.peerconnection),this.p2pJingleSession.terminate(function(){K.info("P2P session terminate RESULT")},function(t){e&&K.error("An error occurred while trying to terminate P2P Jingle session",t)},{reason:e||"success",reasonDescription:t||"Turing off P2P session",sendSessionTerminate:this.room&&this.getParticipantById(r.Strophe.getResourceFromJid(this.p2pJingleSession.remoteJid))}),this.p2pJingleSession=null,this._setP2PStatus(!1),n&&(this.jvbJingleSession?this._addRemoteJVBTracks():K.info("Not adding remote JVB tracks - no session yet"))}else K.error("No P2P session to be stopped!")},z.prototype.isP2PActive=function(){return this.p2p},z.prototype.getP2PConnectionState=function(){return this.isP2PActive()?this.p2pJingleSession.peerconnection.getConnectionState():null},z.prototype.startP2PSession=function(){var e=this.getParticipants();if(1!==e.length)throw new Error("There must be exactly 1 participant to start the P2P session !");var t=e[0].getJid();this._startP2PSession(t)},z.prototype.stopP2PSession=function(){this._stopP2PSession()},z.prototype.getSpeakerStats=function(){return this.speakerStatsCollector.getStats()},z.prototype.setReceiverVideoConstraint=function(e){this.rtc.setReceiverVideoConstraint(e)},z.prototype.createVideoSIPGWSession=function(e,t){return this.room?this.videoSIPGWHandler.createVideoSIPGWSession(e,t):new Error(F.ERROR_NO_CONNECTION)}}).call(this,"JitsiConference.js")},function(e,t,n){(function(e,n){var r=200,i="__lodash_hash_undefined__",o=1,a=2,s=9007199254740991,c="[object Arguments]",u="[object Array]",l="[object AsyncFunction]",d="[object Boolean]",f="[object Date]",p="[object Error]",h="[object Function]",v="[object GeneratorFunction]",m="[object Map]",g="[object Number]",y="[object Null]",b="[object Object]",S="[object Proxy]",_="[object RegExp]",E="[object Set]",C="[object String]",T="[object Symbol]",w="[object Undefined]",k="[object ArrayBuffer]",R="[object DataView]",P=/^\[object .+?Constructor\]$/,I=/^(?:0|[1-9]\d*)$/,O={};O["[object Float32Array]"]=O["[object Float64Array]"]=O["[object Int8Array]"]=O["[object Int16Array]"]=O["[object Int32Array]"]=O["[object Uint8Array]"]=O["[object Uint8ClampedArray]"]=O["[object Uint16Array]"]=O["[object Uint32Array]"]=!0,O[c]=O[u]=O[k]=O[d]=O[R]=O[f]=O[p]=O[h]=O[m]=O[g]=O[b]=O[_]=O[E]=O[C]=O["[object WeakMap]"]=!1;var A="object"==typeof e&&e&&e.Object===Object&&e,M="object"==typeof self&&self&&self.Object===Object&&self,D=A||M||Function("return this")(),N=t&&!t.nodeType&&t,x=N&&"object"==typeof n&&n&&!n.nodeType&&n,L=x&&x.exports===N,j=L&&A.process,F=function(){try{return j&&j.binding&&j.binding("util")}catch(e){}}(),U=F&&F.isTypedArray;function H(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function B(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function G(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var J,V,W,q=Array.prototype,K=Function.prototype,z=Object.prototype,Q=D["__core-js_shared__"],$=K.toString,X=z.hasOwnProperty,Y=(J=/[^.]+$/.exec(Q&&Q.keys&&Q.keys.IE_PROTO||""))?"Symbol(src)_1."+J:"",Z=z.toString,ee=RegExp("^"+$.call(X).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),te=L?D.Buffer:void 0,ne=D.Symbol,re=D.Uint8Array,ie=z.propertyIsEnumerable,oe=q.splice,ae=ne?ne.toStringTag:void 0,se=Object.getOwnPropertySymbols,ce=te?te.isBuffer:void 0,ue=(V=Object.keys,W=Object,function(e){return V(W(e))}),le=Fe(D,"DataView"),de=Fe(D,"Map"),fe=Fe(D,"Promise"),pe=Fe(D,"Set"),he=Fe(D,"WeakMap"),ve=Fe(Object,"create"),me=Ge(le),ge=Ge(de),ye=Ge(fe),be=Ge(pe),Se=Ge(he),_e=ne?ne.prototype:void 0,Ee=_e?_e.valueOf:void 0;function Ce(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Te(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function we(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ke(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new we;++t<n;)this.add(e[t])}function Re(e){var t=this.__data__=new Te(e);this.size=t.size}function Pe(e,t){var n=We(e),r=!n&&Ve(e),i=!n&&!r&&qe(e),o=!n&&!r&&!i&&Xe(e),a=n||r||i||o,s=a?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],c=s.length;for(var u in e)!t&&!X.call(e,u)||a&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Be(u,c))||s.push(u);return s}function Ie(e,t){for(var n=e.length;n--;)if(Je(e[n][0],t))return n;return-1}function Oe(e){return null==e?void 0===e?w:y:ae&&ae in Object(e)?function(e){var t=X.call(e,ae),n=e[ae];try{e[ae]=void 0;var r=!0}catch(e){}var i=Z.call(e);r&&(t?e[ae]=n:delete e[ae]);return i}(e):function(e){return Z.call(e)}(e)}function Ae(e){return $e(e)&&Oe(e)==c}function Me(e,t,n,r,i){return e===t||(null==e||null==t||!$e(e)&&!$e(t)?e!=e&&t!=t:function(e,t,n,r,i,s){var l=We(e),h=We(t),v=l?u:He(e),y=h?u:He(t),S=(v=v==c?b:v)==b,w=(y=y==c?b:y)==b,P=v==y;if(P&&qe(e)){if(!qe(t))return!1;l=!0,S=!1}if(P&&!S)return s||(s=new Re),l||Xe(e)?xe(e,t,n,r,i,s):function(e,t,n,r,i,s,c){switch(n){case R:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case k:return!(e.byteLength!=t.byteLength||!s(new re(e),new re(t)));case d:case f:case g:return Je(+e,+t);case p:return e.name==t.name&&e.message==t.message;case _:case C:return e==t+"";case m:var u=B;case E:var l=r&o;if(u||(u=G),e.size!=t.size&&!l)return!1;var h=c.get(e);if(h)return h==t;r|=a,c.set(e,t);var v=xe(u(e),u(t),r,i,s,c);return c.delete(e),v;case T:if(Ee)return Ee.call(e)==Ee.call(t)}return!1}(e,t,v,n,r,i,s);if(!(n&o)){var I=S&&X.call(e,"__wrapped__"),O=w&&X.call(t,"__wrapped__");if(I||O){var A=I?e.value():e,M=O?t.value():t;return s||(s=new Re),i(A,M,n,r,s)}}if(!P)return!1;return s||(s=new Re),function(e,t,n,r,i,a){var s=n&o,c=Le(e),u=c.length,l=Le(t).length;if(u!=l&&!s)return!1;for(var d=u;d--;){var f=c[d];if(!(s?f in t:X.call(t,f)))return!1}var p=a.get(e);if(p&&a.get(t))return p==t;var h=!0;a.set(e,t),a.set(t,e);for(var v=s;++d<u;){f=c[d];var m=e[f],g=t[f];if(r)var y=s?r(g,m,f,t,e,a):r(m,g,f,e,t,a);if(!(void 0===y?m===g||i(m,g,n,r,a):y)){h=!1;break}v||(v="constructor"==f)}if(h&&!v){var b=e.constructor,S=t.constructor;b!=S&&"constructor"in e&&"constructor"in t&&!("function"==typeof b&&b instanceof b&&"function"==typeof S&&S instanceof S)&&(h=!1)}return a.delete(e),a.delete(t),h}(e,t,n,r,i,s)}(e,t,n,r,Me,i))}function De(e){return!(!Qe(e)||(t=e,Y&&Y in t))&&(Ke(e)?ee:P).test(Ge(e));var t}function Ne(e){if(n=(t=e)&&t.constructor,r="function"==typeof n&&n.prototype||z,t!==r)return ue(e);var t,n,r,i=[];for(var o in Object(e))X.call(e,o)&&"constructor"!=o&&i.push(o);return i}function xe(e,t,n,r,i,s){var c=n&o,u=e.length,l=t.length;if(u!=l&&!(c&&l>u))return!1;var d=s.get(e);if(d&&s.get(t))return d==t;var f=-1,p=!0,h=n&a?new ke:void 0;for(s.set(e,t),s.set(t,e);++f<u;){var v=e[f],m=t[f];if(r)var g=c?r(m,v,f,t,e,s):r(v,m,f,e,t,s);if(void 0!==g){if(g)continue;p=!1;break}if(h){if(!H(t,function(e,t){if(o=t,!h.has(o)&&(v===e||i(v,e,n,r,s)))return h.push(t);var o})){p=!1;break}}else if(v!==m&&!i(v,m,n,r,s)){p=!1;break}}return s.delete(e),s.delete(t),p}function Le(e){return function(e,t,n){var r=t(e);return We(e)?r:function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}(r,n(e))}(e,Ye,Ue)}function je(e,t){var n,r,i=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function Fe(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return De(n)?n:void 0}Ce.prototype.clear=function(){this.__data__=ve?ve(null):{},this.size=0},Ce.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Ce.prototype.get=function(e){var t=this.__data__;if(ve){var n=t[e];return n===i?void 0:n}return X.call(t,e)?t[e]:void 0},Ce.prototype.has=function(e){var t=this.__data__;return ve?void 0!==t[e]:X.call(t,e)},Ce.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ve&&void 0===t?i:t,this},Te.prototype.clear=function(){this.__data__=[],this.size=0},Te.prototype.delete=function(e){var t=this.__data__,n=Ie(t,e);return!(n<0||(n==t.length-1?t.pop():oe.call(t,n,1),--this.size,0))},Te.prototype.get=function(e){var t=this.__data__,n=Ie(t,e);return n<0?void 0:t[n][1]},Te.prototype.has=function(e){return Ie(this.__data__,e)>-1},Te.prototype.set=function(e,t){var n=this.__data__,r=Ie(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},we.prototype.clear=function(){this.size=0,this.__data__={hash:new Ce,map:new(de||Te),string:new Ce}},we.prototype.delete=function(e){var t=je(this,e).delete(e);return this.size-=t?1:0,t},we.prototype.get=function(e){return je(this,e).get(e)},we.prototype.has=function(e){return je(this,e).has(e)},we.prototype.set=function(e,t){var n=je(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},ke.prototype.add=ke.prototype.push=function(e){return this.__data__.set(e,i),this},ke.prototype.has=function(e){return this.__data__.has(e)},Re.prototype.clear=function(){this.__data__=new Te,this.size=0},Re.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Re.prototype.get=function(e){return this.__data__.get(e)},Re.prototype.has=function(e){return this.__data__.has(e)},Re.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Te){var i=n.__data__;if(!de||i.length<r-1)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new we(i)}return n.set(e,t),this.size=n.size,this};var Ue=se?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}(se(e),function(t){return ie.call(e,t)}))}:function(){return[]},He=Oe;function Be(e,t){return!!(t=null==t?s:t)&&("number"==typeof e||I.test(e))&&e>-1&&e%1==0&&e<t}function Ge(e){if(null!=e){try{return $.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Je(e,t){return e===t||e!=e&&t!=t}(le&&He(new le(new ArrayBuffer(1)))!=R||de&&He(new de)!=m||fe&&"[object Promise]"!=He(fe.resolve())||pe&&He(new pe)!=E||he&&"[object WeakMap]"!=He(new he))&&(He=function(e){var t=Oe(e),n=t==b?e.constructor:void 0,r=n?Ge(n):"";if(r)switch(r){case me:return R;case ge:return m;case ye:return"[object Promise]";case be:return E;case Se:return"[object WeakMap]"}return t});var Ve=Ae(function(){return arguments}())?Ae:function(e){return $e(e)&&X.call(e,"callee")&&!ie.call(e,"callee")},We=Array.isArray;var qe=ce||function(){return!1};function Ke(e){if(!Qe(e))return!1;var t=Oe(e);return t==h||t==v||t==l||t==S}function ze(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=s}function Qe(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function $e(e){return null!=e&&"object"==typeof e}var Xe=U?function(e){return function(t){return e(t)}}(U):function(e){return $e(e)&&ze(e.length)&&!!O[Oe(e)]};function Ye(e){return null!=(t=e)&&ze(t.length)&&!Ke(t)?Pe(e):Ne(e);var t}n.exports=function(e,t){return Me(e,t)}}).call(this,n(42),n(119)(e))},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return _});var r=n(1),i=n(7),o=n(58),a=n.n(o),s=n(72),c=n.n(s),u=n(4),l=n(21),d=n(2),f=n(9),p=n(8),h=n.n(p),v=n(14),m=n.n(v),g=n(6),y=n(0),b=n.n(y),S=Object(u.getLogger)(e);function _(e){this.conference=e,e.on(d.TRACK_MUTE_CHANGED,function(t){if(t.isLocal()&&e.statistics){var n=t.isP2P?e.p2pJingleSession:e.jvbJingleSession,r=n&&n.peerconnection||null;e.statistics.sendMuteEvent(r,t.isMuted(),t.getType())}})}_.prototype.setupChatRoomListeners=function(){var e=this,t=this.conference,n=t.room;this.chatRoomForwarder=new c.a(n,this.conference.eventEmitter),n.addListener(b.a.ICE_RESTARTING,function(e){e.isP2P||t.rtc.closeBridgeChannel()}),n.addListener(b.a.ICE_RESTART_SUCCESS,function(e,n){!e.isP2P&&t._setBridgeChannel(n,e.peerconnection)}),n.addListener(b.a.AUDIO_MUTED_BY_FOCUS,function(){g.a.sendAnalytics(Object(i.E)()),t.rtc.setAudioMute(!0).then(function(){t.isMutedByFocus=!0},function(){return S.warn("Error while audio muting due to focus request")})}),this.chatRoomForwarder.forward(b.a.SUBJECT_CHANGED,d.SUBJECT_CHANGED),this.chatRoomForwarder.forward(b.a.MUC_JOINED,d.CONFERENCE_JOINED),n.addListener(b.a.MUC_JOINED,function(){e.conference.isJvbConnectionInterrupted=!1,Object.keys(n.connectionTimes).forEach(function(e){var t=Object(i.x)("conference_".concat(e),{value:n.connectionTimes[e]});g.a.sendAnalytics(t)}),Object.keys(n.xmpp.connectionTimes).forEach(function(e){var t=Object(i.x)("xmpp_".concat(e),{value:n.xmpp.connectionTimes[e]});g.a.sendAnalytics(t)})}),this.chatRoomForwarder.forward(b.a.ROOM_JOIN_ERROR,d.CONFERENCE_FAILED,l.CONNECTION_ERROR),this.chatRoomForwarder.forward(b.a.ROOM_CONNECT_ERROR,d.CONFERENCE_FAILED,l.CONNECTION_ERROR),this.chatRoomForwarder.forward(b.a.ROOM_CONNECT_NOT_ALLOWED_ERROR,d.CONFERENCE_FAILED,l.NOT_ALLOWED_ERROR),this.chatRoomForwarder.forward(b.a.ROOM_MAX_USERS_ERROR,d.CONFERENCE_FAILED,l.CONFERENCE_MAX_USERS),this.chatRoomForwarder.forward(b.a.PASSWORD_REQUIRED,d.CONFERENCE_FAILED,l.PASSWORD_REQUIRED),this.chatRoomForwarder.forward(b.a.AUTHENTICATION_REQUIRED,d.CONFERENCE_FAILED,l.AUTHENTICATION_REQUIRED),this.chatRoomForwarder.forward(b.a.BRIDGE_DOWN,d.CONFERENCE_FAILED,l.VIDEOBRIDGE_NOT_AVAILABLE),n.addListener(b.a.BRIDGE_DOWN,function(){return g.a.sendAnalytics(Object(i.v)())}),this.chatRoomForwarder.forward(b.a.RESERVATION_ERROR,d.CONFERENCE_FAILED,l.RESERVATION_ERROR),this.chatRoomForwarder.forward(b.a.GRACEFUL_SHUTDOWN,d.CONFERENCE_FAILED,l.GRACEFUL_SHUTDOWN),n.addListener(b.a.JINGLE_FATAL_ERROR,function(e,n){e.isP2P||t.eventEmitter.emit(d.CONFERENCE_FAILED,l.JINGLE_FATAL_ERROR,n)}),n.addListener(b.a.CONNECTION_ICE_FAILED,function(e){t._onIceConnectionFailed(e)}),this.chatRoomForwarder.forward(b.a.MUC_DESTROYED,d.CONFERENCE_FAILED,l.CONFERENCE_DESTROYED),this.chatRoomForwarder.forward(b.a.CHAT_ERROR_RECEIVED,d.CONFERENCE_ERROR,l.CHAT_ERROR),this.chatRoomForwarder.forward(b.a.FOCUS_DISCONNECTED,d.CONFERENCE_FAILED,l.FOCUS_DISCONNECTED),n.addListener(b.a.FOCUS_LEFT,function(){g.a.sendAnalytics(Object(i.z)()),t.eventEmitter.emit(d.CONFERENCE_FAILED,l.FOCUS_LEFT)}),n.addListener(b.a.SESSION_ACCEPT_TIMEOUT,function(e){g.a.sendAnalyticsAndLog(Object(i.B)(i.b,{p2p:e.isP2P}))}),this.chatRoomForwarder.forward(b.a.RECORDER_STATE_CHANGED,d.RECORDER_STATE_CHANGED),this.chatRoomForwarder.forward(b.a.TRANSCRIPTION_STATUS_CHANGED,d.TRANSCRIPTION_STATUS_CHANGED),this.chatRoomForwarder.forward(b.a.VIDEO_SIP_GW_AVAILABILITY_CHANGED,d.VIDEO_SIP_GW_AVAILABILITY_CHANGED),this.chatRoomForwarder.forward(b.a.VIDEO_SIP_GW_SESSION_STATE_CHANGED,d.VIDEO_SIP_GW_SESSION_STATE_CHANGED),this.chatRoomForwarder.forward(b.a.PHONE_NUMBER_CHANGED,d.PHONE_NUMBER_CHANGED),n.addListener(b.a.CONFERENCE_SETUP_FAILED,function(e,n){e.isP2P||t.eventEmitter.emit(d.CONFERENCE_FAILED,l.SETUP_FAILED,n)}),n.setParticipantPropertyListener(function(e,n){var r=t.getParticipantById(n);r&&r.setProperty(e.tagName.substring("jitsi_participant_".length),e.value)}),this.chatRoomForwarder.forward(b.a.KICKED,d.KICKED),n.addListener(b.a.KICKED,function(){t.leave()}),n.addListener(b.a.SUSPEND_DETECTED,t.onSuspendDetected.bind(t)),this.chatRoomForwarder.forward(b.a.MUC_LOCK_CHANGED,d.LOCK_STATE_CHANGED),n.addListener(b.a.MUC_MEMBER_JOINED,t.onMemberJoined.bind(t)),n.addListener(b.a.MUC_MEMBER_BOT_TYPE_CHANGED,t._onMemberBotTypeChanged.bind(t)),n.addListener(b.a.MUC_MEMBER_LEFT,t.onMemberLeft.bind(t)),this.chatRoomForwarder.forward(b.a.MUC_LEFT,d.CONFERENCE_LEFT),n.addListener(b.a.DISPLAY_NAME_CHANGED,t.onDisplayNameChanged.bind(t)),n.addListener(b.a.LOCAL_ROLE_CHANGED,function(e){t.onLocalRoleChanged(e),t.statistics&&t.isModerator()&&t.on(d.RECORDER_STATE_CHANGED,function(e){var t={error:e.getError(),id:"recorder_status",status:e.getStatus()};g.a.sendLog(JSON.stringify(t))})}),n.addListener(b.a.MUC_ROLE_CHANGED,t.onUserRoleChanged.bind(t)),n.addListener(a.a.IDENTITY_UPDATED,function(e,n){t.authEnabled=e,t.authIdentity=n,t.eventEmitter.emit(d.AUTH_STATUS_CHANGED,e,n)}),n.addListener(b.a.MESSAGE_RECEIVED,function(e,n,i,o,a){var s=r.Strophe.getResourceFromJid(e);t.eventEmitter.emit(d.MESSAGE_RECEIVED,s,i,a)}),n.addListener(b.a.PRIVATE_MESSAGE_RECEIVED,function(e,n,i,o,a){var s=r.Strophe.getResourceFromJid(e);t.eventEmitter.emit(d.PRIVATE_MESSAGE_RECEIVED,s,i,a)}),n.addListener(b.a.PRESENCE_STATUS,function(e,n){var i=r.Strophe.getResourceFromJid(e),o=t.getParticipantById(i);o&&o._status!==n&&(o._status=n,t.eventEmitter.emit(d.USER_STATUS_CHANGED,i,n))}),n.addListener(b.a.JSON_MESSAGE_RECEIVED,function(e,n){var i=r.Strophe.getResourceFromJid(e),o=t.getParticipantById(i);o?t.eventEmitter.emit(d.ENDPOINT_MESSAGE_RECEIVED,o,n):S.warn("Ignored XMPPEvents.JSON_MESSAGE_RECEIVED for not existing "+"participant: ".concat(e),n)}),n.addPresenceListener("startmuted",function(e,n){var r=!1;if(t.myUserId()===n&&t.isModerator())r=!0;else{var i=t.getParticipantById(n);i&&i.isModerator()&&(r=!0)}if(r){var o="true"===e.attributes.audio,a="true"===e.attributes.video,s=!1;o!==t.startMutedPolicy.audio&&(t.startMutedPolicy.audio=o,s=!0),a!==t.startMutedPolicy.video&&(t.startMutedPolicy.video=a,s=!0),s&&t.eventEmitter.emit(d.START_MUTED_POLICY_CHANGED,t.startMutedPolicy)}}),t.statistics&&(n.addListener(b.a.CONNECTION_ICE_FAILED,function(e){t.statistics.sendIceConnectionFailedEvent(e.peerconnection)}),n.addListener(b.a.ADD_ICE_CANDIDATE_FAILED,function(e,n){t.statistics.sendAddIceCandidateFailed(e,n)}))},_.prototype.setupRTCListeners=function(){var e=this.conference,t=e.rtc;t.addListener(h.a.REMOTE_TRACK_ADDED,e.onRemoteTrackAdded.bind(e)),t.addListener(h.a.REMOTE_TRACK_REMOVED,e.onRemoteTrackRemoved.bind(e)),t.addListener(h.a.DOMINANT_SPEAKER_CHANGED,function(t){e.lastDominantSpeaker!==t&&e.room&&(e.lastDominantSpeaker=t,e.eventEmitter.emit(d.DOMINANT_SPEAKER_CHANGED,t)),e.statistics&&e.myUserId()===t&&e.statistics.sendDominantSpeakerEvent(e.room.roomjid)}),t.addListener(h.a.DATA_CHANNEL_OPEN,function(){var t=window.performance.now(),n="data.channel.opened";S.log("(TIME) ".concat(n),t),e.room.connectionTimes[n]=t,g.a.sendAnalytics(Object(i.x)(n,{value:t})),e.eventEmitter.emit(d.DATA_CHANNEL_OPENED)}),t.addListener(h.a.ENDPOINT_MESSAGE_RECEIVED,function(t,n){var r=e.getParticipantById(t);r?e.eventEmitter.emit(d.ENDPOINT_MESSAGE_RECEIVED,r,n):S.warn("Ignored ENDPOINT_MESSAGE_RECEIVED for not existing "+"participant: ".concat(t),n)}),t.addListener(h.a.LOCAL_UFRAG_CHANGED,function(e,t){e.isP2P||g.a.sendLog(JSON.stringify({id:"local_ufrag",value:t}))}),t.addListener(h.a.REMOTE_UFRAG_CHANGED,function(e,t){e.isP2P||g.a.sendLog(JSON.stringify({id:"remote_ufrag",value:t}))}),t.addListener(h.a.CREATE_ANSWER_FAILED,function(t,n){e.statistics.sendCreateAnswerFailed(t,n)}),t.addListener(h.a.CREATE_OFFER_FAILED,function(t,n){e.statistics.sendCreateOfferFailed(t,n)}),t.addListener(h.a.SET_LOCAL_DESCRIPTION_FAILED,function(t,n){e.statistics.sendSetLocalDescFailed(t,n)}),t.addListener(h.a.SET_REMOTE_DESCRIPTION_FAILED,function(t,n){e.statistics.sendSetRemoteDescFailed(t,n)}),t.addListener(h.a.LOCAL_TRACK_SSRC_UPDATED,function(t,n){t.isVideoTrack()&&t.videoType===m.a.DESKTOP&&e.statistics.sendScreenSharingEvent(!0,n)})},_.prototype.setupXMPPListeners=function(){var e=this.conference;e.xmpp.caps.addListener(b.a.PARTCIPANT_FEATURES_CHANGED,function(t){var n=e.getParticipantById(r.Strophe.getResourceFromJid(t));n&&e.eventEmitter.emit(d.PARTCIPANT_FEATURES_CHANGED,n)}),e.xmpp.addListener(b.a.CALL_INCOMING,e.onIncomingCall.bind(e)),e.xmpp.addListener(b.a.CALL_ACCEPTED,e.onCallAccepted.bind(e)),e.xmpp.addListener(b.a.TRANSPORT_INFO,e.onTransportInfo.bind(e)),e.xmpp.addListener(b.a.CALL_ENDED,e.onCallEnded.bind(e)),e.xmpp.addListener(b.a.START_MUTED_FROM_FOCUS,function(t,n){e.options.config.ignoreStartMuted||(e.startAudioMuted=t,e.startVideoMuted=n,e.getLocalTracks().forEach(function(t){switch(t.getType()){case f.a:e.startAudioMuted&&t.mute();break;case f.b:e.startVideoMuted&&t.mute()}}),e.eventEmitter.emit(d.STARTED_MUTED))})},_.prototype.setupStatisticsListeners=function(){var e=this.conference;e.statistics&&(e.statistics.addAudioLevelListener(function(t,n,r,i){e.rtc.setAudioLevel(t,n,r,i)}),e.statistics.addBeforeDisposedListener(function(){e.eventEmitter.emit(d.BEFORE_STATISTICS_DISPOSED)}),e.statistics.addByteSentStatsListener(function(t,n){e.getLocalTracks(f.a).forEach(function(e){var r=t.getLocalSSRC(e);r&&n.hasOwnProperty(r)&&e._onByteSentStatsReceived(t,n[r])})}))}}).call(this,"JitsiConferenceEventManager.js")},function(e,t){function n(e,t){if(!e||!t||"function"!=typeof e.addListener||"function"!=typeof t.emit)throw new Error("Invalid arguments passed to EventEmitterForwarder");this.src=e,this.dest=t}n.prototype.forward=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0];t[0]=this.dest,this.src.addListener(r,Function.prototype.bind.apply(this.dest.emit,t))},e.exports=n},function(e,t,n){"use strict";(function(e){var r=n(7),i=n(4),o=n(3),a=n(25);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=Object(i.getLogger)(e),d=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.disposed=!1,this.analyticsHandlers=new Set,this.cache=[],this.permanentProperties={},this.conferenceName="",this.addPermanentProperties({callstats_name:a.a.callStatsUserName,user_agent:navigator.userAgent,browser_name:o.a.getName()})}var t,n,i;return t=e,(n=[{key:"dispose",value:function(){l.warn("Disposing of analytics adapter."),this.setAnalyticsHandlers([]),this.disposed=!0}},{key:"setAnalyticsHandlers",value:function(e){var t=this;if(!this.disposed){this.analyticsHandlers=new Set(e),this._setUserProperties();var n=this.cache;this.cache=null,n&&n.forEach(function(e){return t._sendEvent(e)})}}},{key:"_setUserProperties",value:function(){var e=this;this.analyticsHandlers.forEach(function(t){try{t.setUserProperties(e.permanentProperties)}catch(e){l.warn("Error in setUserProperties method of one of the "+"analytics handlers: ".concat(e))}})}},{key:"addPermanentProperties",value:function(e){this.permanentProperties=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){c(e,t,n[t])})}return e}({},this.permanentProperties,e),this._setUserProperties()}},{key:"setConferenceName",value:function(e){this.conferenceName=e,this.addPermanentProperties({conference_name:e})}},{key:"sendEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.disposed){var n=null;"string"==typeof e?n={type:r.r,action:e,actionSubject:e,source:e,attributes:t}:"object"===s(e)&&(n=e),this._verifyRequiredFields(n)?this._sendEvent(n):l.error("Dropping a mis-formatted event: ".concat(JSON.stringify(n)))}}},{key:"_verifyRequiredFields",value:function(e){if(!e)return!1;e.type||(e.type=r.r);var t=e.type;return t!==r.r&&t!==r.s&&t!==r.u&&t!==r.t?(l.error("Unknown event type: ".concat(t)),!1):t===r.s?Boolean(e.name):(e.action=e.action||e.name||e.actionSubject,e.actionSubject=e.actionSubject||e.name||e.action,e.source=e.source||e.name||e.action||e.actionSubject,e.action&&e.actionSubject&&e.source?!!(t!==r.t||(e.objectType=e.objectType||"generic-object-type",e.containerType=e.containerType||"conference","conference"!==e.containerType||e.containerId||(e.containerId=this.conferenceName),e.objectType&&e.objectId&&e.containerType&&e.containerId))||(l.error("Required field missing (containerId, containerType, objectId or objectType)"),!1):(l.error("Required field missing (action, actionSubject or source)"),!1))}},{key:"_maybeCacheEvent",value:function(e){return!!this.cache&&(this.cache.push(e),this.cache.length>100&&this.cache.splice(0,1),!0)}},{key:"_sendEvent",value:function(e){this._maybeCacheEvent(e)||this.analyticsHandlers.forEach(function(t){try{t.sendEvent(e)}catch(e){l.warn("Error sending analytics event: ".concat(e))}})}}])&&u(t.prototype,n),i&&u(t,i),e}();t.a=new d}).call(this,"modules/statistics/AnalyticsAdapter.js")},function(e,t,n){"use strict";(function(e,r){n.d(t,"a",function(){return f});var i=n(4),o=n(19);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=Object(i.getLogger)(e),f=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=c(this,u(t).call(this)),d.info("This appears to be ".concat(e.getName(),", ver: ").concat(e.getVersion())),e}var n,i,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,o["a"]),n=t,(i=[{key:"doesVideoMuteByStreamRemove",value:function(){return!(this.isFirefox()||this.isEdge()||this.isReactNative()||this.isSafariWithWebrtc())}},{key:"supportsP2P",value:function(){return!this.isEdge()&&!this.isFirefox()}},{key:"isChromiumBased",value:function(){return this.isChrome()||this.isElectron()||this.isNWJS()||this.isOpera()}},{key:"isSafariWithWebrtc",value:function(){return this.isSafari()&&!this.isVersionLessThan("11")}},{key:"isSupported",value:function(){return this.isChromiumBased()||this.isEdge()||this.isFirefox()||this.isReactNative()||this.isSafariWithWebrtc()}},{key:"supportsVideoMuteOnConnInterrupted",value:function(){return this.isChromiumBased()||this.isReactNative()}},{key:"supportsBandwidthStatistics",value:function(){return!this.isFirefox()&&!this.isEdge()&&!this.isSafariWithWebrtc()}},{key:"supportsDataChannels",value:function(){return!this.isEdge()}},{key:"supportsDeviceChangeEvent",value:function(){return navigator.mediaDevices&&void 0!==navigator.mediaDevices.ondevicechange&&void 0!==navigator.mediaDevices.addEventListener}},{key:"supportsMediaStreamConstructor",value:function(){return!this.isReactNative()}},{key:"supportsRtpStatistics",value:function(){return this.isChromiumBased()||this.isEdge()||this.isFirefox()||this.isReactNative()||this.isSafariWithWebrtc()}},{key:"supportsLocalCandidateRttStatistics",value:function(){return this.isChromiumBased()||this.isReactNative()}},{key:"supportsRTTStatistics",value:function(){return!this.isFirefox()&&!this.isEdge()}},{key:"supportsRtpSender",value:function(){return this.isFirefox()}},{key:"supportsRtx",value:function(){return!this.isFirefox()}},{key:"supportsSimulcast",value:function(){return this.isChromiumBased()||this.isFirefox()||this.isReactNative()}},{key:"supportsVideo",value:function(){return!this.isSafariWithWebrtc()}},{key:"usesPlanB",value:function(){return!this.usesUnifiedPlan()}},{key:"usesUnifiedPlan",value:function(){return this.isFirefox()}},{key:"usesNewGumFlow",value:function(){return this.isChrome()?!this.isVersionLessThan(61):!(!this.isFirefox()&&!this.isSafariWithWebrtc())||!!this.isChromiumBased()&&this._getChromiumBasedVersion()>=61}},{key:"usesAdapter",value:function(){return this.usesNewGumFlow()||this.isEdge()}},{key:"supportsGetDisplayMedia",value:function(){return void 0!==navigator.getDisplayMedia||void 0!==navigator.mediaDevices.getDisplayMedia}},{key:"supportsSdpSemantics",value:function(){return this.isChromiumBased()&&this._getChromiumBasedVersion()>=65}},{key:"_getChromiumBasedVersion",value:function(){if(this.isChromiumBased()){if(this.isNWJS())return Number.parseInt(r.versions.chromium,10);var e=navigator.userAgent;if(e.match(/Chrome/))return Number.parseInt(e.match(/Chrome\/([\d.]+)/)[1],10)}return-1}}])&&s(n.prototype,i),a&&s(n,a),t}()}).call(this,"modules/browser/BrowserCapabilities.js",n(49))},function(module,exports,__webpack_require__){(function(process,global){var __WEBPACK_AMD_DEFINE_RESULT__;
/**
 * [js-md5]{@link https://github.com/emn178/js-md5}
 *
 * @namespace md5
 * @version 0.7.3
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */
/**
 * [js-md5]{@link https://github.com/emn178/js-md5}
 *
 * @namespace md5
 * @version 0.7.3
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */
!function(){"use strict";var ERROR="input is invalid type",WINDOW="object"==typeof window,root=WINDOW?window:{};root.JS_MD5_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&"object"==typeof self,NODE_JS=!root.JS_MD5_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;NODE_JS?root=global:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_MD5_NO_COMMON_JS&&"object"==typeof module&&module.exports,AMD=__webpack_require__(121),ARRAY_BUFFER=!root.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[128,32768,8388608,-2147483648],SHIFT=[0,8,16,24],OUTPUT_TYPES=["hex","array","digest","buffer","arrayBuffer","base64"],BASE64_ENCODE_CHAR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),blocks=[],buffer8;if(ARRAY_BUFFER){var buffer=new ArrayBuffer(68);buffer8=new Uint8Array(buffer),blocks=new Uint32Array(buffer)}!root.JS_MD5_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),!ARRAY_BUFFER||!root.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return"object"==typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer});var createOutputMethod=function(e){return function(t){return new Md5(!0).update(t)[e]()}},createMethod=function(){var e=createOutputMethod("hex");NODE_JS&&(e=nodeWrap(e)),e.create=function(){return new Md5},e.update=function(t){return e.create().update(t)};for(var t=0;t<OUTPUT_TYPES.length;++t){var n=OUTPUT_TYPES[t];e[n]=createOutputMethod(n)}return e},nodeWrap=function(method){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),nodeMethod=function(e){if("string"==typeof e)return crypto.createHash("md5").update(e,"utf8").digest("hex");if(null==e)throw ERROR;return e.constructor===ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||ArrayBuffer.isView(e)||e.constructor===Buffer?crypto.createHash("md5").update(new Buffer(e)).digest("hex"):method(e)};return nodeMethod};function Md5(e){if(e)blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks,this.buffer8=buffer8;else if(ARRAY_BUFFER){var t=new ArrayBuffer(68);this.buffer8=new Uint8Array(t),this.blocks=new Uint32Array(t)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Md5.prototype.update=function(e){if(!this.finalized){var t,n=typeof e;if("string"!==n){if("object"!==n)throw ERROR;if(null===e)throw ERROR;if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||ARRAY_BUFFER&&ArrayBuffer.isView(e)))throw ERROR;t=!0}for(var r,i,o=0,a=e.length,s=this.blocks,c=this.buffer8;o<a;){if(this.hashed&&(this.hashed=!1,s[0]=s[16],s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),t)if(ARRAY_BUFFER)for(i=this.start;o<a&&i<64;++o)c[i++]=e[o];else for(i=this.start;o<a&&i<64;++o)s[i>>2]|=e[o]<<SHIFT[3&i++];else if(ARRAY_BUFFER)for(i=this.start;o<a&&i<64;++o)(r=e.charCodeAt(o))<128?c[i++]=r:r<2048?(c[i++]=192|r>>6,c[i++]=128|63&r):r<55296||r>=57344?(c[i++]=224|r>>12,c[i++]=128|r>>6&63,c[i++]=128|63&r):(r=65536+((1023&r)<<10|1023&e.charCodeAt(++o)),c[i++]=240|r>>18,c[i++]=128|r>>12&63,c[i++]=128|r>>6&63,c[i++]=128|63&r);else for(i=this.start;o<a&&i<64;++o)(r=e.charCodeAt(o))<128?s[i>>2]|=r<<SHIFT[3&i++]:r<2048?(s[i>>2]|=(192|r>>6)<<SHIFT[3&i++],s[i>>2]|=(128|63&r)<<SHIFT[3&i++]):r<55296||r>=57344?(s[i>>2]|=(224|r>>12)<<SHIFT[3&i++],s[i>>2]|=(128|r>>6&63)<<SHIFT[3&i++],s[i>>2]|=(128|63&r)<<SHIFT[3&i++]):(r=65536+((1023&r)<<10|1023&e.charCodeAt(++o)),s[i>>2]|=(240|r>>18)<<SHIFT[3&i++],s[i>>2]|=(128|r>>12&63)<<SHIFT[3&i++],s[i>>2]|=(128|r>>6&63)<<SHIFT[3&i++],s[i>>2]|=(128|63&r)<<SHIFT[3&i++]);this.lastByteIndex=i,this.bytes+=i-this.start,i>=64?(this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Md5.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[t>>2]|=EXTRA[3&t],t>=56&&(this.hashed||this.hash(),e[0]=e[16],e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.bytes<<3,e[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},Md5.prototype.hash=function(){var e,t,n,r,i,o,a=this.blocks;this.first?t=((t=((e=((e=a[0]-680876937)<<7|e>>>25)-271733879<<0)^(n=((n=(-271733879^(r=((r=(-1732584194^2004318071&e)+a[1]-117830708)<<12|r>>>20)+e<<0)&(-271733879^e))+a[2]-1126478375)<<17|n>>>15)+r<<0)&(r^e))+a[3]-1316259209)<<22|t>>>10)+n<<0:(e=this.h0,t=this.h1,n=this.h2,t=((t+=((e=((e+=((r=this.h3)^t&(n^r))+a[0]-680876936)<<7|e>>>25)+t<<0)^(n=((n+=(t^(r=((r+=(n^e&(t^n))+a[1]-389564586)<<12|r>>>20)+e<<0)&(e^t))+a[2]+606105819)<<17|n>>>15)+r<<0)&(r^e))+a[3]-1044525330)<<22|t>>>10)+n<<0),t=((t+=((e=((e+=(r^t&(n^r))+a[4]-176418897)<<7|e>>>25)+t<<0)^(n=((n+=(t^(r=((r+=(n^e&(t^n))+a[5]+1200080426)<<12|r>>>20)+e<<0)&(e^t))+a[6]-1473231341)<<17|n>>>15)+r<<0)&(r^e))+a[7]-45705983)<<22|t>>>10)+n<<0,t=((t+=((e=((e+=(r^t&(n^r))+a[8]+1770035416)<<7|e>>>25)+t<<0)^(n=((n+=(t^(r=((r+=(n^e&(t^n))+a[9]-1958414417)<<12|r>>>20)+e<<0)&(e^t))+a[10]-42063)<<17|n>>>15)+r<<0)&(r^e))+a[11]-1990404162)<<22|t>>>10)+n<<0,t=((t+=((e=((e+=(r^t&(n^r))+a[12]+1804603682)<<7|e>>>25)+t<<0)^(n=((n+=(t^(r=((r+=(n^e&(t^n))+a[13]-40341101)<<12|r>>>20)+e<<0)&(e^t))+a[14]-1502002290)<<17|n>>>15)+r<<0)&(r^e))+a[15]+1236535329)<<22|t>>>10)+n<<0,t=((t+=((r=((r+=(t^n&((e=((e+=(n^r&(t^n))+a[1]-165796510)<<5|e>>>27)+t<<0)^t))+a[6]-1069501632)<<9|r>>>23)+e<<0)^e&((n=((n+=(e^t&(r^e))+a[11]+643717713)<<14|n>>>18)+r<<0)^r))+a[0]-373897302)<<20|t>>>12)+n<<0,t=((t+=((r=((r+=(t^n&((e=((e+=(n^r&(t^n))+a[5]-701558691)<<5|e>>>27)+t<<0)^t))+a[10]+38016083)<<9|r>>>23)+e<<0)^e&((n=((n+=(e^t&(r^e))+a[15]-660478335)<<14|n>>>18)+r<<0)^r))+a[4]-405537848)<<20|t>>>12)+n<<0,t=((t+=((r=((r+=(t^n&((e=((e+=(n^r&(t^n))+a[9]+568446438)<<5|e>>>27)+t<<0)^t))+a[14]-1019803690)<<9|r>>>23)+e<<0)^e&((n=((n+=(e^t&(r^e))+a[3]-187363961)<<14|n>>>18)+r<<0)^r))+a[8]+1163531501)<<20|t>>>12)+n<<0,t=((t+=((r=((r+=(t^n&((e=((e+=(n^r&(t^n))+a[13]-1444681467)<<5|e>>>27)+t<<0)^t))+a[2]-51403784)<<9|r>>>23)+e<<0)^e&((n=((n+=(e^t&(r^e))+a[7]+1735328473)<<14|n>>>18)+r<<0)^r))+a[12]-1926607734)<<20|t>>>12)+n<<0,t=((t+=((o=(r=((r+=((i=t^n)^(e=((e+=(i^r)+a[5]-378558)<<4|e>>>28)+t<<0))+a[8]-2022574463)<<11|r>>>21)+e<<0)^e)^(n=((n+=(o^t)+a[11]+1839030562)<<16|n>>>16)+r<<0))+a[14]-35309556)<<23|t>>>9)+n<<0,t=((t+=((o=(r=((r+=((i=t^n)^(e=((e+=(i^r)+a[1]-1530992060)<<4|e>>>28)+t<<0))+a[4]+1272893353)<<11|r>>>21)+e<<0)^e)^(n=((n+=(o^t)+a[7]-155497632)<<16|n>>>16)+r<<0))+a[10]-1094730640)<<23|t>>>9)+n<<0,t=((t+=((o=(r=((r+=((i=t^n)^(e=((e+=(i^r)+a[13]+681279174)<<4|e>>>28)+t<<0))+a[0]-358537222)<<11|r>>>21)+e<<0)^e)^(n=((n+=(o^t)+a[3]-722521979)<<16|n>>>16)+r<<0))+a[6]+76029189)<<23|t>>>9)+n<<0,t=((t+=((o=(r=((r+=((i=t^n)^(e=((e+=(i^r)+a[9]-640364487)<<4|e>>>28)+t<<0))+a[12]-421815835)<<11|r>>>21)+e<<0)^e)^(n=((n+=(o^t)+a[15]+530742520)<<16|n>>>16)+r<<0))+a[2]-995338651)<<23|t>>>9)+n<<0,t=((t+=((r=((r+=(t^((e=((e+=(n^(t|~r))+a[0]-198630844)<<6|e>>>26)+t<<0)|~n))+a[7]+1126891415)<<10|r>>>22)+e<<0)^((n=((n+=(e^(r|~t))+a[14]-1416354905)<<15|n>>>17)+r<<0)|~e))+a[5]-57434055)<<21|t>>>11)+n<<0,t=((t+=((r=((r+=(t^((e=((e+=(n^(t|~r))+a[12]+1700485571)<<6|e>>>26)+t<<0)|~n))+a[3]-1894986606)<<10|r>>>22)+e<<0)^((n=((n+=(e^(r|~t))+a[10]-1051523)<<15|n>>>17)+r<<0)|~e))+a[1]-2054922799)<<21|t>>>11)+n<<0,t=((t+=((r=((r+=(t^((e=((e+=(n^(t|~r))+a[8]+1873313359)<<6|e>>>26)+t<<0)|~n))+a[15]-30611744)<<10|r>>>22)+e<<0)^((n=((n+=(e^(r|~t))+a[6]-1560198380)<<15|n>>>17)+r<<0)|~e))+a[13]+1309151649)<<21|t>>>11)+n<<0,t=((t+=((r=((r+=(t^((e=((e+=(n^(t|~r))+a[4]-145523070)<<6|e>>>26)+t<<0)|~n))+a[11]-1120210379)<<10|r>>>22)+e<<0)^((n=((n+=(e^(r|~t))+a[2]+718787259)<<15|n>>>17)+r<<0)|~e))+a[9]-343485551)<<21|t>>>11)+n<<0,this.first?(this.h0=e+1732584193<<0,this.h1=t-271733879<<0,this.h2=n-1732584194<<0,this.h3=r+271733878<<0,this.first=!1):(this.h0=this.h0+e<<0,this.h1=this.h1+t<<0,this.h2=this.h2+n<<0,this.h3=this.h3+r<<0)},Md5.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,r=this.h3;return HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[n>>4&15]+HEX_CHARS[15&n]+HEX_CHARS[n>>12&15]+HEX_CHARS[n>>8&15]+HEX_CHARS[n>>20&15]+HEX_CHARS[n>>16&15]+HEX_CHARS[n>>28&15]+HEX_CHARS[n>>24&15]+HEX_CHARS[r>>4&15]+HEX_CHARS[15&r]+HEX_CHARS[r>>12&15]+HEX_CHARS[r>>8&15]+HEX_CHARS[r>>20&15]+HEX_CHARS[r>>16&15]+HEX_CHARS[r>>28&15]+HEX_CHARS[r>>24&15]},Md5.prototype.toString=Md5.prototype.hex,Md5.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,r=this.h3;return[255&e,e>>8&255,e>>16&255,e>>24&255,255&t,t>>8&255,t>>16&255,t>>24&255,255&n,n>>8&255,n>>16&255,n>>24&255,255&r,r>>8&255,r>>16&255,r>>24&255]},Md5.prototype.array=Md5.prototype.digest,Md5.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(16),t=new Uint32Array(e);return t[0]=this.h0,t[1]=this.h1,t[2]=this.h2,t[3]=this.h3,e},Md5.prototype.buffer=Md5.prototype.arrayBuffer,Md5.prototype.base64=function(){for(var e,t,n,r="",i=this.array(),o=0;o<15;)e=i[o++],t=i[o++],n=i[o++],r+=BASE64_ENCODE_CHAR[e>>>2]+BASE64_ENCODE_CHAR[63&(e<<4|t>>>4)]+BASE64_ENCODE_CHAR[63&(t<<2|n>>>6)]+BASE64_ENCODE_CHAR[63&n];return e=i[o],r+=BASE64_ENCODE_CHAR[e>>>2]+BASE64_ENCODE_CHAR[e<<4&63]+"=="};var exports=createMethod();COMMON_JS?module.exports=exports:(root.md5=exports,AMD&&(__WEBPACK_AMD_DEFINE_RESULT__=function(){return exports}.call(exports,__webpack_require__,exports,module),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)))}()}).call(this,__webpack_require__(49),__webpack_require__(42))},function(e,t,n){var r=n(36),i=["Aaliyah","Aaron","Abagail","Abbey","Abbie","Abbigail","Abby","Abdiel","Abdul","Abdullah","Abe","Abel","Abelardo","Abigail","Abigale","Abigayle","Abner","Abraham","Ada","Adah","Adalberto","Adaline","Adam","Adan","Addie","Addison","Adela","Adelbert","Adele","Adelia","Adeline","Adell","Adella","Adelle","Aditya","Adolf","Adolfo","Adolph","Adolphus","Adonis","Adrain","Adrian","Adriana","Adrianna","Adriel","Adrien","Adrienne","Afton","Aglae","Agnes","Agustin","Agustina","Ahmad","Ahmed","Aida","Aidan","Aiden","Aileen","Aisha","Aiyana","Akeem","Al","Alaina","Alan","Alana","Alanis","Alanna","Alayna","Alba","Albert","Alberta","Albertha","Alberto","Albin","Albina","Alda","Alden","Alec","Aleen","Alejandra","Alejandrin","Alek","Alena","Alene","Alessandra","Alessandro","Alessia","Aletha","Alex","Alexa","Alexander","Alexandra","Alexandre","Alexandrea","Alexandria","Alexandrine","Alexandro","Alexane","Alexanne","Alexie","Alexis","Alexys","Alexzander","Alf","Alfonso","Alfonzo","Alford","Alfred","Alfreda","Alfredo","Ali","Alia","Alice","Alicia","Alisa","Alisha","Alison","Alivia","Aliya","Aliyah","Aliza","Alize","Allan","Allen","Allene","Allie","Allison","Ally","Alphonso","Alta","Althea","Alva","Alvah","Alvena","Alvera","Alverta","Alvina","Alvis","Alyce","Alycia","Alysa","Alysha","Alyson","Alysson","Amalia","Amanda","Amani","Amara","Amari","Amaya","Amber","Ambrose","Amelia","Amelie","Amely","America","Americo","Amie","Amina","Amir","Amira","Amiya","Amos","Amparo","Amy","Amya","Ana","Anabel","Anabelle","Anahi","Anais","Anastacio","Anastasia","Anderson","Andre","Andreane","Andreanne","Andres","Andrew","Andy","Angel","Angela","Angelica","Angelina","Angeline","Angelita","Angelo","Angie","Angus","Anibal","Anika","Anissa","Anita","Aniya","Aniyah","Anjali","Anna","Annabel","Annabell","Annabelle","Annalise","Annamae","Annamarie","Anne","Annetta","Annette","Annie","Ansel","Ansley","Anthony","Antoinette","Antone","Antonetta","Antonette","Antonia","Antonietta","Antonina","Antonio","Antwan","Antwon","Anya","April","Ara","Araceli","Aracely","Arch","Archibald","Ardella","Arden","Ardith","Arely","Ari","Ariane","Arianna","Aric","Ariel","Arielle","Arjun","Arlene","Arlie","Arlo","Armand","Armando","Armani","Arnaldo","Arne","Arno","Arnold","Arnoldo","Arnulfo","Aron","Art","Arthur","Arturo","Arvel","Arvid","Arvilla","Aryanna","Asa","Asha","Ashlee","Ashleigh","Ashley","Ashly","Ashlynn","Ashton","Ashtyn","Asia","Assunta","Astrid","Athena","Aubree","Aubrey","Audie","Audra","Audreanne","Audrey","August","Augusta","Augustine","Augustus","Aurelia","Aurelie","Aurelio","Aurore","Austen","Austin","Austyn","Autumn","Ava","Avery","Avis","Axel","Ayana","Ayden","Ayla","Aylin","Baby","Bailee","Bailey","Barbara","Barney","Baron","Barrett","Barry","Bart","Bartholome","Barton","Baylee","Beatrice","Beau","Beaulah","Bell","Bella","Belle","Ben","Benedict","Benjamin","Bennett","Bennie","Benny","Benton","Berenice","Bernadette","Bernadine","Bernard","Bernardo","Berneice","Bernhard","Bernice","Bernie","Berniece","Bernita","Berry","Bert","Berta","Bertha","Bertram","Bertrand","Beryl","Bessie","Beth","Bethany","Bethel","Betsy","Bette","Bettie","Betty","Bettye","Beulah","Beverly","Bianka","Bill","Billie","Billy","Birdie","Blair","Blaise","Blake","Blanca","Blanche","Blaze","Bo","Bobbie","Bobby","Bonita","Bonnie","Boris","Boyd","Brad","Braden","Bradford","Bradley","Bradly","Brady","Braeden","Brain","Brandi","Brando","Brandon","Brandt","Brandy","Brandyn","Brannon","Branson","Brant","Braulio","Braxton","Brayan","Breana","Breanna","Breanne","Brenda","Brendan","Brenden","Brendon","Brenna","Brennan","Brennon","Brent","Bret","Brett","Bria","Brian","Briana","Brianne","Brice","Bridget","Bridgette","Bridie","Brielle","Brigitte","Brionna","Brisa","Britney","Brittany","Brock","Broderick","Brody","Brook","Brooke","Brooklyn","Brooks","Brown","Bruce","Bryana","Bryce","Brycen","Bryon","Buck","Bud","Buddy","Buford","Bulah","Burdette","Burley","Burnice","Buster","Cade","Caden","Caesar","Caitlyn","Cale","Caleb","Caleigh","Cali","Calista","Callie","Camden","Cameron","Camila","Camilla","Camille","Camren","Camron","Camryn","Camylle","Candace","Candelario","Candice","Candida","Candido","Cara","Carey","Carissa","Carlee","Carleton","Carley","Carli","Carlie","Carlo","Carlos","Carlotta","Carmel","Carmela","Carmella","Carmelo","Carmen","Carmine","Carol","Carolanne","Carole","Carolina","Caroline","Carolyn","Carolyne","Carrie","Carroll","Carson","Carter","Cary","Casandra","Casey","Casimer","Casimir","Casper","Cassandra","Cassandre","Cassidy","Cassie","Catalina","Caterina","Catharine","Catherine","Cathrine","Cathryn","Cathy","Cayla","Ceasar","Cecelia","Cecil","Cecile","Cecilia","Cedrick","Celestine","Celestino","Celia","Celine","Cesar","Chad","Chadd","Chadrick","Chaim","Chance","Chandler","Chanel","Chanelle","Charity","Charlene","Charles","Charley","Charlie","Charlotte","Chase","Chasity","Chauncey","Chaya","Chaz","Chelsea","Chelsey","Chelsie","Chesley","Chester","Chet","Cheyanne","Cheyenne","Chloe","Chris","Christ","Christa","Christelle","Christian","Christiana","Christina","Christine","Christop","Christophe","Christopher","Christy","Chyna","Ciara","Cicero","Cielo","Cierra","Cindy","Citlalli","Clair","Claire","Clara","Clarabelle","Clare","Clarissa","Clark","Claud","Claude","Claudia","Claudie","Claudine","Clay","Clemens","Clement","Clementina","Clementine","Clemmie","Cleo","Cleora","Cleta","Cletus","Cleve","Cleveland","Clifford","Clifton","Clint","Clinton","Clotilde","Clovis","Cloyd","Clyde","Coby","Cody","Colby","Cole","Coleman","Colin","Colleen","Collin","Colt","Colten","Colton","Columbus","Concepcion","Conner","Connie","Connor","Conor","Conrad","Constance","Constantin","Consuelo","Cooper","Cora","Coralie","Corbin","Cordelia","Cordell","Cordia","Cordie","Corene","Corine","Cornelius","Cornell","Corrine","Cortez","Cortney","Cory","Coty","Courtney","Coy","Craig","Crawford","Creola","Cristal","Cristian","Cristina","Cristobal","Cristopher","Cruz","Crystal","Crystel","Cullen","Curt","Curtis","Cydney","Cynthia","Cyril","Cyrus","Dagmar","Dahlia","Daija","Daisha","Daisy","Dakota","Dale","Dallas","Dallin","Dalton","Damaris","Dameon","Damian","Damien","Damion","Damon","Dan","Dana","Dandre","Dane","D'angelo","Dangelo","Danial","Daniela","Daniella","Danielle","Danika","Dannie","Danny","Dante","Danyka","Daphne","Daphnee","Daphney","Darby","Daren","Darian","Dariana","Darien","Dario","Darion","Darius","Darlene","Daron","Darrel","Darrell","Darren","Darrick","Darrin","Darrion","Darron","Darryl","Darwin","Daryl","Dashawn","Dasia","Dave","David","Davin","Davion","Davon","Davonte","Dawn","Dawson","Dax","Dayana","Dayna","Dayne","Dayton","Dean","Deangelo","Deanna","Deborah","Declan","Dedric","Dedrick","Dee","Deion","Deja","Dejah","Dejon","Dejuan","Delaney","Delbert","Delfina","Delia","Delilah","Dell","Della","Delmer","Delores","Delpha","Delphia","Delphine","Delta","Demarco","Demarcus","Demario","Demetris","Demetrius","Demond","Dena","Denis","Dennis","Deon","Deondre","Deontae","Deonte","Dereck","Derek","Derick","Deron","Derrick","Deshaun","Deshawn","Desiree","Desmond","Dessie","Destany","Destin","Destinee","Destiney","Destini","Destiny","Devan","Devante","Deven","Devin","Devon","Devonte","Devyn","Dewayne","Dewitt","Dexter","Diamond","Diana","Dianna","Diego","Dillan","Dillon","Dimitri","Dina","Dino","Dion","Dixie","Dock","Dolly","Dolores","Domenic","Domenica","Domenick","Domenico","Domingo","Dominic","Dominique","Don","Donald","Donato","Donavon","Donna","Donnell","Donnie","Donny","Dora","Dorcas","Dorian","Doris","Dorothea","Dorothy","Dorris","Dortha","Dorthy","Doug","Douglas","Dovie","Doyle","Drake","Drew","Duane","Dudley","Dulce","Duncan","Durward","Dustin","Dusty","Dwight","Dylan","Earl","Earlene","Earline","Earnest","Earnestine","Easter","Easton","Ebba","Ebony","Ed","Eda","Edd","Eddie","Eden","Edgar","Edgardo","Edison","Edmond","Edmund","Edna","Eduardo","Edward","Edwardo","Edwin","Edwina","Edyth","Edythe","Effie","Efrain","Efren","Eileen","Einar","Eino","Eladio","Elaina","Elbert","Elda","Eldon","Eldora","Eldred","Eldridge","Eleanora","Eleanore","Eleazar","Electa","Elena","Elenor","Elenora","Eleonore","Elfrieda","Eli","Elian","Eliane","Elias","Eliezer","Elijah","Elinor","Elinore","Elisa","Elisabeth","Elise","Eliseo","Elisha","Elissa","Eliza","Elizabeth","Ella","Ellen","Ellie","Elliot","Elliott","Ellis","Ellsworth","Elmer","Elmira","Elmo","Elmore","Elna","Elnora","Elody","Eloisa","Eloise","Elouise","Eloy","Elroy","Elsa","Else","Elsie","Elta","Elton","Elva","Elvera","Elvie","Elvis","Elwin","Elwyn","Elyse","Elyssa","Elza","Emanuel","Emelia","Emelie","Emely","Emerald","Emerson","Emery","Emie","Emil","Emile","Emilia","Emiliano","Emilie","Emilio","Emily","Emma","Emmalee","Emmanuel","Emmanuelle","Emmet","Emmett","Emmie","Emmitt","Emmy","Emory","Ena","Enid","Enoch","Enola","Enos","Enrico","Enrique","Ephraim","Era","Eriberto","Eric","Erica","Erich","Erick","Ericka","Erik","Erika","Erin","Erling","Erna","Ernest","Ernestina","Ernestine","Ernesto","Ernie","Ervin","Erwin","Eryn","Esmeralda","Esperanza","Esta","Esteban","Estefania","Estel","Estell","Estella","Estelle","Estevan","Esther","Estrella","Etha","Ethan","Ethel","Ethelyn","Ethyl","Ettie","Eudora","Eugene","Eugenia","Eula","Eulah","Eulalia","Euna","Eunice","Eusebio","Eva","Evalyn","Evan","Evangeline","Evans","Eve","Eveline","Evelyn","Everardo","Everett","Everette","Evert","Evie","Ewald","Ewell","Ezekiel","Ezequiel","Ezra","Fabian","Fabiola","Fae","Fannie","Fanny","Fatima","Faustino","Fausto","Favian","Fay","Faye","Federico","Felicia","Felicita","Felicity","Felipa","Felipe","Felix","Felton","Fermin","Fern","Fernando","Ferne","Fidel","Filiberto","Filomena","Finn","Fiona","Flavie","Flavio","Fleta","Fletcher","Flo","Florence","Florencio","Florian","Florida","Florine","Flossie","Floy","Floyd","Ford","Forest","Forrest","Foster","Frances","Francesca","Francesco","Francis","Francisca","Francisco","Franco","Frank","Frankie","Franz","Fred","Freda","Freddie","Freddy","Frederic","Frederick","Frederik","Frederique","Fredrick","Fredy","Freeda","Freeman","Freida","Frida","Frieda","Friedrich","Fritz","Furman","Gabe","Gabriel","Gabriella","Gabrielle","Gaetano","Gage","Gail","Gardner","Garett","Garfield","Garland","Garnet","Garnett","Garret","Garrett","Garrick","Garrison","Garry","Garth","Gaston","Gavin","Gay","Gayle","Gaylord","Gene","General","Genesis","Genevieve","Gennaro","Genoveva","Geo","Geoffrey","George","Georgette","Georgiana","Georgianna","Geovanni","Geovanny","Geovany","Gerald","Geraldine","Gerard","Gerardo","Gerda","Gerhard","Germaine","German","Gerry","Gerson","Gertrude","Gia","Gianni","Gideon","Gilbert","Gilberto","Gilda","Giles","Gillian","Gina","Gino","Giovani","Giovanna","Giovanni","Giovanny","Gisselle","Giuseppe","Gladyce","Gladys","Glen","Glenda","Glenna","Glennie","Gloria","Godfrey","Golda","Golden","Gonzalo","Gordon","Grace","Gracie","Graciela","Grady","Graham","Grant","Granville","Grayce","Grayson","Green","Greg","Gregg","Gregoria","Gregorio","Gregory","Greta","Gretchen","Greyson","Griffin","Grover","Guadalupe","Gudrun","Guido","Guillermo","Guiseppe","Gunnar","Gunner","Gus","Gussie","Gust","Gustave","Guy","Gwen","Gwendolyn","Hadley","Hailee","Hailey","Hailie","Hal","Haleigh","Haley","Halie","Halle","Hallie","Hank","Hanna","Hannah","Hans","Hardy","Harley","Harmon","Harmony","Harold","Harrison","Harry","Harvey","Haskell","Hassan","Hassie","Hattie","Haven","Hayden","Haylee","Hayley","Haylie","Hazel","Hazle","Heath","Heather","Heaven","Heber","Hector","Heidi","Helen","Helena","Helene","Helga","Hellen","Helmer","Heloise","Henderson","Henri","Henriette","Henry","Herbert","Herman","Hermann","Hermina","Herminia","Herminio","Hershel","Herta","Hertha","Hester","Hettie","Hilario","Hilbert","Hilda","Hildegard","Hillard","Hillary","Hilma","Hilton","Hipolito","Hiram","Hobart","Holden","Hollie","Hollis","Holly","Hope","Horace","Horacio","Hortense","Hosea","Houston","Howard","Howell","Hoyt","Hubert","Hudson","Hugh","Hulda","Humberto","Hunter","Hyman","Ian","Ibrahim","Icie","Ida","Idell","Idella","Ignacio","Ignatius","Ike","Ila","Ilene","Iliana","Ima","Imani","Imelda","Immanuel","Imogene","Ines","Irma","Irving","Irwin","Isaac","Isabel","Isabell","Isabella","Isabelle","Isac","Isadore","Isai","Isaiah","Isaias","Isidro","Ismael","Isobel","Isom","Israel","Issac","Itzel","Iva","Ivah","Ivory","Ivy","Izabella","Izaiah","Jabari","Jace","Jacey","Jacinthe","Jacinto","Jack","Jackeline","Jackie","Jacklyn","Jackson","Jacky","Jaclyn","Jacquelyn","Jacques","Jacynthe","Jada","Jade","Jaden","Jadon","Jadyn","Jaeden","Jaida","Jaiden","Jailyn","Jaime","Jairo","Jakayla","Jake","Jakob","Jaleel","Jalen","Jalon","Jalyn","Jamaal","Jamal","Jamar","Jamarcus","Jamel","Jameson","Jamey","Jamie","Jamil","Jamir","Jamison","Jammie","Jan","Jana","Janae","Jane","Janelle","Janessa","Janet","Janice","Janick","Janie","Janis","Janiya","Jannie","Jany","Jaquan","Jaquelin","Jaqueline","Jared","Jaren","Jarod","Jaron","Jarred","Jarrell","Jarret","Jarrett","Jarrod","Jarvis","Jasen","Jasmin","Jason","Jasper","Jaunita","Javier","Javon","Javonte","Jay","Jayce","Jaycee","Jayda","Jayde","Jayden","Jaydon","Jaylan","Jaylen","Jaylin","Jaylon","Jayme","Jayne","Jayson","Jazlyn","Jazmin","Jazmyn","Jazmyne","Jean","Jeanette","Jeanie","Jeanne","Jed","Jedediah","Jedidiah","Jeff","Jefferey","Jeffery","Jeffrey","Jeffry","Jena","Jenifer","Jennie","Jennifer","Jennings","Jennyfer","Jensen","Jerad","Jerald","Jeramie","Jeramy","Jerel","Jeremie","Jeremy","Jermain","Jermaine","Jermey","Jerod","Jerome","Jeromy","Jerrell","Jerrod","Jerrold","Jerry","Jess","Jesse","Jessica","Jessie","Jessika","Jessy","Jessyca","Jesus","Jett","Jettie","Jevon","Jewel","Jewell","Jillian","Jimmie","Jimmy","Jo","Joan","Joana","Joanie","Joanne","Joannie","Joanny","Joany","Joaquin","Jocelyn","Jodie","Jody","Joe","Joel","Joelle","Joesph","Joey","Johan","Johann","Johanna","Johathan","John","Johnathan","Johnathon","Johnnie","Johnny","Johnpaul","Johnson","Jolie","Jon","Jonas","Jonatan","Jonathan","Jonathon","Jordan","Jordane","Jordi","Jordon","Jordy","Jordyn","Jorge","Jose","Josefa","Josefina","Joseph","Josephine","Josh","Joshua","Joshuah","Josiah","Josiane","Josianne","Josie","Josue","Jovan","Jovani","Jovanny","Jovany","Joy","Joyce","Juana","Juanita","Judah","Judd","Jude","Judge","Judson","Judy","Jules","Julia","Julian","Juliana","Julianne","Julie","Julien","Juliet","Julio","Julius","June","Junior","Junius","Justen","Justice","Justina","Justine","Juston","Justus","Justyn","Juvenal","Juwan","Kacey","Kaci","Kacie","Kade","Kaden","Kadin","Kaela","Kaelyn","Kaia","Kailee","Kailey","Kailyn","Kaitlin","Kaitlyn","Kale","Kaleb","Kaleigh","Kaley","Kali","Kallie","Kameron","Kamille","Kamren","Kamron","Kamryn","Kane","Kara","Kareem","Karelle","Karen","Kari","Kariane","Karianne","Karina","Karine","Karl","Karlee","Karley","Karli","Karlie","Karolann","Karson","Kasandra","Kasey","Kassandra","Katarina","Katelin","Katelyn","Katelynn","Katharina","Katherine","Katheryn","Kathleen","Kathlyn","Kathryn","Kathryne","Katlyn","Katlynn","Katrina","Katrine","Kattie","Kavon","Kay","Kaya","Kaycee","Kayden","Kayla","Kaylah","Kaylee","Kayleigh","Kayley","Kayli","Kaylie","Kaylin","Keagan","Keanu","Keara","Keaton","Keegan","Keeley","Keely","Keenan","Keira","Keith","Kellen","Kelley","Kelli","Kellie","Kelly","Kelsi","Kelsie","Kelton","Kelvin","Ken","Kendall","Kendra","Kendrick","Kenna","Kennedi","Kennedy","Kenneth","Kennith","Kenny","Kenton","Kenya","Kenyatta","Kenyon","Keon","Keshaun","Keshawn","Keven","Kevin","Kevon","Keyon","Keyshawn","Khalid","Khalil","Kian","Kiana","Kianna","Kiara","Kiarra","Kiel","Kiera","Kieran","Kiley","Kim","Kimberly","King","Kip","Kira","Kirk","Kirsten","Kirstin","Kitty","Kobe","Koby","Kody","Kolby","Kole","Korbin","Korey","Kory","Kraig","Kris","Krista","Kristian","Kristin","Kristina","Kristofer","Kristoffer","Kristopher","Kristy","Krystal","Krystel","Krystina","Kurt","Kurtis","Kyla","Kyle","Kylee","Kyleigh","Kyler","Kylie","Kyra","Lacey","Lacy","Ladarius","Lafayette","Laila","Laisha","Lamar","Lambert","Lamont","Lance","Landen","Lane","Laney","Larissa","Laron","Larry","Larue","Laura","Laurel","Lauren","Laurence","Lauretta","Lauriane","Laurianne","Laurie","Laurine","Laury","Lauryn","Lavada","Lavern","Laverna","Laverne","Lavina","Lavinia","Lavon","Lavonne","Lawrence","Lawson","Layla","Layne","Lazaro","Lea","Leann","Leanna","Leanne","Leatha","Leda","Lee","Leif","Leila","Leilani","Lela","Lelah","Leland","Lelia","Lempi","Lemuel","Lenna","Lennie","Lenny","Lenora","Lenore","Leo","Leola","Leon","Leonard","Leonardo","Leone","Leonel","Leonie","Leonor","Leonora","Leopold","Leopoldo","Leora","Lera","Lesley","Leslie","Lesly","Lessie","Lester","Leta","Letha","Letitia","Levi","Lew","Lewis","Lexi","Lexie","Lexus","Lia","Liam","Liana","Libbie","Libby","Lila","Lilian","Liliana","Liliane","Lilla","Lillian","Lilliana","Lillie","Lilly","Lily","Lilyan","Lina","Lincoln","Linda","Lindsay","Lindsey","Linnea","Linnie","Linwood","Lionel","Lisa","Lisandro","Lisette","Litzy","Liza","Lizeth","Lizzie","Llewellyn","Lloyd","Logan","Lois","Lola","Lolita","Loma","Lon","London","Lonie","Lonnie","Lonny","Lonzo","Lora","Loraine","Loren","Lorena","Lorenz","Lorenza","Lorenzo","Lori","Lorine","Lorna","Lottie","Lou","Louie","Louisa","Lourdes","Louvenia","Lowell","Loy","Loyal","Loyce","Lucas","Luciano","Lucie","Lucienne","Lucile","Lucinda","Lucio","Lucious","Lucius","Lucy","Ludie","Ludwig","Lue","Luella","Luigi","Luis","Luisa","Lukas","Lula","Lulu","Luna","Lupe","Lura","Lurline","Luther","Luz","Lyda","Lydia","Lyla","Lynn","Lyric","Lysanne","Mabel","Mabelle","Mable","Mac","Macey","Maci","Macie","Mack","Mackenzie","Macy","Madaline","Madalyn","Maddison","Madeline","Madelyn","Madelynn","Madge","Madie","Madilyn","Madisen","Madison","Madisyn","Madonna","Madyson","Mae","Maegan","Maeve","Mafalda","Magali","Magdalen","Magdalena","Maggie","Magnolia","Magnus","Maia","Maida","Maiya","Major","Makayla","Makenna","Makenzie","Malachi","Malcolm","Malika","Malinda","Mallie","Mallory","Malvina","Mandy","Manley","Manuel","Manuela","Mara","Marc","Marcel","Marcelina","Marcelino","Marcella","Marcelle","Marcellus","Marcelo","Marcia","Marco","Marcos","Marcus","Margaret","Margarete","Margarett","Margaretta","Margarette","Margarita","Marge","Margie","Margot","Margret","Marguerite","Maria","Mariah","Mariam","Marian","Mariana","Mariane","Marianna","Marianne","Mariano","Maribel","Marie","Mariela","Marielle","Marietta","Marilie","Marilou","Marilyne","Marina","Mario","Marion","Marisa","Marisol","Maritza","Marjolaine","Marjorie","Marjory","Mark","Markus","Marlee","Marlen","Marlene","Marley","Marlin","Marlon","Marques","Marquis","Marquise","Marshall","Marta","Martin","Martina","Martine","Marty","Marvin","Mary","Maryam","Maryjane","Maryse","Mason","Mateo","Mathew","Mathias","Mathilde","Matilda","Matilde","Matt","Matteo","Mattie","Maud","Maude","Maudie","Maureen","Maurice","Mauricio","Maurine","Maverick","Mavis","Max","Maxie","Maxime","Maximilian","Maximillia","Maximillian","Maximo","Maximus","Maxine","Maxwell","May","Maya","Maybell","Maybelle","Maye","Maymie","Maynard","Mayra","Mazie","Mckayla","Mckenna","Mckenzie","Meagan","Meaghan","Meda","Megane","Meggie","Meghan","Mekhi","Melany","Melba","Melisa","Melissa","Mellie","Melody","Melvin","Melvina","Melyna","Melyssa","Mercedes","Meredith","Merl","Merle","Merlin","Merritt","Mertie","Mervin","Meta","Mia","Micaela","Micah","Michael","Michaela","Michale","Micheal","Michel","Michele","Michelle","Miguel","Mikayla","Mike","Mikel","Milan","Miles","Milford","Miller","Millie","Milo","Milton","Mina","Minerva","Minnie","Miracle","Mireille","Mireya","Misael","Missouri","Misty","Mitchel","Mitchell","Mittie","Modesta","Modesto","Mohamed","Mohammad","Mohammed","Moises","Mollie","Molly","Mona","Monica","Monique","Monroe","Monserrat","Monserrate","Montana","Monte","Monty","Morgan","Moriah","Morris","Mortimer","Morton","Mose","Moses","Moshe","Mossie","Mozell","Mozelle","Muhammad","Muriel","Murl","Murphy","Murray","Mustafa","Mya","Myah","Mylene","Myles","Myra","Myriam","Myrl","Myrna","Myron","Myrtice","Myrtie","Myrtis","Myrtle","Nadia","Nakia","Name","Nannie","Naomi","Naomie","Napoleon","Narciso","Nash","Nasir","Nat","Natalia","Natalie","Natasha","Nathan","Nathanael","Nathanial","Nathaniel","Nathen","Nayeli","Neal","Ned","Nedra","Neha","Neil","Nelda","Nella","Nelle","Nellie","Nels","Nelson","Neoma","Nestor","Nettie","Neva","Newell","Newton","Nia","Nicholas","Nicholaus","Nichole","Nick","Nicklaus","Nickolas","Nico","Nicola","Nicolas","Nicole","Nicolette","Nigel","Nikita","Nikki","Nikko","Niko","Nikolas","Nils","Nina","Noah","Noble","Noe","Noel","Noelia","Noemi","Noemie","Noemy","Nola","Nolan","Nona","Nora","Norbert","Norberto","Norene","Norma","Norris","Norval","Norwood","Nova","Novella","Nya","Nyah","Nyasia","Obie","Oceane","Ocie","Octavia","Oda","Odell","Odessa","Odie","Ofelia","Okey","Ola","Olaf","Ole","Olen","Oleta","Olga","Olin","Oliver","Ollie","Oma","Omari","Omer","Ona","Onie","Opal","Ophelia","Ora","Oral","Oran","Oren","Orie","Orin","Orion","Orland","Orlando","Orlo","Orpha","Orrin","Orval","Orville","Osbaldo","Osborne","Oscar","Osvaldo","Oswald","Oswaldo","Otha","Otho","Otilia","Otis","Ottilie","Ottis","Otto","Ova","Owen","Ozella","Pablo","Paige","Palma","Pamela","Pansy","Paolo","Paris","Parker","Pascale","Pasquale","Pat","Patience","Patricia","Patrick","Patsy","Pattie","Paul","Paula","Pauline","Paxton","Payton","Pearl","Pearlie","Pearline","Pedro","Peggie","Penelope","Percival","Percy","Perry","Pete","Peter","Petra","Peyton","Philip","Phoebe","Phyllis","Pierce","Pierre","Pietro","Pink","Pinkie","Piper","Polly","Porter","Precious","Presley","Preston","Price","Prince","Princess","Priscilla","Providenci","Prudence","Queen","Queenie","Quentin","Quincy","Quinn","Quinten","Quinton","Rachael","Rachel","Rachelle","Rae","Raegan","Rafael","Rafaela","Raheem","Rahsaan","Rahul","Raina","Raleigh","Ralph","Ramiro","Ramon","Ramona","Randal","Randall","Randi","Randy","Ransom","Raoul","Raphael","Raphaelle","Raquel","Rashad","Rashawn","Rasheed","Raul","Raven","Ray","Raymond","Raymundo","Reagan","Reanna","Reba","Rebeca","Rebecca","Rebeka","Rebekah","Reece","Reed","Reese","Regan","Reggie","Reginald","Reid","Reilly","Reina","Reinhold","Remington","Rene","Renee","Ressie","Reta","Retha","Retta","Reuben","Reva","Rex","Rey","Reyes","Reymundo","Reyna","Reynold","Rhea","Rhett","Rhianna","Rhiannon","Rhoda","Ricardo","Richard","Richie","Richmond","Rick","Rickey","Rickie","Ricky","Rico","Rigoberto","Riley","Rita","River","Robb","Robbie","Robert","Roberta","Roberto","Robin","Robyn","Rocio","Rocky","Rod","Roderick","Rodger","Rodolfo","Rodrick","Rodrigo","Roel","Rogelio","Roger","Rogers","Rolando","Rollin","Roma","Romaine","Roman","Ron","Ronaldo","Ronny","Roosevelt","Rory","Rosa","Rosalee","Rosalia","Rosalind","Rosalinda","Rosalyn","Rosamond","Rosanna","Rosario","Roscoe","Rose","Rosella","Roselyn","Rosemarie","Rosemary","Rosendo","Rosetta","Rosie","Rosina","Roslyn","Ross","Rossie","Rowan","Rowena","Rowland","Roxane","Roxanne","Roy","Royal","Royce","Rozella","Ruben","Rubie","Ruby","Rubye","Rudolph","Rudy","Rupert","Russ","Russel","Russell","Rusty","Ruth","Ruthe","Ruthie","Ryan","Ryann","Ryder","Rylan","Rylee","Ryleigh","Ryley","Sabina","Sabrina","Sabryna","Sadie","Sadye","Sage","Saige","Sallie","Sally","Salma","Salvador","Salvatore","Sam","Samanta","Samantha","Samara","Samir","Sammie","Sammy","Samson","Sandra","Sandrine","Sandy","Sanford","Santa","Santiago","Santina","Santino","Santos","Sarah","Sarai","Sarina","Sasha","Saul","Savanah","Savanna","Savannah","Savion","Scarlett","Schuyler","Scot","Scottie","Scotty","Seamus","Sean","Sebastian","Sedrick","Selena","Selina","Selmer","Serena","Serenity","Seth","Shad","Shaina","Shakira","Shana","Shane","Shanel","Shanelle","Shania","Shanie","Shaniya","Shanna","Shannon","Shanny","Shanon","Shany","Sharon","Shaun","Shawn","Shawna","Shaylee","Shayna","Shayne","Shea","Sheila","Sheldon","Shemar","Sheridan","Sherman","Sherwood","Shirley","Shyann","Shyanne","Sibyl","Sid","Sidney","Sienna","Sierra","Sigmund","Sigrid","Sigurd","Silas","Sim","Simeon","Simone","Sincere","Sister","Skye","Skyla","Skylar","Sofia","Soledad","Solon","Sonia","Sonny","Sonya","Sophia","Sophie","Spencer","Stacey","Stacy","Stan","Stanford","Stanley","Stanton","Stefan","Stefanie","Stella","Stephan","Stephania","Stephanie","Stephany","Stephen","Stephon","Sterling","Steve","Stevie","Stewart","Stone","Stuart","Summer","Sunny","Susan","Susana","Susanna","Susie","Suzanne","Sven","Syble","Sydnee","Sydney","Sydni","Sydnie","Sylvan","Sylvester","Sylvia","Tabitha","Tad","Talia","Talon","Tamara","Tamia","Tania","Tanner","Tanya","Tara","Taryn","Tate","Tatum","Tatyana","Taurean","Tavares","Taya","Taylor","Teagan","Ted","Telly","Terence","Teresa","Terrance","Terrell","Terrence","Terrill","Terry","Tess","Tessie","Tevin","Thad","Thaddeus","Thalia","Thea","Thelma","Theo","Theodora","Theodore","Theresa","Therese","Theresia","Theron","Thomas","Thora","Thurman","Tia","Tiana","Tianna","Tiara","Tierra","Tiffany","Tillman","Timmothy","Timmy","Timothy","Tina","Tito","Titus","Tobin","Toby","Tod","Tom","Tomas","Tomasa","Tommie","Toney","Toni","Tony","Torey","Torrance","Torrey","Toy","Trace","Tracey","Tracy","Travis","Travon","Tre","Tremaine","Tremayne","Trent","Trenton","Tressa","Tressie","Treva","Trever","Trevion","Trevor","Trey","Trinity","Trisha","Tristian","Tristin","Triston","Troy","Trudie","Trycia","Trystan","Turner","Twila","Tyler","Tyra","Tyree","Tyreek","Tyrel","Tyrell","Tyrese","Tyrique","Tyshawn","Tyson","Ubaldo","Ulices","Ulises","Una","Unique","Urban","Uriah","Uriel","Ursula","Vada","Valentin","Valentina","Valentine","Valerie","Vallie","Van","Vance","Vanessa","Vaughn","Veda","Velda","Vella","Velma","Velva","Vena","Verda","Verdie","Vergie","Verla","Verlie","Vern","Verna","Verner","Vernice","Vernie","Vernon","Verona","Veronica","Vesta","Vicenta","Vicente","Vickie","Vicky","Victor","Victoria","Vida","Vidal","Vilma","Vince","Vincent","Vincenza","Vincenzo","Vinnie","Viola","Violet","Violette","Virgie","Virgil","Virginia","Virginie","Vita","Vito","Viva","Vivian","Viviane","Vivianne","Vivien","Vivienne","Vladimir","Wade","Waino","Waldo","Walker","Wallace","Walter","Walton","Wanda","Ward","Warren","Watson","Wava","Waylon","Wayne","Webster","Weldon","Wellington","Wendell","Wendy","Werner","Westley","Weston","Whitney","Wilber","Wilbert","Wilburn","Wiley","Wilford","Wilfred","Wilfredo","Wilfrid","Wilhelm","Wilhelmine","Will","Willa","Willard","William","Willie","Willis","Willow","Willy","Wilma","Wilmer","Wilson","Wilton","Winfield","Winifred","Winnifred","Winona","Winston","Woodrow","Wyatt","Wyman","Xander","Xavier","Xzavier","Yadira","Yasmeen","Yasmin","Yasmine","Yazmin","Yesenia","Yessenia","Yolanda","Yoshiko","Yvette","Yvonne","Zachariah","Zachary","Zachery","Zack","Zackary","Zackery","Zakary","Zander","Zane","Zaria","Zechariah","Zelda","Zella","Zelma","Zena","Zetta","Zion","Zita","Zoe","Zoey","Zoie","Zoila","Zola","Zora","Zula"];e.exports={generateUsername:function(){var e=r.randomElement(i),t=r.randomAlphanumStr(3);return"".concat(e,"-").concat(t)}}},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return h});var r=n(3),i=n(19),o=n(23),a=n(9);function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var c=n(10),u=n(4).getLogger(e),l={};function d(e,t){return!t||t<=0||!e||e<=0?0:Math.round(e/t*100)}function f(){this.loss={},this.bitrate={download:0,upload:0},this.resolution={},this.framerate=0}function p(){this.bandwidth={},this.bitrate={},this.packetLoss=null,this.transport=[]}function h(e,t,n,i){this._browserType=r.a.getName();var o=l[this._browserType];if(!o)throw"The browser type '".concat(this._browserType,"' isn't supported!");this._usesPromiseGetStats=r.a.isSafariWithWebrtc()||r.a.isFirefox(),this._getStatValue=this._usesPromiseGetStats?this._defineNewGetStatValueMethod(o):this._defineGetStatValueMethod(o),this.peerconnection=e,this.baselineAudioLevelsReport=null,this.currentAudioLevelsReport=null,this.currentStatsReport=null,this.previousStatsReport=null,this.audioLevelsIntervalId=null,this.eventEmitter=i,this.conferenceStats=new p,this.audioLevelsIntervalMilis=t,this.statsIntervalId=null,this.statsIntervalMilis=n,this.ssrc2stats=new Map}l[i.b.FIREFOX]={ssrc:"ssrc",packetsReceived:"packetsReceived",packetsLost:"packetsLost",packetsSent:"packetsSent",bytesReceived:"bytesReceived",bytesSent:"bytesSent",framerateMean:"framerateMean",ip:"ipAddress",port:"portNumber",protocol:"transport"},l[i.b.CHROME]={receiveBandwidth:"googAvailableReceiveBandwidth",sendBandwidth:"googAvailableSendBandwidth",remoteAddress:"googRemoteAddress",transportType:"googTransportType",localAddress:"googLocalAddress",activeConnection:"googActiveConnection",ssrc:"ssrc",packetsReceived:"packetsReceived",packetsSent:"packetsSent",packetsLost:"packetsLost",bytesReceived:"bytesReceived",bytesSent:"bytesSent",googFrameHeightReceived:"googFrameHeightReceived",googFrameWidthReceived:"googFrameWidthReceived",googFrameHeightSent:"googFrameHeightSent",googFrameWidthSent:"googFrameWidthSent",googFrameRateReceived:"googFrameRateReceived",googFrameRateSent:"googFrameRateSent",audioInputLevel:"audioInputLevel",audioOutputLevel:"audioOutputLevel",currentRoundTripTime:"googRtt",remoteCandidateType:"googRemoteCandidateType",localCandidateType:"googLocalCandidateType",ip:"ip",port:"port",protocol:"protocol"},l[i.b.EDGE]={sendBandwidth:"googAvailableSendBandwidth",remoteAddress:"remoteAddress",transportType:"protocol",localAddress:"localAddress",activeConnection:"activeConnection",ssrc:"ssrc",packetsReceived:"packetsReceived",packetsSent:"packetsSent",packetsLost:"packetsLost",bytesReceived:"bytesReceived",bytesSent:"bytesSent",googFrameHeightReceived:"frameHeight",googFrameWidthReceived:"frameWidth",googFrameHeightSent:"frameHeight",googFrameWidthSent:"frameWidth",googFrameRateReceived:"framesPerSecond",googFrameRateSent:"framesPerSecond",audioInputLevel:"audioLevel",audioOutputLevel:"audioLevel",currentRoundTripTime:"roundTripTime"},l[i.b.OPERA]=l[i.b.CHROME],l[i.b.NWJS]=l[i.b.CHROME],l[i.b.ELECTRON]=l[i.b.CHROME],l[i.b.SAFARI]=l[i.b.CHROME],l[i.b.REACT_NATIVE]=l[i.b.CHROME],f.prototype.setLoss=function(e){this.loss=e||{}},f.prototype.setResolution=function(e){this.resolution=e||{}},f.prototype.addBitrate=function(e){this.bitrate.download+=e.download,this.bitrate.upload+=e.upload},f.prototype.resetBitrate=function(){this.bitrate.download=0,this.bitrate.upload=0},f.prototype.setFramerate=function(e){this.framerate=e||0},h.prototype.stop=function(){this.audioLevelsIntervalId&&(clearInterval(this.audioLevelsIntervalId),this.audioLevelsIntervalId=null),this.statsIntervalId&&(clearInterval(this.statsIntervalId),this.statsIntervalId=null)},h.prototype.errorCallback=function(e){c.callErrorHandler(e),u.error("Get stats error",e),this.stop()},h.prototype.start=function(e){var t=this,n=this;e&&(this.audioLevelsIntervalId=setInterval(function(){n.peerconnection.getStats(function(e){var r=null;r=e&&e.result&&"function"==typeof e.result?e.result():e,n.currentAudioLevelsReport=r,t._usesPromiseGetStats?n.processNewAudioLevelReport():n.processAudioLevelReport(),n.baselineAudioLevelsReport=n.currentAudioLevelsReport},function(e){return n.errorCallback(e)})},n.audioLevelsIntervalMilis)),r.a.supportsRtpStatistics()&&(this.statsIntervalId=setInterval(function(){n.peerconnection.getStats(function(e){var r=null;r=e&&e.result&&"function"==typeof e.result?e.result():e,n.currentStatsReport=r;try{t._usesPromiseGetStats?n.processNewStatsReport():n.processStatsReport()}catch(e){c.callErrorHandler(e),u.error("Unsupported key:".concat(e),e)}n.previousStatsReport=n.currentStatsReport},function(e){return n.errorCallback(e)})},n.statsIntervalMilis))},h.prototype._defineGetStatValueMethod=function(e){var t;switch(this._browserType){case i.b.CHROME:case i.b.OPERA:case i.b.NWJS:case i.b.ELECTRON:t=function(e,t){return e.stat(t)};break;case i.b.REACT_NATIVE:t=function(e,t){var n;return e.values.some(function(e){return!!e.hasOwnProperty(t)&&(n=e[t],!0)}),n};break;case i.b.EDGE:t=function(e,t){return e[t]};break;default:t=function(e,t){return e[t]}}return function(n,r){return t(n,function(t){var n=e[t];if(n)return n;throw"The property '".concat(t,"' isn't supported!")}(r))}},h.prototype.getNonNegativeStat=function(e,t){var n=this._getStatValue(e,t);return"number"!=typeof n&&(n=Number(n)),isNaN(n)?0:Math.max(0,n)},h.prototype.processStatsReport=function(){var e=this;if(this.previousStatsReport){var t=this._getStatValue,n={};for(var i in this.currentStatsReport)if(this.currentStatsReport.hasOwnProperty(i)){var a=this.currentStatsReport[i];if(a){try{var s=t(a,"receiveBandwidth"),c=t(a,"sendBandwidth");(s||c)&&(this.conferenceStats.bandwidth={download:Math.round(s/1e3),upload:Math.round(c/1e3)})}catch(e){}if("googCandidatePair"===a.type)if("continue"===function(){var n=void 0,r=void 0,i=void 0,o=void 0,s=void 0,c=void 0,u=void 0;try{if(!(n=t(a,"activeConnection")))return"continue";r=t(a,"remoteAddress"),u=t(a,"transportType"),o=t(a,"localAddress"),i=t(a,"localCandidateType"),s=t(a,"remoteCandidateType"),c=e.getNonNegativeStat(a,"currentRoundTripTime")}catch(e){}if(!r||!u||!o||"true"!==n)return"continue";var l=e.conferenceStats.transport;return l.some(function(e){return e.ip===r&&e.type===u&&e.localip===o})||l.push({ip:r,type:u,localip:o,p2p:e.peerconnection.isP2P,localCandidateType:i,remoteCandidateType:s,rtt:c}),"continue"}())continue;if("candidatepair"===a.type){if("succeeded"!==a.state||!a.selected)continue;var l=this.currentStatsReport[a.localCandidateId],d=this.currentStatsReport[a.remoteCandidateId];this.conferenceStats.transport.push({ip:"".concat(d.ipAddress,":").concat(d.portNumber),type:l.transport,localip:"".concat(l.ipAddress,":").concat(l.portNumber),p2p:this.peerconnection.isP2P,localCandidateType:l.candidateType,remoteCandidateType:d.candidateType})}if("transportdiagnostics"===a.msType&&this.conferenceStats.transport.push({ip:a.remoteAddress,type:a.protocol,localip:a.localAddress,p2p:this.peerconnection.isP2P}),("ssrc"===a.type||"outboundrtp"===a.type||"inboundrtp"===a.type||"track"===a.type)&&(!r.a.isEdge()||"inboundrtp"!==a.type&&"outboundrtp"!==a.type)){var p=this.previousStatsReport[i],h=this.getNonNegativeStat(a,"ssrc");if("track"===a.type&&Array.isArray(a.ssrcIds)&&(h=Number(a.ssrcIds[0])),p&&h&&(r.a.isEdge()||!0!==a.isRemote&&!0!==a.remoteSource)){var v=this.ssrc2stats.get(h);v||(v=new f,this.ssrc2stats.set(h,v));var m=!0,g="packetsReceived",y=t(a,g);null!=y&&""!==y||(m=!1,null==(y=t(a,g="packetsSent"))&&u.warn("No packetsReceived nor packetsSent stat found")),(!y||y<0)&&(y=0);var b=this.getNonNegativeStat(p,g),S=Math.max(0,y-b),_=this.getNonNegativeStat(a,"packetsLost"),E=this.getNonNegativeStat(p,"packetsLost"),C=Math.max(0,_-E);v.setLoss({packetsTotal:S+C,packetsLost:C,isDownloadStream:m});var T=this.getNonNegativeStat(a,"bytesReceived"),w=this.getNonNegativeStat(p,"bytesReceived"),k=Math.max(0,T-w),R=0,P=t(a,"bytesSent");"number"!=typeof P&&"string"!=typeof P||(P=Number(P),isNaN(P)||(n[h]=P,P>0&&(R=P-t(p,"bytesSent")))),R=Math.max(0,R);var I=a.timestamp-p.timestamp,O=0,A=0;I>0&&(O=Math.round(8*k/I),A=Math.round(8*R/I)),v.addBitrate({download:O,upload:A});var M={height:null,width:null};try{var D=void 0,N=void 0;(D=t(a,"googFrameHeightReceived"))&&(N=t(a,"googFrameWidthReceived"))?(M.height=D,M.width=N):(D=t(a,"googFrameHeightSent"))&&(N=t(a,"googFrameWidthSent"))&&(M.height=D,M.width=N)}catch(e){}var x=void 0;try{x=t(a,"googFrameRateReceived")||t(a,"googFrameRateSent")||0}catch(e){try{x=this.getNonNegativeStat(a,"framerateMean")}catch(e){}}v.setFramerate(Math.round(x||0)),M.height&&M.width?v.setResolution(M):v.setResolution(null)}}}}this.eventEmitter.emit(o.c,this.peerconnection,n),this._processAndEmitReport()}},h.prototype._processAndEmitReport=function(){var e={download:0,upload:0},t={download:0,upload:0},n=0,r=0,i={},a={},c=0,l=0,f=0,p=0,h=!0,v=!1,m=void 0;try{for(var g,y=this.ssrc2stats[Symbol.iterator]();!(h=(g=y.next()).done);h=!0){var b=s(g.value,2),S=b[0],_=b[1],E=_.loss,C=E.isDownloadStream?"download":"upload";e[C]+=E.packetsTotal,t[C]+=E.packetsLost,n+=_.bitrate.download,r+=_.bitrate.upload;var T=this.peerconnection.getTrackBySSRC(S);if(T){T.isAudioTrack()?(c+=_.bitrate.download,l+=_.bitrate.upload):(f+=_.bitrate.download,p+=_.bitrate.upload);var w=T.getParticipantId();if(w){var k=_.resolution;if(k.width&&k.height&&-1!==k.width&&-1!==k.height){var R=i[w]||{};R[S]=k,i[w]=R}if(0!==_.framerate){var P=a[w]||{};P[S]=_.framerate,a[w]=P}}else u.error("No participant ID returned by ".concat(T))}else this.peerconnection.isP2P&&u.error("JitsiTrack not found for SSRC ".concat(S)+" in ".concat(this.peerconnection));_.resetBitrate()}}catch(e){v=!0,m=e}finally{try{h||null==y.return||y.return()}finally{if(v)throw m}}this.conferenceStats.bitrate={upload:r,download:n},this.conferenceStats.bitrate.audio={upload:l,download:c},this.conferenceStats.bitrate.video={upload:p,download:f},this.conferenceStats.packetLoss={total:d(t.download+t.upload,e.download+e.upload),download:d(t.download,e.download),upload:d(t.upload,e.upload)},this.eventEmitter.emit(o.d,this.peerconnection,{bandwidth:this.conferenceStats.bandwidth,bitrate:this.conferenceStats.bitrate,packetLoss:this.conferenceStats.packetLoss,resolution:i,framerate:a,transport:this.conferenceStats.transport}),this.conferenceStats.transport=[]},h.prototype.processAudioLevelReport=function(){if(this.baselineAudioLevelsReport){var e=this._getStatValue;for(var t in this.currentAudioLevelsReport)if(this.currentAudioLevelsReport.hasOwnProperty(t)){var n=this.currentAudioLevelsReport[t];if("ssrc"===n.type||"track"===n.type){var i=this.baselineAudioLevelsReport[t],a=this.getNonNegativeStat(n,"ssrc");if(!a&&Array.isArray(n.ssrcIds)&&(a=Number(n.ssrcIds[0])),i)if(a){var s=void 0;try{s=e(n,"audioInputLevel")||e(n,"audioOutputLevel")}catch(e){return u.warn("Audio Levels are not available in the statistics."),void clearInterval(this.audioLevelsIntervalId)}if(s){var c=void 0;c="ssrc"===n.type?!e(n,"packetsReceived"):!n.remoteSource,r.a.isEdge()?s=s<0?Math.pow(10,s/20):0:s/=32767,this.eventEmitter.emit(o.a,this.peerconnection,a,s,c)}}else Date.now()-n.timestamp<3e3&&u.warn("No ssrc: ");else u.warn("".concat(a," not enough data"))}}}},h.prototype._defineNewGetStatValueMethod=function(e){return function(t,n){return t[function(t){var n=e[t];if(n)return n;throw"The property '".concat(t,"' isn't supported!")}(n)]}},h.prototype.getNonNegativeValue=function(e){var t=e;return"number"!=typeof t&&(t=Number(t)),isNaN(t)?0:Math.max(0,t)},h.prototype._calculateBitrate=function(e,t,n){var r=this.getNonNegativeValue(e[n]),i=this.getNonNegativeValue(t[n]),o=Math.max(0,r-i),a=e.timestamp-t.timestamp,s=0;return a>0&&(s=Math.round(8*o/a)),s},h.prototype.processNewStatsReport=function(){var e=this;if(this.previousStatsReport){var t=this._getStatValue,n={};this.currentStatsReport.forEach(function(r){if("candidate-pair"===r.type&&r.nominated&&"succeeded"===r.state){var i=r.availableIncomingBitrate,o=r.availableOutgoingBitrate;(i||o)&&(e.conferenceStats.bandwidth={download:Math.round(i/1e3),upload:Math.round(o/1e3)});var a=e.currentStatsReport.get(r.remoteCandidateId),s=e.currentStatsReport.get(r.localCandidateId);if(a&&s){var c=t(a,"ip"),u=t(a,"port"),l="".concat(c,":").concat(u),d=t(s,"ip"),p=t(s,"port"),h="".concat(d,":").concat(p),v=t(a,"protocol"),m=e.conferenceStats.transport;m.some(function(e){return e.ip===l&&e.type===v&&e.localip===h})||m.push({ip:l,type:v,localIp:h,p2p:e.peerconnection.isP2P,localCandidateType:s.candidateType,remoteCandidateType:a.candidateType,networkType:s.networkType,rtt:1e3*r.currentRoundTripTime})}}else if("inbound-rtp"===r.type||"outbound-rtp"===r.type){var g=e.previousStatsReport.get(r.id),y=e.getNonNegativeValue(r.ssrc);if(!g||!y)return;var b=e.ssrc2stats.get(y);b||(b=new f,e.ssrc2stats.set(y,b));var S=!0,_="packetsReceived";"outbound-rtp"===r.type&&(S=!1,_="packetsSent");var E=r[_];(!E||E<0)&&(E=0);var C=e.getNonNegativeValue(g[_]),T=Math.max(0,E-C),w=e.getNonNegativeValue(r.packetsLost),k=e.getNonNegativeValue(g.packetsLost),R=Math.max(0,w-k);b.setLoss({packetsTotal:T+R,packetsLost:R,isDownloadStream:S}),"inbound-rtp"===r.type?b.addBitrate({download:e._calculateBitrate(r,g,"bytesReceived"),upload:0}):(n[y]=e.getNonNegativeValue(r.bytesSent),b.addBitrate({download:0,upload:e._calculateBitrate(r,g,"bytesSent")}));var P=r.framerateMean;P&&b.setFramerate(Math.round(P||0))}else if("track"===r.type){var I={height:r.frameHeight,width:r.frameWidth},O=r.framesPerSecond;if(!O){var A=e.previousStatsReport.get(r.id);if(A){var M=r.timestamp-A.timestamp;if(M>0&&r.framesSent)O=(r.framesSent-A.framesSent)/M*1e3}if(!O)return}var D=r.trackIdentifier,N=e.peerconnection.getSsrcByTrackId(D),x=e.ssrc2stats.get(N);x||(x=new f,e.ssrc2stats.set(N,x)),x.setFramerate(Math.round(O||0)),I.height&&I.width?x.setResolution(I):x.setResolution(null)}}),this.eventEmitter.emit(o.c,this.peerconnection,n),this._processAndEmitReport()}},h.prototype.processNewAudioLevelReport=function(){var e=this;this.baselineAudioLevelsReport&&this.currentAudioLevelsReport.forEach(function(t){if("track"===t.type){var n=t.audioLevel;if(n){var r=t.trackIdentifier,i=e.peerconnection.getSsrcByTrackId(r);if(i){var s=i===e.peerconnection.getLocalSSRC(e.peerconnection.getLocalTracks(a.a));e.eventEmitter.emit(o.a,e.peerconnection,i,n,s)}}}})}}).call(this,"modules/statistics/RTPStatsCollector.js")},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n(1),i=n(2),o=n(44),a=n(9);function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(t,n,i,a,s,c){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._jid=t,this._id=r.Strophe.getResourceFromJid(t),this._conference=n,this._displayName=i,this._supportsDTMF=!1,this._tracks=[],this._role="none",this._status=c,this._hidden=a,this._statsID=s,this._connectionStatus=o.a.ACTIVE,this._properties={}}var t,n,c;return t=e,(n=[{key:"getConference",value:function(){return this._conference}},{key:"getProperty",value:function(e){return this._properties[e]}},{key:"hasAnyVideoTrackWebRTCMuted",value:function(){return this.getTracks().some(function(e){return e.getType()===a.b&&e.isWebRTCTrackMuted()})}},{key:"_setConnectionStatus",value:function(e){this._connectionStatus=e}},{key:"getConnectionStatus",value:function(){return this._connectionStatus}},{key:"setProperty",value:function(e,t){var n=this._properties[e];t!==n&&(this._properties[e]=t,this._conference.eventEmitter.emit(i.PARTICIPANT_PROPERTY_CHANGED,this,e,n,t))}},{key:"getTracks",value:function(){return this._tracks.slice()}},{key:"getTracksByMediaType",value:function(e){return this.getTracks().filter(function(t){return t.getType()===e})}},{key:"getId",value:function(){return this._id}},{key:"getJid",value:function(){return this._jid}},{key:"getDisplayName",value:function(){return this._displayName}},{key:"getStatsID",value:function(){return this._statsID}},{key:"getStatus",value:function(){return this._status}},{key:"isModerator",value:function(){return"moderator"===this._role}},{key:"isHidden",value:function(){return this._hidden}},{key:"isAudioMuted",value:function(){return this._isMediaTypeMuted(a.a)}},{key:"_isMediaTypeMuted",value:function(e){return this.getTracks().reduce(function(t,n){return t&&(n.getType()!==e||n.isMuted())},!0)}},{key:"isVideoMuted",value:function(){return this._isMediaTypeMuted(a.b)}},{key:"getRole",value:function(){return this._role}},{key:"supportsDTMF",value:function(){return this._supportsDTMF}},{key:"getFeatures",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5e3;return this._conference.xmpp.caps.getFeatures(this._jid,e)}},{key:"getBotType",value:function(){return this._botType}}])&&s(t.prototype,n),c&&s(t,c),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(22),i=n(43);function o(e){var t,n=this,o=e.id,a=e.password,s=e.onLoginSuccessful,c=e.roomPassword,u=!1,l=new i.b(this.connection.options),d=new Promise(function(e,i){t=i,l.addListener(r.CONNECTION_DISCONNECTED,function(){l=void 0}),l.addListener(r.CONNECTION_ESTABLISHED,function(){u||(s&&s(),l.createRoom(n.options.name,n.options.config).moderator.authenticate().then(function(){l&&l.disconnect(),u||(n.join(c),e())}).catch(function(e){var t=e.error,n=e.message;l.disconnect(),i({authenticationError:t,message:n})}))}),l.addListener(r.CONNECTION_FAILED,function(e,t,n){i({connectionError:e,credentials:n,message:t}),l=void 0}),u||l.connect(o,a)});return d.cancel=function(){u=!0,t({}),l&&l.disconnect()},d}},function(e,t,n){"use strict";(function(e){var r=n(4),i=n(1),o=n(81),a=n(35),s=n(0),c=n.n(s);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e,t,n){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=Object(r.getLogger)(e),m=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=d(this,p(t).call(this))).xmpp=e,n.rooms={},n}var n,r,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,a["a"]),n=t,(r=[{key:"init",value:function(e){f(p(t.prototype),"init",this).call(this,e),this.connection.addHandler(this.onPresence.bind(this),null,"presence",null,null,null,null),this.connection.addHandler(this.onPresenceUnavailable.bind(this),null,"presence","unavailable",null),this.connection.addHandler(this.onPresenceError.bind(this),null,"presence","error",null),this.connection.addHandler(this.onMessage.bind(this),null,"message",null,null),this.connection.addHandler(this.onMute.bind(this),"http://jitsi.org/jitmeet/audio","iq","set",null,null)}},{key:"createRoom",value:function(e,t,n){var r=i.Strophe.getBareJidFromJid(e);if(this.rooms[r]){var a="You are already in the room!";throw v.error(a),new Error(a)}return this.rooms[r]=new o.a(this.connection,e,t,this.xmpp,n),this.eventEmitter.emit(c.a.EMUC_ROOM_ADDED,this.rooms[r]),this.rooms[r]}},{key:"doLeave",value:function(e){this.eventEmitter.emit(c.a.EMUC_ROOM_REMOVED,this.rooms[e]),delete this.rooms[e]}},{key:"onPresence",value:function(e){var t=e.getAttribute("from");if(e.getAttribute("type"))return!0;var n=this.rooms[i.Strophe.getBareJidFromJid(t)];return n?($(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>status[code="201"]').length&&n.createNonAnonymousRoom(),n.onPresence(e),!0):void 0}},{key:"onPresenceUnavailable",value:function(e){var t=e.getAttribute("from"),n=this.rooms[i.Strophe.getBareJidFromJid(t)];if(n)return n.onPresenceUnavailable(e,t),!0}},{key:"onPresenceError",value:function(e){var t=e.getAttribute("from"),n=this.rooms[i.Strophe.getBareJidFromJid(t)];if(n)return n.onPresenceError(e,t),!0}},{key:"onMessage",value:function(e){var t=e.getAttribute("from"),n=this.rooms[i.Strophe.getBareJidFromJid(t)];if(n)return n.onMessage(e,t),!0}},{key:"onMute",value:function(e){var t=e.getAttribute("from"),n=this.rooms[i.Strophe.getBareJidFromJid(t)];if(n)return n.onMute(e),!0}}])&&l(n.prototype,r),s&&l(n,s),t}();t.a=function(e){i.Strophe.addConnectionPlugin("emuc",new m(e))}}).call(this,"modules/xmpp/strophe.emuc.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return E});var r=n(4),i=n(1),o=n(10),a=n.n(o),s=n(53),c=n(24),u=n(25),l=n(9),d=n(0),f=n.n(d),p=n(82);function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b=Object(r.getLogger)(e),S={packet2JSON:function(e,t){for(var n=Array.from(e.children),r=0;r<n.length;r++){for(var o=n[r],a={attributes:{},children:[],tagName:o.tagName},s=Array.from(o.attributes),c=0;c<s.length;c++){var u=s[c];a.attributes[u.name]=u.value}var l=i.Strophe.getText(o);l&&(a.value=i.Strophe.xmlunescape(l)),t.push(a),this.packet2JSON(o,a.children)}},json2packet:function(e,t){for(var n=0;n<e.length;n++){var r=e[n];r&&(t.c(r.tagName,r.attributes),r.value&&t.t(r.value),r.children&&this.json2packet(r.children,t),t.up())}}};function _(e,t){for(var n=[],r=0;r<e.length;r++)e[r].tagName===t&&n.push(e[r]);return n}var E=function(e){function t(e,n,r,o,a){var c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(c=m(this,g(t).call(this))).xmpp=o,c.connection=e,c.roomjid=i.Strophe.getBareJidFromJid(n),c.myroomjid=n,c.password=r,b.info("Joined MUC as ".concat(c.myroomjid)),c.members={},c.presMap={},c.presHandlers={},c.joined=!1,c.role=null,c.focusMucJid=null,c.noBridgeAvailable=!1,c.options=a||{},c.moderator=new p.a(c.roomjid,c.xmpp,c.eventEmitter,{connection:c.xmpp.options,conference:c.options}),c.initPresenceMap(a),c.lastPresences={},c.phoneNumber=null,c.phonePin=null,c.connectionTimes={},c.participantPropertyListener=null,c.locked=!1,c.transcriptionStatus=s.OFF,c}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(t,c["a"]),n=t,(r=[{key:"initPresenceMap",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.presMap.to=this.myroomjid,this.presMap.xns="http://jabber.org/protocol/muc",this.presMap.nodes=[],e.enableStatsID&&this.presMap.nodes.push({tagName:"stats-id",value:u.a.callStatsUserName}),this.addVideoInfoToPresence(!1),e.deploymentInfo&&e.deploymentInfo.userRegion&&this.presMap.nodes.push({tagName:"region",attributes:{id:e.deploymentInfo.userRegion,xmlns:"http://jitsi.org/jitsi-meet"}})}},{key:"join",value:function(e){var t=this;return this.password=e,new Promise(function(e){t.moderator.allocateConferenceFocus(function(){t.sendPresence(!0),e()})})}},{key:"sendPresence",value:function(e){var t=this.presMap.to;if(t&&(this.joined||e)){var n=Object(i.$pres)({to:t});e&&(n.c("x",{xmlns:this.presMap.xns}),this.password&&n.c("password").t(this.password).up(),n.up()),S.json2packet(this.presMap.nodes,n),this.connection.send(n),e&&this.connection.flush()}}},{key:"doLeave",value:function(){b.log("do leave",this.myroomjid);var e=Object(i.$pres)({to:this.myroomjid,type:"unavailable"});this.presMap.length=0,this.connection.flush(),this.connection.send(e),this.connection.flush()}},{key:"discoRoomInfo",value:function(){var e=this,t=Object(i.$iq)({type:"get",to:this.roomjid}).c("query",{xmlns:i.Strophe.NS.DISCO_INFO});this.connection.sendIQ(t,function(t){var n=1===$(t).find('>query>feature[var="muc_passwordprotected"]').length;n!==e.locked&&(e.eventEmitter.emit(f.a.MUC_LOCK_CHANGED,n),e.locked=n)},function(e){a.a.callErrorHandler(e),b.error("Error getting room info: ",e)})}},{key:"createNonAnonymousRoom",value:function(){var e=Object(i.$iq)({type:"get",to:this.roomjid}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}).c("x",{xmlns:"jabber:x:data",type:"submit"}),t=this;this.connection.sendIQ(e,function(e){if(!$(e).find('>query>x[xmlns="jabber:x:data"]>field[var="muc#roomconfig_whois"]').length){var n="non-anonymous rooms not supported";return a.a.callErrorHandler(new Error(n)),void b.error(n)}var r=Object(i.$iq)({to:t.roomjid,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"});r.c("x",{xmlns:"jabber:x:data",type:"submit"}),r.c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up(),r.c("field",{var:"muc#roomconfig_whois"}).c("value").t("anyone").up().up(),t.connection.sendIQ(r)},function(e){a.a.callErrorHandler(e),b.error("Error getting room configuration form: ",e)})}},{key:"onPresence",value:function(e){var t=e.getAttribute("from"),n={},r=e.getElementsByTagName("status")[0];r&&(n.status=r.textContent||"");var o=!1,a=e.getElementsByTagNameNS("http://jabber.org/protocol/muc#user","x")[0],s=a&&a.getElementsByTagName("item")[0];n.affiliation=s&&s.getAttribute("affiliation"),n.role=s&&s.getAttribute("role");var c=s&&s.getAttribute("jid");n.jid=c,n.isFocus=c&&0===c.indexOf("".concat(this.moderator.getFocusUserJid(),"/")),n.isHiddenDomain=c&&c.indexOf("@")>0&&this.options.hiddenDomain===c.substring(c.indexOf("@")+1,c.indexOf("/")),this.eventEmitter.emit(f.a.PRESENCE_RECEIVED,{fromHiddenDomain:n.isHiddenDomain,presence:e});var u=e.querySelector("x");u&&u.remove();var l=[];S.packet2JSON(e,l),this.lastPresences[t]=l;for(var d=function(e){var t={},n=e.children.find(function(e){return"user"===e.tagName});if(n){t.user={};for(var r=["id","name","avatar"],i=function(){var e=r[o],i=n.children.find(function(t){return t.tagName===e});i&&(t.user[e]=i.value)},o=0;o<r.length;o++)i()}var a=e.children.find(function(e){return"group"===e.tagName});return a&&(t.group=a.value),t},p=0;p<l.length;p++){var h=l[p];switch(h.tagName){case"bot":var v=h.attributes;if(!v)break;var m=v.type;n.botType=m;break;case"nick":n.nick=h.value;break;case"userId":n.id=h.value;break;case"stats-id":n.statsID=h.value;break;case"identity":n.identity=d(h)}}if(t===this.myroomjid){var g="owner"===n.affiliation?n.role:"none";if(this.role!==g&&(this.role=g,this.eventEmitter.emit(f.a.LOCAL_ROLE_CHANGED,this.role)),!this.joined){this.joined=!0;var y=this.connectionTimes["muc.joined"]=window.performance.now();b.log("(TIME) MUC joined:\t",y),this.password&&(this.locked=!0),this.eventEmitter.emit(f.a.MUC_JOINED)}}else if(void 0===this.members[t])this.members[t]=n,b.log("entered",t,n),o=void 0!==n.status,n.isFocus?this._initFocus(t,c):(this.eventEmitter.emit(f.a.MUC_MEMBER_JOINED,t,n.nick,n.role,n.isHiddenDomain,n.statsID,n.status,n.identity,n.botType),o=!1);else{var _=this.members[t];_.role!==n.role&&(_.role=n.role,this.eventEmitter.emit(f.a.MUC_ROLE_CHANGED,t,n.role)),_.botType!==n.botType&&(_.botType=n.botType,this.eventEmitter.emit(f.a.MUC_MEMBER_BOT_TYPE_CHANGED,t,n.botType)),n.isFocus&&(_.isFocus=!0,this._initFocus(t,c)),n.displayName&&(_.displayName=n.displayName),_.status!==n.status&&(o=!0,_.status=n.status)}for(var E=0;E<l.length;E++){var C=l[E];switch(C.tagName){case"nick":if(!n.isFocus){var T=this.xmpp.options.displayJids?i.Strophe.getResourceFromJid(t):n.nick;T&&T.length>0&&this.eventEmitter.emit(f.a.DISPLAY_NAME_CHANGED,t,T)}break;case"bridgeNotAvailable":n.isFocus&&!this.noBridgeAvailable&&(this.noBridgeAvailable=!0,this.eventEmitter.emit(f.a.BRIDGE_DOWN));break;case"conference-properties":if(n.isFocus){for(var w={},k=0;k<C.children.length;k++){var R=C.children[k].attributes;R&&R.key&&(w[R.key]=R.value)}this.eventEmitter.emit(f.a.CONFERENCE_PROPERTIES_CHANGED,w)}break;case"transcription-status":var P=C.attributes;if(!P)break;var I=P.status;I&&I!==this.transcriptionStatus&&(this.transcriptionStatus=I,this.eventEmitter.emit(f.a.TRANSCRIPTION_STATUS_CHANGED,I));break;case"call-control":var O=C.attributes;if(!O)break;this.phoneNumber=O.phone||null,this.phonePin=O.pin||null,this.eventEmitter.emit(f.a.PHONE_NUMBER_CHANGED);break;default:this.processNode(C,t)}}o&&this.eventEmitter.emit(f.a.PRESENCE_STATUS,t,n.status)}},{key:"_initFocus",value:function(e,t){this.focusMucJid=e,b.info("Ignore focus: ".concat(e,", real JID: ").concat(t))}},{key:"setParticipantPropertyListener",value:function(e){this.participantPropertyListener=e}},{key:"processNode",value:function(e,t){try{var n=this.presHandlers[e.tagName];e.tagName.startsWith("jitsi_participant_")&&(n=[this.participantPropertyListener]),n&&n.forEach(function(n){n(e,i.Strophe.getResourceFromJid(t),t)})}catch(t){a.a.callErrorHandler(t),b.error("Error processing:".concat(e.tagName," node."),t)}}},{key:"sendMessage",value:function(e,t,n){var r=Object(i.$msg)({to:this.roomjid,type:"groupchat"});"body"===t?r.c(t,e).up():r.c(t,{xmlns:"http://jitsi.org/jitmeet"},e).up(),n&&r.c("nick",{xmlns:"http://jabber.org/protocol/nick"}).t(n).up().up(),this.connection.send(r),this.eventEmitter.emit(f.a.SENDING_CHAT_MESSAGE,e)}},{key:"sendPrivateMessage",value:function(e,t,n,r){var o=Object(i.$msg)({to:"".concat(this.roomjid,"/").concat(e),type:"chat"});"body"===n?o.c(n,t).up():o.c(n,{xmlns:"http://jitsi.org/jitmeet"},t).up(),r&&o.c("nick",{xmlns:"http://jabber.org/protocol/nick"}).t(r).up().up(),this.connection.send(o),this.eventEmitter.emit(f.a.SENDING_PRIVATE_CHAT_MESSAGE,t)}},{key:"setSubject",value:function(e){var t=Object(i.$msg)({to:this.roomjid,type:"groupchat"});t.c("subject",e),this.connection.send(t)}},{key:"onParticipantLeft",value:function(e,t){delete this.lastPresences[e],t||(this.eventEmitter.emit(f.a.MUC_MEMBER_LEFT,e),this.moderator.onMucMemberLeft(e))}},{key:"onPresenceUnavailable",value:function(e,t){var n=this;if($(e).find('>ignore[xmlns="http://jitsi.org/jitmeet/"]').length)return!0;if($(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>destroy').length){var r,i=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>destroy>reason');return i.length&&(r=i.text()),this.eventEmitter.emit(f.a.MUC_DESTROYED,r),this.connection.emuc.doLeave(this.roomjid),!0}var o=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>status[code="110"]').length,a=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>status[code="307"]').length,s=Object.keys(this.members);o?s.length>0&&(s.forEach(function(e){var t=n.members[e];delete n.members[e],n.onParticipantLeft(e,t.isFocus)}),this.connection.emuc.doLeave(this.roomjid),a||this.eventEmitter.emit(f.a.MUC_LEFT)):(delete this.members[t],this.onParticipantLeft(t,!1)),a&&this.myroomjid===t&&this.eventEmitter.emit(f.a.KICKED)}},{key:"onMessage",value:function(e,t){var n=$(e).find('>nick[xmlns="http://jabber.org/protocol/nick"]').text()||i.Strophe.getResourceFromJid(t),r=$(e).find(">body").text(),o=e.getAttribute("type");if("error"===o)return this.eventEmitter.emit(f.a.CHAT_ERROR_RECEIVED,$(e).find(">text").text(),r),!0;var a=$(e).find(">subject");if(a.length){var s=a.text();(s||""===s)&&(this.eventEmitter.emit(f.a.SUBJECT_CHANGED,s),b.log("Subject is changed to ".concat(s)))}var c=$(e).find(">delay").attr("stamp");if(!c&&(c=$(e).find('>[xmlns="jabber:x:delay"]').attr("stamp"))){var u=c.match(/(\d{4})(\d{2})(\d{2}T\d{2}:\d{2}:\d{2})/);c="".concat(u[1],"-").concat(u[2],"-").concat(u[3],"Z")}t===this.roomjid&&$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>status[code="104"]').length&&this.discoRoomInfo();var l=$(e).find(">json-message").text(),d=this.xmpp.tryParseJSONAndVerify(l);d&&void 0===c?this.eventEmitter.emit(f.a.JSON_MESSAGE_RECEIVED,t,d):r&&("chat"===o?this.eventEmitter.emit(f.a.PRIVATE_MESSAGE_RECEIVED,t,n,r,this.myroomjid,c):"groupchat"===o&&this.eventEmitter.emit(f.a.MESSAGE_RECEIVED,t,n,r,this.myroomjid,c))}},{key:"onPresenceError",value:function(e,t){if($(e).find('>error[type="auth"]>not-authorized[xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"]').length)b.log("on password required",t),this.eventEmitter.emit(f.a.PASSWORD_REQUIRED);else if($(e).find('>error[type="cancel"]>not-allowed[xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"]').length){i.Strophe.getDomainFromJid(e.getAttribute("to"))===this.xmpp.options.hosts.anonymousdomain?this.eventEmitter.emit(f.a.ROOM_JOIN_ERROR):(b.warn("onPresError ",e),this.eventEmitter.emit(f.a.ROOM_CONNECT_NOT_ALLOWED_ERROR))}else $(e).find(">error>service-unavailable").length?(b.warn("Maximum users limit for the room has been reached",e),this.eventEmitter.emit(f.a.ROOM_MAX_USERS_ERROR)):(b.warn("onPresError ",e),this.eventEmitter.emit(f.a.ROOM_CONNECT_ERROR))}},{key:"kick",value:function(e){var t=Object(i.$iq)({to:this.roomjid,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{nick:i.Strophe.getResourceFromJid(e),role:"none"}).c("reason").t("You have been kicked.").up().up().up();this.connection.sendIQ(t,function(t){return b.log("Kick participant with jid: ",e,t)},function(e){return b.log("Kick participant error: ",e)})}},{key:"lockRoom",value:function(e,t,n,r){var o=this;this.connection.sendIQ(Object(i.$iq)({to:this.roomjid,type:"get"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}),function(a){if($(a).find('>query>x[xmlns="jabber:x:data"]>field[var="muc#roomconfig_roomsecret"]').length){var s=Object(i.$iq)({to:o.roomjid,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"});s.c("x",{xmlns:"jabber:x:data",type:"submit"}),s.c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up(),s.c("field",{var:"muc#roomconfig_roomsecret"}).c("value").t(e).up().up(),s.c("field",{var:"muc#roomconfig_whois"}).c("value").t("anyone").up().up(),o.connection.sendIQ(s,t,n)}else r()},n)}},{key:"addToPresence",value:function(e,t){t.tagName=e,this.removeFromPresence(e),this.presMap.nodes.push(t)}},{key:"removeFromPresence",value:function(e){var t=this.presMap.nodes.filter(function(t){return e!==t.tagName});this.presMap.nodes=t}},{key:"addPresenceListener",value:function(e,t){if("function"!=typeof t)throw new Error('"handler" is not a function');var n=this.presHandlers[e];n||(this.presHandlers[e]=n=[]),-1===n.indexOf(t)?n.push(t):b.warn("Trying to add the same handler more than once for: ".concat(e))}},{key:"removePresenceListener",value:function(e,t){var n=this.presHandlers[e],r=n?n.indexOf(t):-1;-1!==r?n.splice(r,1):b.warn("Handler for: ".concat(e," was not registered"))}},{key:"isFocus",value:function(e){var t=this.members[e];return t?t.isFocus:null}},{key:"isModerator",value:function(){return"moderator"===this.role}},{key:"getMemberRole",value:function(e){return this.members[e]?this.members[e].role:null}},{key:"setVideoMute",value:function(e,t){this.sendVideoInfoPresence(e),t&&t(e)}},{key:"setAudioMute",value:function(e,t){return this.sendAudioInfoPresence(e,t)}},{key:"addAudioInfoToPresence",value:function(e){this.removeFromPresence("audiomuted"),this.addToPresence("audiomuted",{attributes:{xmlns:"http://jitsi.org/jitmeet/audio"},value:e.toString()})}},{key:"sendAudioInfoPresence",value:function(e,t){this.addAudioInfoToPresence(e),this.connection&&this.sendPresence(),t&&t()}},{key:"addVideoInfoToPresence",value:function(e){this.removeFromPresence("videomuted"),this.addToPresence("videomuted",{attributes:{xmlns:"http://jitsi.org/jitmeet/video"},value:e.toString()})}},{key:"sendVideoInfoPresence",value:function(e){this.addVideoInfoToPresence(e),this.connection&&this.sendPresence()}},{key:"getMediaPresenceInfo",value:function(e,t){var n=this.lastPresences["".concat(this.roomjid,"/").concat(e)];if(!n)return null;var r={muted:!1,videoType:void 0},i=null;if(t===l.a)i=_(n,"audiomuted");else{if(t!==l.b)return b.error("Unsupported media type: ".concat(t)),null;i=_(n,"videomuted");var o=_(n,"videoType");o.length>0&&(r.videoType=o[0].value)}return r.muted=i.length>0&&"true"===i[0].value,r}},{key:"isSIPCallingSupported",value:function(){return!!this.moderator&&this.moderator.isSipGatewayEnabled()}},{key:"dial",value:function(e){return this.connection.rayo.dial(e,"fromnumber",i.Strophe.getBareJidFromJid(this.myroomjid),this.password,this.focusMucJid)}},{key:"hangup",value:function(){return this.connection.rayo.hangup()}},{key:"getPhoneNumber",value:function(){return this.phoneNumber}},{key:"getPhonePin",value:function(){return this.phonePin}},{key:"muteParticipant",value:function(e,t){b.info("set mute",t);var n=Object(i.$iq)({to:this.focusMucJid,type:"set"}).c("mute",{xmlns:"http://jitsi.org/jitmeet/audio",jid:e}).t(t.toString()).up();this.connection.sendIQ(n,function(e){return b.log("set mute",e)},function(e){return b.log("set mute error",e)})}},{key:"onMute",value:function(e){if(e.getAttribute("from")===this.focusMucJid){var t=$(e).find("mute");t.length&&"true"===t.text()?this.eventEmitter.emit(f.a.AUDIO_MUTED_BY_FOCUS):b.warn("Ignoring a mute request which does not explicitly specify a positive mute command.")}else b.warn("Ignored mute from non focus peer")}},{key:"leave",value:function(){var e=this;return new Promise(function(t,n){var r=setTimeout(function(){return o(!0)},5e3),i=e.eventEmitter;function o(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];i.removeListener(f.a.MUC_LEFT,o),clearTimeout(r),e?n(new Error("The timeout for the confirmation about leaving the room expired.")):t()}i.on(f.a.MUC_LEFT,o),e.doLeave()})}}])&&v(n.prototype,r),o&&v(n,o),t}()}).call(this,"modules/xmpp/ChatRoom.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return d});var r=n(1),i=n(3),o=n(25),a=n(4).getLogger(e),s=n(0),c=n(58),u=n(10);function l(e){var t=1;return function(n){if(!n){var r=Math.pow(2,t-1);return t+=1,r*e}t=1}}function d(e,t,n,r){function i(e){if(e.data&&e.data.sessionId){if(e.origin!==window.location.origin)return void a.warn("Ignoring sessionId from different origin: ".concat(e.origin));o.a.sessionId=e.data.sessionId}}this.roomName=e,this.xmppService=t,this.getNextTimeout=l(1e3),this.getNextErrorTimeout=l(1e3),this.externalAuthEnabled=!1,this.options=r,this.sipGatewayEnabled=this.options.connection.hosts&&void 0!==this.options.connection.hosts.call_control,this.eventEmitter=n,this.connection=this.xmppService.connection,window.addEventListener?window.addEventListener("message",i,!1):window.attachEvent("onmessage",i)}d.prototype.isExternalAuthEnabled=function(){return this.externalAuthEnabled},d.prototype.isSipGatewayEnabled=function(){return this.sipGatewayEnabled},d.prototype.onMucMemberLeft=function(e){a.info("Someone left is it focus ? ".concat(e)),"focus"===r.Strophe.getResourceFromJid(e)&&(a.info("Focus has left the room - leaving conference"),this.eventEmitter.emit(s.FOCUS_LEFT))},d.prototype.setFocusUserJid=function(e){this.focusUserJid||(this.focusUserJid=e,a.info("Focus jid set to:  ".concat(this.focusUserJid)))},d.prototype.getFocusUserJid=function(){return this.focusUserJid},d.prototype.getFocusComponent=function(){var e=this.options.connection.hosts.focus;return e||(e="focus.".concat(this.options.connection.hosts.domain)),e},d.prototype.createConferenceIq=function(){var e,t=Object(r.$iq)({to:this.getFocusComponent(),type:"set"}),n=o.a.sessionId,s=o.a.machineId,c=this.options.conference;switch(a.info("Session ID: ".concat(n," machine UID: ").concat(s)),t.c("conference",{xmlns:"http://jitsi.org/protocol/focus",room:this.roomName,"machine-uid":s}),n&&t.attrs({"session-id":n}),void 0!==this.options.connection.enforcedBridge&&t.c("property",{name:"enforcedBridge",value:this.options.connection.enforcedBridge}).up(),void 0!==this.options.connection.hosts&&void 0!==this.options.connection.hosts.call_control&&t.c("property",{name:"call_control",value:this.options.connection.hosts.call_control}).up(),void 0!==c.channelLastN&&t.c("property",{name:"channelLastN",value:c.channelLastN}).up(),t.c("property",{name:"disableRtx",value:Boolean(c.disableRtx)}).up(),void 0!==c.enableTcc&&t.c("property",{name:"enableTcc",value:Boolean(c.enableTcc)}).up(),void 0!==c.enableRemb&&t.c("property",{name:"enableRemb",value:Boolean(c.enableRemb)}).up(),void 0!==c.minParticipants&&t.c("property",{name:"minParticipants",value:c.minParticipants}).up(),t.c("property",{name:"enableLipSync",value:!1!==this.options.connection.enableLipSync}).up(),void 0!==c.audioPacketDelay&&t.c("property",{name:"audioPacketDelay",value:c.audioPacketDelay}).up(),c.startBitrate&&t.c("property",{name:"startBitrate",value:c.startBitrate}).up(),c.minBitrate&&t.c("property",{name:"minBitrate",value:c.minBitrate}).up(),c.testing&&c.testing.octo&&"number"==typeof c.testing.octo.probability&&Math.random()<c.testing.octo.probability&&t.c("property",{name:"octo",value:!0}).up(),this.options.conference.openBridgeChannel){case"datachannel":case!0:case void 0:e=!0;break;case"websocket":e=!1}return e&&!i.a.supportsDataChannels()&&(e=!1),t.c("property",{name:"openSctp",value:e}).up(),void 0!==this.options.conference.startAudioMuted&&t.c("property",{name:"startAudioMuted",value:this.options.conference.startAudioMuted}).up(),void 0!==this.options.conference.startVideoMuted&&t.c("property",{name:"startVideoMuted",value:this.options.conference.startVideoMuted}).up(),void 0!==this.options.conference.stereo&&t.c("property",{name:"stereo",value:this.options.conference.stereo}).up(),void 0!==this.options.conference.useRoomAsSharedDocumentName&&t.c("property",{name:"useRoomAsSharedDocumentName",value:this.options.conference.useRoomAsSharedDocumentName}).up(),t.up(),t},d.prototype.parseSessionId=function(e){var t=$(e).find("conference").attr("session-id");t&&(a.info("Received sessionId:  ".concat(t)),o.a.sessionId=t)},d.prototype.parseConfigOptions=function(e){this.setFocusUserJid($(e).find("conference").attr("focusjid"));var t=$(e).find(">conference>property[name='authentication'][value='true']").length>0;a.info("Authentication enabled: ".concat(t)),this.externalAuthEnabled=$(e).find(">conference>property[name='externalAuth'][value='true']").length>0,a.info("External authentication enabled: ".concat(this.externalAuthEnabled)),this.externalAuthEnabled||this.parseSessionId(e);var n=$(e).find(">conference").attr("identity");this.eventEmitter.emit(c.IDENTITY_UPDATED,t,n),$(e).find(">conference>property[name='sipGatewayEnabled'][value='true']").length&&(this.sipGatewayEnabled=!0),a.info("Sip gateway enabled:  ".concat(this.sipGatewayEnabled))},d.prototype.allocateConferenceFocus=function(e){var t=this;this.setFocusUserJid(this.options.connection.focusUserJid),this.connection.sendIQ(this.createConferenceIq(),function(n){return t._allocateConferenceFocusSuccess(n,e)},function(n){return t._allocateConferenceFocusError(n,e)}),this.connection.flush()},d.prototype._allocateConferenceFocusError=function(e,t){var n=this,i=$(e).find(">error>session-invalid").length||$(e).find(">error>not-acceptable").length;if(i&&(a.info("Session expired! - removing"),o.a.sessionId=void 0),$(e).find(">error>graceful-shutdown").length)this.eventEmitter.emit(s.GRACEFUL_SHUTDOWN);else{var c=$(e).find(">error>reservation-error");if(c.length){var l,d=c.attr("error-code"),f=$(e).find(">error>text");return f&&(l=f.text()),void this.eventEmitter.emit(s.RESERVATION_ERROR,d,l)}if($(e).find(">error>not-authorized").length)return a.warn("Unauthorized to start the conference",e),r.Strophe.getDomainFromJid(e.getAttribute("to"))!==this.options.connection.hosts.anonymousdomain&&(this.externalAuthEnabled=!0),void this.eventEmitter.emit(s.AUTHENTICATION_REQUIRED);var p=this.getNextErrorTimeout(),h="Focus error, retry after ".concat(p);u.callErrorHandler(new Error(h)),a.error(h,e);var v=this.getFocusComponent(),m=p/1e3;i||this.eventEmitter.emit(s.FOCUS_DISCONNECTED,v,m),this.getNextTimeout(!0),window.setTimeout(function(){return n.allocateConferenceFocus(t)},p)}},d.prototype._allocateConferenceFocusSuccess=function(e,t){var n=this;if(this.parseConfigOptions(e),this.getNextErrorTimeout(!0),"true"===$(e).find("conference").attr("ready"))this.getNextTimeout(!0),t();else{var r=this.getNextTimeout();a.info("Waiting for the focus... ".concat(r)),window.setTimeout(function(){return n.allocateConferenceFocus(t)},r)}},d.prototype.authenticate=function(){var e=this;return new Promise(function(t,n){e.connection.sendIQ(e.createConferenceIq(),function(n){e.parseSessionId(n),t()},function(e){return n({error:$(e).find("iq>error :first").prop("tagName"),message:$(e).find("iq>error>text").text()})})})},d.prototype.getLoginUrl=function(e,t){this._getLoginUrl(!1,e,t)},d.prototype._getLoginUrl=function(e,t,n){var i=Object(r.$iq)({to:this.getFocusComponent(),type:"get"}),s={xmlns:"http://jitsi.org/protocol/focus",room:this.roomName,"machine-uid":o.a.machineId},c="auth url";function l(e,t){u.callErrorHandler(new Error(e)),a.error(e,t),n(t)}e&&(s.popup=!0,c="POPUP ".concat(c)),i.c("login-url",s),this.connection.sendIQ(i,function(e){var n=$(e).find("login-url").attr("url");(n=decodeURIComponent(n))?(a.info("Got ".concat(c,": ").concat(n)),t(n)):l("Failed to get ".concat(c," from the focus"),e)},l.bind(void 0,"Get ".concat(c," error")))},d.prototype.getPopupLoginUrl=function(e,t){this._getLoginUrl(!0,e,t)},d.prototype.logout=function(e){var t=Object(r.$iq)({to:this.getFocusComponent(),type:"set"}),n=o.a.sessionId;n?(t.c("logout",{xmlns:"http://jitsi.org/protocol/focus","session-id":n}),this.connection.sendIQ(t,function(t){var n=$(t).find("logout").attr("logout-url");n&&(n=decodeURIComponent(n)),a.info("Log out OK, url: ".concat(n),t),o.a.sessionId=void 0,e(n)},function(e){u.callErrorHandler(new Error("Logout error")),a.error("Logout error",e)})):e()}}).call(this,"modules/xmpp/moderator.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return C});var r=n(7),i=n(4),o=n(1),a=n(0),s=n.n(a),c=n(10),u=n.n(c),l=n(36),d=n.n(l),f=n(6),p=n(59),h=n(35);function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e,t,n){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=Object(i.getLogger)(e),E=function(e){function t(e,n,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=g(this,b(t).call(this))).xmpp=e,i.eventEmitter=n,i.sessions={},i.jvbIceConfig=r.jvb,i.p2pIceConfig=r.p2p,i.mediaConstraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0},i}var n,i,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,h["b"]),n=t,(i=[{key:"init",value:function(e){y(b(t.prototype),"init",this).call(this,e),this.connection.addHandler(this.onJingle.bind(this),"urn:xmpp:jingle:1","iq","set",null,null)}},{key:"onJingle",value:function(e){var t=$(e).find("jingle").attr("sid"),n=$(e).find("jingle").attr("action"),i=e.getAttribute("from"),a=Object(o.$iq)({type:"result",to:i,id:e.getAttribute("id")});_.log("on jingle ".concat(n," from ").concat(i),e);var c=this.sessions[t];if("session-initiate"!==n){if(!c)return a.attrs({type:"error"}),a.c("error",{type:"cancel"}).c("item-not-found",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("unknown-session",{xmlns:"urn:xmpp:jingle:errors:1"}),_.warn("invalid session id",e),this.connection.send(a),!0;if(i!==c.remoteJid)return _.warn("jid mismatch for session id",t,c.remoteJid,e),a.attrs({type:"error"}),a.c("error",{type:"cancel"}).c("item-not-found",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("unknown-session",{xmlns:"urn:xmpp:jingle:errors:1"}),this.connection.send(a),!0}else if(void 0!==c)return a.attrs({type:"error"}),a.c("error",{type:"cancel"}).c("service-unavailable",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up(),_.warn("duplicate session id",t,e),this.connection.send(a),!0;var l=window.performance.now(),d="focus"!==o.Strophe.getResourceFromJid(i);switch(n){case"session-initiate":_.log("(TIME) received session-initiate:\t",l);var h=$(e).find("jingle>startmuted");if(h&&h.length>0){var v=h.attr("audio"),m=h.attr("video");this.eventEmitter.emit(s.a.START_MUTED_FROM_FOCUS,"true"===v,"true"===m)}_.info("Marking session from ".concat(i," as ").concat(d?"":"*not*"," P2P")),c=new p.a($(e).find("jingle").attr("sid"),$(e).attr("to"),i,this.connection,this.mediaConstraints,d?this.p2pIceConfig:this.jvbIceConfig,d,!1),this.sessions[c.sid]=c,this.eventEmitter.emit(s.a.CALL_INCOMING,c,$(e).find(">jingle"),l);break;case"session-accept":this.eventEmitter.emit(s.a.CALL_ACCEPTED,c,$(e).find(">jingle"));break;case"content-modify":c.modifyContents($(e).find(">jingle"));break;case"transport-info":this.eventEmitter.emit(s.a.TRANSPORT_INFO,c,$(e).find(">jingle"));break;case"session-terminate":_.log("terminating...",c.sid);var g=null,y=null;$(e).find(">jingle>reason").length&&(g=$(e).find(">jingle>reason>:first")[0].tagName,y=$(e).find(">jingle>reason>text").text()),this.terminate(c.sid,g,y),this.eventEmitter.emit(s.a.CALL_ENDED,c,g,y);break;case"transport-replace":_.info("(TIME) Start transport replace",l),f.a.sendAnalytics(Object(r.B)(r.f,{p2p:d,value:l})),c.replaceTransport($(e).find(">jingle"),function(){var e=window.performance.now();_.info("(TIME) Transport replace success!",e),f.a.sendAnalytics(Object(r.B)(r.g,{p2p:d,value:e}))},function(e){u.a.callErrorHandler(e),_.error("Transport replace failed",e),c.sendTransportReject()});break;case"addsource":case"source-add":c.addRemoteStream($(e).find(">jingle>content"));break;case"removesource":case"source-remove":c.removeRemoteStream($(e).find(">jingle>content"));break;default:_.warn("jingle action not implemented",n),a.attrs({type:"error"}),a.c("error",{type:"cancel"}).c("bad-request",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up()}return this.connection.send(a),!0}},{key:"newP2PJingleSession",value:function(e,t){var n=new p.a(d.a.randomHexString(12),e,t,this.connection,this.mediaConstraints,this.p2pIceConfig,!0,!0);return this.sessions[n.sid]=n,n}},{key:"terminate",value:function(e,t,n){this.sessions.hasOwnProperty(e)&&("ended"!==this.sessions[e].state&&this.sessions[e].onTerminated(t,n),delete this.sessions[e])}},{key:"getStunAndTurnCredentials",value:function(){var e=this;this.connection.sendIQ(Object(o.$iq)({type:"get",to:this.connection.domain}).c("services",{xmlns:"urn:xmpp:extdisco:1"}),function(t){var n=[];$(t).find(">services>service").each(function(e,t){var r={},i=(t=$(t)).attr("type");switch(i){case"stun":r.url="stun:".concat(t.attr("host")),t.attr("port")&&(r.url+=":".concat(t.attr("port"))),n.push(r);break;case"turn":case"turns":r.url="".concat(i,":");var o=t.attr("username");if(o){var a=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);a&&parseInt(a[2],10)<28?r.url+="".concat(o,"@"):r.username=o}r.url+=t.attr("host"),t.attr("port")&&(r.url+=":".concat(t.attr("port")));var s=t.attr("transport");s&&"udp"!==s&&(r.url+="?transport=".concat(s)),r.credential=t.attr("password")||r.credential,n.push(r)}});var r=e.xmpp.options;r.useStunTurn&&(e.jvbIceConfig.iceServers=n.filter(function(e){return e.url.startsWith("turns")})),r.p2p&&r.p2p.useStunTurn&&(e.p2pIceConfig.iceServers=n)},function(e){_.warn("getting turn credentials failed",e),_.warn("is mod_turncredentials or similar installed?")})}},{key:"getLog",value:function(){var e=this,t={};return Object.keys(this.sessions).forEach(function(n){var r=e.sessions[n].peerconnection;r&&r.updateLog&&(t["jingle_".concat(n)]={updateLog:r.updateLog,stats:r.stats,url:window.location.href})}),t}}])&&m(n.prototype,i),a&&m(n,a),t}();function C(e,t,n){o.Strophe.addConnectionPlugin("jingle",new E(e,t,n))}}).call(this,"modules/xmpp/strophe.jingle.js")},function(e,t,n){(function(n,r){var i;
/*!
 * async
 * https://github.com/caolan/async
 *
 * Copyright 2010-2014 Caolan McMahon
 * Released under the MIT license
 */
/*!
 * async
 * https://github.com/caolan/async
 *
 * Copyright 2010-2014 Caolan McMahon
 * Released under the MIT license
 */
!function(){var o,a,s={};function c(e){var t=!1;return function(){if(t)throw new Error("Callback was already called.");t=!0,e.apply(o,arguments)}}null!=(o=this)&&(a=o.async),s.noConflict=function(){return o.async=a,s};var u=Object.prototype.toString,l=Array.isArray||function(e){return"[object Array]"===u.call(e)},d=function(e,t){if(e.forEach)return e.forEach(t);for(var n=0;n<e.length;n+=1)t(e[n],n,e)},f=function(e,t){if(e.map)return e.map(t);var n=[];return d(e,function(e,r,i){n.push(t(e,r,i))}),n},p=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t};void 0!==n&&n.nextTick?(s.nextTick=n.nextTick,s.setImmediate=void 0!==r?function(e){r(e)}:s.nextTick):"function"==typeof r?(s.nextTick=function(e){r(e)},s.setImmediate=s.nextTick):(s.nextTick=function(e){setTimeout(e,0)},s.setImmediate=s.nextTick),s.each=function(e,t,n){if(n=n||function(){},!e.length)return n();var r=0;function i(t){t?(n(t),n=function(){}):(r+=1)>=e.length&&n()}d(e,function(e){t(e,c(i))})},s.forEach=s.each,s.eachSeries=function(e,t,n){if(n=n||function(){},!e.length)return n();var r=0,i=function(){t(e[r],function(t){t?(n(t),n=function(){}):(r+=1)>=e.length?n():i()})};i()},s.forEachSeries=s.eachSeries,s.eachLimit=function(e,t,n,r){h(t).apply(null,[e,n,r])},s.forEachLimit=s.eachLimit;var h=function(e){return function(t,n,r){if(r=r||function(){},!t.length||e<=0)return r();var i=0,o=0,a=0;!function s(){if(i>=t.length)return r();for(;a<e&&o<t.length;)a+=1,n(t[(o+=1)-1],function(e){e?(r(e),r=function(){}):(a-=1,(i+=1)>=t.length?r():s())})}()}},v=function(e){return function(){var t=Array.prototype.slice.call(arguments);return e.apply(null,[s.each].concat(t))}},m=function(e){return function(){var t=Array.prototype.slice.call(arguments);return e.apply(null,[s.eachSeries].concat(t))}},g=function(e,t,n,r){if(t=f(t,function(e,t){return{index:t,value:e}}),r){var i=[];e(t,function(e,t){n(e.value,function(n,r){i[e.index]=r,t(n)})},function(e){r(e,i)})}else e(t,function(e,t){n(e.value,function(e){t(e)})})};s.map=v(g),s.mapSeries=m(g),s.mapLimit=function(e,t,n,r){return y(t)(e,n,r)};var y=function(e){return function(e,t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[h(e)].concat(n))}}(e,g)};s.reduce=function(e,t,n,r){s.eachSeries(e,function(e,r){n(t,e,function(e,n){t=n,r(e)})},function(e){r(e,t)})},s.inject=s.reduce,s.foldl=s.reduce,s.reduceRight=function(e,t,n,r){var i=f(e,function(e){return e}).reverse();s.reduce(i,t,n,r)},s.foldr=s.reduceRight;var b=function(e,t,n,r){var i=[];e(t=f(t,function(e,t){return{index:t,value:e}}),function(e,t){n(e.value,function(n){n&&i.push(e),t()})},function(e){r(f(i.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};s.filter=v(b),s.filterSeries=m(b),s.select=s.filter,s.selectSeries=s.filterSeries;var S=function(e,t,n,r){var i=[];e(t=f(t,function(e,t){return{index:t,value:e}}),function(e,t){n(e.value,function(n){n||i.push(e),t()})},function(e){r(f(i.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};s.reject=v(S),s.rejectSeries=m(S);var _=function(e,t,n,r){e(t,function(e,t){n(e,function(n){n?(r(e),r=function(){}):t()})},function(e){r()})};s.detect=v(_),s.detectSeries=m(_),s.some=function(e,t,n){s.each(e,function(e,r){t(e,function(e){e&&(n(!0),n=function(){}),r()})},function(e){n(!1)})},s.any=s.some,s.every=function(e,t,n){s.each(e,function(e,r){t(e,function(e){e||(n(!1),n=function(){}),r()})},function(e){n(!0)})},s.all=s.every,s.sortBy=function(e,t,n){s.map(e,function(e,n){t(e,function(t,r){t?n(t):n(null,{value:e,criteria:r})})},function(e,t){if(e)return n(e);n(null,f(t.sort(function(e,t){var n=e.criteria,r=t.criteria;return n<r?-1:n>r?1:0}),function(e){return e.value}))})},s.auto=function(e,t){t=t||function(){};var n=p(e),r=n.length;if(!r)return t();var i={},o=[],a=function(e){o.unshift(e)},c=function(){r--,d(o.slice(0),function(e){e()})};a(function(){if(!r){var e=t;t=function(){},e(null,i)}}),d(n,function(n){var r=l(e[n])?e[n]:[e[n]],u=function(e){var r=Array.prototype.slice.call(arguments,1);if(r.length<=1&&(r=r[0]),e){var o={};d(p(i),function(e){o[e]=i[e]}),o[n]=r,t(e,o),t=function(){}}else i[n]=r,s.setImmediate(c)},f=r.slice(0,Math.abs(r.length-1))||[],h=function(){return t=function(e,t){return e&&i.hasOwnProperty(t)},r=!0,((e=f).reduce?e.reduce(t,r):(d(e,function(e,n,i){r=t(r,e,n,i)}),r))&&!i.hasOwnProperty(n);var e,t,r};if(h())r[r.length-1](u,i);else{var v=function(){h()&&(!function(e){for(var t=0;t<o.length;t+=1)if(o[t]===e)return void o.splice(t,1)}(v),r[r.length-1](u,i))};a(v)}})},s.retry=function(e,t,n){var r=[];"function"==typeof e&&(n=t,t=e,e=5),e=parseInt(e,10)||5;var i=function(i,o){for(var a=function(e,t){return function(n){e(function(e,r){n(!e||t,{err:e,result:r})},o)}};e;)r.push(a(t,!(e-=1)));s.series(r,function(e,t){t=t[t.length-1],(i||n)(t.err,t.result)})};return n?i():i},s.waterfall=function(e,t){if(t=t||function(){},!l(e)){var n=new Error("First argument to waterfall must be an array of functions");return t(n)}if(!e.length)return t();var r=function(e){return function(n){if(n)t.apply(null,arguments),t=function(){};else{var i=Array.prototype.slice.call(arguments,1),o=e.next();o?i.push(r(o)):i.push(t),s.setImmediate(function(){e.apply(null,i)})}}};r(s.iterator(e))()};var E=function(e,t,n){if(n=n||function(){},l(t))e.map(t,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},n);else{var r={};e.each(p(t),function(e,n){t[e](function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),r[e]=i,n(t)})},function(e){n(e,r)})}};s.parallel=function(e,t){E({map:s.map,each:s.each},e,t)},s.parallelLimit=function(e,t,n){E({map:y(t),each:h(t)},e,n)},s.series=function(e,t){if(t=t||function(){},l(e))s.mapSeries(e,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},t);else{var n={};s.eachSeries(p(e),function(t,r){e[t](function(e){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),n[t]=i,r(e)})},function(e){t(e,n)})}},s.iterator=function(e){var t=function(n){var r=function(){return e.length&&e[n].apply(null,arguments),r.next()};return r.next=function(){return n<e.length-1?t(n+1):null},r};return t(0)},s.apply=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t.concat(Array.prototype.slice.call(arguments)))}};var C=function(e,t,n,r){var i=[];e(t,function(e,t){n(e,function(e,n){i=i.concat(n||[]),t(e)})},function(e){r(e,i)})};s.concat=v(C),s.concatSeries=m(C),s.whilst=function(e,t,n){e()?t(function(r){if(r)return n(r);s.whilst(e,t,n)}):n()},s.doWhilst=function(e,t,n){e(function(r){if(r)return n(r);var i=Array.prototype.slice.call(arguments,1);t.apply(null,i)?s.doWhilst(e,t,n):n()})},s.until=function(e,t,n){e()?n():t(function(r){if(r)return n(r);s.until(e,t,n)})},s.doUntil=function(e,t,n){e(function(r){if(r)return n(r);var i=Array.prototype.slice.call(arguments,1);t.apply(null,i)?n():s.doUntil(e,t,n)})},s.queue=function(e,t){function n(e,t,n,r){if(e.started||(e.started=!0),l(t)||(t=[t]),0==t.length)return s.setImmediate(function(){e.drain&&e.drain()});d(t,function(t){var i={data:t,callback:"function"==typeof r?r:null};n?e.tasks.unshift(i):e.tasks.push(i),e.saturated&&e.tasks.length===e.concurrency&&e.saturated(),s.setImmediate(e.process)})}void 0===t&&(t=1);var r=0,i={tasks:[],concurrency:t,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(e,t){n(i,e,!1,t)},kill:function(){i.drain=null,i.tasks=[]},unshift:function(e,t){n(i,e,!0,t)},process:function(){if(!i.paused&&r<i.concurrency&&i.tasks.length){var t=i.tasks.shift();i.empty&&0===i.tasks.length&&i.empty(),r+=1;var n=c(function(){r-=1,t.callback&&t.callback.apply(t,arguments),i.drain&&i.tasks.length+r===0&&i.drain(),i.process()});e(t.data,n)}},length:function(){return i.tasks.length},running:function(){return r},idle:function(){return i.tasks.length+r===0},pause:function(){!0!==i.paused&&(i.paused=!0,i.process())},resume:function(){!1!==i.paused&&(i.paused=!1,i.process())}};return i},s.priorityQueue=function(e,t){function n(e,t){return e.priority-t.priority}var r=s.queue(e,t);return r.push=function(e,t,i){!function(e,t,r,i){if(e.started||(e.started=!0),l(t)||(t=[t]),0==t.length)return s.setImmediate(function(){e.drain&&e.drain()});d(t,function(t){var o={data:t,priority:r,callback:"function"==typeof i?i:null};e.tasks.splice(function(e,t,n){for(var r=-1,i=e.length-1;r<i;){var o=r+(i-r+1>>>1);n(t,e[o])>=0?r=o:i=o-1}return r}(e.tasks,o,n)+1,0,o),e.saturated&&e.tasks.length===e.concurrency&&e.saturated(),s.setImmediate(e.process)})}(r,e,t,i)},delete r.unshift,r},s.cargo=function(e,t){var n=!1,r=[],i={tasks:r,payload:t,saturated:null,empty:null,drain:null,drained:!0,push:function(e,n){l(e)||(e=[e]),d(e,function(e){r.push({data:e,callback:"function"==typeof n?n:null}),i.drained=!1,i.saturated&&r.length===t&&i.saturated()}),s.setImmediate(i.process)},process:function o(){if(!n){if(0===r.length)return i.drain&&!i.drained&&i.drain(),void(i.drained=!0);var a="number"==typeof t?r.splice(0,t):r.splice(0,r.length),s=f(a,function(e){return e.data});i.empty&&i.empty(),n=!0,e(s,function(){n=!1;var e=arguments;d(a,function(t){t.callback&&t.callback.apply(null,e)}),o()})}},length:function(){return r.length},running:function(){return n}};return i};var T=function(e){return function(t){var n=Array.prototype.slice.call(arguments,1);t.apply(null,n.concat([function(t){var n=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(t?console.error&&console.error(t):console[e]&&d(n,function(t){console[e](t)}))}]))}};s.log=T("log"),s.dir=T("dir"),s.memoize=function(e,t){var n={},r={};t=t||function(e){return e};var i=function(){var i=Array.prototype.slice.call(arguments),o=i.pop(),a=t.apply(null,i);a in n?s.nextTick(function(){o.apply(null,n[a])}):a in r?r[a].push(o):(r[a]=[o],e.apply(null,i.concat([function(){n[a]=arguments;var e=r[a];delete r[a];for(var t=0,i=e.length;t<i;t++)e[t].apply(null,arguments)}])))};return i.memo=n,i.unmemoized=e,i},s.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},s.times=function(e,t,n){for(var r=[],i=0;i<e;i++)r.push(i);return s.map(r,t,n)},s.timesSeries=function(e,t,n){for(var r=[],i=0;i<e;i++)r.push(i);return s.mapSeries(r,t,n)},s.seq=function(){var e=arguments;return function(){var t=this,n=Array.prototype.slice.call(arguments),r=n.pop();s.reduce(e,n,function(e,n,r){n.apply(t,e.concat([function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);r(e,t)}]))},function(e,n){r.apply(t,[e].concat(n))})}},s.compose=function(){return s.seq.apply(null,Array.prototype.reverse.call(arguments))};var w=function(e,t){var n=function(){var n=this,r=Array.prototype.slice.call(arguments),i=r.pop();return e(t,function(e,t){e.apply(n,r.concat([t]))},i)};if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return n.apply(this,r)}return n};s.applyEach=v(w),s.applyEachSeries=m(w),s.forever=function(e,t){!function n(r){if(r){if(t)return t(r);throw r}e(n)}()},e.exports?e.exports=s:void 0===(i=function(){return s}.apply(t,[]))||(e.exports=i)}()}).call(this,n(49),n(126).setImmediate)},function(e,t){e.exports={integerHash:function(e){if(!e)return 0;var t,n=0;for(t=0;t<e.length;t++)n+=e.charCodeAt(t)*Math.pow(31,e.length-1-t),n=Math.abs(0|n);return n}}},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return s});var r=n(4),i=n(31);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=Object(r.getLogger)(e),s=function(){function e(t,n,r,i,o,a,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sid=t,this.localJid=n,this.remoteJid=r,this.connection=i,this.mediaConstraints=o,this.iceConfig=a,this.isInitiator=s,this.usedrip=!0,this.dripContainer=[],this.room=null,this.state=null,this.rtc=null}var t,n,r;return t=e,(n=[{key:"initialize",value:function(e,t,n){if(null!==this.state){var r="attempt to initiate on session ".concat(this.sid,"\n                   in state ").concat(this.state);throw a.error(r),new Error(r)}this.room=e,this.rtc=t,this.state=i.c,this.doInitialize(n)}},{key:"doInitialize",value:function(e){}},{key:"addIceCandidates",value:function(e){}},{key:"getState",value:function(){return this.state}},{key:"addSources",value:function(e){}},{key:"removeSources",value:function(e){}},{key:"terminate",value:function(e,t,n){}},{key:"acceptOffer",value:function(e,t,n){}},{key:"_getInitiatorJid",value:function(){return this.isInitiator?this.localJid:this.remoteJid}},{key:"initiatorJid",get:function(){return this.isInitiator?this.localJid:this.remoteJid}},{key:"responderJid",get:function(){return this.isInitiator?this.remoteJid:this.localJid}}])&&o(t.prototype,n),r&&o(t,r),e}()}).call(this,"modules/xmpp/JingleSession.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return p});var r=n(4),i=n(9),o=n(38),a=n(88);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=Object(r.getLogger)(e),p=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=u(this,l(t).call(this))).ssrcOwners=new Map,e.chatRoom=null,e}var n,r,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,a["a"]),n=t,(r=[{key:"setChatRoom",value:function(e){var t=this,n=this.chatRoom;this.chatRoom=e,n&&(n.removePresenceListener("audiomuted",this._audioMuteHandler),n.removePresenceListener("videomuted",this._videoMuteHandler),n.removePresenceListener("videoType",this._videoTypeHandler)),e&&(this._audioMuteHandler=function(e,n){t.eventEmitter.emit(o.a,n,i.a,"true"===e.value)},e.addPresenceListener("audiomuted",this._audioMuteHandler),this._videoMuteHandler=function(e,n){t.eventEmitter.emit(o.a,n,i.b,"true"===e.value)},e.addPresenceListener("videomuted",this._videoMuteHandler),this._videoTypeHandler=function(e,n){t.eventEmitter.emit(o.b,n,e.value)},e.addPresenceListener("videoType",this._videoTypeHandler))}},{key:"getPeerMediaInfo",value:function(e,t){if(this.chatRoom)return this.chatRoom.getMediaPresenceInfo(e,t);f.error("Requested peer media info, before room was set")}},{key:"getSSRCOwner",value:function(e){return this.ssrcOwners.get(e)}},{key:"setSSRCOwner",value:function(e,t){if("number"!=typeof e)throw new TypeError("SSRC(".concat(e,") must be a number"));this.ssrcOwners.set(e,t)}}])&&c(n.prototype,r),s&&c(n,s),t}()}).call(this,"modules/xmpp/SignalingLayerImpl.js")},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(24);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,s(t).apply(this,arguments))}var n,i,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,r["a"]),n=t,(i=[{key:"getSSRCOwner",value:function(e){throw new Error("not implemented")}},{key:"getPeerMediaInfo",value:function(e,t){throw new Error("not implemented")}}])&&o(n.prototype,i),u&&o(n,u),t}()},function(e,t,n){"use strict";(function(e){var r=n(4),i=n(1),o=n(10),a=n.n(o),s=Object(r.getLogger)(e),c=-1,u=/request id \d+.\d+ got 200/,l=/request errored, status: (\d+), number of errors: \d+/;t.a=function(){i.Strophe.log=function(e,t){switch(s.trace("Strophe",e,t),"string"==typeof t&&-1!==t.indexOf("Request ")&&-1!==t.indexOf("timed out (secondary), restarting")&&(e=i.Strophe.LogLevel.WARN),e){case i.Strophe.LogLevel.DEBUG:-1!==c&&u.test(t)&&(s.debug("Reset lastErrorStatus"),c=-1);break;case i.Strophe.LogLevel.WARN:s.warn("Strophe: ".concat(t));var n=l.exec(t);n&&2===n.length&&(c=parseInt(n[1],10),s.debug("lastErrorStatus set to: ".concat(c)));break;case i.Strophe.LogLevel.ERROR:case i.Strophe.LogLevel.FATAL:t="Strophe: ".concat(t),a.a.callErrorHandler(new Error(t)),s.error(t)}},i.Strophe.getLastErrorStatus=function(){return c},i.Strophe.getStatusString=function(e){switch(e){case i.Strophe.Status.ERROR:return"ERROR";case i.Strophe.Status.CONNECTING:return"CONNECTING";case i.Strophe.Status.CONNFAIL:return"CONNFAIL";case i.Strophe.Status.AUTHENTICATING:return"AUTHENTICATING";case i.Strophe.Status.AUTHFAIL:return"AUTHFAIL";case i.Strophe.Status.CONNECTED:return"CONNECTED";case i.Strophe.Status.DISCONNECTED:return"DISCONNECTED";case i.Strophe.Status.DISCONNECTING:return"DISCONNECTING";case i.Strophe.Status.ATTACHED:return"ATTACHED";default:return"unknown"}}}}).call(this,"modules/xmpp/strophe.util.js")},function(e,t,n){"use strict";(function(e){var r=n(4),i=n(1),o=n(10),a=n.n(o),s=n(35);function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e,t,n){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=Object(r.getLogger)(e),v=12,m=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=l(this,f(t).call(this))).failedPings=0,n.xmpp=e,n.pingExecIntervals=new Array(v),n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,s["b"]),n=t,(r=[{key:"init",value:function(e){d(f(t.prototype),"init",this).call(this,e),i.Strophe.addNamespace("PING","urn:xmpp:ping")}},{key:"ping",value:function(e,t,n,r){this._addPingExecutionTimestamp();var o=Object(i.$iq)({type:"get",to:e});o.c("ping",{xmlns:i.Strophe.NS.PING}),this.connection.sendIQ(o,t,n,r)}},{key:"startInterval",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4;if(this.intervalId){var r="Ping task scheduled already";return a.a.callErrorHandler(new Error(r)),void h.error(r)}this.intervalId=window.setInterval(function(){t.ping(e,function(){t.failedPings=0},function(e){t.failedPings+=1;var n="Ping ".concat(e?"error":"timeout");t.failedPings>=3?(a.a.callErrorHandler(new Error(n)),h.error(n,e)):h.warn(n,e)},15e3)},n),h.info("XMPP pings will be sent every ".concat(n," ms"))}},{key:"stopInterval",value:function(){this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null,this.failedPings=0,h.info("Ping interval cleared"))}},{key:"_addPingExecutionTimestamp",value:function(){this.pingExecIntervals.push((new Date).getTime()),this.pingExecIntervals.length>v&&this.pingExecIntervals.shift()}},{key:"getPingSuspendTime",value:function(){var e=this.pingExecIntervals.slice();e.push((new Date).getTime());var t=0,n=e[0];return e.forEach(function(e){var r=e-n;r>t&&(t=r),n=e}),t-=1e4,Math.max(t,0)}}])&&u(n.prototype,r),o&&u(n,o),t}();t.a=function(e){i.Strophe.addConnectionPlugin("ping",new m(e))}}).call(this,"modules/xmpp/strophe.ping.js")},function(e,t,n){"use strict";(function(e){var r=n(4),i=n(1),o=n(35);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e,t,n){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=Object(r.getLogger)(e),p=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),c(this,l(t).apply(this,arguments))}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,o["b"]),n=t,(r=[{key:"init",value:function(e){u(l(t.prototype),"init",this).call(this,e),this.connection.addHandler(this.onRayo.bind(this),"urn:xmpp:rayo:1","iq","set",null,null)}},{key:"onRayo",value:function(e){f.info("Rayo IQ",e)}},{key:"dial",value:function(e,t,n,r,o){var a=this;return new Promise(function(s,c){if(o){var u=Object(i.$iq)({type:"set",to:o});u.c("dial",{xmlns:"urn:xmpp:rayo:1",to:e,from:t}),u.c("header",{name:"JvbRoomName",value:n}).up(),r&&r.length&&u.c("header",{name:"JvbRoomPassword",value:r}).up(),a.connection.sendIQ(u,function(e){f.info("Dial result ",e);var t=$(e).find("ref").attr("uri");a.callResource=t.substr("xmpp:".length),f.info("Received call resource: ".concat(a.callResource)),s()},function(e){f.info("Dial error ",e),c(e)})}else c(new Error("Internal error!"))})}},{key:"hangup",value:function(){var e=this;return new Promise(function(t,n){if(!e.callResource)return n(new Error("No call in progress")),void f.warn("No call in progress");var r=Object(i.$iq)({type:"set",to:e.callResource});r.c("hangup",{xmlns:"urn:xmpp:rayo:1"}),e.connection.sendIQ(r,function(n){f.info("Hangup result ",n),e.callResource=null,t()},function(t){f.info("Hangup error ",t),e.callResource=null,n(new Error("Hangup error "))})})}}])&&s(n.prototype,r),a&&s(n,a),t}();t.a=function(){i.Strophe.addConnectionPlugin("rayo",new p)}}).call(this,"modules/xmpp/strophe.rayo.js")},function(e,t,n){"use strict";var r=n(1),i=n(35);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e,t,n){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=s(this,u(t).call(this))).log=[],e}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,i["b"]),n=t,(r=[{key:"init",value:function(e){c(u(t.prototype),"init",this).call(this,e),this.connection.rawInput=this.logIncoming.bind(this),this.connection.rawOutput=this.logOutgoing.bind(this)}},{key:"logIncoming",value:function(e){this.log.push([(new Date).getTime(),"incoming",e])}},{key:"logOutgoing",value:function(e){this.log.push([(new Date).getTime(),"outgoing",e])}}])&&a(n.prototype,r),o&&a(n,o),t}();t.a=function(){r.Strophe.addConnectionPlugin("logger",new d)}},function(e,t,n){"use strict";n.d(t,"a",function(){return v});var r=n(1),i=n(0),o=n.n(i),a=n(24);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var f=["category","type","lang","name"],p=["category","type","lang"];function h(e,t){var n=0;return p.some(function(r){return 0!==(n=e[r]>t[r]?1:e[r]<t[r]&&-1)}),n}var v=function(e){function t(){var e,n,i,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"http://jitsi.org/jitsimeet";if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,i=u(t).call(this),(e=!i||"object"!==s(i)&&"function"!=typeof i?d(n):i).node=c,e.disco=a.disco,!e.disco)throw new Error("Missing strophe-plugins (disco plugin is required)!");e.versionToCapabilities=Object.create(null),e.jidToVersion=Object.create(null),e.version="",e.rooms=new Set;var l=a.emuc;return l.addListener(o.a.EMUC_ROOM_ADDED,function(t){return e._addChatRoom(t)}),l.addListener(o.a.EMUC_ROOM_REMOVED,function(t){return e._removeChatRoom(t)}),Object.keys(l.rooms).forEach(function(t){e._addChatRoom(l.rooms[t])}),r.Strophe.addNamespace("CAPS","http://jabber.org/protocol/caps"),e.disco.addFeature(r.Strophe.NS.CAPS),a.addHandler(e._handleCaps.bind(d(d(e))),r.Strophe.NS.CAPS),e._onMucMemberLeft=e._removeJidToVersionEntry.bind(d(d(e))),e}var n,i,p;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,a["a"]),n=t,(i=[{key:"addFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.disco.addFeature(e),this._generateVersion(),t&&this.submit()}},{key:"removeFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.disco.removeFeature(e),this._generateVersion(),t&&this.submit()}},{key:"submit",value:function(){this.rooms.forEach(function(e){return e.sendPresence()})}},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,r=e in this.jidToVersion?this.jidToVersion[e]:null;if(!(r&&r.version in this.versionToCapabilities)){var i=r?"".concat(r.node,"#").concat(r.version):null;return this._getDiscoInfo(e,i,n).then(function(e){var n=e.features;return r&&(t.versionToCapabilities[r.version]=n),n})}return Promise.resolve(this.versionToCapabilities[r.version])}},{key:"getFeaturesAndIdentities",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;return this._getDiscoInfo(e,null,t)}},{key:"_getDiscoInfo",value:function(e,t,n){var r=this;return new Promise(function(i,o){return r.disco.info(e,t,function(e){var t=new Set,n=new Set;$(e).find(">query>feature").each(function(e,n){return t.add(n.getAttribute("var"))}),$(e).find(">query>identity").each(function(e,t){return n.add({type:t.getAttribute("type"),name:t.getAttribute("name"),category:t.getAttribute("category")})}),i({features:t,identities:n})},o,n)})}},{key:"_addChatRoom",value:function(e){this.rooms.add(e),e.addListener(o.a.MUC_MEMBER_LEFT,this._onMucMemberLeft),this._fixChatRoomPresenceMap(e)}},{key:"_removeChatRoom",value:function(e){this.rooms.delete(e),e.removeListener(o.a.MUC_MEMBER_LEFT,this._onMucMemberLeft)}},{key:"_fixChatRoomPresenceMap",value:function(e){e.addToPresence("c",{attributes:{xmlns:r.Strophe.NS.CAPS,hash:"sha-1",node:this.node,ver:this.version}})}},{key:"_notifyVersionChanged",value:function(){var e=this;this.rooms.forEach(function(t){return e._fixChatRoomPresenceMap(t)}),this.submit()}},{key:"_generateVersion",value:function(){var e=this.disco._identities.sort(h).reduce(function(e,t){return"".concat(f.reduce(function(e,n,r){return e+(0===r?"":"/")+t[n]},""),"<")},""),t=this.disco._features.sort().reduce(function(e,t){return"".concat(e+t,"<")},"");this.version=Object(r.b64_sha1)(e+t),this._notifyVersionChanged()}},{key:"_handleCaps",value:function(e){var t=e.getAttribute("from"),n=e.querySelector("c"),r=n.getAttribute("ver"),i=n.getAttribute("node"),a=this.jidToVersion[t];return this.jidToVersion[t]={version:r,node:i},a&&a.version!==r&&this.eventEmitter.emit(o.a.PARTCIPANT_FEATURES_CHANGED,t),!0}},{key:"_removeJidToVersionEntry",value:function(e){e in this.jidToVersion&&delete this.jidToVersion[e]}}])&&c(n.prototype,i),p&&c(n,p),t}()},function(e,t,n){(function(e){n(4).getLogger(e)}).call(this,"modules/DTMF/JitsiDTMFManager.js")},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(2);function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.conference=t,t.addEventListener(r.TRACK_AUDIO_LEVEL_CHANGED,this._audioLevel.bind(this)),this.myUserID=this.conference.myUserId()}var t,n,o;return t=e,(n=[{key:"_audioLevel",value:function(e,t){!this.conference.isP2PActive()||t<=.6||e===this.myUserID&&this.conference.getLocalAudioTrack().isMuted()||this.conference.eventEmitter.emit(r.DOMINANT_SPEAKER_CHANGED,e)}}])&&i(t.prototype,n),o&&i(t,o),e}()},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return l});var r=n(4),i=n(8),o=n.n(i),a=n(10),s=n.n(a);function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=Object(r.getLogger)(e),l=function(){function e(t,n,r){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!t&&!n)throw new TypeError("At least peerconnection or wsUrl must be given");if(t&&n)throw new TypeError("Just one of peerconnection or wsUrl must be given");if(t?u.debug("constructor() with peerconnection"):u.debug('constructor() with wsUrl:"'.concat(n,'"')),this._channel=null,this._eventEmitter=r,this._mode=null,t){var i=t.createDataChannel("JVB data channel",{protocol:"http://jitsi.org/protocols/colibri"});this._handleChannel(i),this._mode="datachannel"}else if(n){var o=new WebSocket(n);this._handleChannel(o),this._mode="websocket"}}var t,n,r;return t=e,(n=[{key:"close",value:function(){if(this._channel){try{this._channel.close()}catch(e){}this._channel=null}}},{key:"isOpen",value:function(){return this._channel&&("open"===this._channel.readyState||this._channel.readyState===WebSocket.OPEN)}},{key:"sendMessage",value:function(e,t){this._send({colibriClass:"EndpointMessage",msgPayload:t,to:e})}},{key:"sendSetLastNMessage",value:function(e){var t={colibriClass:"LastNChangedEvent",lastN:e};this._send(t),u.log("Channel lastN set to: ".concat(e))}},{key:"sendPinnedEndpointMessage",value:function(e){u.log("sending pinned changed notification to the bridge for endpoint ",e),this._send({colibriClass:"PinnedEndpointChangedEvent",pinnedEndpoint:e||null})}},{key:"sendSelectedEndpointsMessage",value:function(e){u.log("sending selected changed notification to the bridge for endpoints",e),this._send({colibriClass:"SelectedEndpointsChangedEvent",selectedEndpoints:e})}},{key:"sendReceiverVideoConstraintMessage",value:function(e){u.log("sending a ReceiverVideoConstraint message with "+"a maxFrameHeight of ".concat(e," pixels")),this._send({colibriClass:"ReceiverVideoConstraint",maxFrameHeight:e})}},{key:"_handleChannel",value:function(e){var t=this,n=this._eventEmitter;e.onopen=function(){u.info("".concat(t._mode," channel opened")),n.emit(o.a.DATA_CHANNEL_OPEN)},e.onerror=function(e){u.error("Channel error:",e)},e.onmessage=function(e){var t,r=e.data;try{t=JSON.parse(r)}catch(e){return s.a.callErrorHandler(e),void u.error("Failed to parse channel message as JSON: ",r,e)}var i=t.colibriClass;switch(i){case"DominantSpeakerEndpointChangeEvent":var a=t.dominantSpeakerEndpoint;u.info("Channel new dominant speaker event: ",a),n.emit(o.a.DOMINANT_SPEAKER_CHANGED,a);break;case"EndpointConnectivityStatusChangeEvent":var c=t.endpoint,l="true"===t.active;u.info("Endpoint connection status changed: ".concat(c," active ? ").concat(l)),n.emit(o.a.ENDPOINT_CONN_STATUS_CHANGED,c,l);break;case"EndpointMessage":n.emit(o.a.ENDPOINT_MESSAGE_RECEIVED,t.from,t.msgPayload);break;case"LastNEndpointsChangeEvent":var d=t.lastNEndpoints;u.info("Channel new last-n event: ",d,t),n.emit(o.a.LASTN_ENDPOINT_CHANGED,d,t);break;case"SelectedUpdateEvent":var f=t.isSelected;u.info("SelectedUpdateEvent isSelected? ".concat(f)),n.emit(o.a.IS_SELECTED_CHANGED,f);break;default:u.debug("Channel JSON-formatted message: ",t),n.emit("rtc.datachannel.".concat(i),t)}},e.onclose=function(){u.info("Channel closed"),t._channel=null},this._channel=e}},{key:"_send",value:function(e){var t=this._channel;if(!this.isOpen())throw new Error("No opened channel");t.send(JSON.stringify(e))}},{key:"mode",get:function(){return this._mode}}])&&c(t.prototype,n),r&&c(t,r),e}()}).call(this,"modules/RTC/BridgeChannel.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return E});var r=n(4),i=n(34),o=n.n(i),a=n(55),s=n(26),c=n(27),u=n(36),l=n.n(u),d=n(5);function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y=Object(r.getLogger)(e),b={stable:"stable",haveLocalOffer:"have-local-offer",haveRemoteOffer:"have-remote-offer",closed:"closed"},S={new:"new",gathering:"gathering",complete:"complete"},_="jitsi-ortc-cname-".concat(l.a.randomInt(1e4,99999)),E=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=v(this,m(t).call(this)),y.debug("constructor() pcConfig:",e),n._bufferedIceCandidates=[],n._closed=!1,n._dtlsTransport=null,n._iceGatherer=null,n._iceGatheringState=S.new,n._resolveLocalIceGatheringPromise=null,n._iceGatheringCompletePromise=new Promise(function(e){n._resolveLocalIceGatheringPromise=e}),n._iceTransport=null,n._localCapabilities=null,n._localDescription=null,n._localTrackInfos=new Map,n._mids=new Map,n._remoteDescription=null,n._remoteStreams=new Map,n._remoteTrackInfos=new Map,n._sdpGlobalFields={id:d.a.generateSsrc(),version:0},n._signalingState=b.stable,n._setIceGatherer(e),n._setIceTransport(n._iceGatherer),n._setDtlsTransport(n._iceTransport),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,o.a.EventTarget),n=t,(r=[{key:"addIceCandidate",value:function(e){if(!e)throw new TypeError("candidate missing");return y.debug("addIceCandidate() candidate:",e),this._closed?Promise.reject(new c.a("RTCPeerConnection closed")):Promise.reject(new Error("addIceCandidate() not supported"))}},{key:"addStream",value:function(e){if(y.debug("addStream()"),this._closed)throw new c.a("RTCPeerConnection closed");var t=!0,n=!1,r=void 0;try{for(var i,o=e.getTracks()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if("ended"!==a.readyState)if(this._localTrackInfos.has(a.id))y.warn("ignoring already handled MediaStreamTrack");else{var s=new RTCRtpSender(a,this._dtlsTransport);this._localTrackInfos.set(a.id,{rtpSender:s,stream:e})}else y.warn("ignoring ended MediaStreamTrack")}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}var u=!0,l=!1,d=void 0;try{for(var f,h=this._localTrackInfos[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var v=p(f.value,2),m=v[0],g=v[1],b=g.rtpSender.track;if("ended"===b.readyState){y.warn("addStream() an already handled track was stopped, "+"track.id:".concat(b.id));try{g.rtpSender.stop()}catch(e){y.warn("rtpSender.stop() failed:".concat(e))}this._localTrackInfos.delete(b.id)}else if(g.stream===e&&!e.getTrackById(m)){y.warn("addStream() a track in this stream was removed, "+"track.id:".concat(m));try{g.rtpSender.stop()}catch(e){y.warn("rtpSender.stop() failed:".concat(e))}this._localTrackInfos.delete(b.id)}}}catch(e){l=!0,d=e}finally{try{u||null==h.return||h.return()}finally{if(l)throw d}}this._emitNegotiationNeeded()}},{key:"close",value:function(){if(!this._closed){this._closed=!0,y.debug("close()"),this._updateAndEmitSignalingStateChange(b.closed);try{this._iceGatherer.close()}catch(e){y.warn("iceGatherer.close() failed:".concat(e))}try{this._iceTransport.stop()}catch(e){y.warn("iceTransport.stop() failed:".concat(e))}try{this._dtlsTransport.stop()}catch(e){y.warn("dtlsTransport.stop() failed:".concat(e))}var e=!0,t=!1,n=void 0;try{for(var r,i=this._localTrackInfos.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value.rtpSender;try{o.stop()}catch(e){y.warn("rtpSender.stop() failed:".concat(e))}}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}this._localTrackInfos.clear();var a=!0,s=!1,c=void 0;try{for(var u,l=this._remoteTrackInfos.values()[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var d=u.value.rtpReceiver;try{d.stop()}catch(e){y.warn("rtpReceiver.stop() failed:".concat(e))}}}catch(e){s=!0,c=e}finally{try{a||null==l.return||l.return()}finally{if(s)throw c}}this._remoteTrackInfos.clear(),this._remoteStreams.clear()}}},{key:"createAnswer",value:function(e){if(y.debug("createAnswer() options:",e),this._closed)return Promise.reject(new c.a("RTCPeerConnection closed"));if(this.signalingState!==b.haveRemoteOffer)return Promise.reject(new c.a('invalid signalingState "'.concat(this.signalingState,'"')));var t=this._createLocalDescription("answer");return Promise.resolve(t)}},{key:"createDataChannel",value:function(){throw y.debug("createDataChannel()"),new Error("createDataChannel() not supported in Edge")}},{key:"createOffer",value:function(e){var t=this;return y.debug("createOffer() options:",e),this._closed?Promise.reject(new c.a("RTCPeerConnection closed")):this.signalingState!==b.stable?Promise.reject(new c.a('invalid signalingState "'.concat(this.signalingState,'"'))):this._iceGatheringCompletePromise.then(function(){return t.hasAttemptedOffer||(t._mids.size||(t._mids=new Map([["audio","audio"],["video","video"]])),t._localCapabilities||(t._localCapabilities=s.g(RTCRtpSender.getCapabilities())),t.hasAttemptedOffer=!0),t._createLocalDescription("offer")})}},{key:"getLocalStreams",value:function(){return Array.from(this._localTrackInfos.values()).map(function(e){return e.stream}).filter(function(e,t,n){return n.indexOf(e)===t})}},{key:"getRemoteStreams",value:function(){return Array.from(this._remoteStreams.values())}},{key:"getStats",value:function(){var e,t,n,r;if("function"==typeof(arguments.length<=0?void 0:arguments[0])?(e=!1,n=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1]):"function"==typeof(arguments.length<=1?void 0:arguments[1])?(e=!1,t=arguments.length<=0?void 0:arguments[0],n=arguments.length<=1?void 0:arguments[1],r=arguments.length<=2?void 0:arguments[2]):(e=!0,t=arguments.length<=0?void 0:arguments[0]),e||r||(r=function(e){y.error("getStats() failed: ".concat(e)),y.error(e.stack)}),e)return this._getStats(t);this._getStats(t).then(function(e){return n(e)}).catch(function(e){return r(e)})}},{key:"removeStream",value:function(e){if(y.debug("removeStream()"),this._closed)throw new c.a("RTCPeerConnection closed");var t=!0,n=!1,r=void 0;try{for(var i,o=e.getTracks()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(this._localTrackInfos.has(a.id)){var s=this._localTrackInfos.get(a.id).rtpSender;try{s.stop()}catch(e){y.warn("rtpSender.stop() failed:".concat(e))}this._localTrackInfos.delete(a.id)}}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}this._emitNegotiationNeeded()}},{key:"setLocalDescription",value:function(e){if(!e)throw new TypeError("description missing");return y.debug("setLocalDescription() desc:",e),this._setLocalDescription(e)}},{key:"setRemoteDescription",value:function(e){if(!e)throw new TypeError("description missing");return y.debug("setRemoteDescription() desc:",e),this._setRemoteDescription(e)}},{key:"_createLocalDescription",value:function(e){var t={},n=this._iceGatherer.getLocalParameters(),r=this._iceGatherer.getLocalCandidates(),i=this._dtlsTransport.getLocalParameters(),o="answer"===e?this._dtlsTransport.getRemoteParameters():null,s=this._localCapabilities,c=this._localTrackInfos;"offer"===e&&this._sdpGlobalFields.version++,t.version=0,t.origin={address:"127.0.0.1",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"jitsi-ortc-webrtc-shim"},t.name="-",t.timing={start:0,stop:0},t.msidSemantic={semantic:"WMS",token:"*"},t.groups=[{mids:Array.from(this._mids.keys()).join(" "),type:"BUNDLE"}],t.media=[],t.fingerprint={hash:i.fingerprints[0].value,type:i.fingerprints[0].algorithm};var u=!1,l=!0,f=!1,h=void 0;try{for(var v,m=s.codecs[Symbol.iterator]();!(l=(v=m.next()).done);l=!0){var g=v.value;if("video"===g.kind&&"rtx"===g.name){u=!0;break}}}catch(e){f=!0,h=e}finally{try{l||null==m.return||m.return()}finally{if(f)throw h}}var b=!0,S=!1,E=void 0;try{for(var C,T=this._mids[Symbol.iterator]();!(b=(C=T.next()).done);b=!0){var w=p(C.value,2),k=w[0],R=w[1];I.call(this,k,R)}}catch(e){S=!0,E=e}finally{try{b||null==T.return||T.return()}finally{if(S)throw E}}var P=new a.a({type:e,_sdpObject:t});return y.debug("_createLocalDescription():",P),P;function I(i,a){var l={};switch(l.type=a,a){case"audio":case"video":l.protocol="RTP/SAVPF",l.port=9,l.direction="sendrecv";break;case"application":l.protocol="DTLS/SCTP",l.port=0,l.payloads="0",l.direction="inactive"}l.connection={ip:"127.0.0.1",version:4},l.mid=i,l.iceUfrag=n.usernameFragment,l.icePwd=n.password,l.candidates=[];var f=!0,p=!1,h=void 0;try{for(var v,m=r[Symbol.iterator]();!(f=(v=m.next()).done);f=!0){var g=v.value,y={component:1};y.foundation=g.foundation,y.ip=g.ip,y.port=g.port,y.priority=g.priority,y.transport=g.protocol.toLowerCase(),y.type=g.type,"tcp"===y.transport&&(y.tcptype=g.tcpType),l.candidates.push(y)}}catch(e){p=!0,h=e}finally{try{f||null==m.return||m.return()}finally{if(p)throw h}}if(l.endOfCandidates="end-of-candidates",l.setup="offer"===e?"actpass":"server"===o.role?"active":"passive","audio"===a||"video"===a){l.rtp=[],l.rtcpFb=[],l.fmtp=[];var b=[],S=!0,E=!1,C=void 0;try{for(var T,w=s.codecs[Symbol.iterator]();!(S=(T=w.next()).done);S=!0){var k=T.value;if(!k.kind||k.kind===a){b.push(k.preferredPayloadType);var R={codec:k.name,payload:k.preferredPayloadType,rate:k.clockRate};if(k.numChannels>1&&(R.encoding=k.numChannels),l.rtp.push(R),k.parameters){for(var P={config:"",payload:k.preferredPayloadType},I=Object.keys(k.parameters),O=0;O<I.length;O++){var A=I[O];P.config&&(P.config+=";"),P.config+="".concat(A,"=").concat(k.parameters[A])}P.config&&l.fmtp.push(P)}var M=!0,D=!1,N=void 0;try{for(var x,L=(k.rtcpFeedback||[])[Symbol.iterator]();!(M=(x=L.next()).done);M=!0){var j=x.value;l.rtcpFb.push({payload:k.preferredPayloadType,subtype:j.parameter||void 0,type:j.type})}}catch(e){D=!0,N=e}finally{try{M||null==L.return||L.return()}finally{if(D)throw N}}}}}catch(e){E=!0,C=e}finally{try{S||null==w.return||w.return()}finally{if(E)throw C}}0===b.length?(l.payloads="9",l.port=0,l.direction="inactive"):l.payloads=b.join(" "),l.ssrcs=[],l.ssrcGroups=[];var F=!0,U=!1,H=void 0;try{for(var B,G=c.values()[Symbol.iterator]();!(F=(B=G.next()).done);F=!0){var J=B.value,V=J.rtpSender,W=J.stream.id,q=V.track;if("ended"!==q.readyState&&q.kind===a){J.ssrc||(J.ssrc=d.a.generateSsrc());var K=u&&"video"===q.kind;K&&!J.rtxSsrc&&(J.rtxSsrc=J.ssrc+1),l.ssrcs.push({attribute:"cname",id:J.ssrc,value:_}),l.ssrcs.push({attribute:"msid",id:J.ssrc,value:"".concat(W," ").concat(q.id)}),l.ssrcs.push({attribute:"mslabel",id:J.ssrc,value:W}),l.ssrcs.push({attribute:"label",id:J.ssrc,value:q.id}),K&&(l.ssrcs.push({attribute:"cname",id:J.rtxSsrc,value:_}),l.ssrcs.push({attribute:"msid",id:J.rtxSsrc,value:"".concat(W," ").concat(q.id)}),l.ssrcs.push({attribute:"mslabel",id:J.rtxSsrc,value:W}),l.ssrcs.push({attribute:"label",id:J.rtxSsrc,value:q.id}),l.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(J.ssrc," ").concat(J.rtxSsrc)}))}}}catch(e){U=!0,H=e}finally{try{F||null==G.return||G.return()}finally{if(U)throw H}}l.ext=[];var z=!0,Q=!1,$=void 0;try{for(var X,Y=s.headerExtensions[Symbol.iterator]();!(z=(X=Y.next()).done);z=!0){var Z=X.value;Z.kind&&Z.kind!==a||l.ext.push({value:Z.preferredId,uri:Z.uri})}}catch(e){Q=!0,$=e}finally{try{z||null==Y.return||Y.return()}finally{if(Q)throw $}}l.rtcpMux="rtcp-mux",l.rtcpRsize="rtcp-rsize"}t.media.push(l)}}},{key:"_emitAddStream",value:function(e){if(!this._closed){y.debug('emitting "addstream"');var t=new o.a.Event("addstream");t.stream=e,this.dispatchEvent(t)}}},{key:"_emitBufferedIceCandidates",value:function(){if(!this._closed){var e=!0,t=!1,n=void 0;try{for(var r,i=this._bufferedIceCandidates[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value;if(a){a.sdpMIndex=this._mids.keys().next().value,y.debug('emitting buffered "icecandidate", candidate:',a);var s=new o.a.Event("icecandidate");s.candidate=a,this.dispatchEvent(s)}}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}this._bufferedIceCandidates=[]}}},{key:"_emitConnectionStateChange",value:function(){if(!this._closed||"closed"===this.connectionState){y.debug('emitting "connectionstatechange", connectionState:',this.connectionState);var e=new o.a.Event("connectionstatechange");this.dispatchEvent(e)}}},{key:"_emitIceCandidate",value:function(e){if(!this._closed){var t=null;if(e){var n=this._mids.keys().next().value,r="candidate:".concat(e.foundation," 1 ").concat(e.protocol)+" ".concat(e.priority," ").concat(e.ip," ").concat(e.port)+" typ ".concat(e.type);e.relatedAddress&&(r+=" raddr ".concat(e.relatedAddress)),e.relatedPort&&(r+=" rport ".concat(e.relatedPort)),"tcp"===e.protocol&&(r+=" tcptype ".concat(e.tcpType)),t={candidate:r,component:1,foundation:e.foundation,ip:e.ip,port:e.port,priority:e.priority,protocol:e.protocol,type:e.type,sdpMIndex:n,sdpMLineIndex:0},"tcp"===e.protocol&&(t.tcptype=e.tcpType),e.relatedAddress&&(t.relatedAddress=e.relatedAddress),e.relatedPort&&(t.relatedPort=e.relatedPort)}if(this._localDescription){y.debug('emitting "icecandidate", candidate:',t);var i=new o.a.Event("icecandidate");i.candidate=t,this.dispatchEvent(i)}else y.debug("buffering gathered ICE candidate:",t),this._bufferedIceCandidates.push(t)}}},{key:"_emitIceConnectionStateChange",value:function(){if(!this._closed||"closed"===this.iceConnectionState){y.debug('emitting "iceconnectionstatechange", iceConnectionState:',this.iceConnectionState);var e=new o.a.Event("iceconnectionstatechange");this.dispatchEvent(e)}}},{key:"_emitNegotiationNeeded",value:function(){if(this.signalingState===b.stable){y.debug('emitting "negotiationneeded"');var e=new o.a.Event("negotiationneeded");this.dispatchEvent(e)}}},{key:"_emitRemoveStream",value:function(e){if(!this._closed){y.debug('emitting "removestream"');var t=new o.a.Event("removestream");t.stream=e,this.dispatchEvent(t)}}},{key:"_getParametersForRtpReceiver",value:function(e,t){var n,r=t.ssrc,i=t.rtxSsrc,o=t.cname,a=this._localCapabilities,s={codecs:[],degradationPreference:"balanced",encodings:[],headerExtensions:[],muxId:"",rtcp:{cname:o,compound:!0,mux:!0,reducedSize:!0}},c=[],u=!0,l=!1,d=void 0;try{for(var f,p=a.codecs[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){var h=f.value;if(h.kind===e&&"rtx"!==h.name){n=h.preferredPayloadType,c.push({clockRate:h.clockRate,maxptime:h.maxptime,mimeType:h.mimeType,name:h.name,numChannels:h.numChannels,parameters:h.parameters,payloadType:h.preferredPayloadType,ptime:h.ptime,rtcpFeedback:h.rtcpFeedback});break}}}catch(e){l=!0,d=e}finally{try{u||null==p.return||p.return()}finally{if(l)throw d}}if(i){var v=!0,m=!1,g=void 0;try{for(var y,b=a.codecs[Symbol.iterator]();!(v=(y=b.next()).done);v=!0){var S=y.value;if(S.kind===e&&"rtx"===S.name){c.push({clockRate:S.clockRate,mimeType:S.mimeType,name:"rtx",parameters:S.parameters,payloadType:S.preferredPayloadType,rtcpFeedback:S.rtcpFeedback});break}}}catch(e){m=!0,g=e}finally{try{v||null==b.return||b.return()}finally{if(m)throw g}}}s.codecs=c;var _={active:!0,codecPayloadType:n,ssrc:r};i&&(_.rtx={ssrc:i}),s.encodings.push(_);var E=!0,C=!1,T=void 0;try{for(var w,k=a.headerExtensions[Symbol.iterator]();!(E=(w=k.next()).done);E=!0){var R=w.value;R.kind===e&&s.headerExtensions.push({encrypt:R.preferredEncrypt,id:R.preferredId,uri:R.uri})}}catch(e){C=!0,T=e}finally{try{E||null==k.return||k.return()}finally{if(C)throw T}}return s}},{key:"_getParametersForRtpSender",value:function(e,t){var n,r=t.ssrc,i=t.rtxSsrc,o=_,a=this._localCapabilities,s={codecs:[],degradationPreference:"balanced",encodings:[],headerExtensions:[],muxId:"",rtcp:{cname:o,compound:!0,mux:!0,reducedSize:!0}},c=[],u=!0,l=!1,d=void 0;try{for(var f,p=a.codecs[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){var h=f.value;if(h.kind===e&&"rtx"!==h.name){n=h.preferredPayloadType,c.push({clockRate:h.clockRate,maxptime:h.maxptime,mimeType:h.mimeType,name:h.name,numChannels:h.numChannels,parameters:h.parameters,payloadType:h.preferredPayloadType,ptime:h.ptime,rtcpFeedback:h.rtcpFeedback});break}}}catch(e){l=!0,d=e}finally{try{u||null==p.return||p.return()}finally{if(l)throw d}}if(i){var v=!0,m=!1,g=void 0;try{for(var y,b=a.codecs[Symbol.iterator]();!(v=(y=b.next()).done);v=!0){var S=y.value;if(S.kind===e&&"rtx"===S.name){c.push({clockRate:S.clockRate,mimeType:S.mimeType,name:"rtx",parameters:S.parameters,payloadType:S.preferredPayloadType,rtcpFeedback:S.rtcpFeedback});break}}}catch(e){m=!0,g=e}finally{try{v||null==b.return||b.return()}finally{if(m)throw g}}}s.codecs=c;var E={active:!0,codecPayloadType:n,ssrc:r};i&&(E.rtx={ssrc:i}),s.encodings.push(E);var C=!0,T=!1,w=void 0;try{for(var k,R=a.headerExtensions[Symbol.iterator]();!(C=(k=R.next()).done);C=!0){var P=k.value;P.kind===e&&s.headerExtensions.push({encrypt:P.preferredEncrypt,id:P.preferredId,uri:P.uri})}}catch(e){T=!0,w=e}finally{try{C||null==R.return||R.return()}finally{if(T)throw w}}return s}},{key:"_getStats",value:function(e){if(this._closed)return Promise.reject(new c.a("RTCPeerConnection closed"));var t=this._iceGatherer,n=this._iceTransport,r=[],i=[],o=[],a=!0,s=!1,u=void 0;try{for(var l,d=this._localTrackInfos.values()[Symbol.iterator]();!(a=(l=d.next()).done);a=!0){var f=l.value,p=f.rtpSender;f.sending&&r.push(p)}}catch(e){s=!0,u=e}finally{try{a||null==d.return||d.return()}finally{if(s)throw u}}var h=!0,v=!1,m=void 0;try{for(var g,y=this._remoteTrackInfos.values()[Symbol.iterator]();!(h=(g=y.next()).done);h=!0){var b=g.value.rtpReceiver;i.push(b)}}catch(e){v=!0,m=e}finally{try{h||null==y.return||y.return()}finally{if(v)throw m}}t&&o.push(t.getStats().catch(function(){return null})),n&&(o.push(n.getStats().catch(function(){return null})),"function"==typeof n.msGetStats&&o.push(n.msGetStats().catch(function(){return null})));for(var S=function(){var e=r[_],t="audio"===e.track.kind;o.push(e.getStats().then(function(e){if(!t)for(var n=Object.keys(e),r=0;r<n.length;r++){var i=e[n[r]];"track"===i.type&&delete i.audioLevel}return e}).catch(function(){return null}))},_=0;_<r.length;_++)S();for(var E=function(){var e=i[C],t="audio"===e.track.kind;o.push(e.getStats().then(function(e){if(!t)for(var n=Object.keys(e),r=0;r<n.length;r++){var i=e[n[r]];"track"===i.type&&delete i.audioLevel}return e}).catch(function(){return null}))},C=0;C<i.length;C++)E();return Promise.all(o).then(function(e){var t={},n=!0,r=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if(s)for(var c=Object.keys(s),u=0;u<c.length;u++){var l=c[u];t[l]=s[l]}}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return t})}},{key:"_handleLocalInitialAnswer",value:function(e){y.debug("_handleLocalInitialAnswer(), desc:",e);var t=e.sdpObject;this._localCapabilities=s.a(t),y.debug("local capabilities:",this._localCapabilities)}},{key:"_handleLocalReAnswer",value:function(e){y.debug("_handleLocalReAnswer(), desc:",e);var t=e.sdpObject;this._localCapabilities=s.a(t),y.debug("local capabilities:",this._localCapabilities)}},{key:"_handleRemoteInitialOffer",value:function(e){y.debug("_handleRemoteInitialOffer(), desc:",e);var t=e.sdpObject;this._mids=s.e(t);var n=s.a(t);y.debug("remote capabilities:",n),this._localCapabilities=s.g(n),this._startIceAndDtls(e)}},{key:"_handleRemoteReOffer",value:function(e){y.debug("_handleRemoteReOffer(), desc:",e);var t=e.sdpObject;this._mids=s.e(t);var n=s.a(t);y.debug("remote capabilities:",n),this._localCapabilities=s.g(n)}},{key:"_receiveMedia",value:function(){y.debug("_receiveMedia()");var e=new Set(this._remoteTrackInfos.keys()),t=s.f(this._remoteDescription.sdpObject),n=new Map,r=new Map,i=new Map;y.debug("_receiveMedia() remote track infos:",t);var o=!0,a=!1,c=void 0;try{for(var u,l=t[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var d=p(u.value,2),f=d[0],h=d[1];if(!e.has(f)){y.debug("_receiveMedia() new remote track, ssrc:".concat(f)),this._remoteTrackInfos.set(f,h);var v=h.kind,m=h.rtxSsrc,g=h.streamId,b=h.trackId,S=h.cname,_=!this._remoteStreams.has(g),E=void 0;_?(y.debug("_receiveMedia() new remote stream, id:".concat(g)),(E=new MediaStream).jitsiRemoteId=g,n.set(g,E),this._remoteStreams.set(g,E)):E=this._remoteStreams.get(g);var C=new RTCRtpReceiver(this._dtlsTransport,v),T=this._getParametersForRtpReceiver(v,{ssrc:f,rtxSsrc:m,cname:S});h.track=C.track,C.onerror=function(e){y.error('rtpReceiver "error" event, event:'),y.error(e)},h.stream=E,h.rtpReceiver=C,y.debug("calling rtpReceiver.receive(), parameters:",T);try{C.receive(T);var w=h.track;w.jitsiRemoteId=b,E.addTrack(w),n.has(g)||r.set(w,E)}catch(e){y.error("rtpReceiver.receive() failed:".concat(e.message)),y.error(e)}}}}catch(e){a=!0,c=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw c}}var k=!0,R=!1,P=void 0;try{for(var I,O=e[Symbol.iterator]();!(k=(I=O.next()).done);k=!0){f=I.value;if(!t.has(f)){y.debug("_receiveMedia() remote track removed, ssrc:".concat(f));var A=(h=this._remoteTrackInfos.get(f)).stream,M=h.track,D=h.rtpReceiver;try{D.stop()}catch(e){y.warn("rtpReceiver.stop() failed:".concat(e))}i.set(M,A),A.removeTrack(M),this._remoteTrackInfos.delete(f)}}}catch(e){R=!0,P=e}finally{try{k||null==O.return||O.return()}finally{if(R)throw P}}var N=!0,x=!1,L=void 0;try{for(var j,F=r[Symbol.iterator]();!(N=(j=F.next()).done);N=!0){var U=p(j.value,2),H=U[0],B=U[1],G=new Event("addtrack");G.track=H,B.dispatchEvent(G)}}catch(e){x=!0,L=e}finally{try{N||null==F.return||F.return()}finally{if(x)throw L}}var J=!0,V=!1,W=void 0;try{for(var q,K=i[Symbol.iterator]();!(J=(q=K.next()).done);J=!0){var z=p(q.value,2),Q=z[0],$=z[1],X=new Event("removetrack");X.track=Q,$.dispatchEvent(X)}}catch(e){V=!0,W=e}finally{try{J||null==K.return||K.return()}finally{if(V)throw W}}var Y=!0,Z=!1,ee=void 0;try{for(var te,ne=n.values()[Symbol.iterator]();!(Y=(te=ne.next()).done);Y=!0){var re=te.value;0===re.getTracks().length?(y.warn("ignoring new stream for which no track could be added"),n.delete(re.jitsiRemoteId),this._remoteStreams.delete(re.jitsiRemoteId)):this._emitAddStream(re)}}catch(e){Z=!0,ee=e}finally{try{Y||null==ne.return||ne.return()}finally{if(Z)throw ee}}var ie=!0,oe=!1,ae=void 0;try{for(var se,ce=this._remoteStreams[Symbol.iterator]();!(ie=(se=ce.next()).done);ie=!0){var ue=p(se.value,2),le=ue[0],de=ue[1];de.getTracks().length>0||(this._remoteStreams.delete(le),this._emitRemoveStream(de))}}catch(e){oe=!0,ae=e}finally{try{ie||null==ce.return||ce.return()}finally{if(oe)throw ae}}}},{key:"_sendMedia",value:function(){y.debug("_sendMedia()");var e=!0,t=!1,n=void 0;try{for(var r,i=this._localTrackInfos.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;if(!o.sending){var a=o.rtpSender,s=o.ssrc,c=o.rtxSsrc,u=a.track.kind,l=this._getParametersForRtpSender(u,{ssrc:s,rtxSsrc:c});y.debug("calling rtpSender.send(), parameters:",l);try{a.send(l),o.sending=!0}catch(e){y.error("rtpSender.send() failed:".concat(e.message)),y.error(e)}}}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"_setDtlsTransport",value:function(e){var t=this,n=new RTCDtlsTransport(e);n.onstatechange=function(){y.debug('dtlsTransport "statechange" event, '+"state:".concat(n.state)),t._emitConnectionStateChange()},n.ondtlsstatechange=function(){y.debug('dtlsTransport "dtlsstatechange" event, '+"state:".concat(n.state)),t._emitConnectionStateChange()},n.onerror=function(e){var n;e.message?n=e.message:e.error&&(n=e.error.message),y.error('dtlsTransport "error" event, message:'.concat(n)),t._emitConnectionStateChange()},this._dtlsTransport=n}},{key:"_setIceGatherer",value:function(e){var t=this,n={gatherPolicy:e.iceTransportPolicy||"all",iceServers:e.iceServers},r=new RTCIceGatherer(n);r.onstatechange=function(){y.debug('iceGatherer "statechange" event, state:'.concat(r.state)),t._updateAndEmitIceGatheringStateChange(r.state)},r.onlocalcandidate=function(e){var n=e.candidate,r=e.complete;y.debug('iceGatherer "localcandidate" event, candidate:',n),r||!n||0===Object.keys(n).length?(n=null,t._updateAndEmitIceGatheringStateChange(S.complete),t._resolveLocalIceGatheringPromise(),t._emitIceCandidate(null)):t._emitIceCandidate(n)},r.onerror=function(e){var t=e.errorCode,n=e.errorText;y.error('iceGatherer "error" event, errorCode:'.concat(t,", ")+"errorText:".concat(n))};try{r.gather()}catch(e){y.warn("iceGatherer.gather() failed:".concat(e))}this._iceGatherer=r}},{key:"_setIceTransport",value:function(e){var t=this,n=new RTCIceTransport(e);n.onstatechange=function(){y.debug('iceTransport "statechange" event, '+"state:".concat(n.state)),t._emitIceConnectionStateChange()},n.onicestatechange=function(){y.debug('iceTransport "icestatechange" event, '+"state:".concat(n.state)),"completed"===n.state&&y.debug("nominated candidate pair:",n.getNominatedCandidatePair()),t._emitIceConnectionStateChange()},n.oncandidatepairchange=function(e){y.debug('iceTransport "candidatepairchange" event, '+"pair:".concat(e.pair))},this._iceTransport=n}},{key:"_setLocalDescription",value:function(e){var t,n=this;if(this._closed)return Promise.reject(new c.a("RTCPeerConnection closed"));try{t=new a.a(e)}catch(e){return Promise.reject(new TypeError("invalid RTCSessionDescriptionInit: ".concat(e)))}switch(e.type){case"offer":return this.signalingState!==b.stable?Promise.reject(new c.a('invalid signalingState "'.concat(this.signalingState,'"'))):Promise.resolve().then(function(){var e=t.sdpObject;n._localCapabilities=s.a(e),n._localDescription=t,n._updateAndEmitSignalingStateChange(b.haveLocalOffer)}).catch(function(e){throw y.error("setLocalDescription() failed: ".concat(e.message)),y.error(e),e});case"answer":if(this.signalingState!==b.haveRemoteOffer)return Promise.reject(new c.a('invalid signalingState "'.concat(this.signalingState,'"')));var r=Boolean(!this._localDescription);return Promise.resolve().then(function(){return r?n._handleLocalInitialAnswer(t):n._handleLocalReAnswer(t)}).then(function(){y.debug("setLocalDescription() succeed"),n._localDescription=t,n._updateAndEmitSignalingStateChange(b.stable),r&&n._emitBufferedIceCandidates(),n._sendMedia(),n._receiveMedia()}).catch(function(e){throw y.error("setLocalDescription() failed: ".concat(e.message)),y.error(e),e});default:return Promise.reject(new TypeError('unsupported description.type "'.concat(e.type,'"')))}}},{key:"_setRemoteDescription",value:function(e){var t,n=this;if(this._closed)return Promise.reject(new c.a("RTCPeerConnection closed"));try{t=new a.a(e)}catch(e){return Promise.reject(new TypeError("invalid RTCSessionDescriptionInit: ".concat(e)))}switch(e.type){case"offer":if(this.signalingState!==b.stable)return Promise.reject(new c.a('invalid signalingState "'.concat(this.signalingState,'"')));var r=Boolean(!this._remoteDescription);return Promise.resolve().then(function(){return r?n._handleRemoteInitialOffer(t):n._handleRemoteReOffer(t)}).then(function(){y.debug("setRemoteDescription() succeed"),n._remoteDescription=t,n._updateAndEmitSignalingStateChange(b.haveRemoteOffer)}).catch(function(e){throw y.error("setRemoteDescription() failed: ".concat(e)),e});case"answer":return this.signalingState!==b.haveLocalOffer?Promise.reject(new c.a('invalid signalingState "'.concat(this.signalingState,'"'))):Promise.resolve().then(function(){n._remoteDescription=t,n._updateAndEmitSignalingStateChange(b.stable)}).catch(function(e){throw y.error("setRemoteDescription() failed: ".concat(e)),e});default:return Promise.reject(new TypeError('unsupported description.type "'.concat(e.type,'"')))}}},{key:"_startIceAndDtls",value:function(e){var t=e.sdpObject,n=s.d(t),r=s.c(t),i=s.b(t);switch(e.type){case"offer":this._iceTransport.start(this._iceGatherer,n,"controlled");break;case"answer":this._iceTransport.start(this._iceGatherer,n,"controlling")}var o=!0,a=!1,c=void 0;try{for(var u,l=r[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var d=u.value;0!==d.port&&9!==d.port&&this._iceTransport.addRemoteCandidate(d)}}catch(e){a=!0,c=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw c}}switch(this._iceTransport.addRemoteCandidate({}),e.type){case"offer":i.role="server";break;case"answer":i.role="client"}this._dtlsTransport.start(i)}},{key:"_updateAndEmitIceGatheringStateChange",value:function(e){if(!this._closed&&e!==this.iceGatheringState){this._iceGatheringState=e,y.debug('emitting "icegatheringstatechange", iceGatheringState:',this.iceGatheringState);var t=new o.a.Event("icegatheringstatechange");this.dispatchEvent(t)}}},{key:"_updateAndEmitSignalingStateChange",value:function(e){if(e!==this.signalingState){this._signalingState=e,y.debug('emitting "signalingstatechange", signalingState:',this.signalingState);var t=new o.a.Event("signalingstatechange");this.dispatchEvent(t)}}},{key:"connectionState",get:function(){return this._dtlsTransport.state}},{key:"iceConnectionState",get:function(){return this._iceTransport.state}},{key:"iceGatheringState",get:function(){return this._iceGatheringState}},{key:"localDescription",get:function(){return this._localDescription}},{key:"remoteDescription",get:function(){return this._remoteDescription}},{key:"signalingState",get:function(){return this._signalingState}}])&&h(n.prototype,r),i&&h(n,i),t}()}).call(this,"modules/RTC/ortc/RTCPeerConnection.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return k});var r=n(4),i=n(16),o=n.n(i),a=n(10),s=n(99),c=n(9),u=n(100),l=n(13),d=n(11),f=n(3),p=n(8),h=n.n(p),v=n(101),m=n(18),g=n(102),y=n(28),b=n(5),S=n(38);function _(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var C=Object(r.getLogger)(e),T=3,w=["1","2","3"];function k(e,t,r,i,o,a,s){var c=this;this.audioTransferActive=!0,this.videoTransferActive=!0,this.rtc=e,this.id=t,this.isP2P=a,this.remoteTracks=new Map,this.localTracks=new Map,this._addedStreams=[],this.localSSRCs=new Map,this.localUfrag=null,this.remoteUfrag=null,this.signalingLayer=r,this._peerVideoTypeChanged=this._peerVideoTypeChanged.bind(this),this.signalingLayer.on(S.b,this._peerVideoTypeChanged),this._peerMutedChanged=this._peerMutedChanged.bind(this),this.signalingLayer.on(S.a,this._peerMutedChanged),this.options=s,this.peerconnection=new d.a.RTCPeerConnectionType(i,o),this.updateLog=[],this.stats={},this.statsinterval=null,this.maxstats=s.maxstats;var l=n(143).Interop;this.interop=new l;var f=n(147);this.simulcast=new f({numOfLayers:T,explodeRemoteSimulcast:!1}),this.sdpConsistency=new g.a(this.toString()),this.localSdpMunger=new u.a(this),this.eventEmitter=e.eventEmitter,this.rtxModifier=new v.a,this.trace=function(e,t){C.debug(e,t),c.updateLog.push({time:new Date,type:e,value:t||""})},this.onicecandidate=null,this.peerconnection.onicecandidate=function(e){c.trace("onicecandidate",JSON.stringify(e.candidate,null," ")),null!==c.onicecandidate&&c.onicecandidate(e)},this.peerconnection.onaddstream=function(e){return c._remoteStreamAdded(e.stream)},this.peerconnection.onremovestream=function(e){return c._remoteStreamRemoved(e.stream)},this.onsignalingstatechange=null,this.peerconnection.onsignalingstatechange=function(e){c.trace("onsignalingstatechange",c.signalingState),null!==c.onsignalingstatechange&&c.onsignalingstatechange(e)},this.oniceconnectionstatechange=null,this.peerconnection.oniceconnectionstatechange=function(e){c.trace("oniceconnectionstatechange",c.iceConnectionState),null!==c.oniceconnectionstatechange&&c.oniceconnectionstatechange(e)},this.onnegotiationneeded=null,this.peerconnection.onnegotiationneeded=function(e){c.trace("onnegotiationneeded"),null!==c.onnegotiationneeded&&c.onnegotiationneeded(e)},this.ondatachannel=null,this.peerconnection.ondatachannel=function(e){c.trace("ondatachannel"),null!==c.ondatachannel&&c.ondatachannel(e)},this.maxstats&&(this.statsinterval=window.setInterval(function(){c.getStats(function(e){if(e.result&&"function"==typeof e.result)for(var t=e.result(),n=function(e){var n=t[e];n.names().forEach(function(e){c._processStat(n,e,n.stat(e))})},r=0;r<t.length;++r)n(r);else e.forEach(function(e){return c._processStat(e,"",e)})},function(){})},1e3)),C.info("Create new ".concat(this))}k.prototype._processStat=function(e,t,n){var r="".concat(e.id,"-").concat(t),i=this.stats[r],o=new Date;i||(this.stats[r]=i={startTime:o,endTime:o,values:[],times:[]}),i.values.push(n),i.times.push(o.getTime()),i.values.length>this.maxstats&&(i.values.shift(),i.times.shift()),i.endTime=o};var R=function(e){return null==e?"":"type: ".concat(e.type,"\r\n").concat(e.sdp)};k.prototype.getConnectionState=function(){var e=this.peerconnection.iceConnectionState;return"completed"===e?"connected":e},k.prototype._getDesiredMediaDirection=function(e){var t=!0;return e===c.a?t=this.audioTransferActive:e===c.b&&(t=this.videoTransferActive),t?this.hasAnyTracksOfType(e)?"sendrecv":"recvonly":"inactive"},k.prototype.isSimulcastOn=function(){return!this.options.disableSimulcast&&f.a.supportsSimulcast()&&(!f.a.isFirefox()||this.options.enableFirefoxSimulcast)},k.prototype._peerVideoTypeChanged=function(e,t){if(e){var n=this.getRemoteTracks(e,c.b);n.length&&n[0]._setVideoType(t)}else C.error("No endpointID on peerVideoTypeChanged ".concat(this))},k.prototype._peerMutedChanged=function(e,t,n){if(e){var r=this.getRemoteTracks(e,t);r.length&&r[0].setMute(n)}else C.error("On peerMuteChanged - no endpoint ID")},k.prototype.getLocalTracks=function(e){var t=Array.from(this.localTracks.values());return void 0!==e&&(t=t.filter(function(t){return t.getType()===e})),t},k.prototype.hasAnyTracksOfType=function(e){if(!e)throw new Error('"mediaType" is required');return this.getLocalTracks(e).length>0},k.prototype.getRemoteTracks=function(e,t){var n=[],r=e?[e]:this.remoteTracks.keys(),i=!0,o=!1,a=void 0;try{for(var s,c=r[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value,l=this.remoteTracks.get(u);if(l){var d=!0,f=!1,p=void 0;try{for(var h,v=l.keys()[Symbol.iterator]();!(d=(h=v.next()).done);d=!0){var m=h.value;if(!t||t===m){var g=l.get(m);g&&n.push(g)}}}catch(e){f=!0,p=e}finally{try{d||null==v.return||v.return()}finally{if(f)throw p}}}}}catch(e){o=!0,a=e}finally{try{i||null==c.return||c.return()}finally{if(o)throw a}}return n},k.prototype.getTrackBySSRC=function(e){if("number"!=typeof e)throw new Error("SSRC ".concat(e," is not a number"));var t=!0,n=!1,r=void 0;try{for(var i,o=this.localTracks.values()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(this.getLocalSSRC(a)===e)return a}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}var s=!0,c=!1,u=void 0;try{for(var l,d=this.getRemoteTracks()[Symbol.iterator]();!(s=(l=d.next()).done);s=!0){var f=l.value;if(f.getSSRC()===e)return f}}catch(e){c=!0,u=e}finally{try{s||null==d.return||d.return()}finally{if(c)throw u}}return null},k.prototype.getSsrcByTrackId=function(e){var t=function(t){return t.getTrack().id===e},n=this.getLocalTracks().find(t);if(n)return this.getLocalSSRC(n);var r=this.getRemoteTracks().find(t);return r?r.getSSRC():null},k.prototype._remoteStreamAdded=function(e){var t=this,n=l.a.getStreamID(e);if(l.a.isUserStreamById(n)){(f.a.isChromiumBased()||f.a.isEdge())&&(e.onaddtrack=function(n){t._remoteTrackAdded(e,n.track)},e.onremovetrack=function(n){t._remoteTrackRemoved(e,n.track)});var r=e.getAudioTracks(),i=!0,o=!1,a=void 0;try{for(var s,c=r[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;this._remoteTrackAdded(e,u)}}catch(e){o=!0,a=e}finally{try{i||null==c.return||c.return()}finally{if(o)throw a}}var d=e.getVideoTracks(),p=!0,h=!1,v=void 0;try{for(var m,g=d[Symbol.iterator]();!(p=(m=g.next()).done);p=!0){var y=m.value;this._remoteTrackAdded(e,y)}}catch(e){h=!0,v=e}finally{try{p||null==g.return||g.return()}finally{if(h)throw v}}}else C.info("".concat(this," ignored remote 'stream added' event for non-user stream")+"id: ".concat(n))},k.prototype._remoteTrackAdded=function(e,t){var n=l.a.getStreamID(e),r=t.kind;if(C.info("".concat(this," remote track added:"),n,r),r){var i=new m.a(this.remoteDescription.sdp).media.filter(function(e){return e.startsWith("m=".concat(r))});if(i.length){var o=b.a.findLines(i[0],"a=ssrc:");if((o=o.filter(function(e){return-1!==e.indexOf("msid:".concat(n))})).length){var s=o[0].substring(7).split(" ")[0],c=Number(s),u=this.signalingLayer.getSSRCOwner(c);if(isNaN(c)||c<0)a.callErrorHandler(new Error("Invalid SSRC: ".concat(s," for remote track, msid: ").concat(n," media type: ").concat(r)));else if(u){C.log("".concat(this," associated ssrc"),u,c);var d=this.signalingLayer.getPeerMediaInfo(u,r);if(d){var f=d.muted,p=d.videoType;this._createRemoteTrack(u,e,t,r,p,c,f)}else a.callErrorHandler(new Error("".concat(this,": no peer media info available for ").concat(u)))}else a.callErrorHandler(new Error("No SSRC owner known for: ".concat(c," for remote track, msid: ").concat(n," media type: ").concat(r)))}else a.callErrorHandler(new Error("No SSRC lines for streamId ".concat(n," for remote track, media type: ").concat(r)))}else a.callErrorHandler(new Error("No media lines for type ".concat(r," found in remote SDP for remote track: ").concat(n)))}else a.callErrorHandler(new Error("MediaType undefined for remote track, stream id: ".concat(n)))},k.prototype._createRemoteTrack=function(e,t,n,r,i,o,a){var c=this.remoteTracks.get(e);c||(c=new Map,this.remoteTracks.set(e,c));var u=c.get(r);if(u&&u.getTrack()===n)C.info("".concat(this," ignored duplicated remote track added event for: ")+"".concat(e,", ").concat(r));else{u&&C.error("".concat(this," overwriting remote track for")+"".concat(e," ").concat(r));var l=new s.a(this.rtc,this.rtc.conference,e,t,n,r,i,o,a,this.isP2P);c.set(r,l),this.eventEmitter.emit(h.a.REMOTE_TRACK_ADDED,l)}},k.prototype._remoteStreamRemoved=function(e){if(l.a.isUserStream(e)){var t=e.getVideoTracks(),n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;this._remoteTrackRemoved(e,s)}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}var c=e.getAudioTracks(),u=!0,d=!1,f=void 0;try{for(var p,h=c[Symbol.iterator]();!(u=(p=h.next()).done);u=!0){var v=p.value;this._remoteTrackRemoved(e,v)}}catch(e){d=!0,f=e}finally{try{u||null==h.return||h.return()}finally{if(d)throw f}}}else{var m=l.a.getStreamID(e);C.info("Ignored remote 'stream removed' event for non-user stream ".concat(m))}},k.prototype._remoteTrackRemoved=function(e,t){var n=l.a.getStreamID(e),r=t&&l.a.getTrackID(t);C.info("".concat(this," - remote track removed: ").concat(n,", ").concat(r)),n?r?this._removeRemoteTrackById(n,r)||C.warn("".concat(this," Removed track not found for msid: ").concat(n,",\n             track id: ").concat(r)):a.callErrorHandler(new Error("".concat(this," remote track removal failed - no track ID"))):a.callErrorHandler(new Error("".concat(this," remote track removal failed - no stream ID")))},k.prototype._getRemoteTrackById=function(e,t){var n=!0,r=!1,i=void 0;try{for(var o,a=this.remoteTracks.values()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,c=!0,u=!1,l=void 0;try{for(var d,f=s.values()[Symbol.iterator]();!(c=(d=f.next()).done);c=!0){var p=d.value;if(p.getStreamId()==e&&p.getTrackId()==t)return p}}catch(e){u=!0,l=e}finally{try{c||null==f.return||f.return()}finally{if(u)throw l}}}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}},k.prototype.removeRemoteTracks=function(e){var t=[],n=this.remoteTracks.get(e);if(n){var r=n.get(c.a),i=n.get(c.b);r&&t.push(r),i&&t.push(i),this.remoteTracks.delete(e)}return C.debug("".concat(this," removed remote tracks for ").concat(e," count: ").concat(t.length)),t},k.prototype._removeRemoteTrack=function(e){e.dispose();var t=e.getParticipantId(),n=this.remoteTracks.get(t);n?n.delete(e.getType())||C.error("Failed to remove ".concat(e," - type mapping messed up ?")):C.error("removeRemoteTrack: no remote tracks map for ".concat(t)),this.eventEmitter.emit(h.a.REMOTE_TRACK_REMOVED,e)},k.prototype._removeRemoteTrackById=function(e,t){var n=this._getRemoteTrackById(e,t);return n&&this._removeRemoteTrack(n),n};var P=function(e){if("object"!==E(e)||null===e||"string"!=typeof e.sdp)return C.warn("An empty description was passed as an argument."),e;var t=n(16),r=t.parse(e.sdp);void 0!==r&&void 0!==r.media&&Array.isArray(r.media)&&r.media.forEach(function(e){var t=[],n=[];if(void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&e.ssrcGroups.forEach(function(e){void 0!==e.semantics&&"FID"===e.semantics&&void 0!==e.ssrcs&&t.push(Number(e.ssrcs.split(" ")[0]))}),Array.isArray(e.ssrcs)){var r;for(r=0;r<e.ssrcs.length;r++)"object"===E(e.ssrcs[r])&&void 0!==e.ssrcs[r].id&&t.indexOf(e.ssrcs[r].id)>=0&&(n.push(e.ssrcs[r]),delete e.ssrcs[r]);for(r=0;r<e.ssrcs.length;r++)void 0!==e.ssrcs[r]&&n.push(e.ssrcs[r]);e.ssrcs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!f.a.isChrome()||!f.a.isVersionGreaterThan(70))return e;var t=_(e);return e.filter(function(e){return"mslabel"===e.attribute&&"-"===e.value}).map(function(e){return e.id}).forEach(function(e){var n=t.find(function(t){return t.id===e&&"cname"===t.attribute});n.value="recvonly-".concat(e),(t=t.filter(function(t){return t.id!==e})).push(n)}),t}(n)}});var i=t.write(r);return new RTCSessionDescription({type:e.type,sdp:i})};k.prototype.getLocalSSRC=function(e){var t=this._getSSRC(e.rtcId);return t&&t.ssrcs[0]},k.prototype._injectSsrcGroupForUnifiedSimulcast=function(e){var t=o.a.parse(e.sdp),n=t.media.find(function(e){return"video"===e.type});if(n.simulcast_03){var r=[];if(n.ssrcs.forEach(function(e){"msid"===e.attribute&&r.push(e.id)}),n.ssrcGroups=n.ssrcGroups||[],n.ssrcGroups.find(function(e){return"SIM"===e.semantics}))return e;n.ssrcGroups.push({semantics:"SIM",ssrcs:r.join(" ")})}return new RTCSessionDescription({type:e.type,sdp:o.a.write(t)})};var I={signalingState:function(){return this.peerconnection.signalingState},iceConnectionState:function(){return this.peerconnection.iceConnectionState},localDescription:function(){var e=this.peerconnection.localDescription;return e?(this.trace("getLocalDescription::preTransform",R(e)),f.a.usesUnifiedPlan()&&(e=this.interop.toPlanB(e),this.trace("getLocalDescription::postTransform (Plan B)",R(e)),e=this._injectSsrcGroupForUnifiedSimulcast(e),this.trace("getLocalDescription::postTransform (inject ssrc group)",R(e))),f.a.doesVideoMuteByStreamRemove()&&(e=this.localSdpMunger.maybeAddMutedLocalVideoTracksToSDP(e),C.debug("getLocalDescription::postTransform (munge local SDP)",e)),e=function(e){if(!e)throw new Error("No local description passed in.");var t=new y.a(e.sdp),n=t.selectMedia("audio"),r=!1;n&&"sendrecv"!==n.direction&&(n.direction="sendrecv",r=!0);var i=t.selectMedia("video");return i&&"sendrecv"!==i.direction&&(i.direction="sendrecv",r=!0),r?new RTCSessionDescription({type:e.type,sdp:t.toRawSDP()}):e}(e),e=this.localSdpMunger.transformStreamIdentifiers(e)):(C.debug("getLocalDescription no localDescription found"),{})},remoteDescription:function(){var e=this.peerconnection.remoteDescription;return this.trace("getRemoteDescription::preTransform",R(e)),f.a.usesUnifiedPlan()&&(e=this.interop.toPlanB(e),this.trace("getRemoteDescription::postTransform (Plan B)",R(e))),e||{}}};Object.keys(I).forEach(function(e){Object.defineProperty(k.prototype,e,{get:I[e]})}),k.prototype._getSSRC=function(e){return this.localSSRCs.get(e)},k.prototype.addTrack=function(e){var t=e.rtcId;if(C.info("add ".concat(e," to: ").concat(this)),this.localTracks.has(t))C.error("".concat(e," is already in ").concat(this));else{this.localTracks.set(t,e);var n=e.getOriginalStream();if(n?this._addStream(n):(!f.a.doesVideoMuteByStreamRemove()||e.isAudioTrack()||e.isVideoTrack()&&!e.isMuted())&&C.error("".concat(this," no WebRTC stream for: ").concat(e)),f.a.doesVideoMuteByStreamRemove()&&e.isVideoTrack()&&e.isMuted()){var r=this.generateNewStreamSSRCInfo(e);this.sdpConsistency.setPrimarySsrc(r.ssrcs[0]);var i=r.groups.find(function(e){return"SIM"===e.semantics});i&&this.simulcast.setSsrcCache(i.ssrcs);var o=r.groups.filter(function(e){return"FID"===e.semantics});if(o){var a=new Map;o.forEach(function(e){var t=e.ssrcs[0],n=e.ssrcs[1];a.set(t,n)}),this.rtxModifier.setSsrcCache(a)}}}},k.prototype.addTrackUnmute=function(e){if(!this._assertTrackBelongs("addTrackUnmute",e))return!1;C.info("Adding ".concat(e," as unmute to ").concat(this));var t=e.getOriginalStream();return t?(this._addStream(t),!0):(C.error("Unable to add ".concat(e," as unmute to ").concat(this," - no WebRTC stream")),!1)},k.prototype._addStream=function(e){this.peerconnection.addStream(e),this._addedStreams.push(e)},k.prototype._removeStream=function(e){f.a.isFirefox()?this._handleFirefoxRemoveStream(e):this.peerconnection.removeStream(e),this._addedStreams=this._addedStreams.filter(function(t){return t!==e})},k.prototype._assertTrackBelongs=function(e,t){var n=this.localTracks.has(t.rtcId);return n||C.error("".concat(e,": ").concat(t," does not belong to ").concat(this)),n},k.prototype.isMediaStreamInPc=function(e){return this._addedStreams.indexOf(e)>-1},k.prototype.removeTrack=function(e){var t=e.getOriginalStream();this.trace("removeStream",e.rtcId,t?t.id:void 0),this._assertTrackBelongs("removeStream",e)&&(this.localTracks.delete(e.rtcId),this.localSSRCs.delete(e.rtcId),t&&(f.a.isFirefox()?this._handleFirefoxRemoveStream(t):this.peerconnection.removeStream(t)))},k.prototype.findSenderByStream=function(e){var t=e.getTracks()[0];if(t)return this.peerconnection.getSenders().find(function(e){return e.track===t});C.error("Cannot find sender: no tracks.")},k.prototype.replaceTrack=function(e,t){var n=this;if(f.a.isFirefox()&&e&&t){var r=this.findSenderByStream(e.getOriginalStream()),i=t.getOriginalStream();if(r&&i){var o=i.getTracks()[0];if(o)return r.replaceTrack(o,i).then(function(){var r=n.localSSRCs.get(e.rtcId);return n.localTracks.delete(e.rtcId),n.localSSRCs.delete(e.rtcId),n._addedStreams=n._addedStreams.filter(function(e){return e!==i}),n.localTracks.set(t.rtcId,t),t.storedMSID=e.storedMSID,n._addedStreams.push(i),n.localSSRCs.set(t.rtcId,r),n.eventEmitter.emit(h.a.LOCAL_TRACK_SSRC_UPDATED,t,O(r)),!1})}}return e&&this.removeTrack(e),t&&this.addTrack(t),Promise.resolve(!0)},k.prototype.removeTrackMute=function(e){var t=e.getOriginalStream();return this.trace("removeStreamMute",e.rtcId,t?t.id:null),!!this._assertTrackBelongs("removeStreamMute",e)&&(t?(C.info("Removing ".concat(e," as mute from ").concat(this)),this._removeStream(t),!0):(C.error("removeStreamMute - no WebRTC stream for ".concat(e)),!1))},k.prototype._handleFirefoxRemoveStream=function(e){if(e){var t=this.findSenderByStream(e);t?this.peerconnection.removeTrack(t):C.log("Cannot remove tracks: no RTPSender.")}},k.prototype.createDataChannel=function(e,t){return this.trace("createDataChannel",e,t),this.peerconnection.createDataChannel(e,t)},k.prototype._ensureSimulcastGroupIsLast=function(e){var t=e.sdp,n=t.indexOf("m=video"),r=t.indexOf("a=ssrc-group:SIM",n),i=t.lastIndexOf("a=ssrc-group");if(-1===r||-1===i||i===r)return e;var o=t.indexOf("\r\n",r),a=t.substring(r,o+2);i=(t=t.replace(a,"")).lastIndexOf("a=ssrc-group");var s=t.indexOf("\r\n",i),c=t.slice(0,s),u=a.trim(),l=t.slice(s);return t="".concat(c,"\r\n").concat(u).concat(l),new RTCSessionDescription({type:e.type,sdp:t})},k.prototype._adjustLocalMediaDirection=function(e){var t=new y.a(e.sdp),n=!1,r=t.selectMedia("audio");if(r){var i=this._getDesiredMediaDirection(c.a);r.direction!==i&&(r.direction=i,C.info("Adjusted local audio direction to ".concat(i)),n=!0)}else C.warn('No "audio" media found int the local description');var o=t.selectMedia("video");if(o){var a=this._getDesiredMediaDirection(c.b);o.direction!==a&&(o.direction=a,C.info("Adjusted local video direction to ".concat(a)),n=!0)}else C.warn('No "video" media found in the local description');return n?new RTCSessionDescription({type:e.type,sdp:t.toRawSDP()}):e},k.prototype.setLocalDescription=function(e){var t=this,n=e;if(this.trace("setLocalDescription::preTransform",R(n)),this.options.disableH264||this.options.preferH264){var r=o.a.parse(n.sdp),i=r.media.find(function(e){return"video"===e.type});this.options.disableH264?b.a.stripVideoCodec(i,"h264"):b.a.preferVideoCodec(i,"h264"),n=new RTCSessionDescription({type:n.type,sdp:o.a.write(r)}),this.trace("setLocalDescription::postTransform (H264)",R(n))}return n=this._adjustLocalMediaDirection(n),n=this._ensureSimulcastGroupIsLast(n),f.a.usesUnifiedPlan()&&(n=this.interop.toUnifiedPlan(n),this.trace("setLocalDescription::postTransform (Unified Plan)",R(n))),new Promise(function(e,r){t.peerconnection.setLocalDescription(n).then(function(){t.trace("setLocalDescriptionOnSuccess");var r=b.a.getUfrag(n.sdp);r!==t.localUfrag&&(t.localUfrag=r,t.eventEmitter.emit(h.a.LOCAL_UFRAG_CHANGED,t,r)),e()},function(e){t.trace("setLocalDescriptionOnFailure",e),t.eventEmitter.emit(h.a.SET_LOCAL_DESCRIPTION_FAILED,e,t),r(e)})})},k.prototype.setAudioTransferActive=function(e){C.debug("".concat(this," audio transfer active: ").concat(e));var t=this.audioTransferActive!==e;return this.audioTransferActive=e,t},k.prototype._insertUnifiedPlanSimulcastReceive=function(e){var t=o.a.parse(e.sdp),n=t.media.find(function(e){return"video"===e.type});return n.rids=[{id:"1",direction:"recv"},{id:"2",direction:"recv"},{id:"3",direction:"recv"}],n.simulcast_03={value:"recv rid=".concat(w.join(";"))},new RTCSessionDescription({type:e.type,sdp:o.a.write(t)})},k.prototype.setRemoteDescription=function(e){var t=this;if(this.trace("setRemoteDescription::preTransform",R(e)),e=this.simulcast.mungeRemoteDescription(e),this.trace("setRemoteDescription::postTransform (simulcast)",R(e)),this.options.preferH264){var n=o.a.parse(e.sdp),r=n.media.find(function(e){return"video"===e.type});b.a.preferVideoCodec(r,"h264"),e=new RTCSessionDescription({type:e.type,sdp:o.a.write(n)})}return f.a.usesUnifiedPlan()?(e=new RTCSessionDescription({type:e.type,sdp:this.rtxModifier.stripRtx(e.sdp)}),this.trace("setRemoteDescription::postTransform (stripRtx)",R(e)),e=this.interop.toUnifiedPlan(e),this.trace("setRemoteDescription::postTransform (Plan A)",R(e)),this.isSimulcastOn()&&(e=this._insertUnifiedPlanSimulcastReceive(e),this.trace("setRemoteDescription::postTransform (sim receive)",R(e)))):e=P(e),f.a.isSafariWithWebrtc()&&(C.debug("Maybe injecting H264 into the remote description"),e=this._injectH264IfNotPresent(e)),new Promise(function(n,r){t.peerconnection.setRemoteDescription(e).then(function(){t.trace("setRemoteDescriptionOnSuccess");var r=b.a.getUfrag(e.sdp);r!==t.remoteUfrag&&(t.remoteUfrag=r,t.eventEmitter.emit(h.a.REMOTE_UFRAG_CHANGED,t,r)),n()},function(e){t.trace("setRemoteDescriptionOnFailure",e),t.eventEmitter.emit(h.a.SET_REMOTE_DESCRIPTION_FAILED,e,t),r(e)})})},k.prototype._injectH264IfNotPresent=function(e){var t=o.a.parse(e.sdp),n=t.media.find(function(e){return"video"===e.type});if(!n)return C.debug("No videoMLine found, no need to inject H264."),e;if(n.rtp.some(function(e){return"h264"===e.codec.toLowerCase()}))return C.debug("H264 codec found in video mLine, no need to inject."),e;for(var r,i=n.fmtp,a=n.payloads,s=n.rtp,c=a.toString().split(" "),u=127;u>=96;u--)if(!c.includes(u)){r=u,c.push(u),n.payloads=c.join(" ");break}return void 0===r?(C.error("Could not find valid payload type to inject."),e):(s.push({codec:"H264",payload:r,rate:9e4}),i.push({config:"level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f",payload:r}),C.debug("Injecting H264 payload type ".concat(r," into video mLine.")),new RTCSessionDescription({type:e.type,sdp:o.a.write(t)}))},k.prototype.setVideoTransferActive=function(e){C.debug("".concat(this," video transfer active: ").concat(e));var t=this.videoTransferActive!==e;return this.videoTransferActive=e,t},k.prototype.generateRecvonlySsrc=function(){var e=b.a.generateSsrc();C.info("".concat(this," generated new recvonly SSRC: ").concat(e)),this.sdpConsistency.setPrimarySsrc(e)},k.prototype.clearRecvonlySsrc=function(){C.info("Clearing primary video SSRC!"),this.sdpConsistency.clearVideoSsrcCache()},k.prototype.close=function(){this.trace("stop"),this.signalingLayer.off(S.a,this._peerMutedChanged),this.signalingLayer.off(S.b,this._peerVideoTypeChanged);var e=!0,t=!1,n=void 0;try{for(var r,i=this.remoteTracks.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value,a=!0,s=!1,c=void 0;try{for(var u,l=o.values()[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var d=u.value;this._removeRemoteTrack(d)}}catch(e){s=!0,c=e}finally{try{a||null==l.return||l.return()}finally{if(s)throw c}}}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}this.remoteTracks.clear(),this._addedStreams=[],this.rtc._removePeerConnection(this)||C.error("RTC._removePeerConnection returned false"),null!==this.statsinterval&&(window.clearInterval(this.statsinterval),this.statsinterval=null),C.info("Closing ".concat(this,"...")),this.peerconnection.close()};function O(e){return e&&e.groups&&e.groups.length?e.groups[0].ssrcs[0]:e&&e.ssrcs&&e.ssrcs.length?e.ssrcs[0]:null}k.prototype.createAnswer=function(e){if(f.a.supportsRtpSender()&&this.isSimulcastOn()){var t={encodings:[{rid:"1",scaleResolutionDownBy:4},{rid:"2",scaleResolutionDownBy:2},{rid:"3"}]};this.peerconnection.getSenders().find(function(e){return"video"===e.track.kind}).setParameters(t)}return this._createOfferOrAnswer(!1,e)},k.prototype.createOffer=function(e){return this._createOfferOrAnswer(!0,e)},k.prototype._createOfferOrAnswer=function(e,t){var n=this,r=e?"Offer":"Answer";this.trace("create".concat(r),JSON.stringify(t,null," "));var i=function(t,i,a){try{if(n.trace("create".concat(r,"OnSuccess::preTransform"),R(t)),f.a.usesUnifiedPlan()&&(t=n.interop.toPlanB(t),n.trace("create".concat(r,"OnSuccess::postTransform (Plan B)"),R(t)),n.isSimulcastOn()&&(t=n._injectSsrcGroupForUnifiedSimulcast(t),n.trace("create".concat(r,"OnSuccess::postTransform")+"(inject ssrc group)",R(t)))),f.a.isFirefox()||(n.hasAnyTracksOfType(c.b)||n.sdpConsistency.hasPrimarySsrcCached()||n.generateRecvonlySsrc(),t=new RTCSessionDescription({type:t.type,sdp:n.sdpConsistency.makeVideoPrimarySsrcsConsistent(t.sdp)}),n.trace("create".concat(r,"OnSuccess::postTransform ")+"(make primary audio/video ssrcs consistent)",R(t))),n.isSimulcastOn()&&(t=n.simulcast.mungeLocalDescription(t),n.trace("create".concat(r)+"OnSuccess::postTransform (simulcast)",R(t))),!n.options.disableRtx&&f.a.supportsRtx()&&(t=new RTCSessionDescription({type:t.type,sdp:n.rtxModifier.modifyRtxSsrcs(t.sdp)}),n.trace("create".concat(r)+"OnSuccess::postTransform (rtx modifier)",R(t))),!e){var s=new m.a(n.remoteDescription.sdp),u=new m.a(t.sdp);d=s,p=u,f.a.isChrome()&&d&&p&&d.media&&p.media&&d.media.length===p.media.length&&(p.media.forEach(function(e,t){b.a.findLine(d.media[t],"a=setup:actpass",d.session)&&(p.media[t]=e.replace(/a=setup:active/g,"a=setup:passive"))}),p.raw=p.session+p.media.join("")),t=new RTCSessionDescription({type:t.type,sdp:u.raw})}var l=function(e){var t=new Map,n=new Map;if("object"!==E(e)||null===e||"string"!=typeof e.sdp)return C.warn("An empty description was passed as an argument."),t;var r=o.a.parse(e.sdp);if(!Array.isArray(r.media))return t;var i=!0,a=!1,s=void 0;try{for(var c,u=r.media[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var l=c.value;if(Array.isArray(l.ssrcs)){if(Array.isArray(l.ssrcGroups)){var d=!0,f=!1,p=void 0;try{for(var h,v=l.ssrcGroups[Symbol.iterator]();!(d=(h=v.next()).done);d=!0){var m=h.value;if(void 0!==m.semantics&&void 0!==m.ssrcs){var g=m.ssrcs.split(" ").map(function(e){return parseInt(e,10)}),y=g[0];m.ssrcs=g,n.has(y)||n.set(y,[]),n.get(y).push(m)}}}catch(e){f=!0,p=e}finally{try{d||null==v.return||v.return()}finally{if(f)throw p}}}var b=!0,S=!1,_=void 0;try{for(var T,w=l.ssrcs[Symbol.iterator]();!(b=(T=w.next()).done);b=!0){var k=T.value;if("msid"===k.attribute){var R=k.value,P=t.get(R);P||(P={ssrcs:[],groups:[],msid:R},t.set(R,P));var I=k.id;if(P.ssrcs.push(I),n.has(I)){var O=n.get(I),A=!0,M=!1,D=void 0;try{for(var N,x=O[Symbol.iterator]();!(A=(N=x.next()).done);A=!0){var L=N.value;P.groups.push(L)}}catch(e){M=!0,D=e}finally{try{A||null==x.return||x.return()}finally{if(M)throw D}}}}}}catch(e){S=!0,_=e}finally{try{b||null==w.return||w.return()}finally{if(S)throw _}}}}}catch(e){a=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw s}}return t}(t);C.debug("Got local SSRCs MAP: ",l),n._processLocalSSRCsMap(l),i(t)}catch(e){n.trace("create".concat(r,"OnError"),e),n.trace("create".concat(r,"OnError"),R(t)),C.error("create".concat(r,"OnError"),e,R(t)),a(e)}var d,p};return new Promise(function(o,a){(e?n.peerconnection.createOffer(t):n.peerconnection.createAnswer(t)).then(function(e){return i(e,o,a)},function(t){return function(t,i){n.trace("create".concat(r,"OnFailure"),t);var o=e?h.a.CREATE_OFFER_FAILED:h.a.CREATE_ANSWER_FAILED;n.eventEmitter.emit(o,t,n),i(t)}(t,a)})})},k.prototype._processLocalSSRCsMap=function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=this.localTracks.values()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value,s=a.storedMSID;if(e.has(s)){var c=e.get(s);if(!c)return void C.error("No SSRC found for: ".concat(s," in ").concat(this));var u=this.localSSRCs.get(a.rtcId),l=O(c),d=O(u);l!==d?(null===d?C.info("Storing new local SSRC for ".concat(a," in ").concat(this),c):C.error("Overwriting SSRC for ".concat(a," ").concat(s," in ").concat(this," with: "),c),this.localSSRCs.set(a.rtcId,c),this.eventEmitter.emit(h.a.LOCAL_TRACK_SSRC_UPDATED,a,l)):C.debug("The local SSRC(".concat(l,") for ").concat(a," ").concat(s)+"is still up to date in ".concat(this))}else C.warn("No local track matched with: ".concat(s," in ").concat(this))}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}},k.prototype.addIceCandidate=function(e){return this.trace("addIceCandidate",JSON.stringify({candidate:e.candidate,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex,usernameFragment:e.usernameFragment},null," ")),this.peerconnection.addIceCandidate(e)},k.prototype.getStats=function(e,t){f.a.isSafariWithWebrtc()||f.a.isFirefox()||f.a.isReactNative()?this.peerconnection.getStats().then(e).catch(t||function(){}):this.peerconnection.getStats(e)},k.prototype.generateNewStreamSSRCInfo=function(e){var t=e.rtcId,n=this._getSSRC(t);if(n&&C.error("Will overwrite local SSRCs for track ID: ".concat(t)),this.isSimulcastOn()){n={ssrcs:[],groups:[]};for(var r=0;r<T;r++)n.ssrcs.push(b.a.generateSsrc());n.groups.push({ssrcs:n.ssrcs.slice(),semantics:"SIM"})}else n={ssrcs:[b.a.generateSsrc()],groups:[]};if(!this.options.disableRtx&&f.a.supportsRtx())for(var i=n.ssrcs.length,o=0;o<i;++o){var a=n.ssrcs[o],s=b.a.generateSsrc();n.ssrcs.push(s),n.groups.push({ssrcs:[a,s],semantics:"FID"})}return n.msid=e.storedMSID,this.localSSRCs.set(t,n),n};k.prototype.setIsSelected=function(e){this.options.enableLayerSuspension&&(C.debug("Layer suspension enabled,"+"currently selected? ".concat(e)),function(e,t){if(e.getSenders){var n=e.getSenders().find(function(e){return"video"===e.track.kind});if(n)if(n.getParameters){var r=n.getParameters();t?(C.debug("Currently selected, enabling all sim layers"),r.encodings.forEach(function(e){e.active=!0})):(C.debug("Not currently selected, disabling upper layers"),[1,2].forEach(function(e){r.encodings[e]&&(r.encodings[e].active=!1)})),n.setParameters(r)}else C.debug("Browser doesn't support RTPSender parameters");else C.warn("handleLayerSuspension unable to find video sender")}else C.debug("Browser doesn't support RTPSender")}(this.peerconnection,e))},k.prototype.toString=function(){return"TPC[".concat(this.id,",p2p:").concat(this.isP2P,"]")}}).call(this,"modules/RTC/TraceablePeerConnection.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return m});var r=n(7),i=n(54),o=n(17),a=n(6);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=n(4).getLogger(e),p=n(8),h=!1,v=!1,m=function(e){function t(e,n,r,i,o,a,s,c,d,f){var p;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(p=u(this,l(t).call(this,n,i,o,function(){},a,s))).rtc=e,"number"!=typeof c)throw new TypeError("SSRC ".concat(c," is not a number"));return p.ssrc=c,p.ownerEndpointId=r,p.muted=d,p.isP2P=f,p.hasBeenMuted=d,p.rtc&&p.track&&p._bindMuteHandlers(),p}var n,s,m;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,i["a"]),n=t,(s=[{key:"_bindMuteHandlers",value:function(){var e=this;this.track.addEventListener("mute",function(){return e._onTrackMute()}),this.track.addEventListener("unmute",function(){return e._onTrackUnmute()})}},{key:"_onTrackMute",value:function(){f.debug('"onmute" event('.concat(Date.now(),"): "),this.getParticipantId(),this.getType(),this.getSSRC()),this.rtc.eventEmitter.emit(p.REMOTE_TRACK_MUTE,this)}},{key:"_onTrackUnmute",value:function(){f.debug('"onunmute" event('.concat(Date.now(),"): "),this.getParticipantId(),this.getType(),this.getSSRC()),this.rtc.eventEmitter.emit(p.REMOTE_TRACK_UNMUTE,this)}},{key:"setMute",value:function(e){this.muted!==e&&(e&&(this.hasBeenMuted=!0),this.stream&&(this.stream.muted=e),this.muted=e,this.emit(o.TRACK_MUTE_CHANGED,this))}},{key:"isMuted",value:function(){return this.muted}},{key:"getParticipantId",value:function(){return this.ownerEndpointId}},{key:"isLocal",value:function(){return!1}},{key:"getSSRC",value:function(){return this.ssrc}},{key:"_setVideoType",value:function(e){this.videoType!==e&&(this.videoType=e,this.emit(o.TRACK_VIDEOTYPE_CHANGED,e))}},{key:"_playCallback",value:function(){var e=this.isVideoTrack()?"video":"audio",t=window.performance.now();console.log("(TIME) Render ".concat(e,":\t"),t),this.conference.getConnectionTimes()["".concat(e,".render")]=t;var n=window.connectionTimes["obtainPermissions.start"],i=window.connectionTimes["obtainPermissions.end"],o=isNaN(i)||isNaN(n)?0:i-n,s=t-(this.conference.getConnectionTimes()["session.initiate"]-this.conference.getConnectionTimes()["muc.joined"])-o;this.conference.getConnectionTimes()["".concat(e,".ttfm")]=s,console.log("(TIME) TTFM ".concat(e,":\t"),s),a.a.sendAnalytics(Object(r.H)({media_type:e,muted:this.hasBeenMuted,value:s}))}},{key:"_attachTTFMTracker",value:function(e){h&&this.isAudioTrack()||v&&this.isVideoTrack()||(this.isAudioTrack()&&(h=!0),this.isVideoTrack()&&(v=!0),e.addEventListener("canplay",this._playCallback.bind(this)))}},{key:"toString",value:function(){return"RemoteTrack[".concat(this.ownerEndpointId,", ").concat(this.getType(),", p2p: ").concat(this.isP2P,"]")}}])&&c(n.prototype,s),m&&c(n,m),t}()}).call(this,"modules/RTC/JitsiRemoteTrack.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return c});var r=n(4),i=n(9),o=n(28);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=Object(r.getLogger)(e),c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tpc=t}var t,n,r;return t=e,(n=[{key:"_addMutedLocalVideoTracksToSDP",value:function(e){var t=this.tpc.getLocalTracks(i.b);if(!t.length)return!1;1!==t.length&&s.error("".concat(this.tpc," there is more than 1 video track ! ")+"Strange things may happen !",t);var n=e.selectMedia("video");if(!n)return s.debug("".concat(this.tpc," unable to hack local video track SDP")+'- no "video" media'),!1;var r=!1,o=!0,a=!1,c=void 0;try{for(var u,l=t[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var d=u.value,f=d.isMuted(),p=d.getOriginalStream(),h=p&&this.tpc.isMediaStreamInPc(p),v=f||!h;if(s.debug("".concat(this.tpc," ").concat(d," muted: ").concat(f,", is in PeerConnection: ").concat(h," => should fake sdp ? : ").concat(v)),v){var m=this.tpc.isSimulcastOn()?this.tpc.simulcast.ssrcCache:[this.tpc.sdpConsistency.cachedPrimarySsrc];if(m.length){r=!0,n.direction="sendrecv";var g=m[0],y="injected-".concat(g),b=!0,S=!1,_=void 0;try{for(var E,C=m[Symbol.iterator]();!(b=(E=C.next()).done);b=!0){var T=E.value;n.removeSSRC(T),s.debug("".concat(this.tpc," injecting video SSRC: ").concat(T," for ").concat(d)),n.addSSRCAttribute({id:T,attribute:"cname",value:y}),n.addSSRCAttribute({id:T,attribute:"msid",value:d.storedMSID})}}catch(e){S=!0,_=e}finally{try{b||null==C.return||C.return()}finally{if(S)throw _}}if(m.length>1){var w={ssrcs:m.join(" "),semantics:"SIM"};n.findGroup(w.semantics,w.ssrcs)||(s.debug("".concat(this.tpc," injecting SIM group for ").concat(d),w),n.addSSRCGroup(w))}this.tpc.options.disableRtx||this.tpc.rtxModifier.modifyRtxSsrcs2(n)}else s.error("No SSRCs stored for: ".concat(d," in ").concat(this.tpc))}}}catch(e){a=!0,c=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw c}}return r}},{key:"_transformMediaIdentifiers",value:function(e){var t=this.tpc.id,n=!0,r=!1,i=void 0;try{for(var o,a=e.ssrcs[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var c=o.value;switch(c.attribute){case"cname":case"label":case"mslabel":c.value=c.value&&"".concat(c.value,"-").concat(t);break;case"msid":if(c.value){var u=c.value.split(" ");if(2===u.length){var l=u[0],d=u[1];c.value="".concat(l,"-").concat(t," ").concat(d,"-").concat(t)}else s.warn("Unable to munge local MSID"+"- weird format detected: ".concat(c.value))}}}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}}},{key:"maybeAddMutedLocalVideoTracksToSDP",value:function(e){if(!e)throw new Error("No local description passed in.");var t=new o.a(e.sdp);return this._addMutedLocalVideoTracksToSDP(t)?new RTCSessionDescription({type:e.type,sdp:t.toRawSDP()}):e}},{key:"transformStreamIdentifiers",value:function(e){if(!e||!e.sdp||!e.type)return e;var t=new o.a(e.sdp),n=t.selectMedia("audio");n&&this._transformMediaIdentifiers(n);var r=t.selectMedia("video");return r&&this._transformMediaIdentifiers(r),new RTCSessionDescription({type:e.type,sdp:t.toRawSDP()})}}])&&a(t.prototype,n),r&&a(t,r),e}()}).call(this,"modules/RTC/LocalSdpMunger.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return u});var r=n(4),i=n(28),o=n(5);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=Object(r.getLogger)(e);function c(e,t,n){s.debug("Updating mline to associate ".concat(n)+"rtx ssrc with primary stream, ".concat(t.id));var r=t.id,i=t.msid,o=t.cname,a=e.getRtxSSRC(r);a!==n?(a&&(s.debug("".concat(r," was previously associated with rtx")+"".concat(a,", removing all references to it")),e.removeSSRC(a),s.debug("groups before filtering for ".concat(a)),s.debug(e.dumpSSRCGroups()),e.removeGroupsWithSSRC(a)),e.addSSRCAttribute({id:n,attribute:"cname",value:o}),e.addSSRCAttribute({id:n,attribute:"msid",value:i}),e.addSSRCGroup({semantics:"FID",ssrcs:"".concat(r," ").concat(n)})):s.debug("".concat(n," was already associated with ").concat(r))}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.correspondingRtxSsrcs=new Map}var t,n,r;return t=e,(n=[{key:"clearSsrcCache",value:function(){this.correspondingRtxSsrcs.clear()}},{key:"setSsrcCache",value:function(e){s.debug("Setting ssrc cache to ",e),this.correspondingRtxSsrcs=e}},{key:"modifyRtxSsrcs",value:function(e){var t=new i.a(e),n=t.selectMedia("video");return n?this.modifyRtxSsrcs2(n)?t.toRawSDP():e:(s.debug("No 'video' media found in the sdp: ".concat(e)),e)}},{key:"modifyRtxSsrcs2",value:function(e){if("recvonly"===e.direction)return s.debug("RtxModifier doing nothing, video m line is recvonly"),!1;if(e.getSSRCCount()<1)return s.debug("RtxModifier doing nothing, no video ssrcs present"),!1;s.debug("Current ssrc mapping: ",this.correspondingRtxSsrcs);var t=e.getPrimaryVideoSSRCs();s.debug("Parsed primary video ssrcs ",t," making sure all have rtx streams");var n=!0,r=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(n=(a=u.next()).done);n=!0){var l=a.value,d=e.getSSRCAttrValue(l,"msid"),f=e.getSSRCAttrValue(l,"cname"),p=this.correspondingRtxSsrcs.get(l);if(p)s.debug("Already have an associated rtx ssrc for"+"video ssrc ".concat(l,": ").concat(p));else{s.debug("No previously associated rtx ssrc for video ssrc ".concat(l));var h=e.getRtxSSRC(l);h?(s.debug("Rtx stream ".concat(h," ")+"already existed in the sdp as an rtx stream for "+"".concat(l)),p=h):(p=o.a.generateSsrc(),s.debug("Generated rtx ssrc ".concat(p," ")+"for ssrc ".concat(l))),s.debug("Caching rtx ssrc ".concat(p," ")+"for video ssrc ".concat(l)),this.correspondingRtxSsrcs.set(l,p)}c(e,{id:l,cname:f,msid:d},p)}}catch(e){r=!0,i=e}finally{try{n||null==u.return||u.return()}finally{if(r)throw i}}return!0}},{key:"stripRtx",value:function(e){var t=new i.a(e),n=t.selectMedia("video");if(!n)return s.debug("No 'video' media found in the sdp: ".concat(e)),e;if("recvonly"===n.direction)return s.debug("RtxModifier doing nothing, video m line is recvonly"),e;if(n.getSSRCCount()<1)return s.debug("RtxModifier doing nothing, no video ssrcs present"),e;if(!n.containsAnySSRCGroups())return s.debug("RtxModifier doing nothing, no video ssrcGroups present"),e;var r=n.findGroups("FID");n.removeGroupsBySemantics("FID");var o=!0,a=!1,c=void 0;try{for(var u,l=r[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var d=u.value,f=Object(i.c)(d);n.removeSSRC(f)}}catch(e){a=!0,c=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw c}}return t.toRawSDP()}}])&&a(t.prototype,n),r&&a(t,r),e}()}).call(this,"modules/xmpp/RtxModifier.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return s});var r=n(4),i=n(28);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=Object(r.getLogger)(e),s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.clearVideoSsrcCache(),this.logPrefix=t}var t,n,r;return t=e,(n=[{key:"clearVideoSsrcCache",value:function(){this.cachedPrimarySsrc=null,this.injectRecvOnly=!1}},{key:"setPrimarySsrc",value:function(e){if("number"!=typeof e)throw new Error("Primary SSRC must be a number!");this.cachedPrimarySsrc=e}},{key:"hasPrimarySsrcCached",value:function(){return Boolean(this.cachedPrimarySsrc)}},{key:"makeVideoPrimarySsrcsConsistent",value:function(e){var t=new i.a(e),n=t.selectMedia("video");if(!n)return a.debug("".concat(this.logPrefix," no 'video' media found in the sdp: ")+"".concat(e)),e;if("recvonly"===n.direction)this.cachedPrimarySsrc&&this.injectRecvOnly?n.addSSRCAttribute({id:this.cachedPrimarySsrc,attribute:"cname",value:"recvonly-".concat(this.cachedPrimarySsrc)}):a.info("".concat(this.logPrefix," no SSRC found for the recvonly video")+"stream!");else{var r=n.getPrimaryVideoSsrc();if(!r)return a.info("".concat(this.logPrefix," sdp-consistency couldn't")+" parse new primary ssrc"),e;if(this.cachedPrimarySsrc){a.info("".concat(this.logPrefix," sdp-consistency replacing new ssrc")+"".concat(r," with cached ")+"".concat(this.cachedPrimarySsrc)),n.replaceSSRC(r,this.cachedPrimarySsrc);var o=!0,s=!1,c=void 0;try{for(var u,l=n.ssrcGroups[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var d=u.value;if("FID"===d.semantics){var f=Object(i.b)(d),p=Object(i.c)(d);f===r&&(d.ssrcs="".concat(this.cachedPrimarySsrc," ").concat(p))}}}catch(e){s=!0,c=e}finally{try{o||null==l.return||l.return()}finally{if(s)throw c}}}else this.cachedPrimarySsrc=r,a.info("".concat(this.logPrefix," sdp-consistency caching primary ssrc")+"".concat(this.cachedPrimarySsrc));this.injectRecvOnly=!0}return t.toRawSDP()}}])&&o(t.prototype,n),r&&o(t,r),e}()}).call(this,"modules/xmpp/SdpConsistency.js")},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(2);function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._callback=n,this._eventFired=!1,t.statistics.addAudioLevelListener(this._audioLevel.bind(this)),t.on(r.TRACK_MUTE_CHANGED,this._trackMuteChanged.bind(this)),t.on(r.TRACK_ADDED,this._trackAdded.bind(this))}var t,n,o;return t=e,(n=[{key:"_audioLevel",value:function(e,t,n,r){r&&this.audioTrack&&!this._eventFired&&this.audioTrack.isMuted()&&n>.6&&(this._eventFired=!0,this._callback())}},{key:"_isLocalAudioTrack",value:function(e){return e.isAudioTrack()&&e.isLocal()}},{key:"_trackAdded",value:function(e){this._isLocalAudioTrack(e)&&(this.audioTrack=e)}},{key:"_trackMuteChanged",value:function(e){this._isLocalAudioTrack(e)&&e.isMuted()&&(this._eventFired=!1)}}])&&i(t.prototype,n),o&&i(t,o),e}()},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return m});var r=n(33),i=n(2),o=n(4);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=n(0),c=n(14),u=n(30),l=Object(o.getLogger)(e),d="stats",f=[{width:1920,height:1080,layers:3,max:5e3,target:4e3,min:800},{width:1280,height:720,layers:3,max:2500,target:2500,min:600},{width:960,height:540,layers:3,max:900,target:900,min:450},{width:640,height:360,layers:2,max:700,target:500,min:150},{width:480,height:270,layers:2,max:450,target:350,min:150},{width:320,height:180,layers:1,max:200,target:150,min:30}],p=800,h=null;function v(e,t,n){if(n<15e3)return 1;var r=0,i=Math.min(t.height,t.width);if(e){var o=f.find(function(e){return e.height<=i});if(o){var a=function(){var e=i;if(!(o=f.find(function(t){return t.height===e})))return"break";r+=o.target};for(i=o.height;i>=180;i/=2){if("break"===a())break}}}else{var s=t.width*t.height;r=s<=76800?600:s<=307200?1700:s<=518400?2e3:2500}return Math.min(r,function(e){if(e>6e4)return Number.MAX_SAFE_INTEGER;return p*Math.pow(1.08,e/1e3)}(Math.max(0,n-1e3)))}var m=function(){function e(t,n,o){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.eventEmitter=n,this._conference=t,this._localStats={connectionQuality:100,jvbRTT:void 0},this._lastConnectionQualityUpdate=-1,this._remoteStats={},this._timeIceConnected=-1,this._timeVideoUnmuted=-1,this._timeLastBwCapRemoved=-1,o.startBitrate&&o.startBitrate>0&&(p=o.startBitrate),t.on(i.CONNECTION_INTERRUPTED,function(){a._updateLocalConnectionQuality(0),a.eventEmitter.emit(r.LOCAL_STATS_UPDATED,a._localStats),a._broadcastLocalStats()}),t.room.addListener(s.ICE_CONNECTION_STATE_CHANGED,function(e,t){e.isP2P||"connected"!==t||(a._timeIceConnected=window.performance.now())}),t.on(i.ENDPOINT_MESSAGE_RECEIVED,function(e,t){t.type===d&&a._updateRemoteStats(e.getId(),t.values)}),t.statistics.addConnectionStatsListener(this._updateLocalStats.bind(this)),t.on(i.TRACK_MUTE_CHANGED,function(e){e.isVideoTrack()&&(e.isMuted()?a._timeVideoUnmuted=-1:a._maybeUpdateUnmuteTime())}),t.on(i.TRACK_ADDED,function(e){e.isVideoTrack()&&!e.isMuted()&&a._maybeUpdateUnmuteTime()}),t.on(i.SERVER_REGION_CHANGED,function(e){a._localStats.serverRegion=e}),t.on(i.PROPERTIES_CHANGED,function(e){a._localStats.bridgeCount=Number((e||{})["bridge-count"])})}var t,n,o;return t=e,(n=[{key:"_maybeUpdateUnmuteTime",value:function(){this._timeVideoUnmuted<0&&(this._timeVideoUnmuted=window.performance.now())}},{key:"_calculateConnectionQuality",value:function(e,t,n){var r,i=u[n],o=100;if(this._localStats.packetLoss&&(r=this._localStats.packetLoss.upload,t&&(r*=.5)),t||!i||e===c.DESKTOP||this._timeIceConnected<0||this._timeVideoUnmuted<0)void 0===r?(l.error("Cannot calculate connection quality, unknown packet loss."),o=100):o=r<=2?100:r<=4?70:r<=6?50:r<=8?30:r<=12?10:0;else{var a=this._conference.getActivePeerConnection(),s=Boolean(a&&a.isSimulcastOn()),d=a&&a.bandwidthLimiter&&a.bandwidthLimiter.getBandwidthLimit("video");!d&&h&&(this._timeLastBwCapRemoved=window.performance.now(),p=h),h=d;var f=v(s,i,window.performance.now()-Math.max(this._timeVideoUnmuted,this._timeIceConnected,this._timeLastBwCapRemoved));f=Math.min(.9*f,2500),h&&(f=Math.min(f,h)),o=100*this._localStats.bitrate.upload/f,r&&r>=10&&(o=Math.min(o,30))}if(this._lastConnectionQualityUpdate>0){var m=this._localStats.connectionQuality,g=(window.performance.now()-this._lastConnectionQualityUpdate)/1e3;o=Math.min(o,m+2*g)}return Math.min(100,o)}},{key:"_updateLocalConnectionQuality",value:function(e){this._localStats.connectionQuality=e,this._lastConnectionQualityUpdate=window.performance.now()}},{key:"_broadcastLocalStats",value:function(){var e={bitrate:this._localStats.bitrate,packetLoss:this._localStats.packetLoss,connectionQuality:this._localStats.connectionQuality,jvbRTT:this._localStats.jvbRTT,serverRegion:this._localStats.serverRegion};try{this._conference.broadcastEndpointMessage({type:d,values:e})}catch(e){}}},{key:"_updateLocalStats",value:function(e,t){if(!e.isP2P){var n=t.transport&&t.transport.length&&t.transport[0].rtt;this._localStats.jvbRTT=n||void 0}if(e===this._conference.getActivePeerConnection()){var i,o=!this._conference.isConnectionInterrupted(),a=this._conference.getLocalVideoTrack(),s=a?a.videoType:void 0,c=!a||a.isMuted(),u=a?a.resolution:null;for(i in c||this._maybeUpdateUnmuteTime(),t)t.hasOwnProperty(i)&&(this._localStats[i]=t[i]);o&&this._updateLocalConnectionQuality(this._calculateConnectionQuality(s,c,u)),this.eventEmitter.emit(r.LOCAL_STATS_UPDATED,this._localStats),this._broadcastLocalStats()}}},{key:"_updateRemoteStats",value:function(e,t){this._remoteStats[e]={bitrate:t.bitrate,packetLoss:t.packetLoss,connectionQuality:t.connectionQuality,jvbRTT:t.jvbRTT,serverRegion:t.serverRegion},this.eventEmitter.emit(r.REMOTE_STATS_UPDATED,e,this._remoteStats[e])}},{key:"getStats",value:function(){return this._localStats}}])&&a(t.prototype,n),o&&a(t,o),e}()}).call(this,"modules/connectivity/ConnectionQuality.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return p});var r=n(4),i=n(7),o=n(50),a=n(2),s=n(6);function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}var d=Object(r.getLogger)(e),f=function(){function e(t,n){c(this,e),this.participant=t,this.e2eping=n,this.id=t.getId(),this.requests={},this.lastRequestId=1,this.clearIntervals=this.clearIntervals.bind(this),this.sendRequest=this.sendRequest.bind(this),this.handleResponse=this.handleResponse.bind(this),this.maybeSendAnalytics=this.maybeSendAnalytics.bind(this),this.sendAnalytics=this.sendAnalytics.bind(this),n.isDataChannelOpen&&this.sendRequest(),this.pingInterval=window.setInterval(this.sendRequest,n.pingIntervalMs),this.analyticsInterval=window.setTimeout(this.maybeSendAnalytics,this.e2eping.analyticsIntervalMs)}return l(e,[{key:"clearIntervals",value:function(){this.pingInterval&&window.clearInterval(this.pingInterval),this.analyticsInterval&&window.clearInterval(this.analyticsInterval)}},{key:"sendRequest",value:function(){var e=this.lastRequestId++,t={type:"e2e-ping-request",id:e};this.e2eping.sendMessage(t,this.id),this.requests[e]={id:e,timeSent:window.performance.now()}}},{key:"handleResponse",value:function(e){var t=this.requests[e.id];t&&(t.rtt=window.performance.now()-t.timeSent,this.e2eping.eventEmitter.emit(o.E2E_RTT_CHANGED,this.participant,t.rtt)),this.maybeSendAnalytics()}},{key:"maybeSendAnalytics",value:function(){var e,t,n=window.performance.now(),r=1/0;for(t in this.requests)this.requests.hasOwnProperty(t)&&((e=this.requests[t]).timeSent<n-this.e2eping.analyticsIntervalMs?delete this.requests[t]:e.rtt&&(r=Math.min(r,e.rtt)));r<1/0&&this.sendAnalytics(r)}},{key:"sendAnalytics",value:function(e){s.a.sendAnalytics(Object(i.y)(this.id,this.participant.getProperty("region"),e))}}]),e}(),p=function(){function e(t,n,r){c(this,e),this.conference=t,this.eventEmitter=t.eventEmitter,this.sendMessage=r,this.pingIntervalMs=1e4,this.analyticsIntervalMs=6e4,this.participants={},this.isDataChannelOpen=!1,n&&n.e2eping&&("number"==typeof n.e2eping.pingInterval&&(this.pingIntervalMs=n.e2eping.pingInterval),"number"==typeof n.e2eping.analyticsInterval&&(this.analyticsIntervalMs=n.e2eping.analyticsInterval),this.analyticsIntervalMs>0&&this.analyticsIntervalMs<this.pingIntervalMs&&(this.analyticsIntervalMs=this.pingIntervalMs)),d.info("Initializing e2e ping; pingInterval=".concat(this.pingIntervalMs,", analyticsInterval=").concat(this.analyticsIntervalMs,".")),this.participantJoined=this.participantJoined.bind(this),t.on(a.USER_JOINED,this.participantJoined),this.participantLeft=this.participantLeft.bind(this),t.on(a.USER_LEFT,this.participantLeft),this.messageReceived=this.messageReceived.bind(this),t.on(a.ENDPOINT_MESSAGE_RECEIVED,this.messageReceived),this.dataChannelOpened=this.dataChannelOpened.bind(this),t.on(a.DATA_CHANNEL_OPENED,this.dataChannelOpened)}return l(e,[{key:"dataChannelOpened",value:function(){for(var e in this.isDataChannelOpen=!0,this.participants)if(this.participants.hasOwnProperty(e)){var t=this.participants[e];window.setTimeout(t.sendRequest,200)}}},{key:"messageReceived",value:function(e,t){"e2e-ping-request"===t.type?this.handleRequest(e.getId(),t):"e2e-ping-response"===t.type&&this.handleResponse(e.getId(),t)}},{key:"participantJoined",value:function(e,t){this.pingIntervalMs<=0||(this.participants[e]&&(d.info("Participant wrapper already exists for ".concat(e,". Clearing.")),this.participants[e].clearIntervals(),delete this.participants[e]),this.participants[e]=new f(t,this))}},{key:"participantLeft",value:function(e){this.pingIntervalMs<=0||this.participants[e]&&(this.participants[e].clearIntervals(),delete this.participants[e])}},{key:"handleRequest",value:function(e,t){if(t&&t.id){var n={type:"e2e-ping-response",id:t.id};this.sendMessage(n,e)}else d.info("Received an invalid e2e ping request from ".concat(e,"."))}},{key:"handleResponse",value:function(e,t){var n=this.participants[e];n&&n.handleResponse(t)}},{key:"stop",value:function(){for(var e in d.info("Stopping e2eping"),this.conference.off(a.USER_JOINED,this.participantJoined),this.conference.off(a.USER_LEFT,this.participantLeft),this.conference.off(a.ENDPOINT_MESSAGE_RECEIVED,this.messageReceived),this.conference.off(a.DATA_CHANNEL_OPENED,this.dataChannelOpened),this.participants)this.participants.hasOwnProperty(e)&&this.participants[e].clearIntervals();this.participants={}}}]),e}()}).call(this,"modules/e2eping/e2eping.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return s});var r=n(4),i=n(2);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=Object(r.getLogger)(e),s=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._conference=t,this._jvb121=!0,this._conference.addEventListener(i.USER_JOINED,function(){return n.evaluateStatus()}),this._conference.addEventListener(i.USER_LEFT,function(){return n.evaluateStatus()}),this._conference.addEventListener(i.P2P_STATUS,function(){return n.evaluateStatus()})}var t,n,r;return t=e,(n=[{key:"evaluateStatus",value:function(){var e=this._jvb121,t=!this._conference.isP2PActive()&&this._conference.getParticipantCount()<=2;e!==t&&(this._jvb121=t,a.debug("JVB121 status ".concat(e," => ").concat(t)),this._conference.eventEmitter.emit(i.JVB121_STATUS,e,t))}}])&&o(t.prototype,n),r&&o(t,r),e}()}).call(this,"modules/event/Jvb121EventGenerator.js")},function(e,t,n){"use strict";(function(e){var r=n(4),i=n(0),o=n.n(i),a=n(61),s=n(45);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=Object(r.getLogger)(e),d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._sessions={},this._chatRoom=t,this.onPresence=this.onPresence.bind(this),this._chatRoom.eventEmitter.addListener(o.a.PRESENCE_RECEIVED,this.onPresence)}var t,n,r;return t=e,(n=[{key:"getSession",value:function(e){return this._sessions[e]}},{key:"onPresence",value:function(e){var t=e.fromHiddenDomain,n=e.presence;s.a.isFromFocus(n)?this._handleFocusPresence(n):t&&this._handleJibriPresence(n)}},{key:"startRecording",value:function(e){var t=this,n=new a.a(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){c(e,t,n[t])})}return e}({},e,{connection:this._chatRoom.connection}));return n.start({appData:e.appData,broadcastId:e.broadcastId,focusMucJid:this._chatRoom.focusMucJid,streamId:e.streamId}).then(function(){return t.getSession(n.getID())||(t._addSession(n),t._emitSessionUpdate(n)),n}).catch(function(e){return t._emitSessionUpdate(n),Promise.reject(e)})}},{key:"stopRecording",value:function(e){var t=this.getSession(e);return t?t.stop({focusMucJid:this._chatRoom.focusMucJid}):Promise.reject(new Error("Could not find session"))}},{key:"_addSession",value:function(e){this._sessions[e.getID()]=e}},{key:"_createSession",value:function(e,t,n){var r=new a.a({connection:this._chatRoom.connection,focusMucJid:this._chatRoom.focusMucJid,mode:n,sessionID:e,status:t});return this._addSession(r),r}},{key:"_emitSessionUpdate",value:function(e){this._chatRoom.eventEmitter.emit(o.a.RECORDER_STATE_CHANGED,e)}},{key:"_handleFocusPresence",value:function(e){var t=s.a.getFocusRecordingUpdate(e);if(t){var n=t.sessionID,r=t.status,i=t.error,o=t.recordingMode,a=this.getSession(n);a||"off"!==r?a&&a.getStatus()===r&&a.getError()===i?l.warn("Ignoring duplicate presence update: ",JSON.stringify(t)):(a||(a=this._createSession(n,r,o)),a.setStatus(r),i&&a.setError(i),this._emitSessionUpdate(a)):l.warn("Ignoring recording presence update","Received a new session with status off.")}}},{key:"_handleJibriPresence",value:function(e){var t=s.a.getHiddenDomainUpdate(e),n=t.liveStreamViewURL,r=t.mode,i=t.sessionID;if(i){var o=this.getSession(i);o||(o=this._createSession(i,"",r)),o.setLiveStreamViewURL(n),this._emitSessionUpdate(o)}else l.warn("Ignoring potential jibri presence due to no session id.")}}])&&u(t.prototype,n),r&&u(t,r),e}();t.a=d}).call(this,"modules/recording/RecordingManager.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return v});var r=n(3),i=n(7),o=n(4),a=n(11),s=n(6);function c(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}var f=Object(o.getLogger)(e),p={offerToReceiveAudio:1,offerToReceiveVideo:0},h=function(){function e(t,n,r,i){u(this,e),this.region=t,this.getStatsIntervalMs=r,this.getStatsInterval=null,this.rtt=1/0,this.rtts=[];var o=[{url:"stun:".concat(n)}];this.pc=new a.a.RTCPeerConnectionType({iceServers:o}),this.candidates={},this.stopped=!1,this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.startStatsInterval=this.startStatsInterval.bind(this),this.handleCandidateRtt=this.handleCandidateRtt.bind(this),window.setTimeout(this.start,i)}return d(e,[{key:"start",value:function(){var e=this;this.stopped||this.pc.createOffer(p).then(function(t){e.pc.setLocalDescription(t,function(){f.info("setLocalDescription success for ".concat(e.region)),e.startStatsInterval()},function(t){f.warn("setLocalDescription failed for ".concat(e.region,": ").concat(t))})})}},{key:"startStatsInterval",value:function(){var e=this;this.getStatsInterval=window.setInterval(function(){e.pc.getStats(function(t){for(var n=t.result(),r=0;r<n.length;++r){var i=n[r],o=Number(i.stat("stunKeepaliveRttTotal"));if(o>0){var a="".concat(i.stat("ipAddress"),"_").concat(i.stat("portNumber"),"_").concat(i.stat("priority"));e.handleCandidateRtt(a,o,Number(i.stat("stunKeepaliveResponsesReceived")),Number(i.stat("stunKeepaliveRequestsSent")))}}var s=1/0;for(var u in e.candidates)e.candidates.hasOwnProperty(u)&&e.candidates[u].rtt>0&&(s=Math.min(s,e.candidates[u].rtt));e.rtts.push(s),e.rtts.length>6&&(e.rtts=e.rtts.splice(1,7)),e.rtt=Math.min.apply(Math,c(e.rtts))})},this.getStatsIntervalMs)}},{key:"handleCandidateRtt",value:function(e,t,n,r){this.candidates[e]||(this.candidates[e]={rttTotal:0,responsesReceived:0,requestsSent:0,rtt:NaN});var i=t-this.candidates[e].rttTotal,o=n-this.candidates[e].responsesReceived,a=r-n-(this.candidates[e].requestsSent-this.candidates[e].responsesReceived),s=NaN;o>0&&0===a&&(s=i/o),this.candidates[e].rttTotal=t,this.candidates[e].responsesReceived=n,this.candidates[e].requestsSent=r,this.candidates[e].rtt=s}},{key:"stop",value:function(){this.getStatsInterval&&window.clearInterval(this.getStatsInterval),this.pc.close(),this.stopped=!0}}]),e}(),v=function(){function e(t){var n=this;if(u(this,e),t&&t.enabled&&r.a.supportsLocalCandidateRttStatistics()){this.pcMonitors={},this.startPCMonitors=this.startPCMonitors.bind(this),this.sendAnalytics=this.sendAnalytics.bind(this),this.stop=this.stop.bind(this),this.analyticsInterval=null,this.stopped=!1;var i=t.initialDelay||6e4;f.info("Starting RTT monitor with an initial delay of ".concat(i)),window.setTimeout(function(){return n.startPCMonitors(t)},i)}}return d(e,[{key:"startPCMonitors",value:function(e){var t=this;if(e.stunServers){if(!this.stopped){var n=e.getStatsInterval||1e4,r=e.analyticsInterval||n,i=n/Object.keys(e.stunServers).length,o=0;for(var a in e.stunServers)if(e.stunServers.hasOwnProperty(a)){var s=e.stunServers[a];this.pcMonitors[a]=new h(a,s,n,i*o),o++}window.setTimeout(function(){t.stopped||(t.analyticsInterval=window.setInterval(t.sendAnalytics,r))},1e3)}}else f.warn("No stun servers configured.")}},{key:"sendAnalytics",value:function(){var e={};for(var t in this.pcMonitors)if(this.pcMonitors.hasOwnProperty(t)){var n=this.pcMonitors[t].rtt;isNaN(n)||n===1/0||(e[t.replace("-","_")]=n)}e&&s.a.sendAnalytics(Object(i.G)(e))}},{key:"stop",value:function(){for(var e in f.info("Stopping RttMonitor."),this.stopped=!0,this.pcMonitors)this.pcMonitors.hasOwnProperty(e)&&this.pcMonitors[e].stop();this.pcMonitors={},this.analyticsInterval&&window.clearInterval(this.analyticsInterval)}}]),e}()}).call(this,"modules/rttmonitor/rttmonitor.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return g});var r=n(7),i=n(4),o=n(33),a=n(2),s=n(9),c=n(3),u=n(6),l=n(14);function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),e}var h=Object(i.getLogger)(e),v=function(){function e(t){d(this,e),this.name=t,this.count=0,this.sum=0,this.samples=[]}return p(e,[{key:"addNext",value:function(e){"number"!=typeof e?h.error("".concat(this.name," - invalid value for idx: ").concat(this.count),e):isNaN(e)||(this.sum+=e,this.samples.push(e),this.count+=1)}},{key:"calculate",value:function(){return this.sum/this.count}},{key:"appendReport",value:function(e){e["".concat(this.name,"_avg")]=this.calculate(),e["".concat(this.name,"_samples")]=JSON.stringify(this.samples)}},{key:"reset",value:function(){this.samples=[],this.sum=0,this.count=0}}]),e}(),m=function(){function e(t,n,r){var i=this;d(this,e),this.isP2P=n,this._n=r,this._sampleIdx=0,this._avgRTT=new v("rtt"),this._avgRemoteRTTMap=new Map,this._avgRtpStatsReporter=t,this._avgEnd2EndRTT=void 0,this._onConnectionStats=function(e,t){i.isP2P===e.isP2P&&i._calculateAvgStats(t)};var s=t._conference;s.statistics.addConnectionStatsListener(this._onConnectionStats),this.isP2P||(this._onUserLeft=function(e){return i._avgRemoteRTTMap.delete(e)},s.on(a.USER_LEFT,this._onUserLeft),this._onRemoteStatsUpdated=function(e,t){return i._processRemoteStats(e,t)},s.on(o.REMOTE_STATS_UPDATED,this._onRemoteStatsUpdated))}return p(e,[{key:"_calculateAvgStats",value:function(e){if(e){if(c.a.supportsRTTStatistics()&&e.transport&&e.transport.length&&this._avgRTT.addNext(e.transport[0].rtt),this._sampleIdx+=1,this._sampleIdx>=this._n){if(c.a.supportsRTTStatistics()){var t=this._avgRtpStatsReporter._conference,n={p2p:this.isP2P,conference_size:t.getParticipantCount()};if(e.transport&&e.transport.length&&Object.assign(n,{local_candidate_type:e.transport[0].localCandidateType,remote_candidate_type:e.transport[0].remoteCandidateType,transport_type:e.transport[0].type}),this._avgRTT.appendReport(n),this.isP2P){var i=this._avgRtpStatsReporter.jvbStatsMonitor._avgEnd2EndRTT;isNaN(i)||(n.rtt_diff=this._avgRTT.calculate()-i)}else{var o=this._calculateAvgRemoteRTT(),a=this._avgRTT.calculate();this._avgEnd2EndRTT=a+o,isNaN(a)||isNaN(o)||(n.end2end_rtt_avg=this._avgEnd2EndRTT)}u.a.sendAnalytics(Object(r.F)(n))}this._resetAvgStats()}}else h.error("No stats")}},{key:"_calculateAvgRemoteRTT",value:function(){var e=0,t=0,n=!0,r=!1,i=void 0;try{for(var o,a=this._avgRemoteRTTMap.values()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,c=s.calculate();isNaN(c)||(t+=c,e+=1,s.reset())}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return t/e}},{key:"_processRemoteStats",value:function(e,t){var n="number"==typeof t.jvbRTT,r=this._avgRemoteRTTMap.get(e);!r&&n&&(r=new v("".concat(e,"_stat_rtt")),this._avgRemoteRTTMap.set(e,r)),n?r.addNext(t.jvbRTT):r&&this._avgRemoteRTTMap.delete(e)}},{key:"_resetAvgStats",value:function(){this._avgRTT.reset(),this._avgRemoteRTTMap&&this._avgRemoteRTTMap.clear(),this._sampleIdx=0}},{key:"dispose",value:function(){var e=this._avgRtpStatsReporter._conference;e.statistics.removeConnectionStatsListener(this._onConnectionStats),this.isP2P||(e.off(o.REMOTE_STATS_UPDATED,this._onRemoteStatsUpdated),e.off(a.USER_LEFT,this._onUserLeft))}}]),e}(),g=function(){function e(t,n){var r=this;d(this,e),this._n=n,n>0?(h.info("Avg RTP stats will be calculated every ".concat(n," samples")),this._sampleIdx=0,this._conference=t,this._avgAudioBitrateUp=new v("bitrate_audio_upload"),this._avgAudioBitrateDown=new v("bitrate_audio_download"),this._avgVideoBitrateUp=new v("bitrate_video_upload"),this._avgVideoBitrateDown=new v("bitrate_video_download"),this._avgBandwidthUp=new v("bandwidth_upload"),this._avgBandwidthDown=new v("bandwidth_download"),this._avgPacketLossTotal=new v("packet_loss_total"),this._avgPacketLossUp=new v("packet_loss_upload"),this._avgPacketLossDown=new v("packet_loss_download"),this._avgRemoteFPS=new v("framerate_remote"),this._avgRemoteScreenFPS=new v("framerate_screen_remote"),this._avgLocalFPS=new v("framerate_local"),this._avgLocalScreenFPS=new v("framerate_screen_local"),this._avgRemoteCameraPixels=new v("pixels_remote"),this._avgRemoteScreenPixels=new v("pixels_screen_remote"),this._avgLocalCameraPixels=new v("pixels_local"),this._avgLocalScreenPixels=new v("pixels_screen_local"),this._avgCQ=new v("connection_quality"),this._onLocalStatsUpdated=function(e){return r._calculateAvgStats(e)},t.on(o.LOCAL_STATS_UPDATED,this._onLocalStatsUpdated),this._onP2PStatusChanged=function(){h.debug("Resetting average stats calculation"),r._resetAvgStats(),r.jvbStatsMonitor._resetAvgStats(),r.p2pStatsMonitor._resetAvgStats()},t.on(a.P2P_STATUS,this._onP2PStatusChanged),this._onJvb121StatusChanged=function(e,t){!0===t&&(h.info("Resetting JVB avg RTP stats"),r._resetAvgJvbStats())},t.on(a.JVB121_STATUS,this._onJvb121StatusChanged),this.jvbStatsMonitor=new m(this,!1,n),this.p2pStatsMonitor=new m(this,!0,n)):h.info("Avg RTP stats reports are disabled.")}return p(e,[{key:"_calculateAvgStats",value:function(e){if(e){var t=this._conference.isP2PActive(),n=this._conference.getParticipantCount();if(t||!(n<2)){var i=e.bitrate,o=e.bandwidth,a=e.packetLoss,s=e.framerate,d=e.resolution;if(i)if(o)if(a)if(s)if(d){if(this._avgAudioBitrateUp.addNext(i.audio.upload),this._avgAudioBitrateDown.addNext(i.audio.download),this._avgVideoBitrateUp.addNext(i.video.upload),this._avgVideoBitrateDown.addNext(i.video.download),c.a.supportsBandwidthStatistics()&&(this._avgBandwidthUp.addNext(o.upload),this._avgBandwidthDown.addNext(o.download)),this._avgPacketLossUp.addNext(a.upload),this._avgPacketLossDown.addNext(a.download),this._avgPacketLossTotal.addNext(a.total),this._avgCQ.addNext(e.connectionQuality),s&&(this._avgRemoteFPS.addNext(this._calculateAvgVideoFps(s,!1,l.CAMERA)),this._avgRemoteScreenFPS.addNext(this._calculateAvgVideoFps(s,!1,l.DESKTOP)),this._avgLocalFPS.addNext(this._calculateAvgVideoFps(s,!0,l.CAMERA)),this._avgLocalScreenFPS.addNext(this._calculateAvgVideoFps(s,!0,l.DESKTOP))),d&&(this._avgRemoteCameraPixels.addNext(this._calculateAvgVideoPixels(d,!1,l.CAMERA)),this._avgRemoteScreenPixels.addNext(this._calculateAvgVideoPixels(d,!1,l.DESKTOP)),this._avgLocalCameraPixels.addNext(this._calculateAvgVideoPixels(d,!0,l.CAMERA)),this._avgLocalScreenPixels.addNext(this._calculateAvgVideoPixels(d,!0,l.DESKTOP))),this._sampleIdx+=1,this._sampleIdx>=this._n){var f={p2p:t,conference_size:n};e.transport&&e.transport.length&&Object.assign(f,{local_candidate_type:e.transport[0].localCandidateType,remote_candidate_type:e.transport[0].remoteCandidateType,transport_type:e.transport[0].type}),this._avgAudioBitrateUp.appendReport(f),this._avgAudioBitrateDown.appendReport(f),this._avgVideoBitrateUp.appendReport(f),this._avgVideoBitrateDown.appendReport(f),c.a.supportsBandwidthStatistics()&&(this._avgBandwidthUp.appendReport(f),this._avgBandwidthDown.appendReport(f)),this._avgPacketLossUp.appendReport(f),this._avgPacketLossDown.appendReport(f),this._avgPacketLossTotal.appendReport(f),this._avgRemoteFPS.appendReport(f),isNaN(this._avgRemoteScreenFPS.calculate())||this._avgRemoteScreenFPS.appendReport(f),this._avgLocalFPS.appendReport(f),isNaN(this._avgLocalScreenFPS.calculate())||this._avgLocalScreenFPS.appendReport(f),this._avgRemoteCameraPixels.appendReport(f),isNaN(this._avgRemoteScreenPixels.calculate())||this._avgRemoteScreenPixels.appendReport(f),this._avgLocalCameraPixels.appendReport(f),isNaN(this._avgLocalScreenPixels.calculate())||this._avgLocalScreenPixels.appendReport(f),this._avgCQ.appendReport(f),u.a.sendAnalytics(Object(r.F)(f)),this._resetAvgStats()}}else h.error("No resolution");else h.error('No "framerate"');else h.error('No "packetloss"');else h.error('No "bandwidth"');else h.error('No "bitrate"')}}else h.error("No stats")}},{key:"_calculateAvgVideoPixels",value:function(e,t,n){for(var r=0,i=0,o=this._conference.myUserId(),a=Object.keys(e),s=0;s<a.length;s++){var c=a[s];if(t?c===o:c!==o){var u=t?null:this._conference.getParticipantById(c),l=e[c];if((t||u)&&l){var d=this._calculatePeerAvgVideoPixels(l,u,n);isNaN(d)||(r+=d,i+=1)}}}return r/i}},{key:"_calculatePeerAvgVideoPixels",value:function(e,t,n){var r=Object.keys(e).map(function(e){return Number(e)}),i=null,o=this._conference.getActivePeerConnection();t?(i=t.getTracksByMediaType(s.b))&&(r=r.filter(function(e){return i.find(function(t){return!t.isMuted()&&t.getSSRC()===e&&t.videoType===n})})):(i=this._conference.getLocalTracks(s.b),r=r.filter(function(e){return i.find(function(t){return!t.isMuted()&&o.getLocalSSRC(t)===e&&t.videoType===n})}));var a=0,c=0,u=!0,l=!1,d=void 0;try{for(var f,p=r[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){var h=f.value,v=Number(e[h].height)*Number(e[h].width);!isNaN(v)&&v>0&&(a+=v,c+=1)}}catch(e){l=!0,d=e}finally{try{u||null==p.return||p.return()}finally{if(l)throw d}}return a/c}},{key:"_calculateAvgVideoFps",value:function(e,t,n){for(var r=0,i=0,o=this._conference.myUserId(),a=Object.keys(e),s=0;s<a.length;s++){var c=a[s];if(t?c===o:c!==o){var u=t?null:this._conference.getParticipantById(c),l=e[c];if((t||u)&&l){var d=this._calculatePeerAvgVideoFps(l,u,n);isNaN(d)||(r+=d,i+=1)}}}return r/i}},{key:"_calculatePeerAvgVideoFps",value:function(e,t,n){var r=Object.keys(e).map(function(e){return Number(e)}),i=null,o=this._conference.getActivePeerConnection();t?(i=t.getTracksByMediaType(s.b))&&(r=r.filter(function(e){return i.find(function(t){return!t.isMuted()&&t.getSSRC()===e&&t.videoType===n})})):(i=this._conference.getLocalTracks(s.b),r=r.filter(function(e){return i.find(function(t){return!t.isMuted()&&o.getLocalSSRC(t)===e&&t.videoType===n})}));var a=0,c=0,u=!0,l=!1,d=void 0;try{for(var f,p=r[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){var h=f.value,v=Number(e[h]);!isNaN(v)&&v>0&&(a+=v,c+=1)}}catch(e){l=!0,d=e}finally{try{u||null==p.return||p.return()}finally{if(l)throw d}}return a/c}},{key:"_resetAvgJvbStats",value:function(){this._resetAvgStats(),this.jvbStatsMonitor._resetAvgStats()}},{key:"_resetAvgStats",value:function(){this._avgAudioBitrateUp.reset(),this._avgAudioBitrateDown.reset(),this._avgVideoBitrateUp.reset(),this._avgVideoBitrateDown.reset(),this._avgBandwidthUp.reset(),this._avgBandwidthDown.reset(),this._avgPacketLossUp.reset(),this._avgPacketLossDown.reset(),this._avgPacketLossTotal.reset(),this._avgRemoteFPS.reset(),this._avgRemoteScreenFPS.reset(),this._avgLocalFPS.reset(),this._avgLocalScreenFPS.reset(),this._avgRemoteCameraPixels.reset(),this._avgRemoteScreenPixels.reset(),this._avgLocalCameraPixels.reset(),this._avgLocalScreenPixels.reset(),this._avgCQ.reset(),this._sampleIdx=0}},{key:"dispose",value:function(){this._conference.off(a.P2P_STATUS,this._onP2PStatusChanged),this._conference.off(o.LOCAL_STATS_UPDATED,this._onLocalStatsUpdated),this._conference.off(a.JVB121_STATUS,this._onJvb121StatusChanged),this.jvbStatsMonitor.dispose(),this.p2pStatsMonitor.dispose()}}]),e}()}).call(this,"modules/statistics/AvgRTPStatsReporter.js")},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(2),i=n(57),o=n.n(i),a=n(0),s=n.n(a);function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.stats={users:{},dominantSpeakerId:null};var n=t.myUserId();this.stats.users[n]=new o.a(n,null,!0),t.addEventListener(r.DOMINANT_SPEAKER_CHANGED,this._onDominantSpeaker.bind(this)),t.addEventListener(r.USER_JOINED,this._onUserJoin.bind(this)),t.addEventListener(r.USER_LEFT,this._onUserLeave.bind(this)),t.addEventListener(r.DISPLAY_NAME_CHANGED,this._onDisplayNameChange.bind(this)),t.xmpp&&t.xmpp.addListener(s.a.SPEAKER_STATS_RECEIVED,this._updateStats.bind(this))}var t,n,i;return t=e,(n=[{key:"_onDominantSpeaker",value:function(e){var t=this.stats.users[this.stats.dominantSpeakerId],n=this.stats.users[e];t&&t.setDominantSpeaker(!1),n&&n.setDominantSpeaker(!0),this.stats.dominantSpeakerId=e}},{key:"_onUserJoin",value:function(e,t){var n=this.stats.users[e];n||(n=this.stats.users[e]=new o.a(e,t.getDisplayName()))}},{key:"_onUserLeave",value:function(e){var t=this.stats.users[e];t&&t.markAsHasLeft()}},{key:"_onDisplayNameChange",value:function(e,t){var n=this.stats.users[e];n&&n.setDisplayName(t)}},{key:"getStats",value:function(){return this.stats.users}},{key:"_updateStats",value:function(e){for(var t in e){var n=void 0;this.stats.users[t]?(n=this.stats.users[t]).getDisplayName()||n.setDisplayName(e[t].displayName):(n=new o.a(t,e[t].displayName),this.stats.users[t]=n,n.markAsHasLeft()),n.totalDominantSpeakerTime=e[t].totalDominantSpeakerTime}}}])&&c(t.prototype,n),i&&c(t,i),e}()},function(e,t,n){var r=n(66),i=n(150),o="before";function a(){this.audioRecorder=new r,this.transcriptionService=new i,this.counter=null,this.startTime=null,this.transcription=null,this.callback=null,this.results=[],this.state=o,this.lineLength=0}function s(e){for(var t=0;t<e.length;t++)0===e[t].length&&e.splice(t,1);return e.length>0}a.prototype.start=function(){if(this.state!==o)throw new Error("The transcription can only start when it's in the \"".concat(o,'" state. It\'s currently in the "').concat(this.state,'" state'));this.state="recording",this.audioRecorder.start(),this.startTime=new Date},a.prototype.stop=function(e){var t=this;if("recording"!==this.state)throw new Error("The transcription can only stop when it's in the \"".concat("recording",'" state. It\'s currently in the "').concat(this.state,'" state'));console.log("stopping recording and sending audio files"),this.audioRecorder.stop();var n=function(e,t){if(console.log("retrieved an answer from the transcription service. The answer has an"+" array of length: ".concat(t.wordArray.length)),t.wordArray.length>0){var n=t.startTime.getUTCMilliseconds()-e.startTime.getUTCMilliseconds();n<0&&(n=0);var r="[";t.wordArray.forEach(function(e){e.begin+=n,e.end+=n,r+="".concat(e.word,",")}),r+="]",console.log(r),t.wordArray.name=t.name}e.results.push(t.wordArray),e.counter--,console.log("current counter: ".concat(e.counter)),e.maybeMerge()}.bind(null,this);this.audioRecorder.getRecordingResults().forEach(function(e){t.transcriptionService.send(e,n),t.counter++}),this.state="transcribing",this.callback=e},a.prototype.maybeMerge=function(){"transcribing"===this.state&&0===this.counter&&this.merge()},a.prototype.merge=function(){var e=this;console.log("starting merge process!\n The length of the array: ".concat(this.results.length)),this.transcription="";var t=this.results,n=[];s(t),t.forEach(function(e){return function(e,t){if(0===e.length)e.push(t);else{if(e[e.length-1].begin<=t.begin)return void e.push(t);for(var n=0;n<e.length;n++)if(t.begin<e[n].begin)return void e.splice(n,0,t);e.push(t)}}(n,e)});for(var r=function(){var n=t[0];t.forEach(function(e){e[0].begin<n[0].begin&&(n=e)});var r=n.shift();e.updateTranscription(r,n.name);for(var i=function(){var i=!1,o=n[0].begin;if(t.forEach(function(e){e[0].begin<o&&(i=!0)}),i)return"break";r=n.shift(),e.updateTranscription(r,null)};n.length>0;){if("break"===i())break}};s(t);)r();this.state="finished",this.callback&&this.callback(this.transcription)},a.prototype.updateTranscription=function(e,t){null!=t&&(this.transcription+="\n".concat(t,":"),this.lineLength=t.length+1),this.lineLength+e.word.length>80&&(this.transcription+="\n    ",this.lineLength=4),this.transcription+=" ".concat(e.word),this.lineLength+=e.word.length+1},a.prototype.addTrack=function(e){this.audioRecorder.addTrack(e)},a.prototype.removeTrack=function(e){this.audioRecorder.removeTrack(e)},a.prototype.getTranscription=function(){if("finished"!==this.state)throw new Error("The transcription can only be retrieved when it's in the \"".concat("finished",'" state. It\'s currently in the "').concat(this.state,'" state'));return this.transcription},a.prototype.getState=function(){return this.state},a.prototype.reset=function(){this.state=o,this.counter=null,this.transcription=null,this.startTime=null,this.callback=null,this.results=[],this.lineLength=0},e.exports=a},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return o});var r=n(6),i=n(4).getLogger(e);function o(e){this.versions={},this.conference=e,this.conference.addCommandListener("versions",this.processPresence.bind(this))}o.FOCUS_COMPONENT="focus",o.VIDEOBRIDGE_COMPONENT="videobridge",o.XMPP_SERVER_COMPONENT="xmpp",o.prototype.processPresence=function(e,t,n){var a=this;if("http://jitsi.org/jitmeet"===e.attributes.xmlns)if(this.conference._isFocus(n)){var s=[];e.children.forEach(function(e){var t=e.attributes.name;if(t===o.FOCUS_COMPONENT||t===o.XMPP_SERVER_COMPONENT||t===o.VIDEOBRIDGE_COMPONENT){var n=e.value;a.versions[t]!==n&&(a.versions[t]=n,i.info("Got ".concat(t," version: ").concat(n)),s.push({id:"component_version",component:t,version:n}))}else i.warn("Received version for not supported component name: ".concat(t))}),s.length>0&&r.a.sendLog(JSON.stringify(s))}else i.warn("Received versions not from the focus user: ".concat(e),n);else i.warn("Ignored presence versions node - invalid xmlns",e)},o.prototype.getComponentVersion=function(e){return this.versions[e]}}).call(this,"modules/version/ComponentsVersions.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return l});var r=n(4),i=n(114),o=n(20),a=n(0),s=n.n(a);function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=Object(r.getLogger)(e),l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.chatRoom=t,this.eventEmitter=t.eventEmitter,u.debug("creating VideoSIPGW"),this.sessions={},this.sessionStateChangeListener=this.sessionStateChanged.bind(this),t.addPresenceListener("jibri-sip-call-state",this.handleJibriSIPState.bind(this))}var t,n,r;return t=e,(n=[{key:"handleJibriSIPState",value:function(e){var t=e.attributes;if(t){u.debug("Handle video sip gw state : ",t);var n=t.state;if(n!==this.state)switch(n){case o.STATE_ON:case o.STATE_OFF:case o.STATE_PENDING:case o.STATE_RETRYING:case o.STATE_FAILED:var r=t.sipaddress;if(!r)return;var i=this.sessions[r];i?i.setState(n,t.failure_reason):u.warn("Video SIP GW session not found:",r)}}}},{key:"createVideoSIPGWSession",value:function(e,t){if(this.sessions[e])return u.warn("There was already a Video SIP GW session for address",e),new Error(o.ERROR_SESSION_EXISTS);var n=new i.a(e,t,this.chatRoom);return n.addStateListener(this.sessionStateChangeListener),this.sessions[e]=n,n}},{key:"sessionStateChanged",value:function(e){var t=e.address;if(e.newState===o.STATE_OFF||e.newState===o.STATE_FAILED){var n=this.sessions[t];if(!n)return void u.error("Missing Video SIP GW session with address:",t);n.removeStateListener(this.sessionStateChangeListener),delete this.sessions[t]}this.eventEmitter.emit(s.a.VIDEO_SIP_GW_SESSION_STATE_CHANGED,e)}}])&&c(t.prototype,n),r&&c(t,r),e}()}).call(this,"modules/videosipgw/VideoSIPGW.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return p});var r=n(4),i=n(1),o=n(24),a=n(20);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=Object(r.getLogger)(e),p=function(e){function t(e,n,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=u(this,l(t).call(this))).sipAddress=e,i.displayName=n,i.chatRoom=r,i.state=void 0,i}var n,r,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,o["a"]),n=t,(r=[{key:"stop",value:function(){this.state!==a.STATE_OFF&&this.state!==a.STATE_FAILED?this._sendJibriIQ("stop"):f.warn("Video SIP GW session already stopped or failed!")}},{key:"start",value:function(){this.state!==a.STATE_ON&&this.state!==a.STATE_OFF&&this.state!==a.STATE_PENDING&&this.state!==a.STATE_RETRYING?this._sendJibriIQ("start"):f.warn("Video SIP GW session already started!")}},{key:"setState",value:function(e,t){if(e!==this.state){var n=this.state;this.state=e,this.eventEmitter.emit("STATE_CHANGED",{address:this.sipAddress,failureReason:t,oldState:n,newState:this.state,displayName:this.displayName})}}},{key:"addStateListener",value:function(e){this.addListener("STATE_CHANGED",e)}},{key:"removeStateListener",value:function(e){this.removeListener("STATE_CHANGED",e)}},{key:"_sendJibriIQ",value:function(e){var t=this,n={xmlns:"http://jitsi.org/protocol/jibri",action:e,sipaddress:this.sipAddress};n.displayname=this.displayName;var r=Object(i.$iq)({to:this.chatRoom.focusMucJid,type:"set"}).c("jibri",n).up();f.debug("".concat(e," video SIP GW session"),r.nodeTree),this.chatRoom.connection.sendIQ(r,function(){},function(n){f.error("Failed to ".concat(e," video SIP GW session, error: "),n),t.setState(a.STATE_FAILED)})}}])&&c(n.prototype,r),s&&c(n,s),t}()}).call(this,"modules/videosipgw/JitsiVideoSIPGWSession.js")},function(e,t,n){"use strict";t.a={error:{BUSY:"busy",ERROR:"error",RESOURCE_CONSTRAINT:"resource-constraint",SERVICE_UNAVAILABLE:"service-unavailable"},mode:{FILE:"file",STREAM:"stream"},status:{OFF:"off",ON:"on",PENDING:"pending"}}},function(e,t,n){e.exports=n(117).default},function(e,t,n){"use strict";n.r(t),function(e){var r=n(7),i=n(67),o=n.n(i),a=n(33),s=n(50),c=n(10),u=n.n(c),l=n(21),d=n(2),f=n(68),p=n(37),h=n(22),v=n(62),m=n(46),g=n(15),y=n(12),b=n(17),S=n(53),_=n(51),E=n(4),C=n.n(E),T=n(9),w=n(30),k=n.n(w),R=n(44),P=n(13),I=n(3),O=n(52),A=n.n(O),M=n(115),D=n(6),N=n(20);function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var L,j=C.a.getLogger(e);function F(e){var t={audio_requested:e.devices.includes("audio"),video_requested:e.devices.includes("video"),screen_sharing_requested:e.devices.includes("desktop")};return t.video_requested&&(t.resolution=e.resolution),t}t.default=(L={version:"development",JitsiConnection:f.a,constants:{participantConnectionStatus:R.a,recording:M.a,sipVideoGW:N,transcriptionStatus:S},events:{conference:d,connection:h,track:b,mediaDevices:m,connectionQuality:a,e2eping:s},errors:{conference:l,connection:p,track:y},errorTypes:{JitsiTrackError:g.a},logLevels:C.a.levels,mediaDevices:v.a,analytics:D.a.analytics,init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D.a.init(e),window.connectionTimes||(window.connectionTimes={}),!0!==e.enableAnalyticsLogging&&(j.warn("Analytics disabled, disposing."),this.analytics.dispose()),e.enableWindowOnErrorHandler&&u.a.addHandler(this.getGlobalOnErrorHandler.bind(this));var t=e.deploymentInfo;if(t&&Object.keys(t).length>0){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);n.id="deployment_info",D.a.sendLog(JSON.stringify(n))}if(this.version){var i={id:"component_version",component:"lib-jitsi-meet",version:this.version};D.a.sendLog(JSON.stringify(i))}return P.a.init(e)},isDesktopSharingEnabled:function(){return P.a.isDesktopSharingEnabled()},isWebRtcSupported:function(){return P.a.isWebRtcSupported()},setLogLevel:function(e){C.a.setLogLevel(e)},setLogLevelById:function(e,t){C.a.setLogLevelById(e,t)},addGlobalLogTransport:function(e){C.a.addGlobalTransport(e)},removeGlobalLogTransport:function(e){C.a.removeGlobalTransport(e)},createLocalTracks:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,o=!1;return!0===n&&window.setTimeout(function(){o||v.a.emitEvent(m.PERMISSION_PROMPT_IS_SHOWN,I.a.getName())},1e3),window.connectionTimes||(window.connectionTimes={}),window.connectionTimes["obtainPermissions.start"]=window.performance.now(),P.a.obtainAudioAndVideoPermissions(t).then(function(e){if(o=!0,window.connectionTimes["obtainPermissions.end"]=window.performance.now(),D.a.sendAnalytics(Object(r.A)("success",F(t))),!P.a.options.disableAudioLevels)for(var n=function(t){var n=e[t],r=n.getOriginalStream();n.getType()===T.a&&(D.a.startLocalStats(r,n.setAudioLevel.bind(n)),n.addEventListener(b.LOCAL_TRACK_STOPPED,function(){D.a.stopLocalStats(r)}))},i=0;i<e.length;i++)n(i);var a=P.a.getCurrentlyAvailableMediaDevices();if(a)for(i=0;i<e.length;i++){e[i]._setRealDeviceIdFromDeviceList(a)}return e}).catch(function(n){if(o=!0,n.name===y.UNSUPPORTED_RESOLUTION&&!I.a.usesNewGumFlow()){var a=t.resolution||"720",s=function(e){if(!k.a[e])return null;var t=k.a[e].order,n=null,r=null;return Object.keys(k.a).forEach(function(e){var i=k.a[e];(!n||n.order<i.order&&i.order<t)&&(r=e,n=i)}),r===e&&(r=null),r}(a);if(null!==s)return t.resolution=s,j.debug("Retry createLocalTracks with resolution",s),D.a.sendAnalytics(Object(r.A)("warning",{old_resolution:a,new_resolution:s,reason:"unsupported resolution"})),e.createLocalTracks(t,void 0,i||Object.assign({},t));if(i&&n.gum.constraints&&n.gum.constraints.video&&n.gum.constraints.video.mandatory&&n.gum.constraints.video.mandatory.sourceId)return i.cameraDeviceId=void 0,e.createLocalTracks(i)}if(n.name===y.CHROME_EXTENSION_USER_CANCELED){var c={id:"chrome_extension_user_canceled",message:n.message};D.a.sendLog(JSON.stringify(c)),D.a.sendAnalytics(Object(r.A)("warning",{reason:"extension install user canceled"}))}else if(n.name===y.NOT_FOUND){var u={id:"usermedia_missing_device",status:n.gum.devices};D.a.sendLog(JSON.stringify(u));var l=F(t);l.reason="device not found",l.devices=n.gum.devices.join("."),D.a.sendAnalytics(Object(r.A)("error",l))}else{D.a.sendGetUserMediaFailed(n);var d=F(t);d.reason=n.name,D.a.sendAnalytics(Object(r.A)("error",d))}return window.connectionTimes["obtainPermissions.end"]=window.performance.now(),Promise.reject(n)})},isDeviceListAvailable:function(){return j.warn("This method is deprecated, use JitsiMeetJS.mediaDevices.isDeviceListAvailable instead"),this.mediaDevices.isDeviceListAvailable()},isDeviceChangeAvailable:function(e){return j.warn("This method is deprecated, use JitsiMeetJS.mediaDevices.isDeviceChangeAvailable instead"),this.mediaDevices.isDeviceChangeAvailable(e)},isMultipleAudioInputSupported:function(){return this.mediaDevices.isMultipleAudioInputSupported()},isCollectingLocalStats:function(){return D.a.audioLevelsEnabled&&_.a.isLocalStatsSupported()},enumerateDevices:function(e){j.warn("This method is deprecated, use JitsiMeetJS.mediaDevices.enumerateDevices instead"),this.mediaDevices.enumerateDevices(e)},getGlobalOnErrorHandler:function(e,t,n,r,i){j.error("UnhandledError: ".concat(e),"Script: ".concat(t),"Line: ".concat(n),"Column: ".concat(r),"StackTrace: ",i),D.a.reportGlobalError(i)},util:{AuthUtil:o.a,ScriptUtil:A.a,browser:I.a}},"object"===x(window.JitsiMeetJS)?Object.assign({},window.JitsiMeetJS,L):L)}.call(this,"JitsiMeetJS.js")},function(e,t,n){var r=n(63);function i(e,t){this.logStorage=e,this.stringifyObjects=!(!t||!t.stringifyObjects)&&t.stringifyObjects,this.storeInterval=t&&t.storeInterval?t.storeInterval:3e4,this.maxEntryLength=t&&t.maxEntryLength?t.maxEntryLength:1e4,Object.keys(r.levels).forEach(function(e){this[r.levels[e]]=function(e){this._log.apply(this,arguments)}.bind(this,e)}.bind(this)),this.storeLogsIntervalID=null,this.queue=[],this.totalLen=0,this.outputCache=[]}i.prototype.stringify=function(e){try{return JSON.stringify(e)}catch(e){return"[object with circular refs?]"}},i.prototype.formatLogMessage=function(e){for(var t="",n=1,i=arguments.length;n<i;n++){var o=arguments[n];!this.stringifyObjects&&e!==r.levels.ERROR||"object"!=typeof o||(o=this.stringify(o)),t+=o,n!=i-1&&(t+=" ")}return t.length?t:null},i.prototype._log=function(){var e=this.formatLogMessage.apply(this,arguments);if(e){var t=this.queue.length?this.queue[this.queue.length-1]:void 0;("object"==typeof t?t.text:t)==e?"object"==typeof t?t.count+=1:this.queue[this.queue.length-1]={text:e,count:2}:(this.queue.push(e),this.totalLen+=e.length)}this.totalLen>=this.maxEntryLength&&this._flush(!0,!0)},i.prototype.start=function(){this._reschedulePublishInterval()},i.prototype._reschedulePublishInterval=function(){this.storeLogsIntervalID&&(window.clearTimeout(this.storeLogsIntervalID),this.storeLogsIntervalID=null),this.storeLogsIntervalID=window.setTimeout(this._flush.bind(this,!1,!0),this.storeInterval)},i.prototype.flush=function(){this._flush(!1,!0)},i.prototype._flush=function(e,t){this.totalLen>0&&(this.logStorage.isReady()||e)&&(this.logStorage.isReady()?(this.outputCache.length&&(this.outputCache.forEach(function(e){this.logStorage.storeLogs(e)}.bind(this)),this.outputCache=[]),this.logStorage.storeLogs(this.queue)):this.outputCache.push(this.queue),this.queue=[],this.totalLen=0),t&&this._reschedulePublishInterval()},i.prototype.stop=function(){this._flush(!1,!1)},e.exports=i},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},function(e,t){(function(t){e.exports=t}).call(this,{})},function(e,t,n){(function(n){var r,i,o,a;/*! callstats  version = 3.53.4 2018-09-06 01-38-32 */
!function(){return function e(t,n,i){function o(s,c){if(!n[s]){if(!t[s]){if(!c&&"function"==typeof r&&r)return r(s,!0);if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){return o(t[s][1][e]||e)},l,l.exports,e,t,n,i)}return n[s].exports}for(var a="function"==typeof r&&r,s=0;s<i.length;s++)o(i[s]);return o}}()({1:[function(r,s,c){(function(n,r,u){!function(n){"object"==typeof c&&void 0!==s?s.exports=n():(o=[],void 0===(a="function"==typeof(i=n)?i.apply(t,o):i)||(e.exports=a))}(function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof _dereq_&&_dereq_;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){return i(t[a][1][e]||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof _dereq_&&_dereq_,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";t.exports=function(e){function t(e){var t=new n(e),r=t.promise();return t.setHowMany(1),t.setUnwrap(),t.init(),r}var n=e._SomePromiseArray;e.any=function(e){return t(e)},e.prototype.any=function(){return t(this)}}},{}],2:[function(e,t,r){"use strict";function i(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new l(16),this._normalQueue=new l(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=u}function o(e,t,n){this._lateQueue.push(e,t,n),this._queueTick()}function a(e,t,n){this._normalQueue.push(e,t,n),this._queueTick()}function s(e){this._normalQueue._pushOne(e),this._queueTick()}var c;try{throw new Error}catch(e){c=e}var u=e("./schedule"),l=e("./queue"),d=e("./util");i.prototype.setScheduler=function(e){var t=this._schedule;return this._schedule=e,this._customScheduler=!0,t},i.prototype.hasCustomScheduler=function(){return this._customScheduler},i.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},i.prototype.disableTrampolineIfNecessary=function(){d.hasDevTools&&(this._trampolineEnabled=!1)},i.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},i.prototype.fatalError=function(e,t){t?(n.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n"),n.exit(2)):this.throwLater(e)},i.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),"undefined"!=typeof setTimeout)setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},d.hasDevTools?(i.prototype.invokeLater=function(e,t,n){this._trampolineEnabled?o.call(this,e,t,n):this._schedule(function(){setTimeout(function(){e.call(t,n)},100)})},i.prototype.invoke=function(e,t,n){this._trampolineEnabled?a.call(this,e,t,n):this._schedule(function(){e.call(t,n)})},i.prototype.settlePromises=function(e){this._trampolineEnabled?s.call(this,e):this._schedule(function(){e._settlePromises()})}):(i.prototype.invokeLater=o,i.prototype.invoke=a,i.prototype.settlePromises=s),i.prototype._drainQueue=function(e){for(;e.length()>0;){var t=e.shift();if("function"==typeof t){var n=e.shift(),r=e.shift();t.call(n,r)}else t._settlePromises()}},i.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},i.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},i.prototype._reset=function(){this._isTickUsed=!1},t.exports=i,t.exports.firstLineError=c},{"./queue":26,"./schedule":29,"./util":36}],3:[function(e,t,n){"use strict";t.exports=function(e,t,n,r){var i=!1,o=function(e,t){this._reject(t)},a=function(e,t){t.promiseRejectionQueued=!0,t.bindingPromise._then(o,o,null,this,e)},s=function(e,t){0==(50397184&this._bitField)&&this._resolveCallback(t.target)},c=function(e,t){t.promiseRejectionQueued||this._reject(e)};e.prototype.bind=function(o){i||(i=!0,e.prototype._propagateFrom=r.propagateFromFunction(),e.prototype._boundValue=r.boundValueFunction());var u=n(o),l=new e(t);l._propagateFrom(this,1);var d=this._target();if(l._setBoundTo(u),u instanceof e){var f={promiseRejectionQueued:!1,promise:l,target:d,bindingPromise:u};d._then(t,a,void 0,l,f),u._then(s,c,void 0,l,f),l._setOnCancel(u)}else l._resolveCallback(d);return l},e.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=2097152|this._bitField,this._boundTo=e):this._bitField=-2097153&this._bitField},e.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},e.bind=function(t,n){return e.resolve(n).bind(t)}}},{}],4:[function(e,t,n){"use strict";var r;"undefined"!=typeof Promise&&(r=Promise);var i=e("./promise")();i.noConflict=function(){try{Promise===i&&(Promise=r)}catch(e){}return i},t.exports=i},{"./promise":22}],5:[function(e,t,n){"use strict";var r=Object.create;if(r){var i=r(null),o=r(null);i[" size"]=o[" size"]=0}t.exports=function(t){function n(e){return function(e,n){var r;if(null!=e&&(r=e[n]),"function"!=typeof r){var i="Object "+o.classString(e)+" has no method '"+o.toString(n)+"'";throw new t.TypeError(i)}return r}(e,this.pop()).apply(e,this)}function r(e){return e[this]}function i(e){var t=+this;return t<0&&(t=Math.max(0,t+e.length)),e[t]}var o=e("./util"),a=o.canEvaluate;o.isIdentifier,t.prototype.call=function(e){var t=[].slice.call(arguments,1);return t.push(e),this._then(n,void 0,void 0,t,void 0)},t.prototype.get=function(e){var t;if("number"==typeof e)t=i;else if(a){var n=(void 0)(e);t=null!==n?n:r}else t=r;return this._then(t,void 0,void 0,e,void 0)}}},{"./util":36}],6:[function(e,t,n){"use strict";t.exports=function(t,n,r,i){var o=e("./util"),a=o.tryCatch,s=o.errorObj,c=t._async;t.prototype.break=t.prototype.cancel=function(){if(!i.cancellation())return this._warn("cancellation is disabled");for(var e=this,t=e;e._isCancellable();){if(!e._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}var n=e._cancellationParent;if(null==n||!n._isCancellable()){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}e._isFollowing()&&e._followee().cancel(),e._setWillBeCancelled(),t=e,e=n}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},t.prototype._cancelBy=function(e){return e===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),c.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(e,t){if(o.isArray(e))for(var n=0;n<e.length;++n)this._doInvokeOnCancel(e[n],t);else if(void 0!==e)if("function"==typeof e){if(!t){var r=a(e).call(this._boundValue());r===s&&(this._attachExtraTrace(r.e),c.throwLater(r.e))}}else e._resultCancelled(this)},t.prototype._invokeOnCancel=function(){var e=this._onCancel();this._unsetOnCancel(),c.invoke(this._doInvokeOnCancel,this,e)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(e,t,n){"use strict";t.exports=function(t){var n=e("./util"),r=e("./es5").keys,i=n.tryCatch,o=n.errorObj;return function(e,a,s){return function(c){var u=s._boundValue();e:for(var l=0;l<e.length;++l){var d=e[l];if(d===Error||null!=d&&d.prototype instanceof Error){if(c instanceof d)return i(a).call(u,c)}else if("function"==typeof d){var f=i(d).call(u,c);if(f===o)return f;if(f)return i(a).call(u,c)}else if(n.isObject(c)){for(var p=r(d),h=0;h<p.length;++h){var v=p[h];if(d[v]!=c[v])continue e}return i(a).call(u,c)}}return t}}}},{"./es5":13,"./util":36}],8:[function(e,t,n){"use strict";t.exports=function(e){function t(){this._trace=new t.CapturedTrace(n())}function n(){var e=i.length-1;if(e>=0)return i[e]}var r=!1,i=[];return e.prototype._promiseCreated=function(){},e.prototype._pushContext=function(){},e.prototype._popContext=function(){return null},e._peekContext=e.prototype._peekContext=function(){},t.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,i.push(this._trace))},t.prototype._popContext=function(){if(void 0!==this._trace){var e=i.pop(),t=e._promiseCreated;return e._promiseCreated=null,t}return null},t.CapturedTrace=null,t.create=function(){if(r)return new t},t.deactivateLongStackTraces=function(){},t.activateLongStackTraces=function(){var i=e.prototype._pushContext,o=e.prototype._popContext,a=e._peekContext,s=e.prototype._peekContext,c=e.prototype._promiseCreated;t.deactivateLongStackTraces=function(){e.prototype._pushContext=i,e.prototype._popContext=o,e._peekContext=a,e.prototype._peekContext=s,e.prototype._promiseCreated=c,r=!1},r=!0,e.prototype._pushContext=t.prototype._pushContext,e.prototype._popContext=t.prototype._popContext,e._peekContext=e.prototype._peekContext=n,e.prototype._promiseCreated=function(){var e=this._peekContext();e&&null==e._promiseCreated&&(e._promiseCreated=this)}},t}},{}],9:[function(e,t,r){"use strict";t.exports=function(t,r){function i(e,t){return{promise:t}}function o(){return!1}function a(e,t,n){var r=this;try{e(t,n,function(e){if("function"!=typeof e)throw new TypeError("onCancel must be a function, got: "+O.toString(e));r._attachCancellationCallback(e)})}catch(e){return e}}function s(e){if(!this._isCancellable())return this;var t=this._onCancel();void 0!==t?O.isArray(t)?t.push(e):this._setOnCancel([t,e]):this._setOnCancel(e)}function c(){return this._onCancelField}function u(e){this._onCancelField=e}function l(){this._cancellationParent=void 0,this._onCancelField=void 0}function d(e,t){if(0!=(1&t)){this._cancellationParent=e;var n=e._branchesRemainingToCancel;void 0===n&&(n=0),e._branchesRemainingToCancel=n+1}0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function f(){var e=this._boundTo;return void 0!==e&&e instanceof t?e.isFulfilled()?e.value():void 0:e}function p(){this._trace=new C(this._peekContext())}function h(e,t){if(A(e)){var n=this._trace;if(void 0!==n&&t&&(n=n._parent),void 0!==n)n.attachExtraTrace(e);else if(!e.__stackCleaned__){var r=g(e);O.notEnumerableProp(e,"stack",r.message+"\n"+r.stack.join("\n")),O.notEnumerableProp(e,"__stackCleaned__",!0)}}}function v(e,n,r){if(X.warnings){var i,o=new I(e);if(n)r._attachExtraTrace(o);else if(X.longStackTraces&&(i=t._peekContext()))i.attachExtraTrace(o);else{var a=g(o);o.stack=a.message+"\n"+a.stack.join("\n")}q("warning",o)||y(o,"",!0)}}function m(e){for(var t=[],n=0;n<e.length;++n){var r=e[n],i="    (No stack trace)"===r||x.test(r),o=i&&z(r);i&&!o&&(j&&" "!==r.charAt(0)&&(r="    "+r),t.push(r))}return t}function g(e){var t=e.stack,n=e.toString();return t="string"==typeof t&&t.length>0?function(e){for(var t=e.stack.replace(/\s+$/g,"").split("\n"),n=0;n<t.length;++n){var r=t[n];if("    (No stack trace)"===r||x.test(r))break}return n>0&&"SyntaxError"!=e.name&&(t=t.slice(n)),t}(e):["    (No stack trace)"],{message:n,stack:"SyntaxError"==e.name?t:m(t)}}function y(e,t,n){if("undefined"!=typeof console){var r;if(O.isObject(e)){var i=e.stack;r=t+L(i,e)}else r=t+String(e);"function"==typeof k?k(r,n):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(r)}}function b(e,t,n,r){var i=!1;try{"function"==typeof t&&(i=!0,"rejectionHandled"===e?t(r):t(n,r))}catch(e){P.throwLater(e)}"unhandledRejection"===e?q(e,n,r)||i||y(n,"Unhandled rejection "):q(e,r)}function S(e){var t;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{if(t=e&&"function"==typeof e.toString?e.toString():O.toString(e),/\[object [a-zA-Z0-9$_]+\]/.test(t))try{t=JSON.stringify(e)}catch(e){}0===t.length&&(t="(empty array)")}return"(<"+function(e){return e.length<41?e:e.substr(0,38)+"..."}(t)+">, no stack trace)"}function _(){return"function"==typeof $}function E(e){var t=e.match(Q);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}function C(e){this._parent=e,this._promisesCreated=0;var t=this._length=1+(void 0===e?0:e._length);$(this,C),t>32&&this.uncycle()}var T,w,k,R=t._getDomain,P=t._async,I=e("./errors").Warning,O=e("./util"),A=O.canAttachTrace,M=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,D=/\((?:timers\.js):\d+:\d+\)/,N=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,x=null,L=null,j=!1,F=!(0==O.env("BLUEBIRD_DEBUG")),U=!(0==O.env("BLUEBIRD_WARNINGS")||!F&&!O.env("BLUEBIRD_WARNINGS")),H=!(0==O.env("BLUEBIRD_LONG_STACK_TRACES")||!F&&!O.env("BLUEBIRD_LONG_STACK_TRACES")),B=0!=O.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(U||!!O.env("BLUEBIRD_W_FORGOTTEN_RETURN"));t.prototype.suppressUnhandledRejections=function(){var e=this._target();e._bitField=-1048577&e._bitField|524288},t.prototype._ensurePossibleRejectionHandled=function(){if(0==(524288&this._bitField)){this._setRejectionIsUnhandled();var e=this;setTimeout(function(){e._notifyUnhandledRejection()},1)}},t.prototype._notifyUnhandledRejectionIsHandled=function(){b("rejectionHandled",T,void 0,this)},t.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},t.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},t.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue();this._setUnhandledRejectionIsNotified(),b("unhandledRejection",w,e,this)}},t.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},t.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},t.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},t.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},t.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},t.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},t.prototype._warn=function(e,t,n){return v(e,t,n||this)},t.onPossiblyUnhandledRejection=function(e){var t=R();w="function"==typeof e?null===t?e:O.domainBind(t,e):void 0},t.onUnhandledRejectionHandled=function(e){var t=R();T="function"==typeof e?null===t?e:O.domainBind(t,e):void 0};var G=function(){};t.longStackTraces=function(){if(P.haveItemsQueued()&&!X.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!X.longStackTraces&&_()){var e=t.prototype._captureStackTrace,n=t.prototype._attachExtraTrace;X.longStackTraces=!0,G=function(){if(P.haveItemsQueued()&&!X.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");t.prototype._captureStackTrace=e,t.prototype._attachExtraTrace=n,r.deactivateLongStackTraces(),P.enableTrampoline(),X.longStackTraces=!1},t.prototype._captureStackTrace=p,t.prototype._attachExtraTrace=h,r.activateLongStackTraces(),P.disableTrampolineIfNecessary()}},t.hasLongStackTraces=function(){return X.longStackTraces&&_()};var J=function(){try{if("function"==typeof CustomEvent){var e=new CustomEvent("CustomEvent");return O.global.dispatchEvent(e),function(e,t){var n=new CustomEvent(e.toLowerCase(),{detail:t,cancelable:!0});return!O.global.dispatchEvent(n)}}if("function"==typeof Event){e=new Event("CustomEvent");return O.global.dispatchEvent(e),function(e,t){var n=new Event(e.toLowerCase(),{cancelable:!0});return n.detail=t,!O.global.dispatchEvent(n)}}return(e=document.createEvent("CustomEvent")).initCustomEvent("testingtheevent",!1,!0,{}),O.global.dispatchEvent(e),function(e,t){var n=document.createEvent("CustomEvent");return n.initCustomEvent(e.toLowerCase(),!1,!0,t),!O.global.dispatchEvent(n)}}catch(e){}return function(){return!1}}(),V=O.isNode?function(){return n.emit.apply(n,arguments)}:O.global?function(e){var t="on"+e.toLowerCase(),n=O.global[t];return!!n&&(n.apply(O.global,[].slice.call(arguments,1)),!0)}:function(){return!1},W={promiseCreated:i,promiseFulfilled:i,promiseRejected:i,promiseResolved:i,promiseCancelled:i,promiseChained:function(e,t,n){return{promise:t,child:n}},warning:function(e,t){return{warning:t}},unhandledRejection:function(e,t,n){return{reason:t,promise:n}},rejectionHandled:i},q=function(e){var t=!1;try{t=V.apply(null,arguments)}catch(e){P.throwLater(e),t=!0}var n=!1;try{n=J(e,W[e].apply(null,arguments))}catch(e){P.throwLater(e),n=!0}return n||t};t.config=function(e){if("longStackTraces"in(e=Object(e))&&(e.longStackTraces?t.longStackTraces():!e.longStackTraces&&t.hasLongStackTraces()&&G()),"warnings"in e){var n=e.warnings;X.warnings=!!n,B=X.warnings,O.isObject(n)&&"wForgottenReturn"in n&&(B=!!n.wForgottenReturn)}if("cancellation"in e&&e.cancellation&&!X.cancellation){if(P.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");t.prototype._clearCancellationData=l,t.prototype._propagateFrom=d,t.prototype._onCancel=c,t.prototype._setOnCancel=u,t.prototype._attachCancellationCallback=s,t.prototype._execute=a,K=d,X.cancellation=!0}return"monitoring"in e&&(e.monitoring&&!X.monitoring?(X.monitoring=!0,t.prototype._fireEvent=q):!e.monitoring&&X.monitoring&&(X.monitoring=!1,t.prototype._fireEvent=o)),t},t.prototype._fireEvent=o,t.prototype._execute=function(e,t,n){try{e(t,n)}catch(e){return e}},t.prototype._onCancel=function(){},t.prototype._setOnCancel=function(e){},t.prototype._attachCancellationCallback=function(e){},t.prototype._captureStackTrace=function(){},t.prototype._attachExtraTrace=function(){},t.prototype._clearCancellationData=function(){},t.prototype._propagateFrom=function(e,t){};var K=function(e,t){0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)},z=function(){return!1},Q=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;O.inherits(C,Error),r.CapturedTrace=C,C.prototype.uncycle=function(){var e=this._length;if(!(e<2)){for(var t=[],n={},r=0,i=this;void 0!==i;++r)t.push(i),i=i._parent;for(r=(e=this._length=r)-1;r>=0;--r){var o=t[r].stack;void 0===n[o]&&(n[o]=r)}for(r=0;r<e;++r){var a=n[t[r].stack];if(void 0!==a&&a!==r){a>0&&(t[a-1]._parent=void 0,t[a-1]._length=1),t[r]._parent=void 0,t[r]._length=1;var s=r>0?t[r-1]:this;a<e-1?(s._parent=t[a+1],s._parent.uncycle(),s._length=s._parent._length+1):(s._parent=void 0,s._length=1);for(var c=s._length+1,u=r-2;u>=0;--u)t[u]._length=c,c++;return}}}},C.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=g(e),n=t.message,r=[t.stack],i=this;void 0!==i;)r.push(m(i.stack.split("\n"))),i=i._parent;(function(e){for(var t=e[0],n=1;n<e.length;++n){for(var r=e[n],i=t.length-1,o=t[i],a=-1,s=r.length-1;s>=0;--s)if(r[s]===o){a=s;break}for(s=a;s>=0;--s){var c=r[s];if(t[i]!==c)break;t.pop(),i--}t=r}})(r),function(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}(r),O.notEnumerableProp(e,"stack",function(e,t){for(var n=0;n<t.length-1;++n)t[n].push("From previous event:"),t[n]=t[n].join("\n");return n<t.length&&(t[n]=t[n].join("\n")),e+"\n"+t.join("\n")}(n,r)),O.notEnumerableProp(e,"__stackCleaned__",!0)}};var $=function(){var e=/^\s*at\s*/,t=function(e,t){return"string"==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():S(t)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,x=e,L=t;var n=Error.captureStackTrace;return z=function(e){return M.test(e)},function(e,t){Error.stackTraceLimit+=6,n(e,t),Error.stackTraceLimit-=6}}var r,i=new Error;if("string"==typeof i.stack&&i.stack.split("\n")[0].indexOf("stackDetection@")>=0)return x=/@/,L=t,j=!0,function(e){e.stack=(new Error).stack};try{throw new Error}catch(e){r="stack"in e}return"stack"in i||!r||"number"!=typeof Error.stackTraceLimit?(L=function(e,t){return"string"==typeof e?e:"object"!=typeof t&&"function"!=typeof t||void 0===t.name||void 0===t.message?S(t):t.toString()},null):(x=e,L=t,function(e){Error.stackTraceLimit+=6;try{throw new Error}catch(t){e.stack=t.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(k=function(e){console.warn(e)},O.isNode&&n.stderr.isTTY?k=function(e,t){var n=t?"[33m":"[31m";console.warn(n+e+"[0m\n")}:O.isNode||"string"!=typeof(new Error).stack||(k=function(e,t){console.warn("%c"+e,t?"color: darkorange":"color: red")}));var X={warnings:U,longStackTraces:!1,cancellation:!1,monitoring:!1};return H&&t.longStackTraces(),{longStackTraces:function(){return X.longStackTraces},warnings:function(){return X.warnings},cancellation:function(){return X.cancellation},monitoring:function(){return X.monitoring},propagateFromFunction:function(){return K},boundValueFunction:function(){return f},checkForgottenReturns:function(e,t,n,r,i){if(void 0===e&&null!==t&&B){if(void 0!==i&&i._returnedNonUndefined())return;if(0==(65535&r._bitField))return;n&&(n+=" ");var o="",a="";if(t._trace){for(var s=t._trace.stack.split("\n"),c=m(s),u=c.length-1;u>=0;--u){var l=c[u];if(!D.test(l)){var d=l.match(N);d&&(o="at "+d[1]+":"+d[2]+":"+d[3]+" ");break}}if(c.length>0){var f=c[0];for(u=0;u<s.length;++u)if(s[u]===f){u>0&&(a="\n"+s[u-1]);break}}}var p="a promise was created in a "+n+"handler "+o+"but was not returned from it, see http://goo.gl/rRqMUw"+a;r._warn(p,!0,t)}},setBounds:function(e,t){if(_()){for(var n,r,i=e.stack.split("\n"),o=t.stack.split("\n"),a=-1,s=-1,c=0;c<i.length;++c)if(u=E(i[c])){n=u.fileName,a=u.line;break}for(c=0;c<o.length;++c){var u;if(u=E(o[c])){r=u.fileName,s=u.line;break}}a<0||s<0||!n||!r||n!==r||a>=s||(z=function(e){if(M.test(e))return!0;var t=E(e);return!!(t&&t.fileName===n&&a<=t.line&&t.line<=s)})}},warn:v,deprecated:function(e,t){var n=e+" is deprecated and will be removed in a future version.";return t&&(n+=" Use "+t+" instead."),v(n)},CapturedTrace:C,fireDomEvent:J,fireGlobalEvent:V}}},{"./errors":12,"./util":36}],10:[function(e,t,n){"use strict";t.exports=function(e){function t(){return this.value}function n(){throw this.reason}e.prototype.return=e.prototype.thenReturn=function(n){return n instanceof e&&n.suppressUnhandledRejections(),this._then(t,void 0,void 0,{value:n},void 0)},e.prototype.throw=e.prototype.thenThrow=function(e){return this._then(n,void 0,void 0,{reason:e},void 0)},e.prototype.catchThrow=function(e){if(arguments.length<=1)return this._then(void 0,n,void 0,{reason:e},void 0);var t=arguments[1];return this.caught(e,function(){throw t})},e.prototype.catchReturn=function(n){if(arguments.length<=1)return n instanceof e&&n.suppressUnhandledRejections(),this._then(void 0,t,void 0,{value:n},void 0);var r=arguments[1];r instanceof e&&r.suppressUnhandledRejections();return this.caught(n,function(){return r})}}},{}],11:[function(e,t,n){"use strict";t.exports=function(e,t){function n(){return i(this)}var r=e.reduce,i=e.all;e.prototype.each=function(e){return r(this,e,t,0)._then(n,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(e){return r(this,e,t,t)},e.each=function(e,i){return r(e,i,t,0)._then(n,void 0,void 0,e,void 0)},e.mapSeries=function(e,n){return r(e,n,t,t)}}},{}],12:[function(e,t,n){"use strict";function r(e,t){function n(r){if(!(this instanceof n))return new n(r);d(this,"message","string"==typeof r?r:t),d(this,"name",e),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return l(n,Error),n}function i(e){if(!(this instanceof i))return new i(e);d(this,"name","OperationalError"),d(this,"message",e),this.cause=e,this.isOperational=!0,e instanceof Error?(d(this,"message",e.message),d(this,"stack",e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var o,a,s=e("./es5"),c=s.freeze,u=e("./util"),l=u.inherits,d=u.notEnumerableProp,f=r("Warning","warning"),p=r("CancellationError","cancellation error"),h=r("TimeoutError","timeout error"),v=r("AggregateError","aggregate error");try{o=TypeError,a=RangeError}catch(e){o=r("TypeError","type error"),a=r("RangeError","range error")}for(var m="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),g=0;g<m.length;++g)"function"==typeof Array.prototype[m[g]]&&(v.prototype[m[g]]=Array.prototype[m[g]]);s.defineProperty(v.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),v.prototype.isOperational=!0;var y=0;v.prototype.toString=function(){var e=Array(4*y+1).join(" "),t="\n"+e+"AggregateError of:\n";y++,e=Array(4*y+1).join(" ");for(var n=0;n<this.length;++n){for(var r=this[n]===this?"[Circular AggregateError]":this[n]+"",i=r.split("\n"),o=0;o<i.length;++o)i[o]=e+i[o];t+=(r=i.join("\n"))+"\n"}return y--,t},l(i,Error);var b=Error.__BluebirdErrorTypes__;b||(b=c({CancellationError:p,TimeoutError:h,OperationalError:i,RejectionError:i,AggregateError:v}),s.defineProperty(Error,"__BluebirdErrorTypes__",{value:b,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:o,RangeError:a,CancellationError:b.CancellationError,OperationalError:b.OperationalError,TimeoutError:b.TimeoutError,AggregateError:b.AggregateError,Warning:f}},{"./es5":13,"./util":36}],13:[function(e,t,n){var r=function(){"use strict";return void 0===this}();if(r)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r,propertyIsWritable:function(e,t){var n=Object.getOwnPropertyDescriptor(e,t);return!(n&&!n.writable&&!n.set)}};else{var i={}.hasOwnProperty,o={}.toString,a={}.constructor.prototype,s=function(e){var t=[];for(var n in e)i.call(e,n)&&t.push(n);return t};t.exports={isArray:function(e){try{return"[object Array]"===o.call(e)}catch(e){return!1}},keys:s,names:s,defineProperty:function(e,t,n){return e[t]=n.value,e},getDescriptor:function(e,t){return{value:e[t]}},freeze:function(e){return e},getPrototypeOf:function(e){try{return Object(e).constructor.prototype}catch(e){return a}},isES5:r,propertyIsWritable:function(){return!0}}}},{}],14:[function(e,t,n){"use strict";t.exports=function(e,t){var n=e.map;e.prototype.filter=function(e,r){return n(this,e,r,t)},e.filter=function(e,r,i){return n(e,r,i,t)}}},{}],15:[function(e,t,n){"use strict";t.exports=function(t,n,r){function i(e,t,n){this.promise=e,this.type=t,this.handler=n,this.called=!1,this.cancelPromise=null}function o(e){this.finallyHandler=e}function a(e,t){return null!=e.cancelPromise&&(arguments.length>1?e.cancelPromise._reject(t):e.cancelPromise._cancel(),e.cancelPromise=null,!0)}function s(){return u.call(this,this.promise._target()._settledValue())}function c(e){if(!a(this,e))return f.e=e,f}function u(e){var i=this.promise,u=this.handler;if(!this.called){this.called=!0;var l=this.isFinallyHandler()?u.call(i._boundValue()):u.call(i._boundValue(),e);if(l===r)return l;if(void 0!==l){i._setReturnedNonUndefined();var p=n(l,i);if(p instanceof t){if(null!=this.cancelPromise){if(p._isCancelled()){var h=new d("late cancellation observer");return i._attachExtraTrace(h),f.e=h,f}p.isPending()&&p._attachCancellationCallback(new o(this))}return p._then(s,c,void 0,this,void 0)}}}return i.isRejected()?(a(this),f.e=e,f):(a(this),e)}var l=e("./util"),d=t.CancellationError,f=l.errorObj,p=e("./catch_filter")(r);return i.prototype.isFinallyHandler=function(){return 0===this.type},o.prototype._resultCancelled=function(){a(this.finallyHandler)},t.prototype._passThrough=function(e,t,n,r){return"function"!=typeof e?this.then():this._then(n,r,void 0,new i(this,t,e),void 0)},t.prototype.lastly=t.prototype.finally=function(e){return this._passThrough(e,0,u,u)},t.prototype.tap=function(e){return this._passThrough(e,1,u)},t.prototype.tapCatch=function(e){var n=arguments.length;if(1===n)return this._passThrough(e,1,void 0,u);var r,i=new Array(n-1),o=0;for(r=0;r<n-1;++r){var a=arguments[r];if(!l.isObject(a))return t.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+l.classString(a)));i[o++]=a}i.length=o;var s=arguments[r];return this._passThrough(p(i,s,this),1,void 0,u)},i}},{"./catch_filter":7,"./util":36}],16:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,a){function s(e,n,i,o){if(a.cancellation()){var s=new t(r),c=this._finallyPromise=new t(r);this._promise=s.lastly(function(){return c}),s._captureStackTrace(),s._setOnCancel(this)}else(this._promise=new t(r))._captureStackTrace();this._stack=o,this._generatorFunction=e,this._receiver=n,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(f):f,this._yieldedPromise=null,this._cancellationPhase=!1}var c=e("./errors").TypeError,u=e("./util"),l=u.errorObj,d=u.tryCatch,f=[];u.inherits(s,o),s.prototype._isResolved=function(){return null===this._promise},s.prototype._cleanup=function(){this._promise=this._generator=null,a.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},s.prototype._promiseCancelled=function(){if(!this._isResolved()){var e;if(void 0!==this._generator.return)this._promise._pushContext(),e=d(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var n=new t.CancellationError("generator .return() sentinel");t.coroutine.returnSentinel=n,this._promise._attachExtraTrace(n),this._promise._pushContext(),e=d(this._generator.throw).call(this._generator,n),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e)}},s.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();var t=d(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},s.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();var t=d(this._generator.throw).call(this._generator,e);this._promise._popContext(),this._continue(t)},s.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},s.prototype.promise=function(){return this._promise},s.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},s.prototype._continue=function(e){var n=this._promise;if(e===l)return this._cleanup(),this._cancellationPhase?n.cancel():n._rejectCallback(e.e,!1);var r=e.value;if(!0===e.done)return this._cleanup(),this._cancellationPhase?n.cancel():n._resolveCallback(r);var o=i(r,this._promise);if(o instanceof t||null!==(o=function(e,n,r){for(var o=0;o<n.length;++o){r._pushContext();var a=d(n[o])(e);if(r._popContext(),a===l){r._pushContext();var s=t.reject(l.e);return r._popContext(),s}var c=i(a,r);if(c instanceof t)return c}return null}(o,this._yieldHandlers,this._promise))){var a=(o=o._target())._bitField;0==(50397184&a)?(this._yieldedPromise=o,o._proxy(this,null)):0!=(33554432&a)?t._async.invoke(this._promiseFulfilled,this,o._value()):0!=(16777216&a)?t._async.invoke(this._promiseRejected,this,o._reason()):this._promiseCancelled()}else this._promiseRejected(new c("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(r))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))},t.coroutine=function(e,t){if("function"!=typeof e)throw new c("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=Object(t).yieldHandler,r=s,i=(new Error).stack;return function(){var t=e.apply(this,arguments),o=new r(void 0,void 0,n,i),a=o.promise();return o._generator=t,o._promiseFulfilled(void 0),a}},t.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new c("expecting a function but got "+u.classString(e));f.push(e)},t.spawn=function(e){if(a.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof e)return n("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=new s(e,this),i=r.promise();return r._run(t.spawn),i}}},{"./errors":12,"./util":36}],17:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,a){var s=e("./util");s.canEvaluate,s.tryCatch,s.errorObj,t.join=function(){var e,t=arguments.length-1;t>0&&"function"==typeof arguments[t]&&(e=arguments[t]);var r=[].slice.call(arguments);e&&r.pop();var i=new n(r).promise();return void 0!==e?i.spread(e):i}}},{"./util":36}],18:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,a){function s(e,t,n,r){this.constructor$(e),this._promise._captureStackTrace();var i=u();this._callback=null===i?t:l.domainBind(i,t),this._preservedValues=r===o?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=[],p.invoke(this._asyncInit,this,void 0)}function c(e,n,i,o){if("function"!=typeof n)return r("expecting a function but got "+l.classString(n));var a=0;if(void 0!==i){if("object"!=typeof i||null===i)return t.reject(new TypeError("options argument must be an object but it is "+l.classString(i)));if("number"!=typeof i.concurrency)return t.reject(new TypeError("'concurrency' must be a number but it is "+l.classString(i.concurrency)));a=i.concurrency}return new s(e,n,a="number"==typeof a&&isFinite(a)&&a>=1?a:0,o).promise()}var u=t._getDomain,l=e("./util"),d=l.tryCatch,f=l.errorObj,p=t._async;l.inherits(s,n),s.prototype._asyncInit=function(){this._init$(void 0,-2)},s.prototype._init=function(){},s.prototype._promiseFulfilled=function(e,n){var r=this._values,o=this.length(),s=this._preservedValues,c=this._limit;if(n<0){if(r[n=-1*n-1]=e,c>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(c>=1&&this._inFlight>=c)return r[n]=e,this._queue.push(n),!1;null!==s&&(s[n]=e);var u=this._promise,l=this._callback,p=u._boundValue();u._pushContext();var h=d(l).call(p,e,n,o),v=u._popContext();if(a.checkForgottenReturns(h,v,null!==s?"Promise.filter":"Promise.map",u),h===f)return this._reject(h.e),!0;var m=i(h,this._promise);if(m instanceof t){var g=(m=m._target())._bitField;if(0==(50397184&g))return c>=1&&this._inFlight++,r[n]=m,m._proxy(this,-1*(n+1)),!1;if(0==(33554432&g))return 0!=(16777216&g)?(this._reject(m._reason()),!0):(this._cancel(),!0);h=m._value()}r[n]=h}return++this._totalResolved>=o&&(null!==s?this._filter(r,s):this._resolve(r),!0)},s.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,n=this._values;e.length>0&&this._inFlight<t;){if(this._isResolved())return;var r=e.pop();this._promiseFulfilled(n[r],r)}},s.prototype._filter=function(e,t){for(var n=t.length,r=new Array(n),i=0,o=0;o<n;++o)e[o]&&(r[i++]=t[o]);r.length=i,this._resolve(r)},s.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(e,t){return c(this,e,t,null)},t.map=function(e,t,n,r){return c(e,t,n,r)}}},{"./util":36}],19:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o){var a=e("./util"),s=a.tryCatch;t.method=function(e){if("function"!=typeof e)throw new t.TypeError("expecting a function but got "+a.classString(e));return function(){var r=new t(n);r._captureStackTrace(),r._pushContext();var i=s(e).apply(this,arguments),a=r._popContext();return o.checkForgottenReturns(i,a,"Promise.method",r),r._resolveFromSyncValue(i),r}},t.attempt=t.try=function(e){if("function"!=typeof e)return i("expecting a function but got "+a.classString(e));var r,c=new t(n);if(c._captureStackTrace(),c._pushContext(),arguments.length>1){o.deprecated("calling Promise.try with more than 1 argument");var u=arguments[1],l=arguments[2];r=a.isArray(u)?s(e).apply(l,u):s(e).call(l,u)}else r=s(e)();var d=c._popContext();return o.checkForgottenReturns(r,d,"Promise.try",c),c._resolveFromSyncValue(r),c},t.prototype._resolveFromSyncValue=function(e){e===a.errorObj?this._rejectCallback(e.e,!1):this._resolveCallback(e,!0)}}},{"./util":36}],20:[function(e,t,n){"use strict";function r(e){var t;if(function(e){return e instanceof Error&&s.getPrototypeOf(e)===Error.prototype}(e)){(t=new a(e)).name=e.name,t.message=e.message,t.stack=e.stack;for(var n=s.keys(e),r=0;r<n.length;++r){var o=n[r];c.test(o)||(t[o]=e[o])}return t}return i.markAsOriginatingFromRejection(e),e}var i=e("./util"),o=i.maybeWrapAsError,a=e("./errors").OperationalError,s=e("./es5"),c=/^(?:name|message|stack|cause)$/;t.exports=function(e,t){return function(n,i){if(null!==e){if(n){var a=r(o(n));e._attachExtraTrace(a),e._reject(a)}else if(t){var s=[].slice.call(arguments,1);e._fulfill(s)}else e._fulfill(i);e=null}}}},{"./errors":12,"./es5":13,"./util":36}],21:[function(e,t,n){"use strict";t.exports=function(t){function n(e,t){if(!o.isArray(e))return r.call(this,e,t);var n=s(t).apply(this._boundValue(),[null].concat(e));n===c&&a.throwLater(n.e)}function r(e,t){var n=this._boundValue(),r=void 0===e?s(t).call(n,null):s(t).call(n,null,e);r===c&&a.throwLater(r.e)}function i(e,t){if(!e){var n=new Error(e+"");n.cause=e,e=n}var r=s(t).call(this._boundValue(),e);r===c&&a.throwLater(r.e)}var o=e("./util"),a=t._async,s=o.tryCatch,c=o.errorObj;t.prototype.asCallback=t.prototype.nodeify=function(e,t){if("function"==typeof e){var o=r;void 0!==t&&Object(t).spread&&(o=n),this._then(o,i,void 0,this,e)}return this}}},{"./util":36}],22:[function(e,t,r){"use strict";t.exports=function(){function r(){}function i(e){e!==S&&function(e,t){if(null==e||e.constructor!==i)throw new y("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof t)throw new y("expecting a function but got "+p.classString(t))}(this,e),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(e),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function o(e){this.promise._resolveCallback(e)}function a(e){this.promise._rejectCallback(e,!1)}function s(e){var t=new i(S);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}var c,u=function(){return new y("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},l=function(){return new i.PromiseInspection(this._target())},d=function(e){return i.reject(new y(e))},f={},p=e("./util");c=p.isNode?function(){var e=n.domain;return void 0===e&&(e=null),e}:function(){return null},p.notEnumerableProp(i,"_getDomain",c);var h=e("./es5"),v=e("./async"),m=new v;h.defineProperty(i,"_async",{value:m});var g=e("./errors"),y=i.TypeError=g.TypeError;i.RangeError=g.RangeError;var b=i.CancellationError=g.CancellationError;i.TimeoutError=g.TimeoutError,i.OperationalError=g.OperationalError,i.RejectionError=g.OperationalError,i.AggregateError=g.AggregateError;var S=function(){},_={},E={},C=e("./thenables")(i,S),T=e("./promise_array")(i,S,C,d,r),w=e("./context")(i),k=w.create,R=e("./debuggability")(i,w),P=(R.CapturedTrace,e("./finally")(i,C,E)),I=e("./catch_filter")(E),O=e("./nodeback"),A=p.errorObj,M=p.tryCatch;return i.prototype.toString=function(){return"[object Promise]"},i.prototype.caught=i.prototype.catch=function(e){var t=arguments.length;if(t>1){var n,r=new Array(t-1),i=0;for(n=0;n<t-1;++n){var o=arguments[n];if(!p.isObject(o))return d("Catch statement predicate: expecting an object but got "+p.classString(o));r[i++]=o}return r.length=i,e=arguments[n],this.then(void 0,I(r,e,this))}return this.then(void 0,e)},i.prototype.reflect=function(){return this._then(l,l,void 0,this,void 0)},i.prototype.then=function(e,t){if(R.warnings()&&arguments.length>0&&"function"!=typeof e&&"function"!=typeof t){var n=".then() only accepts functions but was passed: "+p.classString(e);arguments.length>1&&(n+=", "+p.classString(t)),this._warn(n)}return this._then(e,t,void 0,void 0,void 0)},i.prototype.done=function(e,t){this._then(e,t,void 0,void 0,void 0)._setIsFinal()},i.prototype.spread=function(e){return"function"!=typeof e?d("expecting a function but got "+p.classString(e)):this.all()._then(e,void 0,void 0,_,void 0)},i.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},i.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new T(this).promise()},i.prototype.error=function(e){return this.caught(p.originatesFromRejection,e)},i.getNewLibraryCopy=t.exports,i.is=function(e){return e instanceof i},i.fromNode=i.fromCallback=function(e){var t=new i(S);t._captureStackTrace();var n=arguments.length>1&&!!Object(arguments[1]).multiArgs,r=M(e)(O(t,n));return r===A&&t._rejectCallback(r.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},i.all=function(e){return new T(e).promise()},i.cast=function(e){var t=C(e);return t instanceof i||((t=new i(S))._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},i.resolve=i.fulfilled=i.cast,i.reject=i.rejected=function(e){var t=new i(S);return t._captureStackTrace(),t._rejectCallback(e,!0),t},i.setScheduler=function(e){if("function"!=typeof e)throw new y("expecting a function but got "+p.classString(e));return m.setScheduler(e)},i.prototype._then=function(e,t,n,r,o){var a=void 0!==o,s=a?o:new i(S),u=this._target(),l=u._bitField;a||(s._propagateFrom(this,3),s._captureStackTrace(),void 0===r&&0!=(2097152&this._bitField)&&(r=0!=(50397184&l)?this._boundValue():u===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,s));var d=c();if(0!=(50397184&l)){var f,h,v=u._settlePromiseCtx;0!=(33554432&l)?(h=u._rejectionHandler0,f=e):0!=(16777216&l)?(h=u._fulfillmentHandler0,f=t,u._unsetRejectionIsUnhandled()):(v=u._settlePromiseLateCancellationObserver,h=new b("late cancellation observer"),u._attachExtraTrace(h),f=t),m.invoke(v,u,{handler:null===d?f:"function"==typeof f&&p.domainBind(d,f),promise:s,receiver:r,value:h})}else u._addCallbacks(e,t,s,r,d);return s},i.prototype._length=function(){return 65535&this._bitField},i.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},i.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},i.prototype._setLength=function(e){this._bitField=-65536&this._bitField|65535&e},i.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},i.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},i.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},i.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},i.prototype._isFinal=function(){return(4194304&this._bitField)>0},i.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},i.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},i.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},i.prototype._setAsyncGuaranteed=function(){m.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},i.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[4*e-4+3];if(t!==f)return void 0===t&&this._isBound()?this._boundValue():t},i.prototype._promiseAt=function(e){return this[4*e-4+2]},i.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4+0]},i.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},i.prototype._boundValue=function(){},i.prototype._migrateCallback0=function(e){var t=(e._bitField,e._fulfillmentHandler0),n=e._rejectionHandler0,r=e._promise0,i=e._receiverAt(0);void 0===i&&(i=f),this._addCallbacks(t,n,r,i,null)},i.prototype._migrateCallbackAt=function(e,t){var n=e._fulfillmentHandlerAt(t),r=e._rejectionHandlerAt(t),i=e._promiseAt(t),o=e._receiverAt(t);void 0===o&&(o=f),this._addCallbacks(n,r,i,o,null)},i.prototype._addCallbacks=function(e,t,n,r,i){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=n,this._receiver0=r,"function"==typeof e&&(this._fulfillmentHandler0=null===i?e:p.domainBind(i,e)),"function"==typeof t&&(this._rejectionHandler0=null===i?t:p.domainBind(i,t));else{var a=4*o-4;this[a+2]=n,this[a+3]=r,"function"==typeof e&&(this[a+0]=null===i?e:p.domainBind(i,e)),"function"==typeof t&&(this[a+1]=null===i?t:p.domainBind(i,t))}return this._setLength(o+1),o},i.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},i.prototype._resolveCallback=function(e,t){if(0==(117506048&this._bitField)){if(e===this)return this._rejectCallback(u(),!1);var n=C(e,this);if(!(n instanceof i))return this._fulfill(e);t&&this._propagateFrom(n,2);var r=n._target();if(r===this)return void this._reject(u());var o=r._bitField;if(0==(50397184&o)){var a=this._length();a>0&&r._migrateCallback0(this);for(var s=1;s<a;++s)r._migrateCallbackAt(this,s);this._setFollowing(),this._setLength(0),this._setFollowee(r)}else if(0!=(33554432&o))this._fulfill(r._value());else if(0!=(16777216&o))this._reject(r._reason());else{var c=new b("late cancellation observer");r._attachExtraTrace(c),this._reject(c)}}},i.prototype._rejectCallback=function(e,t,n){var r=p.ensureErrorObject(e),i=r===e;if(!i&&!n&&R.warnings()){var o="a promise was rejected with a non-error: "+p.classString(e);this._warn(o,!0)}this._attachExtraTrace(r,!!t&&i),this._reject(e)},i.prototype._resolveFromExecutor=function(e){if(e!==S){var t=this;this._captureStackTrace(),this._pushContext();var n=!0,r=this._execute(e,function(e){t._resolveCallback(e)},function(e){t._rejectCallback(e,n)});n=!1,this._popContext(),void 0!==r&&t._rejectCallback(r,!0)}},i.prototype._settlePromiseFromHandler=function(e,t,n,r){var i=r._bitField;if(0==(65536&i)){var o;r._pushContext(),t===_?n&&"number"==typeof n.length?o=M(e).apply(this._boundValue(),n):(o=A).e=new y("cannot .spread() a non-array: "+p.classString(n)):o=M(e).call(t,n);var a=r._popContext();0==(65536&(i=r._bitField))&&(o===E?r._reject(n):o===A?r._rejectCallback(o.e,!1):(R.checkForgottenReturns(o,a,"",r,this),r._resolveCallback(o)))}},i.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},i.prototype._followee=function(){return this._rejectionHandler0},i.prototype._setFollowee=function(e){this._rejectionHandler0=e},i.prototype._settlePromise=function(e,t,n,o){var a=e instanceof i,s=this._bitField,c=0!=(134217728&s);0!=(65536&s)?(a&&e._invokeInternalOnCancel(),n instanceof P&&n.isFinallyHandler()?(n.cancelPromise=e,M(t).call(n,o)===A&&e._reject(A.e)):t===l?e._fulfill(l.call(n)):n instanceof r?n._promiseCancelled(e):a||e instanceof T?e._cancel():n.cancel()):"function"==typeof t?a?(c&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(t,n,o,e)):t.call(n,o,e):n instanceof r?n._isResolved()||(0!=(33554432&s)?n._promiseFulfilled(o,e):n._promiseRejected(o,e)):a&&(c&&e._setAsyncGuaranteed(),0!=(33554432&s)?e._fulfill(o):e._reject(o))},i.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,n=e.promise,r=e.receiver,o=e.value;"function"==typeof t?n instanceof i?this._settlePromiseFromHandler(t,r,o,n):t.call(r,o,n):n instanceof i&&n._reject(o)},i.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},i.prototype._settlePromise0=function(e,t,n){var r=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(r,e,i,t)},i.prototype._clearCallbackDataAtIndex=function(e){var t=4*e-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},i.prototype._fulfill=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(e===this){var n=u();return this._attachExtraTrace(n),this._reject(n)}this._setFulfilled(),this._rejectionHandler0=e,(65535&t)>0&&(0!=(134217728&t)?this._settlePromises():m.settlePromises(this))}},i.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=e,this._isFinal())return m.fatalError(e,p.isNode);(65535&t)>0?m.settlePromises(this):this._ensurePossibleRejectionHandled()}},i.prototype._fulfillPromises=function(e,t){for(var n=1;n<e;n++){var r=this._fulfillmentHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},i.prototype._rejectPromises=function(e,t){for(var n=1;n<e;n++){var r=this._rejectionHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},i.prototype._settlePromises=function(){var e=this._bitField,t=65535&e;if(t>0){if(0!=(16842752&e)){var n=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,n,e),this._rejectPromises(t,n)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,e),this._fulfillPromises(t,r)}this._setLength(0)}this._clearCancellationData()},i.prototype._settledValue=function(){var e=this._bitField;return 0!=(33554432&e)?this._rejectionHandler0:0!=(16777216&e)?this._fulfillmentHandler0:void 0},i.defer=i.pending=function(){return R.deprecated("Promise.defer","new Promise"),{promise:new i(S),resolve:o,reject:a}},p.notEnumerableProp(i,"_makeSelfResolutionError",u),e("./method")(i,S,C,d,R),e("./bind")(i,S,C,R),e("./cancel")(i,T,d,R),e("./direct_resolve")(i),e("./synchronous_inspection")(i),e("./join")(i,T,C,S,m,c),i.Promise=i,i.version="3.5.1",e("./map.js")(i,T,d,C,S,R),e("./call_get.js")(i),e("./using.js")(i,d,C,k,S,R),e("./timers.js")(i,S,R),e("./generators.js")(i,d,S,C,r,R),e("./nodeify.js")(i),e("./promisify.js")(i,S),e("./props.js")(i,T,C,d),e("./race.js")(i,S,C,d),e("./reduce.js")(i,T,d,C,S,R),e("./settle.js")(i,T,R),e("./some.js")(i,T,d),e("./filter.js")(i,S),e("./each.js")(i,S),e("./any.js")(i),p.toFastProperties(i),p.toFastProperties(i.prototype),s({a:1}),s({b:2}),s({c:3}),s(1),s(function(){}),s(void 0),s(!1),s(new i(S)),R.setBounds(v.firstLineError,p.lastLineError),i}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o){function a(e){var r=this._promise=new t(n);e instanceof t&&r._propagateFrom(e,3),r._setOnCancel(this),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var s=e("./util");return s.isArray,s.inherits(a,o),a.prototype.length=function(){return this._length},a.prototype.promise=function(){return this._promise},a.prototype._init=function e(n,o){var a=r(this._values,this._promise);if(a instanceof t){var c=(a=a._target())._bitField;if(this._values=a,0==(50397184&c))return this._promise._setAsyncGuaranteed(),a._then(e,this._reject,void 0,this,o);if(0==(33554432&c))return 0!=(16777216&c)?this._reject(a._reason()):this._cancel();a=a._value()}if(null!==(a=s.asArray(a)))0!==a.length?this._iterate(a):-5===o?this._resolveEmptyArray():this._resolve(function(e){switch(e){case-2:return[];case-3:return{};case-6:return new Map}}(o));else{var u=i("expecting an array or an iterable object but got "+s.classString(a)).reason();this._promise._rejectCallback(u,!1)}},a.prototype._iterate=function(e){var n=this.getActualLength(e.length);this._length=n,this._values=this.shouldCopyValues()?new Array(n):this._values;for(var i=this._promise,o=!1,a=null,s=0;s<n;++s){var c=r(e[s],i);c instanceof t?a=(c=c._target())._bitField:a=null,o?null!==a&&c.suppressUnhandledRejections():null!==a?0==(50397184&a)?(c._proxy(this,s),this._values[s]=c):o=0!=(33554432&a)?this._promiseFulfilled(c._value(),s):0!=(16777216&a)?this._promiseRejected(c._reason(),s):this._promiseCancelled(s):o=this._promiseFulfilled(c,s)}o||i._setAsyncGuaranteed()},a.prototype._isResolved=function(){return null===this._values},a.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},a.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},a.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},a.prototype._promiseFulfilled=function(e,t){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},a.prototype._promiseCancelled=function(){return this._cancel(),!0},a.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},a.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof t)e.cancel();else for(var n=0;n<e.length;++n)e[n]instanceof t&&e[n].cancel()}},a.prototype.shouldCopyValues=function(){return!0},a.prototype.getActualLength=function(e){return e},a}},{"./util":36}],24:[function(e,t,n){"use strict";t.exports=function(t,n){function r(e){return!m.test(e)}function i(e){try{return!0===e.__isPromisified__}catch(e){return!1}}function o(e,t,n){var r=u.getDataPropertyOrDefault(e,t+n,v);return!!r&&i(r)}function a(e,t,n,r){for(var a=u.inheritedDataKeys(e),s=[],c=0;c<a.length;++c){var l=a[c],d=e[l],f=r===g||g(l,d,e);"function"!=typeof d||i(d)||o(e,l,t)||!r(l,d,e,f)||s.push(l,d)}return function(e,t,n){for(var r=0;r<e.length;r+=2){var i=e[r];if(n.test(i))for(var o=i.replace(n,""),a=0;a<e.length;a+=2)if(e[a]===o)throw new h("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",t))}}(s,t,n),s}function s(e,t,n,r,i){for(var o=new RegExp(y(t)+"$"),s=a(e,t,o,n),l=0,d=s.length;l<d;l+=2){var f=s[l],p=s[l+1],h=f+t;if(r===b)e[h]=b(f,c,f,p,t,i);else{var v=r(p,function(){return b(f,c,f,p,t,i)});u.notEnumerableProp(v,"__isPromisified__",!0),e[h]=v}}return u.toFastProperties(e),e}var c={},u=e("./util"),l=e("./nodeback"),d=u.withAppended,f=u.maybeWrapAsError,p=u.canEvaluate,h=e("./errors").TypeError,v={__isPromisified__:!0},m=new RegExp("^(?:"+["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"].join("|")+")$"),g=function(e){return u.isIdentifier(e)&&"_"!==e.charAt(0)&&"constructor"!==e},y=function(e){return e.replace(/([$])/,"\\$")},b=p?void 0:function(e,r,i,o,a,s){function p(){var i=r;r===c&&(i=this);var o=new t(n);o._captureStackTrace();var a="string"==typeof v&&this!==h?this[v]:e,u=l(o,s);try{a.apply(i,d(arguments,u))}catch(e){o._rejectCallback(f(e),!0,!0)}return o._isFateSealed()||o._setAsyncGuaranteed(),o}var h=function(){return this}(),v=e;return"string"==typeof v&&(e=o),u.notEnumerableProp(p,"__isPromisified__",!0),p};t.promisify=function(e,t){if("function"!=typeof e)throw new h("expecting a function but got "+u.classString(e));if(i(e))return e;var n=function(e,t,n){return b(e,t,void 0,e,null,n)}(e,void 0===(t=Object(t)).context?c:t.context,!!t.multiArgs);return u.copyDescriptors(e,n,r),n},t.promisifyAll=function(e,t){if("function"!=typeof e&&"object"!=typeof e)throw new h("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var n=!!(t=Object(t)).multiArgs,r=t.suffix;"string"!=typeof r&&(r="Async");var i=t.filter;"function"!=typeof i&&(i=g);var o=t.promisifier;if("function"!=typeof o&&(o=b),!u.isIdentifier(r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var a=u.inheritedDataKeys(e),c=0;c<a.length;++c){var l=e[a[c]];"constructor"!==a[c]&&u.isClass(l)&&(s(l.prototype,r,i,o,n),s(l,r,i,o,n))}return s(e,r,i,o,n)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(e,t,n){"use strict";t.exports=function(t,n,r,i){function o(e){var t,n=!1;if(void 0!==s&&e instanceof s)t=d(e),n=!0;else{var r=l.keys(e),i=r.length;t=new Array(2*i);for(var o=0;o<i;++o){var a=r[o];t[o]=e[a],t[o+i]=a}}this.constructor$(t),this._isMap=n,this._init$(void 0,n?-6:-3)}function a(e){var n,a=r(e);return u(a)?(n=a instanceof t?a._then(t.props,void 0,void 0,void 0,void 0):new o(a).promise(),a instanceof t&&n._propagateFrom(a,2),n):i("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var s,c=e("./util"),u=c.isObject,l=e("./es5");"function"==typeof Map&&(s=Map);var d=function(){function e(e,r){this[t]=e,this[t+n]=r,t++}var t=0,n=0;return function(r){n=r.size,t=0;var i=new Array(2*r.size);return r.forEach(e,i),i}}();c.inherits(o,n),o.prototype._init=function(){},o.prototype._promiseFulfilled=function(e,t){if(this._values[t]=e,++this._totalResolved>=this._length){var n;if(this._isMap)n=function(e){for(var t=new s,n=e.length/2|0,r=0;r<n;++r){var i=e[n+r],o=e[r];t.set(i,o)}return t}(this._values);else{n={};for(var r=this.length(),i=0,o=this.length();i<o;++i)n[this._values[i+r]]=this._values[i]}return this._resolve(n),!0}return!1},o.prototype.shouldCopyValues=function(){return!1},o.prototype.getActualLength=function(e){return e>>1},t.prototype.props=function(){return a(this)},t.props=function(e){return a(e)}}},{"./es5":13,"./util":36}],26:[function(e,t,n){"use strict";function r(e){this._capacity=e,this._length=0,this._front=0}r.prototype._willBeOverCapacity=function(e){return this._capacity<e},r.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1),this[this._front+t&this._capacity-1]=e,this._length=t+1},r.prototype.push=function(e,t,n){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(e),this._pushOne(t),void this._pushOne(n);var i=this._front+r-3;this._checkCapacity(r);var o=this._capacity-1;this[i+0&o]=e,this[i+1&o]=t,this[i+2&o]=n,this._length=r},r.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},r.prototype.length=function(){return this._length},r.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},r.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e,function(e,t,n,r,i){for(var o=0;o<i;++o)n[o+r]=e[o+t],e[o+t]=void 0}(this,0,this,t,this._front+this._length&t-1)},t.exports=r},{}],27:[function(e,t,n){"use strict";t.exports=function(t,n,r,i){function o(e,o){var c=r(e);if(c instanceof t)return s(c);if(null===(e=a.asArray(e)))return i("expecting an array or an iterable object but got "+a.classString(e));var u=new t(n);void 0!==o&&u._propagateFrom(o,3);for(var l=u._fulfill,d=u._reject,f=0,p=e.length;f<p;++f){var h=e[f];(void 0!==h||f in e)&&t.cast(h)._then(l,d,void 0,u,null)}return u}var a=e("./util"),s=function(e){return e.then(function(t){return o(t,e)})};t.race=function(e){return o(e,void 0)},t.prototype.race=function(){return o(this,void 0)}}},{"./util":36}],28:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,a){function s(e,n,r,i){this.constructor$(e);var a=f();this._fn=null===a?n:p.domainBind(a,n),void 0!==r&&(r=t.resolve(r))._attachCancellationCallback(this),this._initialValue=r,this._currentCancellable=null,this._eachValues=i===o?Array(this._length):0===i?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function c(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function u(e,t,n,i){return"function"!=typeof t?r("expecting a function but got "+p.classString(t)):new s(e,t,n,i).promise()}function l(e){this.accum=e,this.array._gotAccum(e);var n=i(this.value,this.array._promise);return n instanceof t?(this.array._currentCancellable=n,n._then(d,void 0,void 0,this,void 0)):d.call(this,n)}function d(e){var n,r=this.array,i=r._promise,o=h(r._fn);i._pushContext(),(n=void 0!==r._eachValues?o.call(i._boundValue(),e,this.index,this.length):o.call(i._boundValue(),this.accum,e,this.index,this.length))instanceof t&&(r._currentCancellable=n);var s=i._popContext();return a.checkForgottenReturns(n,s,void 0!==r._eachValues?"Promise.each":"Promise.reduce",i),n}var f=t._getDomain,p=e("./util"),h=p.tryCatch;p.inherits(s,n),s.prototype._gotAccum=function(e){void 0!==this._eachValues&&null!==this._eachValues&&e!==o&&this._eachValues.push(e)},s.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},s.prototype._init=function(){},s.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},s.prototype.shouldCopyValues=function(){return!1},s.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},s.prototype._resultCancelled=function(e){if(e===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel())},s.prototype._iterate=function(e){this._values=e;var n,r,i=e.length;if(void 0!==this._initialValue?(n=this._initialValue,r=0):(n=t.resolve(e[0]),r=1),this._currentCancellable=n,!n.isRejected())for(;r<i;++r){var o={accum:null,value:e[r],index:r,length:i,array:this};n=n._then(l,void 0,void 0,o,void 0)}void 0!==this._eachValues&&(n=n._then(this._eachComplete,void 0,void 0,this,void 0)),n._then(c,c,void 0,n,this)},t.prototype.reduce=function(e,t){return u(this,e,t,null)},t.reduce=function(e,t,n,r){return u(e,t,n,r)}}},{"./util":36}],29:[function(e,t,i){"use strict";var o,a=e("./util"),s=a.getNativePromise();if(a.isNode&&"undefined"==typeof MutationObserver){var c=r.setImmediate,l=n.nextTick;o=a.isRecentNode?function(e){c.call(r,e)}:function(e){l.call(n,e)}}else if("function"==typeof s&&"function"==typeof s.resolve){var d=s.resolve();o=function(e){d.then(e)}}else o="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?void 0!==u?function(e){u(e)}:"undefined"!=typeof setTimeout?function(e){setTimeout(e,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}:function(){var e=document.createElement("div"),t={attributes:!0},n=!1,r=document.createElement("div");new MutationObserver(function(){e.classList.toggle("foo"),n=!1}).observe(r,t);var i=function(){n||(n=!0,r.classList.toggle("foo"))};return function(n){var r=new MutationObserver(function(){r.disconnect(),n()});r.observe(e,t),i()}}();t.exports=o},{"./util":36}],30:[function(e,t,n){"use strict";t.exports=function(t,n,r){function i(e){this.constructor$(e)}var o=t.PromiseInspection;e("./util").inherits(i,n),i.prototype._promiseResolved=function(e,t){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},i.prototype._promiseFulfilled=function(e,t){var n=new o;return n._bitField=33554432,n._settledValueField=e,this._promiseResolved(t,n)},i.prototype._promiseRejected=function(e,t){var n=new o;return n._bitField=16777216,n._settledValueField=e,this._promiseResolved(t,n)},t.settle=function(e){return r.deprecated(".settle()",".reflect()"),new i(e).promise()},t.prototype.settle=function(){return t.settle(this)}}},{"./util":36}],31:[function(e,t,n){"use strict";t.exports=function(t,n,r){function i(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function o(e,t){if((0|t)!==t||t<0)return r("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var n=new i(e),o=n.promise();return n.setHowMany(t),n.init(),o}var a=e("./util"),s=e("./errors").RangeError,c=e("./errors").AggregateError,u=a.isArray,l={};a.inherits(i,n),i.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var e=u(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},i.prototype.init=function(){this._initialized=!0,this._init()},i.prototype.setUnwrap=function(){this._unwrap=!0},i.prototype.howMany=function(){return this._howMany},i.prototype.setHowMany=function(e){this._howMany=e},i.prototype._promiseFulfilled=function(e){return this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},i.prototype._promiseRejected=function(e){return this._addRejected(e),this._checkOutcome()},i.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(l),this._checkOutcome())},i.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var e=new c,t=this.length();t<this._values.length;++t)this._values[t]!==l&&e.push(this._values[t]);return e.length>0?this._reject(e):this._cancel(),!0}return!1},i.prototype._fulfilled=function(){return this._totalResolved},i.prototype._rejected=function(){return this._values.length-this.length()},i.prototype._addRejected=function(e){this._values.push(e)},i.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},i.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},i.prototype._getRangeError=function(e){var t="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";return new s(t)},i.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(e,t){return o(e,t)},t.prototype.some=function(e){return o(this,e)},t._SomePromiseArray=i}},{"./errors":12,"./util":36}],32:[function(e,t,n){"use strict";t.exports=function(e){function t(e){void 0!==e?(e=e._target(),this._bitField=e._bitField,this._settledValueField=e._isFateSealed()?e._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}t.prototype._settledValue=function(){return this._settledValueField};var n=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=t.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},o=t.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},a=t.prototype.isPending=function(){return 0==(50397184&this._bitField)},s=t.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};t.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},e.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},e.prototype._isCancelled=function(){return this._target().__isCancelled()},e.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},e.prototype.isPending=function(){return a.call(this._target())},e.prototype.isRejected=function(){return o.call(this._target())},e.prototype.isFulfilled=function(){return i.call(this._target())},e.prototype.isResolved=function(){return s.call(this._target())},e.prototype.value=function(){return n.call(this._target())},e.prototype.reason=function(){var e=this._target();return e._unsetRejectionIsUnhandled(),r.call(e)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t}},{}],33:[function(e,t,n){"use strict";t.exports=function(t,n){function r(e,r,a){var s=new t(n),c=s;a&&a._pushContext(),s._captureStackTrace(),a&&a._popContext();var u=!0,l=i.tryCatch(r).call(e,function(e){s&&(s._resolveCallback(e),s=null)},function(e){s&&(s._rejectCallback(e,u,!0),s=null)});return u=!1,s&&l===o&&(s._rejectCallback(l.e,!0,!0),s=null),c}var i=e("./util"),o=i.errorObj,a=i.isObject,s={}.hasOwnProperty;return function(e,i){if(a(e)){if(e instanceof t)return e;var c=function(e){try{return function(e){return e.then}(e)}catch(e){return o.e=e,o}}(e);if(c===o){i&&i._pushContext();var u=t.reject(c.e);return i&&i._popContext(),u}if("function"==typeof c)return function(e){try{return s.call(e,"_promise0")}catch(e){return!1}}(e)?(u=new t(n),e._then(u._fulfill,u._reject,void 0,u,null),u):r(e,c,i)}return e}}},{"./util":36}],34:[function(e,t,n){"use strict";t.exports=function(t,n,r){function i(e){this.handle=e}function o(e){return clearTimeout(this.handle),e}function a(e){throw clearTimeout(this.handle),e}var s=e("./util"),c=t.TimeoutError;i.prototype._resultCancelled=function(){clearTimeout(this.handle)};var u=function(e){return l(+this).thenReturn(e)},l=t.delay=function(e,o){var a,s;return void 0!==o?(a=t.resolve(o)._then(u,null,null,e,void 0),r.cancellation()&&o instanceof t&&a._setOnCancel(o)):(a=new t(n),s=setTimeout(function(){a._fulfill()},+e),r.cancellation()&&a._setOnCancel(new i(s)),a._captureStackTrace()),a._setAsyncGuaranteed(),a};t.prototype.delay=function(e){return l(e,this)};var d=function(e,t,n){var r;r="string"!=typeof t?t instanceof Error?t:new c("operation timed out"):new c(t),s.markAsOriginatingFromRejection(r),e._attachExtraTrace(r),e._reject(r),null!=n&&n.cancel()};t.prototype.timeout=function(e,t){e=+e;var n,s,c=new i(setTimeout(function(){n.isPending()&&d(n,t,s)},e));return r.cancellation()?(s=this.then(),(n=s._then(o,a,void 0,c,void 0))._setOnCancel(c)):n=this._then(o,a,void 0,c,void 0),n}}},{"./util":36}],35:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,a){function s(e){setTimeout(function(){throw e},0)}function c(e,n){var i=0,a=e.length,c=new t(o);return function o(){if(i>=a)return c._fulfill();var u=function(e){var t=r(e);return t!==e&&"function"==typeof e._isDisposable&&"function"==typeof e._getDisposer&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}(e[i++]);if(u instanceof t&&u._isDisposable()){try{u=r(u._getDisposer().tryDispose(n),e.promise)}catch(e){return s(e)}if(u instanceof t)return u._then(o,s,null,null,null)}o()}(),c}function u(e,t,n){this._data=e,this._promise=t,this._context=n}function l(e,t,n){this.constructor$(e,t,n)}function d(e){return u.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}function f(e){this.length=e,this.promise=null,this[e-1]=null}var p=e("./util"),h=e("./errors").TypeError,v=e("./util").inherits,m=p.errorObj,g=p.tryCatch,y={};u.prototype.data=function(){return this._data},u.prototype.promise=function(){return this._promise},u.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():y},u.prototype.tryDispose=function(e){var t=this.resource(),n=this._context;void 0!==n&&n._pushContext();var r=t!==y?this.doDispose(t,e):null;return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,r},u.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},v(l,u),l.prototype.doDispose=function(e,t){return this.data().call(e,e,t)},f.prototype._resultCancelled=function(){for(var e=this.length,n=0;n<e;++n){var r=this[n];r instanceof t&&r.cancel()}},t.using=function(){var e=arguments.length;if(e<2)return n("you must pass at least 2 arguments to Promise.using");var i=arguments[e-1];if("function"!=typeof i)return n("expecting a function but got "+p.classString(i));var o,s=!0;2===e&&Array.isArray(arguments[0])?(e=(o=arguments[0]).length,s=!1):(o=arguments,e--);for(var l=new f(e),h=0;h<e;++h){var v=o[h];if(u.isDisposer(v)){var y=v;(v=v.promise())._setDisposable(y)}else{var b=r(v);b instanceof t&&(v=b._then(d,null,null,{resources:l,index:h},void 0))}l[h]=v}var S=new Array(l.length);for(h=0;h<S.length;++h)S[h]=t.resolve(l[h]).reflect();var _=t.all(S).then(function(e){for(var t=0;t<e.length;++t){var n=e[t];if(n.isRejected())return m.e=n.error(),m;if(!n.isFulfilled())return void _.cancel();e[t]=n.value()}E._pushContext(),i=g(i);var r=s?i.apply(void 0,e):i(e),o=E._popContext();return a.checkForgottenReturns(r,o,"Promise.using",E),r}),E=_.lastly(function(){var e=new t.PromiseInspection(_);return c(l,e)});return l.promise=E,E._setOnCancel(l),E},t.prototype._setDisposable=function(e){this._bitField=131072|this._bitField,this._disposer=e},t.prototype._isDisposable=function(){return(131072&this._bitField)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},t.prototype.disposer=function(e){if("function"==typeof e)return new l(e,this,i());throw new h}}},{"./errors":12,"./util":36}],36:[function(e,t,i){"use strict";function o(){try{var e=f;return f=null,e.apply(this,arguments)}catch(e){return v.e=e,v}}function a(e){return null==e||!0===e||!1===e||"string"==typeof e||"number"==typeof e}function s(e,t,n){if(a(e))return e;var r={value:n,configurable:!0,enumerable:!1,writable:!0};return p.defineProperty(e,t,r),e}function c(e){try{return e+""}catch(e){return"[no string representation]"}}function u(e){return e instanceof Error||null!==e&&"object"==typeof e&&"string"==typeof e.message&&"string"==typeof e.name}function l(e){return u(e)&&p.propertyIsWritable(e,"stack")}function d(e){return{}.toString.call(e)}var f,p=e("./es5"),h="undefined"==typeof navigator,v={e:{}},m="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==r?r:void 0!==this?this:null,g=function(){var e=[Array.prototype,Object.prototype,Function.prototype],t=function(t){for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1};if(p.isES5){var n=Object.getOwnPropertyNames;return function(e){for(var r=[],i=Object.create(null);null!=e&&!t(e);){var o;try{o=n(e)}catch(e){return r}for(var a=0;a<o.length;++a){var s=o[a];if(!i[s]){i[s]=!0;var c=Object.getOwnPropertyDescriptor(e,s);null!=c&&null==c.get&&null==c.set&&r.push(s)}}e=p.getPrototypeOf(e)}return r}}var r={}.hasOwnProperty;return function(n){if(t(n))return[];var i=[];e:for(var o in n)if(r.call(n,o))i.push(o);else{for(var a=0;a<e.length;++a)if(r.call(e[a],o))continue e;i.push(o)}return i}}(),y=/this\s*\.\s*\S+\s*=/,b=/^[a-z$_][a-z$_0-9]*$/i,S="stack"in new Error?function(e){return l(e)?e:new Error(c(e))}:function(e){if(l(e))return e;try{throw new Error(c(e))}catch(e){return e}},_=function(e){return p.isArray(e)?e:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var E="function"==typeof Array.from?function(e){return Array.from(e)}:function(e){for(var t,n=[],r=e[Symbol.iterator]();!(t=r.next()).done;)n.push(t.value);return n};_=function(e){return p.isArray(e)?e:null!=e&&"function"==typeof e[Symbol.iterator]?E(e):null}}var C=void 0!==n&&"[object process]"===d(n).toLowerCase(),T=void 0!==n&&void 0!==n.env,w={isClass:function(e){try{if("function"==typeof e){var t=p.names(e.prototype),n=p.isES5&&t.length>1,r=t.length>0&&!(1===t.length&&"constructor"===t[0]),i=y.test(e+"")&&p.names(e).length>0;if(n||r||i)return!0}return!1}catch(e){return!1}},isIdentifier:function(e){return b.test(e)},inheritedDataKeys:g,getDataPropertyOrDefault:function(e,t,n){if(!p.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var r=Object.getOwnPropertyDescriptor(e,t);return null!=r?null==r.get&&null==r.set?r.value:n:void 0},thrower:function(e){throw e},isArray:p.isArray,asArray:_,notEnumerableProp:s,isPrimitive:a,isObject:function(e){return"function"==typeof e||"object"==typeof e&&null!==e},isError:u,canEvaluate:h,errorObj:v,tryCatch:function(e){return f=e,o},inherits:function(e,t){function n(){for(var n in this.constructor=e,this.constructor$=t,t.prototype)r.call(t.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=t.prototype[n])}var r={}.hasOwnProperty;return n.prototype=t.prototype,e.prototype=new n,e.prototype},withAppended:function(e,t){var n,r=e.length,i=new Array(r+1);for(n=0;n<r;++n)i[n]=e[n];return i[n]=t,i},maybeWrapAsError:function(e){return a(e)?new Error(c(e)):e},toFastProperties:function(e){function t(){}t.prototype=e;for(var n=8;n--;)new t;return e},filledRange:function(e,t,n){for(var r=new Array(e),i=0;i<e;++i)r[i]=t+i+n;return r},toString:c,canAttachTrace:l,ensureErrorObject:S,originatesFromRejection:function(e){return null!=e&&(e instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===e.isOperational)},markAsOriginatingFromRejection:function(e){try{s(e,"isOperational",!0)}catch(e){}},classString:d,copyDescriptors:function(e,t,n){for(var r=p.names(e),i=0;i<r.length;++i){var o=r[i];if(n(o))try{p.defineProperty(t,o,p.getDescriptor(e,o))}catch(e){}}},hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:C,hasEnvVariables:T,env:function(e){return T?n.env[e]:void 0},global:m,getNativePromise:function(){if("function"==typeof Promise)try{var e=new Promise(function(){});if("[object Promise]"==={}.toString.call(e))return Promise}catch(e){}},domainBind:function(e,t){return e.bind(t)}};w.isRecentNode=w.isNode&&function(){var e=n.versions.node.split(".").map(Number);return 0===e[0]&&e[1]>10||e[0]>0}(),w.isNode&&w.toFastProperties(n);try{throw new Error}catch(e){w.lastLineError=e}t.exports=w},{"./es5":13}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(this,r("_process"),void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},r("timers").setImmediate)},{_process:15,timers:16}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PreCallTest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./turnConnection"),o=e("./tests/rttTest"),a=e("./tests/throughputTest"),s=e("./utility/resultsHandler"),c=e("./utility/onlineCheck"),u=e("./utility/stats/detectbrowser"),l=e("bluebird"),d={RTT:"rtt",THROUGHPUT:"throughput"},f=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.browserInfo=(0,u.detect)(),this.onlineCheck=new c.OnlineCheck,this.callsInProgress=0,this.turnTests=[d.RTT,d.THROUGHPUT],this.active=!1,this.rtt=null,this.resultsHandler=null}return r(e,[{key:"start",value:function(e,t,n){if(this.browserInfo.browserName!==u.Constants.browserName.msie)if(this.iceServers=e,this.callback=n,this.active)this.callback&&this.callback(null,"Not started: already in progress");else if(0<this.callsInProgress)this.callback&&this.callback(null,"Not started: call in progress");else if(e){this.turnTestCounter=0,this.resultsHandler=new s.ResultsHandler,this.resultsHandler.setProvider(t);var r={type:"browser",os:this.browserInfo.os,osVersion:this.browserInfo.osVersion,buildName:this.browserInfo.browserName,buildVersion:this.browserInfo.browserVersion};this.resultsHandler.add("endpointInfo",r),this.onlineCheck.start(),this.active=!0,this._start()}else this.callback&&this.callback(null,"Not started: no ICE servers given");else this.callback&&this.callback(null,"Not started: disabled for IE")}},{key:"_start",value:function(){var e=this;this.active&&(this.turnConnection=new i.TurnConnection(this.browserInfo),this.turnConnection.connect(this.iceServers).then(function(){e.active?(e.resultsHandler&&e.resultsHandler.setStatusSuccess(),e.startTurnTests().then(function(){e.stop()},function(t){e.stop()})):e.stop()},function(t){var n=t.continueFlag;if(e.resultsHandler.failure(t),!n){e.turnConnection.disconnect(),e.active=!1;var r="";try{r=t.stack}catch(n){r=t.toString()}return r&&""!==r||(r=t.toString()),e.resultsHandler&&e.resultsHandler.setStatusFailed(),void e.callback(null,r)}e.resultsHandler.setStatusFailed(),e.resultsHandler.getFailureNumber()>=10?e.stop():(e.turnConnection.disconnect(),setTimeout(function(){e._start()},0))}))}},{key:"stop",value:function(){var e=this;if(this.browserInfo.browserName!==u.Constants.browserName.msie&&this.active){this.active=!1,this.activeTurnTest&&this.activeTurnTest.forceStop();var t=this.onlineCheck.stop();this.resultsHandler&&this.resultsHandler.add("onlineStatus",t),this.turnConnection.getIceResults().then(function(t){e.resultsHandler&&e.resultsHandler.add("ice",t),e.turnConnection.disconnect(),e.sendResults()},function(t){e.resultsHandler&&e.resultsHandler.failure(t),e.turnConnection.disconnect(),e.sendResults()})}}},{key:"sendResults",value:function(){if(this.resultsHandler){var e=this.resultsHandler.getResults();this.resultsHandler=null,this.callback&&this.callback(e,null)}else this.callback&&this.callback(null,"No results present")}},{key:"callStarts",value:function(){this.callsInProgress+=1,this.resultsHandler&&this.resultsHandler.setStatusStopped(),this.stop()}},{key:"callFinished",value:function(){this.callsInProgress-=1}},{key:"getId",value:function(){return this.resultsHandler?this.resultsHandler.getId():null}},{key:"crashDisconnect",value:function(){try{this.turnConnection.disconnect()}catch(e){}}},{key:"startTurnTests",value:function(){var e=this;if(this.turnTestCounter>=this.turnTests.length)return new l(function(e,t){e()});var t=this.turnTests[this.turnTestCounter],n=null;switch(t){case d.RTT:n=new o.RttTest(this.turnConnection);break;case d.THROUGHPUT:n=new a.ThroughputTest(this.turnConnection,this.rtt);break;default:return new l(function(e,n){n(new Error("Unknown test: "+t))})}return this.activeTurnTest=n,this.active?n.start().then(function(){return e.handleTestResults(t,n.getResults()),e.turnTestCounter+=1,e.activeTurnTest=null,e.startTurnTests()},function(r){return e.handleTestResults(t,n.getResults(),r),e.turnTestCounter+=1,e.activeTurnTest=null,e.startTurnTests()}):new l(function(e,t){t(new Error("Test trying to start while testing is not active"))})}},{key:"handleTestResults",value:function(e,t){null==(2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)&&e==d.RTT&&(this.rtt=t.median),this.resultsHandler&&this.resultsHandler.add(e,t)}}]),e}();n.PreCallTest=f},{"./tests/rttTest":3,"./tests/throughputTest":4,"./turnConnection":6,"./utility/onlineCheck":8,"./utility/resultsHandler":10,"./utility/stats/detectbrowser":11,bluebird:1}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.RttTest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/timestamps")),o=e("./turnTest"),a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.sendTimer=null,n.countSent=0,n.rtts=[],n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.TurnTest),r(t,[{key:"initiate",value:function(){this.results.startTimestamp=i.getCurrent(),this.sendPing()}},{key:"handleMessage",value:function(e){if(this.isActive()){var t=parseInt(e,10),n=this.calculateRtt(t);this.rtts.push(n),this.countSent<10?this.sendPing():this.calculateMetrics()}}},{key:"handleError",value:function(e){this.fillResults(),this.failed(e)}},{key:"sendPing",value:function(){if(this.isActive()){var e=i.getCurrent();this.send(e.toString()),this.countSent+=1,this.sendTimer&&(clearTimeout(this.sendTimer),this.sendTimer=null),this.countSent<10?this.sendTimer=setTimeout(this.sendPing.bind(this),100):this.sendTimer=setTimeout(this.calculateMetrics.bind(this),500)}}},{key:"calculateRtt",value:function(e){return i.getCurrent()-e}},{key:"calculateMetrics",value:function(){this.sendTimer&&(clearTimeout(this.sendTimer),this.sendTimer=null),this.fillResults(),this.finished()}},{key:"fillResults",value:function(){this.results.sentMessages=this.countSent,this.results.unAckedMessages=this.countSent-this.rtts.length,this.results.maxMessages=10,this.results.forceStopped=this.forceStopped,this.results.median=this.median(),this.results.average=this.average(),this.results.variance=this.variance(),this.results.endTimestamp=i.getCurrent()}},{key:"median",value:function(){if(0==this.rtts.length)return null;this.rtts.sort();var e=Math.floor(this.rtts.length/2);return this.rtts[e]}},{key:"average",value:function(){if(0==this.rtts.length)return null;for(var e=0,t=0;t<this.rtts.length;t++)e+=this.rtts[t];return e/this.rtts.length}},{key:"variance",value:function(){if(0==this.rtts.length)return null;for(var e=0,t=this.average(),n=0;n<this.rtts.length;n++){var r=this.rtts[n];e+=Math.pow(r-t,2)}return e/this.rtts.length}},{key:"stop",value:function(){this.isActive()&&(function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stop",this).call(this),this.fillResults())}}]),t}();n.RttTest=a},{"../utility/timestamps":14,"./turnTest":5}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ThroughputTest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/timestamps")),o=e("../utility/messageMaker"),a=e("./turnTest"),s=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(r.sentBytes=0,r.receivedBytes=0,r.secondHalfBytes=0,r.secondHalfStart=null,r.bufferEmpty=0,r.chunkSize=1200,r.messageMaker=new o.MessageMaker(r.chunkSize),r.duration=5e3,null!=n){var i=50*n;r.duration=Math.max(Math.min(i,1e4),1e3)}return r.sendTimer=null,r.lastMessage=null,r.intervals=[],r.intervalStart=0,r.intervalLength=100,r.intervalBytes=0,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.TurnTest),r(t,[{key:"initiate",value:function(){window&&window.csioReactNative?this.handleError(new Error("Not running throughput test for react-native")):this.startSend()}},{key:"handleMessage",value:function(e){var t=this;if(this.isActive()){this.lastMessage=e,this.receivedBytes+=e.length;var n=i.getCurrent();if(this.sendTimer||(this.results.startTimestamp=n,this.sendTimer=setTimeout(function(){t.stop(),t.finished()},this.duration)),0==this.intervalStart&&(this.intervalStart=n),this.intervalBytes+=e.length,n-this.intervalStart>=this.intervalLength){var r=n-this.intervalStart,o=this.averageThroughput(this.intervalBytes,r),a=null;try{a=n-JSON.parse(this.lastMessage).timestamp}catch(e){}this.intervals.push({startTimestamp:this.intervalStart,endTimestamp:n,bytesReceived:this.intervalBytes,average:o,rtt:a}),this.intervalStart=n,this.intervalBytes=0}this.results.startTimestamp&&n-this.results.startTimestamp>this.duration/2&&(this.secondHalfStart||(this.secondHalfStart=n),this.secondHalfBytes+=e.length)}}},{key:"handleError",value:function(e){this.stop(),this.failed(e)}},{key:"averageThroughput",value:function(e,t){return e/(t/1e3)*8/1024}},{key:"bufferListener",value:function(){this.sendChannel.removeEventListener("bufferedamountlow",this.bufferListener.bind(this)),this.fillBuffer()}},{key:"fillBuffer",value:function(){for(0==this.sendChannel.bufferedAmount&&(this.bufferEmpty+=1);this.isActive();){if(this.sendChannel.bufferedAmount>this.bufferFullThreshold)return void(this.usePolling?setTimeout(this.fillBuffer.bind(this),250):this.sendChannel.addEventListener("bufferedamountlow",this.bufferListener.bind(this)));var e=this.messageMaker.make(this.sentBytes);this.sentBytes+=e.length,this.send(e)}this.sendChannel.removeEventListener("bufferedamountlow",this.bufferListener.bind(this))}},{key:"startSend",value:function(){this.isActive()&&(this.bufferFullThreshold=1e3*this.chunkSize,this.sendChannel=this.connection.sendChannel,this.usePolling=!0,"number"==typeof this.sendChannel.bufferedAmountLowThreshold&&(this.usePolling=!1,this.sendChannel.bufferedAmountLowThreshold=this.bufferFullThreshold/10),setTimeout(this.fillBuffer.bind(this),0))}},{key:"fillResults",value:function(){this.results.endTimestamp=i.getCurrent(),this.results.maxDuration=this.duration,this.results.forceStopped=this.forceStopped,this.results.bufferEmpty=this.bufferEmpty,this.results.intervals=this.intervals,this.results.bytesPrepared=this.sentBytes,this.results.bytesReceived=this.receivedBytes;var e=0,t=0;this.secondHalfStart&&(e=this.results.endTimestamp-this.secondHalfStart,t=this.averageThroughput(this.secondHalfBytes,e));var n=this.results.endTimestamp-this.results.startTimestamp,r=this.averageThroughput(this.receivedBytes,n);t<r&&(t=r),this.results.average=t;var o=null;try{o=JSON.parse(this.lastMessage)}catch(e){return}if(o){var a=o.sentBytes+this.lastMessage.length;this.results.bytesSent=a,this.results.fractionLostBytes=1-this.receivedBytes/a}else this.results.bytesSent=-1,this.results.fractionLostBytes=-1}},{key:"stop",value:function(){this.isActive()&&(clearTimeout(this.sendTimer),this.sendTimer=null,function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stop",this).call(this),this.fillResults())}}]),t}();n.ThroughputTest=s},{"../utility/messageMaker":7,"../utility/timestamps":14,"./turnTest":5}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("bluebird"),o=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.connection=t,this.active=!1,this.results={}}return r(e,[{key:"getResults",value:function(){return this.results}},{key:"start",value:function(){var e=this,t=new i(function(t,n){e.resolveCb=t,e.rejectCb=n});return this.connection.setMessageCallback(this.handleMessage.bind(this)),this.connection.setErrorCallback(this.handleError.bind(this)),this.active=!0,this.forceStopped=!1,this.initiate(),t}},{key:"stop",value:function(){this.active=!1}},{key:"forceStop",value:function(){this.forceStopped=!0,this.stop(),this.finished()}},{key:"isActive",value:function(){return this.active}},{key:"initiate",value:function(){}},{key:"handleMessage",value:function(e){}},{key:"handleError",value:function(e){}},{key:"send",value:function(e){this.connection.send(e)}},{key:"finished",value:function(){this.active=!1,this.resolveCb&&(this.resolveCb(),this.resolveCb=null)}},{key:"failed",value:function(e){this.active=!1,this.rejectCb&&(this.rejectCb(e),this.rejectCb=null)}}]),e}();n.TurnTest=o},{bluebird:1}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TurnConnection=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./utility/parsedIceCandidate"),o=e("./utility/stats/getstatshandler"),a=e("./utility/stats/detectbrowser"),s=e("bluebird"),c=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.reset(),this.statshandler=new o.GetStatsHandler(t)}return r(e,[{key:"reset",value:function(){this.disconnect(),this.iceServers=null,this.pctpc1=null,this.pctpc2=null,this.sendChannel=null,this.messageCallback=null,this.errorCallback=null,this.parsedIceResults={},this.resolveCb=null,this.rejectCb=null}},{key:"setMessageCallback",value:function(e){this.messageCallback=e}},{key:"setErrorCallback",value:function(e){this.errorCallback=e}},{key:"send",value:function(e){if(this.sendChannel)try{this.sendChannel.send(e)}catch(e){this.raiseSendError(e)}else this.raiseSendError(new Error("No send channel"))}},{key:"raiseSendError",value:function(e){this.errorCallback&&this.errorCallback(e)}},{key:"assignEvent",value:function(e,t,n){e.addEventListener?e.addEventListener(t,n.bind(this),!1):e.attachEvent&&(t="on"+t,e.attachEvent(t,n.bind(this)))}},{key:"connect",value:function(e){var t=this;this.reset();var n=new s(function(e,n){t.resolveCb=e,t.rejectCb=n});this.iceServers=e;var r=null;try{if(RTCPeerConnection?r=RTCPeerConnection:webkitRTCPeerConnection?r=webkitRTCPeerConnection:mozRTCPeerConnection?r=mozRTCPeerConnection:window&&window.RTCPeerConnection&&(r=window.RTCPeerConnection),!r){var i=new Error("RTCPeerConnection not found");return i.continueFlag=!1,this.rejectCb(i),n}}catch(i){return i.continueFlag=!1,this.rejectCb(i),n}var o={iceTransportPolicy:"all",iceServers:this.iceServers};try{this.pctpc1=new r(o),this.pctpc2=new r(o)}catch(i){return this.rejectDisconnect(!1,i),n}this.connectionTimer=setTimeout(function(){delete t.connectionTimer,t.rejectDisconnect(!1,new Error("Connection timeout"))},3e4);try{this.sendChannel=this.pctpc1.createDataChannel("precalltest",{ordered:!1,maxRetransmits:0}),this.sendChannel.binaryType="arraybuffer",this.assignEvent(this.sendChannel,"error",function(e){t.raiseSendError(e),t.rejectDisconnect(!0,e)}),this.assignEvent(this.pctpc2,"datachannel",function(e){var n=e.channel;t.assignEvent(n,"open",function(e){t.resolveCb&&(t.resolveCb(),t.resolveCb=null)}),t.assignEvent(n,"close",function(e){t&&t.disconnect&&t.disconnect()}),t.assignEvent(n,"message",function(e){t.messageCallback&&t.messageCallback(e.data)}),t.assignEvent(n,"error",function(e){t.errorCallback&&t.errorCallback(e),t.rejectDisconnect(!0,e)})})}catch(i){return this.rejectDisconnect(!1,i),n}try{this.assignEvent(this.pctpc1,"icecandidate",function(e){t.onIceCandidate(t.pctpc1,e)}),this.assignEvent(this.pctpc1,"iceconnectionstatechange",function(e){t.onIceStateChange(t.pctpc1,e)}),this.assignEvent(this.pctpc2,"icecandidate",function(e){t.onIceCandidate(t.pctpc2,e)}),this.assignEvent(this.pctpc2,"iceconnectionstatechange",function(e){t.onIceStateChange(t.pctpc2,e)}),this.pctpc1.createOffer().then(function(e,n){t.onCreateOfferSuccess(e)},function(e){t.onCreateOfferError(t.pctpc1,e)})}catch(i){return this.rejectDisconnect(!1,i),n}return n}},{key:"rejectDisconnect",value:function(e,t){this.disconnect(),this.rejectCb&&(t.continueFlag=e,this.rejectCb(t)),this.resolveCb=null,this.rejectCb=null}},{key:"disconnect",value:function(){if(clearTimeout(this.connectionTimer),clearTimeout(this.iceTimer),this.pctpc1)try{this.pctpc1.close()}catch(e){}if(this.pctpc1=null,this.pctpc2)try{this.pctpc2.close()}catch(e){}this.pctpc2=null}},{key:"getName",value:function(e){return e===this.pctpc1?"pctpc1":"pctpc2"}},{key:"getOtherPc",value:function(e){return e===this.pctpc1?this.pctpc2:this.pctpc1}},{key:"onCreateOfferError",value:function(e,t){this.rejectDisconnect(!1,t)}},{key:"onCreateAnswerError",value:function(e,t){this.rejectDisconnect(!1,t)}},{key:"onCreateOfferSuccess",value:function(e){var t=this;try{this.pctpc1.setLocalDescription(e).then(function(){t.onSetLocalSuccess(t.pctpc1)},function(e){t.onSetSessionDescriptionError(t.pctpc1,e)}),this.pctpc2.setRemoteDescription(e).then(function(){t.onSetRemoteSuccess(t.pctpc2)},function(e){t.onSetRemoteSessionDescriptionError(t.pctpc2,e)}),this.pctpc2.createAnswer().then(function(e){t.onCreateAnswerSuccess(e)},function(e){t.onCreateAnswerError(t.pctpc2,e)})}catch(e){this.rejectDisconnect(!1,e)}}},{key:"onSetLocalSuccess",value:function(e){}},{key:"onSetRemoteSuccess",value:function(e){}},{key:"onSetSessionDescriptionError",value:function(e,t){this.rejectDisconnect(!1,t)}},{key:"onSetRemoteSessionDescriptionError",value:function(e,t){this.rejectDisconnect(!1,t)}},{key:"onCreateAnswerSuccess",value:function(e){var t=this;try{this.pctpc2.setLocalDescription(e).then(function(){t.onSetLocalSuccess(t.pctpc2)},function(e){t.onSetSessionDescriptionError(t.pctpc2,e)}),this.pctpc1.setRemoteDescription(e).then(function(){t.onSetRemoteSuccess(t.pctpc1)},function(e){t.onSetRemoteSessionDescriptionError(t.pctpc1,e)})}catch(e){this.rejectDisconnect(!1,e)}}},{key:"onIceCandidate",value:function(e,t){var n=this;try{if(!t.candidate)return;var r=new i.ParsedIceCandidate(t.candidate);if(e==this.pctpc1&&this.statshandler.codeBase==a.Constants.codeBaseType.chrome&&(r.isRelay()&&(r.isTypeTransportUdp()&&(this.parsedIceResults.relayUdpGathered=!0),r.isTypeTransportTcp()&&(this.parsedIceResults.relayTcpGathered=!0),r.isTypeTransportTls()&&(this.parsedIceResults.relayTlsGathered=!0)),r.isServerReflexive()&&(this.parsedIceResults.srflxGathered=!0)),!r.isRelay())return;this.getOtherPc(e).addIceCandidate(t.candidate).then(function(){n.onAddIceCandidateSuccess(e)},function(t){n.onAddIceCandidateError(e,t,r.isRelay())})}catch(t){this.rejectDisconnect(!1,t)}}},{key:"onAddIceCandidateSuccess",value:function(e){}},{key:"onAddIceCandidateError",value:function(e,t,n){n&&this.rejectDisconnect(!1,t)}},{key:"onIceStateChange",value:function(e,t){var n=this;try{var r="(?)";e&&(r=e.iceConnectionState),"failed"===r&&this.rejectDisconnect(!0,new Error("ICE failure")),"checking"!==r||this.iceTimer||(this.iceTimer=setTimeout(function(){delete n.iceTimer,n.rejectDisconnect(!0,new Error("ICE timeout"))},1e4)),"completed"!==r&&"connected"!==r||(clearTimeout(this.iceTimer),delete this.iceTimer)}catch(e){this.rejectDisconnect(!1,e)}}},{key:"getIceResults",value:function(){var e=this;return new s(function(t,n){for(var r=JSON.parse(JSON.stringify(e.iceServers)),i=0;i<r.length;i++){var o=r[i];r.hasOwnProperty(o)||delete o.credential}var a={turnIpAddress:"",turnIpVersion:"",turnTransport:"",iceServers:r,ipv6Supported:!1,ipv4Supported:!1,relayTlsGathered:!1,relayTcpGathered:!1,relayUdpGathered:!1,srflxGathered:!1,relayTlsSuccess:!1,relayTcpSuccess:!1,relayUdpSuccess:!1,srflxSuccess:!1};for(var s in e.parsedIceResults)e.parsedIceResults.hasOwnProperty(s)&&(a[s]=e.parsedIceResults[s]);e.pctpc1?e.statshandler.getIceCandidates(e.pctpc1).then(function(e){for(var n=0;n<e.iceCandidatePairs.length;n++){var r=e.iceCandidatePairs[n];if(r.googActiveConnection||r.selected)for(var i=0;i<e.localCandidates.length;i++){var o=e.localCandidates[i],s=null;if(s=o.ip?o.ip:o.ipAddress,o.id==r.localCandidateId){var c=-1!==(a.turnIpAddress=s).indexOf(":");a.turnIpVersion=c?"ipv6":"ipv4",a.turnTransport=o.mozLocalTransport}"relay"!==o.candidateType&&"relayed"!==o.candidateType||("udp"===o.mozLocalTransport&&(a.relayUdpSuccess=!0),"tcp"===o.mozLocalTransport&&(a.relayTcpSuccess=!0),"tls"===o.mozLocalTransport&&(a.relayTlsSuccess=!0)),-1!==s.indexOf(":")?a.ipv6Supported=!0:a.ipv4Supported=!0}}for(var u=0;u<e.localCandidates.length;u++){var l=e.localCandidates[u];"relay"!==l.candidateType&&"relayed"!==l.candidateType||("udp"===l.mozLocalTransport&&(a.relayUdpGathered=!0),"tcp"===l.mozLocalTransport&&(a.relayTcpGathered=!0),"tls"===l.mozLocalTransport&&(a.relayTlsGathered=!0)),"srflx"!==l.candidateType&&"serverreflexive"!==l.candidateType||(a.srflxGathered=!0)}for(var d=0;d<e.iceCandidatePairs.length;d++){var f=e.iceCandidatePairs[d];if("succeeded"===f.state)for(var p=0;p<e.localCandidates.length;p++){var h=e.localCandidates[p];h.id==f.localCandidateId&&("relay"!==h.candidateType&&"relayed"!==h.candidateType||("udp"===h.mozLocalTransport&&(a.relayUdpSuccess=!0),"tcp"===h.mozLocalTransport&&(a.relayTcpSuccess=!0),"tls"===h.mozLocalTransport&&(a.relayTlsSuccess=!0)),"srflx"!==h.candidateType&&"serverreflexive"!==h.candidateType||(a.srflxSuccess=!0))}}t(a)},function(e){n(e)}):n(new Error("PC not available for stats"))},function(e){reject(e)})}}]),e}();n.TurnConnection=c},{"./utility/parsedIceCandidate":9,"./utility/stats/detectbrowser":11,"./utility/stats/getstatshandler":12,bluebird:1}],7:[function(e,t,n){"use strict";function r(e){for(var t="",n=0;n<e;n++)t+=String.fromCharCode(35+58*Math.random());return t}Object.defineProperty(n,"__esModule",{value:!0}),n.randomAsciiString=n.MessageMaker=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/timestamps")),a=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1200;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.message={timestamp:"",sentBytes:1e4,padding:""};var n=r(t-o.getCurrent().toString().length-JSON.stringify(this.message).length);this.message.padding=n}return i(e,[{key:"make",value:function(e){return this.message.timestamp=o.getCurrent(),this.message.sentBytes=e,JSON.stringify(this.message)}}]),e}();n.MessageMaker=a,n.randomAsciiString=r},{"../utility/timestamps":14}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.OnlineCheck=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("./timestamps")),o=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.active=!1}return r(e,[{key:"start",value:function(){var e=this;this.active=!0,this.onlineCheck=[],window&&window.addEventListener&&"function"==typeof window.addEventListener&&(window.addEventListener("offline",function(){e.addEntry()}),window.addEventListener("online",function(){e.addEntry()}),this.addEntry())}},{key:"addEntry",value:function(){if(this.active){var e=i.getCurrent();if(navigator&&navigator.onLine){var t=navigator.onLine;this.onlineCheck.push({timestamp:e,online:t})}}}},{key:"stop",value:function(){var e=this;return this.active=!1,window&&window.removeEventListener&&"function"==typeof window.removeEventListener&&(window.removeEventListener("offline",function(){e.addEntry()}),window.removeEventListener("online",function(){e.addEntry()})),this.onlineCheck}}]),e}();n.OnlineCheck=o},{"./timestamps":14}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.iceCandidateStr=t.candidate,this.parse()}return r(e,[{key:"parse",value:function(){var e=this.iceCandidateStr.split(" ");e.length<8||(this.protocol="1"===e[1]?"rtp":"rtcp",this.transport=e[2],this.typeTransport=this.extractTypeTransport(e[3]),this.ipv6=-1!==e[4].indexOf(":"),this.ipAddress=e[4],this.port=e[5],this.type=e[7])}},{key:"extractTypeTransport",value:function(e){var t="None",n=e>>24;if("rtp"===this.protocol&&0<=n&&n<=2)switch(n){case 0:t="TLS";break;case 1:t="TCP";break;case 2:t="UDP"}return t}},{key:"getString",value:function(){return this.iceCandidateStr}},{key:"getType",value:function(){return this.type}},{key:"isHost",value:function(){return"host"===this.type.toLowerCase()}},{key:"isServerReflexive",value:function(){return"srflx"===this.type.toLowerCase()}},{key:"isPeerReflexive",value:function(){return"prflx"===this.type.toLowerCase()}},{key:"isRelay",value:function(){return"relay"===this.type.toLowerCase()||"relayed"===this.type.toLowerCase()}},{key:"getTypeTransport",value:function(){return this.typeTransport}},{key:"isTypeTransportUdp",value:function(){return"UDP"===this.typeTransport}},{key:"isTypeTransportTcp",value:function(){return"TCP"===this.typeTransport}},{key:"isTypeTransportTls",value:function(){return"TLS"===this.typeTransport}},{key:"getTransport",value:function(){return this.transport}},{key:"isUdp",value:function(){return"udp"===this.transport.toLowerCase()}},{key:"isTcp",value:function(){return"tcp"===this.transport.toLowerCase()}},{key:"getProtocol",value:function(){return this.protocol}},{key:"isRtp",value:function(){return"rtp"===this.protocol}},{key:"isRtcp",value:function(){return"rtcp"===this.protocol}},{key:"isIpv6",value:function(){return this.ipv6}},{key:"getIpAddress",value:function(){return this.ipAddress}},{key:"getPort",value:function(){return this.port}}]),e}();n.ParsedIceCandidate=i},{}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ResultsHandler=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("./timestamps")),a=e("./messageMaker"),s={success:"success",stopped:"stopped",failed:"failed"},c=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.start=o.getCurrent(),this.id=Math.trunc(this.start)+"-"+(0,a.randomAsciiString)(20),this.version="1.4.0",this.failures=[],this.results={},this.status=s.success,this.provider="callstats"}return i(e,[{key:"setStatusStopped",value:function(){this.status!==s.failed&&(this.status=s.stopped)}},{key:"setStatusFailed",value:function(){this.status=s.failed}},{key:"setStatusSuccess",value:function(){this.status!==s.stopped&&(this.status=s.success)}},{key:"setProvider",value:function(e){e&&(this.provider=e)}},{key:"getResults",value:function(){return{id:this.id,version:this.version,status:this.status,startTimestamp:this.start,endTimestamp:o.getCurrent(),failures:this.failures,tests:this.results,provider:this.provider}}},{key:"getFailureNumber",value:function(){return this.failures.length}},{key:"getId",value:function(){return this.id}},{key:"add",value:function(e,t){(this.results[e]=t).hasOwnProperty("forceStopped")&&1==t.forceStopped&&this.setStatusStopped()}},{key:"failure",value:function(e){"object"===(void 0===e?"undefined":r(e))&&(e=e.toString());var t={timestamp:o.getCurrent(),reason:e};this.failures.push(t)}}]),e}();n.ResultsHandler=c},{"./messageMaker":7,"./timestamps":14}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.detect=function(){var e=r.browserName.chrome,t=null,n=null,i=null,o=null,a=r.codeBaseType.chrome;if(window&&(!window.navigator||!window.navigator.userAgent||window.csioReactNative))return window&&window.csioGetOsName&&(t=window.csioGetOsName()),window&&window.csioGetOsVer&&(n=window.csioGetOsVer()),window&&window.csioReactNative&&(i="react-native"),{browserName:e,codeBase:a,os:t,osVersion:n,userAgent:i};var s=(i=navigator.userAgent).toLowerCase(),c=void 0,u=void 0;(o=navigator.appVersion)&&(c=o.toLowerCase(),u=""+parseFloat(c));var l=void 0,d="Version";-1!==(l=s.indexOf("opera"))?(e=r.browserName.opera,u=s.substring(l+6),-1!==(l=s.indexOf(d))&&(u=s.substring(l+8)),a=r.codeBaseType.chrome):-1!==(l=s.indexOf("opr"))?(e=r.browserName.opera,u=s.substring(l+4),-1!==(l=s.indexOf(d))&&(u=s.substring(l+8)),a=r.codeBaseType.chrome):-1!==(l=s.indexOf("msie"))?(e=r.browserName.msie,u=s.substring(l+5),a=r.codeBaseType.chrome):-1!==(l=s.indexOf("edge"))?(e=r.browserName.edge,u=s.substring(l+5),a=r.codeBaseType.edge):-1!==(l=s.indexOf("chrome"))?(e=r.browserName.chrome,u=s.substring(l+7),a=r.codeBaseType.chrome):-1!==(l=s.indexOf("safari"))?(e=r.browserName.safari,u=s.substring(l+7),-1!==(l=s.indexOf(d))&&(u=s.substring(l+8)),a=r.codeBaseType.chrome):-1!==(l=s.indexOf("firefox"))?(e=r.browserName.firefox,u=s.substring(l+8),a=r.codeBaseType.firefox):-1!==(l=s.indexOf("trident"))&&(e=r.browserName.msie,l=s.indexOf("rv"),u=s.substring(l+3,l+7),a=r.codeBaseType.chrome);var f=[{s:"Windows 3.11",r:/win16/},{s:"Windows 95",r:/(windows 95|win95|windows_95)/},{s:"Windows ME",r:/(win 9x 4.90|windows me)/},{s:"Windows 98",r:/(windows 98|win98)/},{s:"Windows CE",r:/windows ce/},{s:"Windows 2000",r:/(windows nt 5.0|windows 2000)/},{s:"Windows XP",r:/(windows nt 5.1|windows xp)/},{s:"Windows Server 2003",r:/windows nt 5.2/},{s:"Windows Vista",r:/windows nt 6.0/},{s:"Windows 7",r:/(windows 7|windows nt 6.1)/},{s:"Windows 8.1",r:/(windows 8.1|windows nt 6.3)/},{s:"Windows 8",r:/(windows 8|windows nt 6.2)/},{s:"Windows 10",r:/(windows 10|windows nt 10.0)/},{s:"Windows NT 4.0",r:/(windows nt 4.0|winnt4.0|winnt|windows nt)/},{s:"Windows ME",r:/windows me/},{s:"Android",r:/android/},{s:"Open BSD",r:/openbsd/},{s:"Sun OS",r:/sunos/},{s:"Linux",r:/(linux|x11)/},{s:"iOS",r:/(iphone|ipad|ipod)/},{s:"Mac OS X",r:/mac os x/},{s:"Mac OS",r:/(macppc|macintel|mac_powerpc|macintosh)/},{s:"QNX",r:/qnx/},{s:"UNIX",r:/unix/},{s:"BeOS",r:/beos/},{s:"OS/2",r:/os\/2/},{s:"Search Bot",r:/(nuhk|googlebot|yammybot|openbot|slurp|msnbot|ask jeeves\/teoma|ia_archiver)/}],p=void 0,h=void 0;for(p in f)if(f.hasOwnProperty(p)&&(h=f[p]).r.test(s)){t=h.s;break}switch(t&&/Windows/.test(t)&&(n=/Windows (.*)/.exec(t)[1],t=r.osName.windows),t){case r.osName.mac:n=/mac os x (10[\.\_\d]+)/.exec(s)[1];break;case r.osName.android:n=/android ([\.\_\d]+)/.exec(s)[1];break;case r.osName.ios:if(!c)break;if(!(n=/os (\d+)_(\d+)_?(\d+)?/.exec(c)))break;n=n[1]+"."+n[2]+"."+(0|n[3])}return{browserName:e,browserVersion:u.toString(),os:t,osVersion:n,codeBase:a,userAgent:i}};var r=n.Constants={codeBaseType:{chrome:"Chrome",firefox:"Firefox",edge:"Edge",plugin:"Plugin"},browserName:{chrome:"Chrome",firefox:"Firefox",edge:"Edge",msie:"Microsoft Internet Explorer",safari:"Safari"},osName:{windows:"Windows",mac:"Mac OS X",android:"Android",ios:"iOS"}}},{}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GetStatsHandler=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./detectbrowser"),o=e("./statsadapter"),a=e("bluebird"),s=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.codeBase=t.codeBase,this.browserName=t.browserName,this.adapter=new o.StatsAdapter(this.codeBase,this.browserName),this.isPromiseBased=!0}return r(e,[{key:"getIceCandidates",value:function(e){var t=this;return new a(function(n,r){t.csioGetStats(t.iceCandidatesHandler.bind(t),e,function(e){n(e)})})}},{key:"iceCandidatesHandler",value:function(e,t){t(this.adapter.getIceCandidates(e))}},{key:"csioGetStats",value:function(e,t,n){var r=i.Constants.codeBaseType.firefox,o=i.Constants.codeBaseType.chrome,a=i.Constants.codeBaseType.edge,s=i.Constants.browserName.safari;t&&(this.codeBase===r?this.getStatsFirefox(e,t,n):this.browserName===s?this.getStatsSafari(e,t,n):this.codeBase===o?this.getStatsChrome(e,t,n):this.codeBase===a&&this.getStatsEdge(e,t,n))}},{key:"getStatsFirefox",value:function(e,t,n){var r=this;if(r.isPromiseBased)try{t.getStats().then(function(t){e(t,n)}).catch(function(i){r.isPromiseBased=!1,t.getStats(null,function(t){e(t,n)},function(){})})}catch(i){r.isPromiseBased=!1,t.getStats(null,function(t){e(t,n)},function(){})}else t.getStats(null,function(t){e(t,n)},function(){})}},{key:"getStatsChrome",value:function(e,t,n){var r=this;if(window&&window.csioReactNative)t.getStats(null,function(t){e(t,n)},function(e){});else if(r.isPromiseBased)try{t.getStats().then(function(t){e(t,n)}).catch(function(i){r.isPromiseBased=!1,t.getStats(function(t){e(t,n)})})}catch(r){isPromiseBased=!1,t.getStats(function(t){e(t,n)})}else t.getStats(function(t){e(t,n)})}},{key:"getStatsEdge",value:function(e,t,n){t.getStats().then(function(t){e(t,n)}).catch(function(e){})}},{key:"getStatsSafari",value:function(e,t,n){t.getStats().then(function(t){e(t,n)}).catch(function(e){})}}]),e}();n.GetStatsHandler=s},{"./detectbrowser":11,"./statsadapter":13,bluebird:1}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.StatsAdapter=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./detectbrowser"),o=function(){function e(t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.codeBase=t,this.browser=n}return r(e,[{key:"getIceCandidates",value:function(e){if(!e)return{localCandidates:[],remoteCandidates:[],iceCandidatePairs:[]};var t=this.extractRawStats(e);return this.processRawStatsForIceInfo(t)}},{key:"extractRawStats",value:function(e){var t=[],n=void 0,r=i.Constants.codeBaseType.firefox,o=i.Constants.codeBaseType.chrome,a=i.Constants.browserName.safari;if(this.codeBase===r&&this.browser!==a)e.forEach(function(e){t.push(e)});else if(this.codeBase===o&&this.browser!==a)e&&e.result?t=e.result():e&&e.forEach&&(t=[],e.forEach(function(e){t.push(e)}));else for(n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}},{key:"processRawStatsForIceInfo",value:function(e){var t=[],n=[],r=[],i=void 0;if(!e)return{localCandidates:t,remoteCandidates:n,iceCandidatePairs:r};for(var o=0;o<e.length;++o){var a=this.getParsedStats(e[o]),s=this.statsClassifier(a);if(s.candidatePair)r.push(s.candidatePair);else if(s.transportStats){if("transport"===s.transportStats.type){i=s.transportStats.selectedCandidatePairId;continue}r.push(s.transportStats)}else if(s.localCandidate){var c=s.localCandidate;if("relay"==c.candidateType||"relayed"==c.candidateType){if(!c.mozLocalTransport){var u=c.priority>>24;c.mozLocalTransport=this.formatRelayType(u)}c.mozLocalTransport=c.mozLocalTransport.toLowerCase()}t.push(c)}else s.remoteCandidate&&n.push(s.remoteCandidate)}if(i)for(var l=0;l<r.length;++l)r[l].id===i&&(r[l].googActiveConnection="true");return{localCandidates:t,remoteCandidates:n,iceCandidatePairs:r}}},{key:"getParsedStats",value:function(e){var t={};if(e.timestamp instanceof Date&&(t.timestamp=e.timestamp.getTime().toString()),e.type&&(t.type=e.type),e.names)for(var n=e.names(),r=0;r<n.length;++r)t[n[r]]=e.stat(n[r]);else Object.assign(t,e);if(t.values){for(var i=0;i<t.values.length;i++){var o=t.values[i];Object.assign(t,o)}delete t.values}return t}},{key:"statsClassifier",value:function(e){var t={},n=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0;i<n.length;i++){var o=n[i];if(e.type===o)return!0}return!1},r=n("inbound-rtp","inboundrtp"),i="true"===e.isRemote||!0===e.isRemote;return r||n("outbound-rtp","outboundrtp")?(t.tracks={},t.tracks.data=e,t.tracks.ssrc=e.ssrc,t.tracks.streamType=r?"inbound":"outbound",t.tracks.reportType="local",void 0!==e.isRemote&&(t.tracks.reportType=i?"remote":"local")):n("candidatepair")&&e.selected?t.transportStats=e:n("localcandidate","local-candidate")?t.localCandidate=e:n("remotecandidate","remote-candidate")?t.remoteCandidate=e:n("transport","googCandidatePair")?t.transportStats=e:n("VideoBwe")?t.bwe=e:n("track")?t.trackStats=e:n("candidate-pair")?t.candidatePair=e:n("codec")?t.codec=e:n("ssrc")&&(t.tracks={},t.tracks.data=e,t.tracks.ssrc=e.ssrc,t.tracks.reportType="local",t.tracks.streamType=e.bytesSent?"outbound":"inbound"),t}},{key:"formatRelayType",value:function(e){var t="none";switch(e){case 0:t="tls";break;case 1:t="tcp";break;case 2:t="udp"}return t}}]),e}();n.StatsAdapter=o},{"./detectbrowser":11}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getCurrent=function(){return window&&window.performance&&window.performance.now&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.now()+window.performance.timing.navigationStart:Date.now()}},{}],15:[function(e,t,n){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(l===setTimeout)return setTimeout(e,0);if((l===r||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function a(){v&&p&&(v=!1,p.length?h=p.concat(h):m=-1,h.length&&s())}function s(){if(!v){var e=o(a);v=!0;for(var t=h.length;t;){for(p=h,h=[];++m<t;)p&&p[m].run();m=-1,t=h.length}p=null,v=!1,function(e){if(d===clearTimeout)return clearTimeout(e);if((d===i||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{d(e)}catch(t){try{return d.call(null,e)}catch(t){return d.call(this,e)}}}(e)}}function c(e,t){this.fun=e,this.array=t}function u(){}var l,d,f=t.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:r}catch(e){l=r}try{d="function"==typeof clearTimeout?clearTimeout:i}catch(e){d=i}}();var p,h=[],v=!1,m=-1;f.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new c(e,t)),1!==h.length||v||o(s)},c.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=u,f.addListener=u,f.once=u,f.off=u,f.removeListener=u,f.removeAllListeners=u,f.emit=u,f.prependListener=u,f.prependOnceListener=u,f.listeners=function(e){return[]},f.binding=function(e){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(e){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],16:[function(e,t,n){(function(t,r){function i(e,t){this._id=e,this._clearFn=t}var o=e("process/browser.js").nextTick,a=Function.prototype.apply,s=Array.prototype.slice,c={},u=0;n.setTimeout=function(){return new i(a.call(setTimeout,window,arguments),clearTimeout)},n.setInterval=function(){return new i(a.call(setInterval,window,arguments),clearInterval)},n.clearTimeout=n.clearInterval=function(e){e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},n.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},n.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},n._unrefActive=n.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n.setImmediate="function"==typeof t?t:function(e){var t=u++,r=!(arguments.length<2)&&s.call(arguments,1);return c[t]=!0,o(function(){c[t]&&(r?e.apply(null,r):e.call(null),n.clearImmediate(t))}),t},n.clearImmediate="function"==typeof r?r:function(e){delete c[e]}}).call(this,e("timers").setImmediate,e("timers").clearImmediate)},{"process/browser.js":15,timers:16}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){var t=this;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.batteryManager=null,"function"==typeof navigator.getBattery&&navigator.getBattery().then(function(e){t.batteryManager=e})}return r(e,[{key:"getLevel",value:function(){return this.batteryManager?this.batteryManager.level:-1}},{key:"getCharging",value:function(){return this.batteryManager?this.batteryManager.charging:null}}]),e}();n.Battery=i},{}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.detect=function(){var e=r.browserName.chrome,t=null,n=null,i=null,o=null,a=r.codeBaseType.chrome;if(!window.navigator.userAgent||window.csioReactNative)return window&&window.csioGetOsName&&(t=window.csioGetOsName()),window&&window.csioGetOsVer&&(n=window.csioGetOsVer()),window&&window.csioReactNative&&(i="react-native"),{browserName:e,codeBase:a,os:t,osVersion:n,userAgent:i,browserVersion:null};var s=(i=navigator.userAgent).toLowerCase(),c=void 0,u=void 0;(o=navigator.appVersion)&&(c=o.toLowerCase(),u=""+parseFloat(c));var l=void 0;-1!==(l=s.indexOf("opera"))?(e=r.browserName.opera,u=s.substring(l+6),-1!==(l=s.indexOf("Version"))&&(u=s.substring(l+8)),a=r.codeBaseType.chrome):-1!==(l=s.indexOf("opr"))?(e=r.browserName.opera,u=s.substring(l+4),-1!==(l=s.indexOf("Version"))&&(u=s.substring(l+8)),a=r.codeBaseType.chrome):-1!==(l=s.indexOf("msie"))?(e=r.browserName.msie,u=s.substring(l+5),a=r.codeBaseType.chrome):-1!==(l=s.indexOf("edge"))?(e=r.browserName.edge,u=s.substring(l+5),a=r.codeBaseType.edge):-1!==(l=s.indexOf("chrome"))?(e=r.browserName.chrome,u=s.substring(l+7),a=r.codeBaseType.chrome):-1!==(l=s.indexOf("safari"))?(e=r.browserName.safari,u=s.substring(l+7),-1!==(l=s.indexOf("Version"))&&(u=s.substring(l+8)),a=r.codeBaseType.chrome):-1!==(l=s.indexOf("firefox"))?(e=r.browserName.firefox,u=s.substring(l+8),a=r.codeBaseType.firefox):-1!==(l=s.indexOf("trident"))&&(e=r.browserName.msie,l=s.indexOf("rv"),u=s.substring(l+3,l+7),a=r.codeBaseType.chrome);var d=[{s:"Windows 3.11",r:/win16/},{s:"Windows 95",r:/(windows 95|win95|windows_95)/},{s:"Windows ME",r:/(win 9x 4.90|windows me)/},{s:"Windows 98",r:/(windows 98|win98)/},{s:"Windows CE",r:/windows ce/},{s:"Windows 2000",r:/(windows nt 5.0|windows 2000)/},{s:"Windows XP",r:/(windows nt 5.1|windows xp)/},{s:"Windows Server 2003",r:/windows nt 5.2/},{s:"Windows Vista",r:/windows nt 6.0/},{s:"Windows 7",r:/(windows 7|windows nt 6.1)/},{s:"Windows 8.1",r:/(windows 8.1|windows nt 6.3)/},{s:"Windows 8",r:/(windows 8|windows nt 6.2)/},{s:"Windows 10",r:/(windows 10|windows nt 10.0)/},{s:"Windows NT 4.0",r:/(windows nt 4.0|winnt4.0|winnt|windows nt)/},{s:"Windows ME",r:/windows me/},{s:"Android",r:/android/},{s:"Open BSD",r:/openbsd/},{s:"Sun OS",r:/sunos/},{s:"Linux",r:/(linux|x11)/},{s:"iOS",r:/(iphone|ipad|ipod)/},{s:"Mac OS X",r:/mac os x/},{s:"Mac OS",r:/(macppc|macintel|mac_powerpc|macintosh)/},{s:"QNX",r:/qnx/},{s:"UNIX",r:/unix/},{s:"BeOS",r:/beos/},{s:"OS/2",r:/os\/2/},{s:"Search Bot",r:/(nuhk|googlebot|yammybot|openbot|slurp|msnbot|ask jeeves\/teoma|ia_archiver)/}],f=void 0,p=void 0;for(f in d)if(d.hasOwnProperty(f)&&(p=d[f]).r.test(s)){t=p.s;break}switch(t&&/Windows/.test(t)&&(n=/Windows (.*)/.exec(t)[1],t=r.osName.windows),t){case r.osName.mac:n=/mac os x (10[\.\_\d]+)/.exec(s)[1];break;case r.osName.android:n=/android ([\.\_\d]+)/.exec(s)[1];break;case r.osName.ios:if(!c)break;if(!(n=/os (\d+)_(\d+)_?(\d+)?/.exec(c)))break;n=n[1]+"."+n[2]+"."+(0|n[3])}return{browserName:e,browserVersion:u.toString(),os:t,osVersion:n,codeBase:a,userAgent:i}};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../config/constants"))},{"../config/constants":33}],19:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.Devices=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=r(e("../config/constants")),a=e("../utility/registry"),s=r(e("../utility/csiologger")),c=r(e("../utility/utils")),u=function(){function e(t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.conferenceId=t,this.pc=n,this.devices=null,this.emb=a.Registry.getEventMessageBuilder()}return i(e,[{key:"collectConnected",value:function(){var e=this;if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){var t=this;navigator.mediaDevices.enumerateDevices().then(function(n){var r=c.normalizeMediaDeviceList(n);t.sendConnected(r),setTimeout(e.collectConnected.bind(t),1e4)}).catch(function(n){setTimeout(e.collectConnected.bind(t),1e4)})}}},{key:"sendConnected",value:function(e){this.devices&&this.compare(e)||(this.devices=e,this.send())}},{key:"compare",value:function(e){return self.devices.sort().toString()===e.sort().toString()}},{key:"send",value:function(){var e={mediaDeviceList:this.devices};s.log("sending connectedDevice",o.internalFabricEvent.connectedDeviceList,e),this.emb.make(o.internalFabricEvent.connectedDeviceList,this.conferenceId,this.pc,e)}}]),e}();n.Devices=u},{"../config/constants":33,"../utility/csiologger":88,"../utility/registry":95,"../utility/utils":101}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.store=function(e,t){if(t)try{window&&window.localStorage&&window.localStorage.setItem(e,t)}catch(e){return}},n.get=function(e){try{if(window&&window.localStorage)return window.localStorage.getItem(e)}catch(e){return null}return null},n.remove=function(e){try{window&&window.localStorage&&window.localStorage.removeItem(e)}catch(e){return}}},{}],21:[function(e,t,n){"use strict";function r(e,t){if(t)try{window&&window.sessionStorage&&window.sessionStorage.setItem(e,t)}catch(e){return}}function i(e){try{if(window&&window.sessionStorage)return window.sessionStorage.getItem(e)}catch(e){return null}return null}Object.defineProperty(n,"__esModule",{value:!0}),n.store=r,n.get=i,n.remove=function(e){try{window&&window.sessionStorage&&window.sessionStorage.removeItem(e)}catch(e){return}},n.storeUcId=function(e,t){if(e){var n=JSON.parse(i("csio_ucid_data"));n||(n={}),n[e]||(n[e]={}),n[e].ucID=t,r("csio_ucid_data",JSON.stringify(n))}},n.getUcId=function(e){if(!e)return null;var t=JSON.parse(i("csio_ucid_data"));return t&&t[e]?t[e].ucID:null}},{}],22:[function(r,s,c){(function(n){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function c(e,t){var n={};return n.status=e,t&&(n.message=t),n}function u(e,t){return e+": "+t+" "+(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")}function l(e){if(null===e)return!1;var t=g.Registry.getEndpoint().getCodeBase();if(t===p.codeBaseType.firefox)return"undefined"!=typeof mozRTCPeerConnection&&e instanceof mozRTCPeerConnection||"undefined"!=typeof RTCPeerConnection&&e instanceof RTCPeerConnection;if(t===p.codeBaseType.edge||"function"==typeof e)return!0;var n=function(){var e=null,t=g.Registry.getEndpoint().getBrowserName();return"Firefox"===t?e=mozRTCPeerConnection:"Chrome"===t||"Opera"===t?e=webkitRTCPeerConnection:"Safari"===t?y.log("Browser type Safari"):"Edge"===t&&(e=window.RTCPeerConnection),e}();return null!==n&&e instanceof n||void 0!==e.createOffer}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=s(r("./config/constants")),h=s(r("./config/settings")),v=r("./config/callstatserrors"),m=r("./fsm/mainfsm"),g=r("./utility/registry"),y=s(r("./utility/csiologger")),b=s(r("./utility/onerroreventlistner")),S=s(r("./utility/utils"));b.setErrorEventListener(),S.assignPollyfill(),S.isIntegerPollyfill();var _=null,E=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),_=new m.MainFSM}return f(e,[{key:"initialize",value:function(e,t,n,r,i,o){if(!e||!n||!t){var a=u("initialize",v.csErrorStrings.argumentError);return y.error(a),c(p.callstatsAPIReturnStatus.failure,a)}if(r&&"function"!=typeof r){var s=u("initialize",v.csErrorStrings.argumentError);y.warn(s),r=null}if(i&&"function"!=typeof i){var l=u("initialize",v.csErrorStrings.argumentError);y.warn(l),i=null}if("function"!=typeof t&&!(window.crypto&&(window.crypto.subtle||window.crypto.webkitSubtle)||window.msCrypto&&window.msCrypto.subtle||window.csioReactNative)){var d=u("initialize",v.csErrorStrings.cryptoError);return y.error(d),r&&r(v.csError.tokenGenerationError,v.csErrorStrings.cryptoError),c(p.callstatsAPIReturnStatus.failure,d)}try{_.fire(m.MainEvents.onInitialize,e,n,t,r,i,o),_.run()}catch(e){g.Registry.getGenericEventHandler().sendEvent(p.logEvents.error,{msg:"initialize: Error",error:e.message+":"+e.stack}),y.error("initialize: Error",e)}return c(p.callstatsAPIReturnStatus.success)}},{key:"addNewFabric",value:function(e,t,n,r,i,o){var a=null,s=p.endpointType.peer,d=p.transmissionDirection.sendrecv;if(void 0===t){var f=u("addNewFabric",v.csErrorStrings.argumentError);return y.error(f),c(p.callstatsAPIReturnStatus.failure,f)}if(void 0===r){var h=u("addNewFabric",v.csErrorStrings.argumentError);return y.error(h),c(p.callstatsAPIReturnStatus.failure,h)}if(r||(r=p.tmpConferenceId),!e||!n){var b=u("addNewFabric",v.csErrorStrings.argumentError);return y.error(b),c(p.callstatsAPIReturnStatus.failure,b)}if(o&&"function"==typeof o&&(a=o),i&&"function"==typeof i&&(a=i),i&&"function"!=typeof i){if(i.remoteEndpointType){if(!p.endpointType.hasOwnProperty(i.remoteEndpointType)){var S=u("addNewFabric",v.csErrorStrings.invalidEndPointType,i.remoteEndpointType);return y.error(S),c(p.callstatsAPIReturnStatus.failure,S)}s=i.remoteEndpointType}if(i.fabricTransmissionDirection){if(!p.transmissionDirection.hasOwnProperty(i.fabricTransmissionDirection)){var E=u("addNewFabric",v.csErrorStrings.invalidTransmissionDirection,i.fabricTransmissionDirection);return y.error(E),c(p.callstatsAPIReturnStatus.failure,E)}d=i.fabricTransmissionDirection}}if(!p.fabricUsage.hasOwnProperty(n)||n instanceof Function){var C=u("addNewFabric",v.csErrorStrings.fabricUsageInvalid,n);return y.error(C),c(p.callstatsAPIReturnStatus.failure,C)}if(!l(e)){var T=u("addNewFabric",v.csErrorStrings.pcInvalid);return y.error(T),c(p.callstatsAPIReturnStatus.failure,T)}var w=g.Registry.getConferenceManager().get(r);if(w&&w.getPeerConnectionManager().getPcHandler(e))return c(p.callstatsAPIReturnStatus.success);if(!g.Registry.getCredentials().getAppId()||!g.Registry.getCredentials().getUserId()){var k=u("addNewFabric",v.csErrorStrings.notInitialized);return y.error(k),c(p.callstatsAPIReturnStatus.failure,k)}try{_.fire(m.MainEvents.onAddNewFabric,e,t,n,r,s,d,a),_.run()}catch(e){g.Registry.getGenericEventHandler().sendEvent(p.logEvents.error,{msg:"addNewFabric: Error",error:e.message+":"+e.stack}),y.error("addNewFabric: Error",e)}return c(p.callstatsAPIReturnStatus.success)}},{key:"sendFabricEvent",value:function(e,t,n,r){if(y.log("sendFabricEvent ",t),n||(n=p.tmpConferenceId),!e||!t){var i=u("sendFabricEvent",v.csErrorStrings.argumentError);return y.error(i),c(p.callstatsAPIReturnStatus.failure,i)}if(t===p.fabricEvent.fabricSetupFailed){var o=u("sendFabricEvent",v.csErrorStrings.fabricEventUnsupported,t);return y.error(o),c(p.callstatsAPIReturnStatus.failure,o)}if(!p.fabricEvent.hasOwnProperty(t)&&!p.internalFabricEvent.hasOwnProperty(t)){var a=u("sendFabricEvent",v.csErrorStrings.fabricEventInvalid,t);return y.error(a),c(p.callstatsAPIReturnStatus.failure,a)}if(!(t!==p.fabricEvent.activeDeviceList||r&&r.deviceList)){var s=u("sendFabricEvent ",v.csErrorStrings.argumentError);return y.error(s),c(p.callstatsAPIReturnStatus.failure,s)}var l=g.Registry.getConferenceManager().get(n);if(!g.Registry.getCredentials().getAppId()||!g.Registry.getCredentials().getUserId()||!l){var d=u("sendFabricEvent ",v.csErrorStrings.notInitialized);return y.error(d),c(p.callstatsAPIReturnStatus.failure,d)}if(!l.getPeerConnectionManager().getPcHandler(e)){var f=u("sendFabricEvent ",v.csErrorStrings.pcInvalid);return y.error(f),c(p.callstatsAPIReturnStatus.failure,f)}try{_.fire(m.MainEvents.onSendFabricEvent,e,t,n,r),_.run()}catch(e){g.Registry.getGenericEventHandler().sendEvent(p.logEvents.error,{msg:"sendFabricEvent: Error",error:e.message+":"+e.stack}),y.error("sendFabricEvent: Error",e)}return c(p.callstatsAPIReturnStatus.success)}},{key:"sendUserFeedback",value:function(e,t,n){if(!t||!e){var r=u("sendUserFeedback",v.csErrorStrings.argumentError);return y.error(r),n&&"function"==typeof n&&n(p.callstatsAPIReturnStatus.failure,r),c(p.callstatsAPIReturnStatus.failure,r)}if("object"!==(void 0===t?"undefined":d(t))){var i=u("sendUserFeedback",v.csErrorStrings.argumentError);return y.error(i),n&&"function"==typeof n&&n(p.callstatsAPIReturnStatus.failure,i),c(p.callstatsAPIReturnStatus.failure,i)}if(0===Object.keys(t).length){var o=u("sendUserFeedback",v.csErrorStrings.argumentError);return y.error(o),n&&"function"==typeof n&&n(p.callstatsAPIReturnStatus.failure,o),c(p.callstatsAPIReturnStatus.failure,o)}try{_.fire(m.MainEvents.onSendUserFeedback,e,t,n),_.run()}catch(e){g.Registry.getGenericEventHandler().sendEvent(p.logEvents.error,{msg:"sendUserFeedback: Error",error:e.message+":"+e.stack}),y.error("sendUserFeedback: Error",e)}return n&&"function"==typeof n&&n(p.callstatsAPIReturnStatus.success,"userFeedback Event sent successfully"),c(p.callstatsAPIReturnStatus.success)}},{key:"associateMstWithUserID",value:function(e,t,n,r,i,o){if(n||(n=p.tmpConferenceId),!e||!r||!i){var a=u("associateMstWithUserID",v.csErrorStrings.argumentError);return y.error(a),c(p.callstatsAPIReturnStatus.failure,a)}if(!l(e)){var s=u("associateMstWithUserID",v.csErrorStrings.pcInvalid);return y.error(s),c(p.callstatsAPIReturnStatus.failure,s)}var d=g.Registry.getConferenceManager().get(n);if(!d){var f=u("associateMstWithUserID",v.csErrorStrings.confereneDoesNotExist);return y.error(f),c(p.callstatsAPIReturnStatus.failure,f)}if(!d.getPeerConnectionManager().getPcHandler(e)){var h=u("associateMstWithUserID",v.csErrorStrings.pcInvalid);return y.error(h),c(p.callstatsAPIReturnStatus.failure,h)}o&&"string"!=typeof o&&(y.error("associateMstWithUserID: Invalid videoTag"),o=null);try{_.fire(m.MainEvents.onAssociateMstWithUserID,e,t,n,r,i,o),_.run()}catch(e){g.Registry.getGenericEventHandler().sendEvent(p.logEvents.error,{msg:"associateMstWithUserID: Error",error:e.message+":"+e.stack}),y.error("associateMstWithUserID: Error",e)}return c(p.callstatsAPIReturnStatus.success)}},{key:"reportError",value:function(e,t,n,r,i,o){if(t||(t=p.tmpConferenceId),void 0===e||!n){var a=u("reportError",v.csErrorStrings.argumentError);return y.error(a),c(p.callstatsAPIReturnStatus.failure,a)}if(!p.webRTCFunctions.hasOwnProperty(n)){var s=u("reportError",v.csErrorStrings.webRTCFunctionsInvalid,n);return y.error(s),c(p.callstatsAPIReturnStatus.failure,s)}if(void 0===r&&y.warn("reportError: Missing DOM error parameter"),!g.Registry.getCredentials().getAppId()||!g.Registry.getCredentials().getUserId()){var l=u("reportError",v.csErrorStrings.notInitialized);return y.error(l),c(p.callstatsAPIReturnStatus.failure,l)}try{_.fire(m.MainEvents.onReportError,e,t,n,r,i,o),_.run()}catch(e){g.Registry.getGenericEventHandler().sendEvent(p.logEvents.error,{msg:"reportError: Error",error:e.message+":"+e.stack}),y.error("reportError: Error",e)}return c(p.callstatsAPIReturnStatus.success)}},{key:"setProxyConfig",value:function(e){if(window&&!window.csioproxy){var t=u("setProxyConfig",v.csErrorStrings.setProxyConfigInvokeError);return y.error(t),c(p.callstatsAPIReturnStatus.failure,t)}if(!e){var n=u("setProxyConfig",v.csErrorStrings.argumentError);return y.error(n),c(p.callstatsAPIReturnStatus.failure,n)}try{_.fire(m.MainEvents.onSetProxyConfig,e),_.run()}catch(e){g.Registry.getGenericEventHandler().sendEvent(p.logEvents.error,{msg:"setProxyConfig: Error",error:e.message+":"+e.stack}),y.error("setProxyConfig: Error",e)}return c(p.callstatsAPIReturnStatus.success)}},{key:"attachWifiStatsHandler",value:function(e){if(!e){var t=u("attachWifiStatsHandler",v.csErrorStrings.argumentError);return y.error(t),c(p.callstatsAPIReturnStatus.failure,t)}if("function"!=typeof e){var n=u("attachWifiStatsHandler",v.csErrorStrings.argumentError);return y.error(n),c(p.callstatsAPIReturnStatus.failure,n)}try{_.fire(m.MainEvents.onAttachWifiStatsHandler,e),_.run()}catch(e){g.Registry.getGenericEventHandler().sendEvent(p.logEvents.error,{msg:"attachWifiStatsHandler: Error",error:e.message+":"+e.stack}),y.error("attachWifiStatsHandler: Error",e)}return c(p.callstatsAPIReturnStatus.success)}},{key:"setIdentifiers",value:function(e,t){if(!e){var n=u("setIdentifiers",v.csErrorStrings.argumentError);return y.error(n),c(p.callstatsAPIReturnStatus.failure,n)}try{_.fire(m.MainEvents.onSetIdentifiers,e,t),_.run()}catch(e){g.Registry.getGenericEventHandler().sendEvent(p.logEvents.error,{msg:"setIdentifiers: Error",error:e.message+":"+e.stack}),y.error("setIdentifiers: Error",e)}return c(p.callstatsAPIReturnStatus.success)}},{key:"makePrecallTest",value:function(e,t){if(!g.Registry.getAuthenticator().getToken()||!g.Registry.getCredentials().getAppId()){var n=u("makePrecallTest",v.csErrorStrings.notInitialized);return y.error(n),c(p.callstatsAPIReturnStatus.failure,n)}if(!g.Registry.getAuthenticator().getIceServers()){var r=u("makePrecallTest",v.csErrorStrings.notInitialized);return y.error(r),c(p.callstatsAPIReturnStatus.failure,r)}if(!g.Registry.getCredentials().getCollectSDP()){var i=u("makePrecallTest",v.csErrorStrings.apiaccesserror);return y.error(i),c(p.callstatsAPIReturnStatus.failure,i)}try{_.fire(m.MainEvents.onMakePrecallTest,e,t),_.run()}catch(e){g.Registry.getGenericEventHandler().sendEvent(p.logEvents.error,{msg:"on: Error",error:e.message+":"+e.stack}),y.error("makePrecallTest: Error",e)}return c(p.callstatsAPIReturnStatus.success)}},{key:"on",value:function(e,t){if(!t||"function"!=typeof t){var n=u("on",v.csErrorStrings.argumentError);return y.error(n),c(p.callstatsAPIReturnStatus.failure,n)}if(!e||!p.callbackFunctions.hasOwnProperty(e)){var r=u("on",v.csErrorStrings.argumentError);return y.error(r),c(p.callstatsAPIReturnStatus.failure,r)}try{_.fire(m.MainEvents.onOn,e,t),_.run()}catch(e){g.Registry.getGenericEventHandler().sendEvent(p.logEvents.error,{msg:"on: Error",error:e.message+":"+e.stack}),y.error("on: Error",e)}return c(p.callstatsAPIReturnStatus.success)}},{key:"fabricUsage",get:function(){return this.constructor.fabricUsage}},{key:"fabricEvent",get:function(){return this.constructor.fabricEvent}},{key:"webRTCFunctions",get:function(){return this.constructor.webRTCFunctions}},{key:"csError",get:function(){return this.constructor.csError}},{key:"qualityRating",get:function(){return this.constructor.qualityRating}},{key:"callStatsAPIReturnStatus",get:function(){return this.constructor.callStatsAPIReturnStatus}},{key:"version",get:function(){return this.constructor.version}},{key:"userIDType",get:function(){return this.constructor.userIDType}},{key:"transmissionDirection",get:function(){return this.constructor.transmissionDirection}},{key:"endpointType",get:function(){return this.constructor.endpointType}}]),e}();E.fabricUsage=p.fabricUsage,E.fabricEvent=p.fabricEvent,E.webRTCFunctions=p.webRTCFunctions,E.csError=v.csError,E.qualityRating=p.qualityRating,E.callStatsAPIReturnStatus=p.callstatsAPIReturnStatus,E.version=h.version,E.userIDType=p.userIdType,E.endpointType=p.endpointType,E.transmissionDirection=p.transmissionDirection,function(){function n(){return new E}o=[],void 0!==(a="function"==typeof(i=n)?i.apply(t,o):i)&&(e.exports=a),e.exports=n}("undefined"!=typeof window&&window)}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./config/callstatserrors":32,"./config/constants":33,"./config/settings":34,"./fsm/mainfsm":35,"./utility/csiologger":88,"./utility/onerroreventlistner":94,"./utility/registry":95,"./utility/utils":101}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BinaryTree=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./binarytreenode.js"),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/csiologger")),a=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.root=null,this.top=null,this.bottom=null,this.comparator=t,this.node_counter=0,this.duplicate_counter=0}return r(e,[{key:"getTopNode",value:function(){return this.top}},{key:"getTopValue",value:function(){return null===this.top?null:this.top.peek()}},{key:"getBottomValue",value:function(){return null===this.bottom?null:this.bottom.peek()}},{key:"getBottomNode",value:function(){return this.bottom}},{key:"getDuplicatedCounter",value:function(){return this.duplicate_counter}},{key:"getNodeCounter",value:function(){return this.node_counter}},{key:"getSize",value:function(){return this.duplicate_counter+this.node_counter}},{key:"insertNodeAtTop",value:function(e){e&&this.inserting(e.getValues(),this.top)}},{key:"insertNodeAtBottom",value:function(e){e&&this.inserting(e.getValues(),this.bottom)}},{key:"insert",value:function(e){this.inserting([e],this.root)}},{key:"createNode",value:function(e){var t=new(Function.prototype.bind.apply(i.BinaryTreeNode,[null].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(e))));return null===this.top?this.top=t:this.comparator(this.top.peek(),t.peek())<0&&(this.top=t),null===this.bottom?this.bottom=t:this.comparator(t.peek(),this.bottom.peek())<0&&(this.bottom=t),t}},{key:"inserting",value:function(e,t){if(null===this.root)return this.root=this.createNode(e),this.node_counter=1,void(this.duplicate_counter+=e.length-1);for(var n=null,r=t,i=0;null!==r;){if(0===(i=this.comparator(e[0],r.peek())))return r.concat(e),this.duplicate_counter+=e.length,void r.find(e[0]);n=r,r=i<0?r.getLeft():r.getRight()}++this.node_counter,this.duplicate_counter+=e.length-1,r=this.createNode(e),i<0?n.setLeft(r):n.setRight(r)}},{key:"getRightist",value:function(e){for(var t=null;null!==e.right;)t=e,e=e.right;return[e,t]}},{key:"getLeftist",value:function(e){for(var t=null;null!==e.getLeft();)t=e,e=e.getLeft();return[e,t]}},{key:"popBottomNode",value:function(){if(null===this.bottom)return null;var e=this.search(this.bottom.peek()),t=e[0],n=e[1];return null===t?null:(this.replaceNode(t,n,t.getRight()),this.disposeNode(t),--this.node_counter,this.duplicate_counter-=t.getLength()-1,t.setRight(null),t)}},{key:"popTopNode",value:function(){if(null===this.top)return null;var e=this.search(this.top.peek()),t=e[0],n=e[1];return null===t?null:(this.replaceNode(t,n,t.getLeft()),this.disposeNode(t),--this.node_counter,this.duplicate_counter-=t.getLength()-1,t.setLeft(null),t)}},{key:"search",value:function(e){for(var t=this.root,n=null,r=void 0;null!==t;){if(0===(r=this.comparator(e,t.peek())))return t.find(e)?[t,n]:[null,null];n=t,t=r<0?t.getLeft():t.getRight()}return[null,null]}},{key:"replaceNode",value:function(e,t,n){null!==t?t.left===e?t.left=n:t.right=n:this.root=n}},{key:"disposeNode",value:function(e){if(null!==e){if(null===this.root)return void(this.bottom=this.top=null);if(0===this.comparator(this.top.peek(),e.peek())){var t=this.getRightist(this.root);this.top=t[0]}if(0===this.comparator(this.bottom.peek(),e.peek())){var n=this.getLeftist(this.root);this.bottom=n[0]}}}},{key:"delete",value:function(e){var t=this.search(e),n=t[0],r=t[1];if(null===n)return!1;if(1<n.getLength())return n.remove(e),--this.duplicate_counter,!0;if(--this.node_counter,null===n.getLeft()&&null===n.getRight())this.replaceNode(n,r,null);else if(null===n.getLeft())this.replaceNode(n,r,n.getRight());else if(null===n.getRight())this.replaceNode(n,r,n.getLeft());else{for(var i=n.getLeft(),o=n;null!==i.getRight();o=i,i=i.getRight());var a=i.getLeft();o===n?o.setLeft(a):o.setRight(a),n.setValues(i.getValues())}return this.disposeNode(n),!0}},{key:"logging",value:function(){null!==this.root?(o.log("Size of the tree: "+this.getSize()+" Node: "+this.getNodeCounter()+" Duplicates: "+this.getDuplicatedCounter()+" Top: "+this.getTopNode().toString()+" Bottom: "+this.getBottomNode().toString()),function e(t,n,r){if(null!==t){for(var i="-",a=0;a<n;++a)i+="--";o.log(i+"> ("+r+") ["+t.toString()+"]"),null!==t.getLeft()&&e(t.getLeft(),n+1,"Left"),null!==t.getRight()&&e(t.getRight(),n+1,"Right")}}(this.root,0,"Root")):o.log("This tree is empty Duplicate Counter: "+this.duplicate_counter)}}]),e}();n.BinaryTree=a},{"../utility/csiologger":88,"./binarytreenode.js":24}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];this.values=n,this.left=null,this.right=null}return r(e,[{key:"getRight",value:function(){return this.right}},{key:"setRight",value:function(e){this.right=e}},{key:"getLeft",value:function(){return this.left}},{key:"setLeft",value:function(e){this.left=e}},{key:"push",value:function(e){this.values.push(e)}},{key:"concat",value:function(e){this.values=this.values.concat(e)}},{key:"pop",value:function(){return this.values.length<1?null:this.values.shift()}},{key:"remove",value:function(e){this.values.splice(this.values.indexOf(e),1)}},{key:"setValues",value:function(e){this.values=e}},{key:"getValues",value:function(){return this.values}},{key:"hasValue",value:function(){return 0<this.values.length}},{key:"getLength",value:function(){return this.values.length}},{key:"peek",value:function(){return this.values.length<1?null:this.values[0]}},{key:"find",value:function(e){return this.values.find(function(t){return t===e})}},{key:"toString",value:function(){return this.values.toString()}}]),e}();n.BinaryTreeNode=i},{}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Cache=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/csiologger")),o=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.queue=[],this.priority=[]}return r(e,[{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.length()>1e6?i.error("Maximum cached items reached, dropping."):t?this.priority.push(e):this.queue.push(e)}},{key:"pop",value:function(){return this.priority.length>0?this.priority.shift():this.queue.shift()}},{key:"peak",value:function(){return this.priority.length>0?this.priority[0]:this.queue.length>0?this.queue[0]:null}},{key:"length",value:function(){return this.queue.length+this.priority.length}},{key:"updateConferenceId",value:function(e){for(var t=0;t<this.queue.length;++t)this.queue[t].updateConferenceId(e);for(var n=0;n<this.priority.length;++n)this.priority[n].updateConferenceId(e)}}]),e}();n.Cache=o},{"../utility/csiologger":88}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Component=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./port"),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/csiologger")),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unknown";(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.name=t,this.ports=new Map}return r(e,[{key:"bindPort",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this.ports.has(e)?o.warn("Port ("+e+") for "+this.name+" already exists."):this.ports.set(e,new i.Port(t,n))}},{key:"declarePort",value:function(e){this.ports.has(e)?o.warn("Port ("+e+") for "+this.name+" already exists."):this.ports.set(e,null)}},{key:"getPort",value:function(e){return this.ports.get(e)}},{key:"isConnected",value:function(e){return!!this.ports.has(e)&&null!==this.ports.get(e)}},{key:"connect",value:function(e,t){this.ports.has(e)?this.ports.set(e,t):o.warn("Port ("+e+") for "+this.name+" does not exists.")}},{key:"transmit",value:function(e){var t=this.ports.get(e);if(void 0!==t)if(null!==t){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.transmit(r)}else o.warn("Port ("+e+") for "+this.name+" is not connected.");else o.warn("Port ("+e+") for "+this.name+" does not exists.")}},{key:"request",value:function(e){var t=this.ports.get(e);if(void 0===t)return o.warn("Port ("+e+") for "+this.name+" does not exists."),null;if(null===t)return o.warn("Port ("+e+") for "+this.name+" is not connected."),null;for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return t.request(r)}}]),e}();n.Component=a},{"../utility/csiologger":88,"./port":27}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.target=t,this.object=n}return r(e,[{key:"transmit",value:function(e){this.target.apply(this.object,e)}},{key:"request",value:function(e){return this.target.apply(this.object,e)}}]),e}();n.Port=i},{}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SlidingWindow=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./switem"),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/timestamps")),a=function(){function e(t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.items=[],this.plugins=[],this.postProcesses=[],this.preProcesses=[],this.timeoutInMs=n,this.maxItemsNum=t,this.minItemsNum=0}return r(e,[{key:"setMaxItemsNum",value:function(e){this.maxItemsNum=e}},{key:"setTimeoutInMs",value:function(e){this.timeoutInMs=e}},{key:"setMinItemsNum",value:function(e){this.minItemsNum=e}},{key:"refresh",value:function(){var e=o.getCurrent();if(!(this.items.length<=this.minItemsNum)){for(;0<this.maxItemsNum&&this.maxItemsNum<=this.items.length;)this.remove();this.timeoutInMs&&this.timeoutInMs<e-this.items[0].getCreated()&&(this.remove(),this.refresh())}}},{key:"getLength",value:function(){return this.items.length}},{key:"add",value:function(e){this.refresh(),this.items.push(new i.SWItem(e));for(var t=0;t<this.preProcesses.length;t++)(0,this.preProcesses[t])(e);for(var n=0;n<this.plugins.length;n++)this.plugins[n].add(e);for(var r=0;r<this.postProcesses.length;r++)(0,this.postProcesses[r])(e)}},{key:"remove",value:function(){for(var e=this.items.shift(),t=0;t<this.plugins.length;t++)this.plugins[t].remove(e.value)}},{key:"peek",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.items.length<=e?null:this.items[this.items.length-e-1].getValue()}},{key:"attach",value:function(e){this.plugins.push(e)}},{key:"addPreProcess",value:function(e){this.preProcesses.push(e)}},{key:"addPostProcess",value:function(e){this.postProcesses.push(e)}},{key:"detach",value:function(e){this.plugins=this.plugins.filter(function(t){return t!==e})}}]),e}();n.SlidingWindow=a},{"../utility/timestamps":99,"./switem":29}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SWItem=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/timestamps")),o=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.value=t,this.created=i.getCurrent()}return r(e,[{key:"getValue",value:function(){return this.value}},{key:"getCreated",value:function(){return this.created}},{key:"toString",value:function(){return""}}]),e}();n.SWItem=o},{"../utility/timestamps":99}],30:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.Conference=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../peerconnection/peerconnectionmanager"),a=r(e("../config/settings")),s=e("../utility/registry"),c=r(e("../browserapi/sessionstorage")),u=function(){function e(t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.conferenceId=t,this.startTime,this.peerConnectionManager=new o.PeerConnectionManager,this.credentials=n,this.ucId=null,this.url=null,this.userJoinedSent=!1}return i(e,[{key:"getCredentials",value:function(){return this.credentials}},{key:"getUcId",value:function(){return this.ucId}},{key:"setUcId",value:function(e){this.ucId=e,this.url=a.conferenceBaseUrl+s.Registry.getCredentials().getAppId()+"/conferences/"+encodeURIComponent(this.conferenceId)+"/"+e+"/general",c.storeUcId(this.conferenceId,e)}},{key:"getPeerConnectionManager",value:function(){return this.peerConnectionManager}},{key:"getUrl",value:function(){return this.url}},{key:"updateConferenceId",value:function(e){this.conferenceId=e,this.peerConnectionManager.updateConferenceId(e)}},{key:"close",value:function(e){}}]),e}();n.Conference=u},{"../browserapi/sessionstorage":21,"../config/settings":34,"../peerconnection/peerconnectionmanager":42,"../utility/registry":95}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ConferenceManager=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./conference"),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../config/constants")),a=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.conferenceMap=new Map}return r(e,[{key:"add",value:function(e,t){if(!this.get(e)){var n=new i.Conference(e,t);this.conferenceMap.set(e,n)}}},{key:"get",value:function(e){return this.conferenceMap.get(e)}},{key:"getConferenceForPc",value:function(e){var t=null;return e?(this.conferenceMap.forEach(function(n,r){var i=n.getPeerConnectionManager().getPcHandler(e);i&&i.getConferenceId()===r&&(t=n)}),t):t}},{key:"getConferenceForPcHash",value:function(e){var t=null;return e?(this.conferenceMap.forEach(function(n,r){var i=n.getPeerConnectionManager().getPcHandlerByHash(e);i&&i.getConferenceId()===r&&(t=n)}),t):t}},{key:"updateConferenceId",value:function(e){var t=o.tmpConferenceId,n=this.get(t);n&&(n.updateConferenceId(e),this.conferenceMap.set(e,n),this.conferenceMap.delete(t))}},{key:"getConferenceIds",value:function(){var e=[];return this.conferenceMap.forEach(function(t,n){e.push(n)}),e}}]),e}();n.ConferenceManager=a},{"../config/constants":33,"./conference":30}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.csError={httpError:"httpError",authError:"authError",wsChannelFailure:"wsChannelFailure",success:"success",csProtoError:"csProtoError",appConnectivityError:"appConnectivityError",tokenGenerationError:"tokenGenerationError",ok:"OK",authOngoing:"authOngoing",invalidWebRTCFunctionName:"Invalid WebRTC function name",invalidEndPointType:"Invalid EndPoint Type",invalidTransmissionDirection:"Invalid fabric transmission direction"},n.csErrorStrings={argumentError:"Argument missing/invalid",cryptoError:"Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API",fabricEventUnsupported:"Unsupported fabricEvent",fabricEventInvalid:"Invalid fabricEvents value",fabricUsageInvalid:"Invalid fabricUsage value",notInitialized:"SDK is not initialized or no Fabrics added",pcInvalid:"Invalid PeerConnection object passed",confereneDoesNotExist:"conferenceId does not exist",webRTCFunctionsInvalid:"Invalid webRTC functionName value",setProxyConfigInvokeError:"cannot be called if window.csioproxy is false",invalidWebRTCFunctionName:"Invalid WebRTC function name",invalidEndPointType:"Invalid EndPoint Type",invalidTransmissionDirection:"Invalid fabric transmission direction",apiaccesserror:"API access Error"},n.csErrorReason={csProtoError:"Protocol fields cannot be empty.",csNoAuthState:"Authentication state unavailable in server."},n.internalErrors={authOngoing:"authOngoing"},n.authErrorActions={RETRY:0,GET_NEW_TOKEN:1,REPORT_ERROR:2}},{}],33:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.logEvents={stateMachine:"stateMachine",log:"log",timing:"timing",error:"error",getStatsError:"getStatsError",restResponseError:"restResponseError"},n.fabricEvent={fabricSetupFailed:"fabricSetupFailed",fabricHold:"fabricHold",fabricResume:"fabricResume",audioMute:"audioMute",audioUnmute:"audioUnmute",videoPause:"videoPause",videoResume:"videoResume",fabricUsageEvent:"fabricUsageEvent",fabricTerminated:"fabricTerminated",screenShareStart:"screenShareStart",screenShareStop:"screenShareStop",dominantSpeaker:"dominantSpeaker",activeDeviceList:"activeDeviceList",applicationErrorLog:"applicationErrorLog"},n.internalFabricEvent={fabricSetup:"fabricSetup",fabricSetupFailed:"fabricSetupFailed",userJoined:"userJoined",userLeft:"userLeft",userAlive:"userAlive",ssrcMap:"ssrcMap",mediaPlaybackStart:"mediaPlaybackStart",mediaPlaybackSuspended:"mediaPlaybackSuspended",mediaPlaybackStalled:"mediaPlaybackStalled",oneWayMedia:"oneWayMedia",fabricStateChange:"fabricStateChange",iceDisruptionStart:"iceDisruptionStart",iceDisruptionEnd:"iceDisruptionEnd",fabricTransportSwitch:"fabricTransportSwitch",iceConnectionDisruptionStart:"iceConnectionDisruptionStart",iceConnectionDisruptionEnd:"iceConnectionDisruptionEnd",iceAborted:"iceAborted",iceTerminated:"iceTerminated",iceFailed:"iceFailed",iceRestarted:"iceRestarted",fabricDropped:"fabricDropped",connectedDeviceList:"connectedDeviceList",sdpSubmission:"sdpSubmissionEvent",sendingThroughputObservations:"sendingThroughputObservations",limitationObservations:"limitationObservations",userDetails:"userDetails"},n.callstatsChannels={sdpSubmission:"sdpSubmissionEvent",processedStats:"processedStats",callstatsEvent:"callStatsEvent",userFeedback:"userFeedbackEvent",preCallTest:"preCallTest",senderConfiguration:"senderConfiguration"},n.precalltestEvents={results:"preCallTestResults",associate:"preCallTestAssociate"},n.callstatsAPIReturnStatus={success:"success",failure:"failure"},n.fabricUsage={audio:"audio",video:"video",data:"data",screen:"screen",multiplex:"multiplex",unbundled:"unbundled"},n.userIdType={local:"local",remote:"remote"},n.qualityRating={excellent:5,good:4,fair:3,poor:2,bad:1},n.reportType={local:"local",remote:"remote",inbound:"inbound",outbound:"outbound"},n.avQualityRatings={excellent:"excellent",fair:"fair",bad:"bad",unknown:"unknown"},n.fabricState={established:"established",initializing:"initializing",failed:"failed",disrupted:"disrupted",hold:"hold",checkingDisrupted:"checkingDisrupted",terminated:"terminated"},n.webRTCFunctions={createOffer:"createOffer",createAnswer:"createAnswer",setLocalDescription:"setLocalDescription",setRemoteDescription:"setRemoteDescription",addIceCandidate:"addIceCandidate",getUserMedia:"getUserMedia",iceConnectionFailure:"iceConnectionFailure",signalingError:"signalingError",applicationError:"applicationError",applicationLog:"applicationLog"},n.callFailureReasons={mediaConfigError:"MediaConfigError",negotiationFailure:"NegotiationFailure",sdpError:"SDPGenerationError",iceFailure:"IceConnectionFailure",transportFailure:"TransportFailure",signalingError:"SignalingError",applicationError:"ApplicationError",applicationLog:"ApplicationLog",invalidWebRTCFunctionName:"Invalid WebRTC function name"},n.throughputThreshold={video:{green:1024,red:256},audio:{green:30,red:8}},n.currOverPrevFrameRateThreshold={video:{green:.8,red:.3}},n.rttThreshold={video:{green:400,red:1e3}},n.fractionalLossThreshold={video:{green:.1,red:.5},audio:{green:.15,red:.3}},n.eModelThreshold={audio:{green:240,red:400}},n.codeBaseType={chrome:"Chrome",firefox:"Firefox",edge:"Edge",plugin:"Plugin"},n.browserName={chrome:"Chrome",firefox:"Firefox",edge:"Edge",msie:"Microsoft Internet Explorer",safari:"Safari",opera:"Opera"},n.osName={windows:"Windows",mac:"Mac OS X",android:"Android",ios:"iOS"},n.mediaType={audio:"audio",video:"video"},n.streamType={inbound:"inbound",outbound:"outbound"},n.fabricStateChangeType={signalingState:"signalingState",iceConnectionState:"iceConnectionState",iceGatheringState:"iceGatheringState"},n.transportType={rest:"rest",ws:"ws"},n.wsConnectionState={initiated:"initiated",connected:"connected",closed:"closed"},n.csCallBackMessages={authSuccessful:"SDK authentication successful.",authFailed:"SDK authentication failed.",authProtocolInvalid:"Fatal authentication error. Invalid auth protocol message.",authOngoing:"Authentication on going.",wsConnected:"WebSocket establishment successful.",wsClosed:"WebSocket server closed.",wsFailed:"WebSocket establishment failed."},n.oneWayMediaTypes={audio:"audio",video:"video",screen:"screen"},n.limitationType={cpu:"cpu",network:"network"},n.qualityDisruptionTypes={qpchange:"qpchange"},n.callbackFunctions={stats:"stats",defaultConfig:"defaultConfig",recommendedConfig:"recommendedConfig",preCallTestResults:"preCallTestResults",preCallTest:"preCallTest"},n.endpointType={peer:"peer",server:"server"},n.transmissionDirection={sendonly:"sendonly",receiveonly:"receiveonly",sendrecv:"sendrecv",inactive:"inactive"},n.tmpConferenceId="csio-conf-id-tmp"},{}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.setConfigServiceUrl=function(e){n.configServiceUrl=e},n.setAuthServiceUrl=function(e){n.authServiceUrl=e},n.setConferenceBaseUrl=function(e){n.conferenceBaseUrl=e},n.setWsUrl=function(e){n.wsUrl=e},n.setRestEventUrl=function(e){n.restEventUrl=e},n.setRestStatsUrl=function(e){n.restStatsUrl=e},n.setBaseUrl=function(e){n.baseUrl=e},n.setQmodelThresholdsAPIUrl=function(e){n.qmodelThresholdsAPIUrl=e},n.setTransportType=function(e){n.transportType=e};n.version="3.53.4",n.configServiceUrl="https://appsettings.callstats.io/v1/apps/",n.authServiceUrl="https://auth.callstats.io/",n.authRetryTimeout=5e3,n.conferenceBaseUrl="https://dashboard.callstats.io/apps/",n.wsUrl="wss://collector.callstats.io:443/csiows/collectCallStats",n.restEventUrl="https://events.callstats.io/v1/apps/",n.restStatsUrl="https://stats.callstats.io/v1/apps/",n.baseUrl="https://collector.callstats.io:443/",n.qmodelThresholdsAPIUrl="https://dashboard.callstats.io/api-internal/v1/qmodelthresholds",n.csioDebug="false",n.transportType="@@transportType"},{}],35:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.MainFSM=n.MainEvents=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./statemachine"),c=e("../utility/registry"),u=r(e("../utility/csiologger")),l=r(e("../utility/utils")),d=r(e("../utility/timestamps")),f=r(e("../config/constants")),p=r(e("../config/settings")),h=r(e("./utility")),v=e("../statspipeline/statsadapter"),m=e("../statspipeline/statsparser"),g=e("../statspipeline/statsmonitor"),y=e("../statspipeline/statstransmitter"),b=e("../statspipeline/statsassembler"),S={Created:"Created",Initializing:"Initializing",Idle:"Idle",Run:"Run"},_=n.MainEvents={onStart:"onStart",onInitialize:"onInitialize",onAddNewFabric:"onAddNewFabric",onSendFabricEvent:"onSendFabricEvent",onReportError:"onReportError",onAssociateMstWithUserID:"onAssociateMstWithUserID",onSetProxyConfig:"onSetProxyConfig",onAttachWifiStatsHandler:"onAttachWifiStatsHandler",onSendUserFeedback:"onSendUserFeedback",onOn:"onOn",onSetIdentifiers:"onSetIdentifiers",onMakePrecallTest:"onMakePrecallTest"},E="onServicesFinished",C=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,S.Created));return u.log("FSM:",e.getState()),e.fire(_.onStart),e.run(),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t=Object(this),n=t.length>>>0,r=arguments[1],i=void 0,o=0;o<n;o++)if(i=t[o],e.call(r,i,o,t))return i}}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.StateMachine),a(t,[{key:"proceed",value:function(e,t){switch(this.getState()){case S.Created:switch(e){case _.onStart:this.onStart.apply(this,i(t));break;case _.onInitialize:this.setState(S.Initializing),u.log("FSM:",this.getState()),this.onInitialize.apply(this,i(t));break;case _.onOn:this.onOn.apply(this,i(t));break;case _.onSetProxyConfig:this.onSetProxyConfig.apply(this,i(t))}break;case S.Initializing:switch(e){case E:this.onServicesFinished()&&(this.setState(S.Idle),u.log("FSM:",this.getState()));break;case _.onAddNewFabric:this.onAddNewFabric.apply(this,i(t));break;case _.onSendFabricEvent:this.onSendFabricEvent.apply(this,i(t));break;case _.onReportError:this.onReportError.apply(this,i(t));break;case _.onAssociateMstWithUserID:this.onAssociateMstWithUserID.apply(this,i(t));break;case _.onSendUserFeedback:this.onSendUserFeedback.apply(this,i(t));break;case _.onAttachWifiStatsHandler:this.onAttachWifiStatsHandler.apply(this,i(t));break;case _.onOn:this.onOn.apply(this,i(t));break;case _.onMakePrecallTest:this.onMakePrecallTest.apply(this,i(t));break;case _.onSetIdentifiers:this.onSetIdentifiers.apply(this,i(t));break;case _.onSetProxyConfig:this.onSetProxyConfig.apply(this,i(t))}break;case S.Idle:case S.Run:switch(e){case _.onAddNewFabric:this.onAddNewFabric.apply(this,i(t));break;case _.onSendFabricEvent:this.onSendFabricEvent.apply(this,i(t));break;case _.onReportError:this.onReportError.apply(this,i(t));break;case _.onAssociateMstWithUserID:this.onAssociateMstWithUserID.apply(this,i(t));break;case _.onSendUserFeedback:this.onSendUserFeedback.apply(this,i(t));break;case _.onAttachWifiStatsHandler:this.onAttachWifiStatsHandler.apply(this,i(t));break;case _.onOn:this.onOn.apply(this,i(t));break;case _.onSetProxyConfig:this.onSetProxyConfig.apply(this,i(t));break;case _.onMakePrecallTest:this.onMakePrecallTest.apply(this,i(t));break;case _.onSetIdentifiers:this.onSetIdentifiers.apply(this,i(t))}}}},{key:"onStart",value:function(){c.Registry.getEndpoint().setup(),this.authenticator=c.Registry.getAuthenticator(),this.configservicewrapper=c.Registry.getConfigServiceWrapper(),this.precalltest=c.Registry.getPreCallTest(),this.precalltestIds=[];var e=c.Registry.getStatsAdapter(),t=c.Registry.getStatsParser(),n=c.Registry.getStatsMonitor(),r=c.Registry.getStatsTransmitter(),i=c.Registry.getStatsAssembler();e.connect(v.StatsAdapterIO.RawStatsOut,t.getPort(m.StatsParserIO.RawStatsIn)),t.connect(m.StatsParserIO.PcStatsTupleOut,n.getPort(g.StatsMonitorIO.PcStatsTupleIn)),n.connect(g.StatsMonitorIO.StatsTupleOut,i.getPort(b.StatsAssemblerIO.StatsTupleIn)),i.connect(b.StatsAssemblerIO.CallstatsOut,r.getPort(y.StatsTransmitterIO.CallstatsIn)),e.connect(v.StatsAdapterIO.UnprocessedOut,r.getPort(y.StatsTransmitterIO.UnprocessedIn))}},{key:"setupConnection",value:function(){var e=this;this.connectionManager=c.Registry.getConnectionManager(),this.connectionManager.setupCollectorConnection(c.Registry.getCredentials().getTransportType()),this.connectionManager.setup().then(function(){u.log("Connected to connectionManager"),e.fire(E),e.run()}).catch(function(e){return u.log("Could not connect to connectionManager",e)})}},{key:"setup",value:function(){var e=this;this.clocksync=c.Registry.getClockSync(),this.clocksync.initiate().then(function(){u.log("Clocksync completed"),e.fire(E),e.run()}).catch(function(e){return u.log("Could not finish ClockSync",e)})}},{key:"onInitialize",value:function(e,t,n,r,i,o){var a=this,s=c.Registry.getCredentials();s.setAppId(e),s.setUserId(t),c.Registry.getCallbacks().set(f.callbackFunctions.stats,i),this.doPrecalltest=!0,o&&(!0===o.disableBeforeUnloadHandler&&this.setBeforeUnloadHandler(),o.applicationVersion&&c.Registry.getEndpoint().setAppVersion(o.applicationVersion),o.transportType&&p.setTransportType(o.transportType),o.disablePrecalltest&&(this.doPrecalltest=!1)),this.setup(),this.authenticator.initiate(n,r).then(function(e){u.log("Authentication complete"),a.setupConnection();var t=c.Registry.getCredentials().getStatsSubmissionInterval();c.Registry.getStatsMonitor().setIntervals(t,t),a.fire(E),a.run();var n=a.authenticator.getIceServers();n&&a.doPrecalltest&&a.precalltest.start(n,"callstats",a.precalltestCallback.bind(a)),a.configservicewrapper.initiateInternalConfig().then(function(){u.log("ConfigService internal config:",a.configservicewrapper.getInternalConfig()),a.fire(E),a.run()},function(e){return u.log(e)}),a.configservicewrapper.initiateAppConfig().then(function(){var e=c.Registry.getCallbacks().get(f.callbackFunctions.defaultConfig),t=a.configservicewrapper.getAppDefaultConfig();e&&t&&e(t);var n=c.Registry.getCallbacks().get(f.callbackFunctions.recommendedConfig),r=a.configservicewrapper.getAppRecommendedConfig();n&&r&&n(r),a.fire(E),a.run()},function(e){return u.log(e)})},function(e){u.log(e)})}},{key:"precalltestCallback",value:function(e,t){var n=c.Registry.getCallbacks().get(f.callbackFunctions.preCallTestResults),r=c.Registry.getCallbacks().get(f.callbackFunctions.preCallTest);if(r&&r(e),n){if(t){var i={msg:"precalltest error: "+t};return u.warn("backendlog",i),c.Registry.getGenericEventHandler().sendEvent(f.logEvents.log,i),void n(f.callstatsAPIReturnStatus.failure,null)}var o=h.getPublicPrecalltestResults(e);n(f.callstatsAPIReturnStatus.success,o)}e&&(this.precalltestIds.push(e.id),e.tests&&e.tests.ice&&(""===e.tests.ice.turnIpAddress&&delete e.tests.ice.turnIpAddress,""===e.tests.ice.turnIpVersion&&delete e.tests.ice.turnIpVersion,""===e.tests.ice.turnTransport&&delete e.tests.ice.turnTransport),u.log("sending preCallTest results",e),c.Registry.getEventMessageBuilder().make(f.precalltestEvents.results,null,null,{results:e}))}},{key:"setBeforeUnloadHandler",value:function(){window&&window.addEventListener&&(u.log("setBeforeUnloadHandler"),window.addEventListener("beforeunload",function(e){return c.Registry.getConferenceManager().conferenceMap.forEach(function(e,t){e&&e.getPeerConnectionManager().pcHandlers.forEach(function(e,t){c.Registry.getEventMessageBuilder().make(f.internalFabricEvent.userLeft,e.getConferenceId(),e.getPeerConnection())})}),"Are you sure you want to close the call?"}))}},{key:"onServicesFinished",value:function(){return!!(this.connectionManager&&this.connectionManager.isReady()&&this.clocksync.isCompleted()&&this.authenticator.isCompleted())&&(c.Registry.getTransmissionManager().trySend(),!0)}},{key:"onAddNewFabric",value:function(e,t,n,r,i,o,a){u.warn("FSM onAddNewFabric"),c.Registry.getConferenceManager().add(r,c.Registry.getCredentials());var s=c.Registry.getConferenceManager().get(r);s.getPeerConnectionManager().addPcHandler(e,t,n,r,i,o,a);var l={endpointInfo:c.Registry.getEndpoint().serialize()};c.Registry.getCredentials().getUserIdObject()&&(l.localUserIDObject=c.Registry.getCredentials().getUserIdObject()),s.userJoinedSent||(c.Registry.getEventMessageBuilder().make(f.internalFabricEvent.userJoined,r,e,l),s.userJoinedSent=!0,c.Registry.getCredentials().getTransportType()===f.transportType.rest&&l.localUserIDObject&&l.localUserIDObject.userName&&c.Registry.getEventMessageBuilder().make(f.internalFabricEvent.userDetails,r,e,{userName:String(l.localUserIDObject.userName)}));var d=this.precalltestIds;this.precalltestIds=[];var p=this.precalltest.getId();p&&d.push(p),d.length>0&&c.Registry.getEventMessageBuilder().make(f.precalltestEvents.associate,r,e,{ids:d})}},{key:"onSendFabricEvent",value:function(e,t,n,r){u.warn("FSM onSendFabricEvent");var i={};r&&((i=r).ssrc&&(i.ssrc=String(i.ssrc))),t===f.fabricEvent.activeDeviceList&&(i={mediaDeviceList:l.normalizeMediaDeviceList(r.deviceList)}),c.Registry.getEventMessageBuilder().make(t,n,e,i);var o=c.Registry.getConferenceManager().get(n);if(o){var a=o.getPeerConnectionManager().getPcHandler(e);t!==f.fabricEvent.fabricTerminated&&t!==f.internalFabricEvent.fabricSetupFailed||(a.stopUserAliveHandler(),a.setPcState(f.fabricState.terminated),a.stopStatsPolling()),t===f.fabricEvent.fabricHold&&(a.setPcState(f.fabricState.hold),a.stopStatsPolling()),t===f.fabricEvent.fabricResume&&(a.setPcState(f.fabricState.established),a.startStatsPolling())}}},{key:"onReportError",value:function(e,t,n,r,i,o){u.warn("FSM onReportError");var a={failureDelay:0,reason:this.callFailureClassifier(n),function:n,magicKey:c.Registry.getEndpoint().getMagicKey(),endpoint:c.Registry.getEndpoint().serialize(),level:"debug"};if(r){var s=this.formatDomError(r);a.message=s.message,a.messageType=s.messageType,a.name=r.name,a.stack=r.stack}if(e){var l=c.Registry.getConferenceManager().get(t),p=void 0;if(l&&(p=l.getPeerConnectionManager().getPcHandler(e)),!p)return void u.error("onReportError: No handler found for given PeerConnection!");if(a.failureDelay=d.getCurrent()-p.getStartTime(),a.fabricState=p.getPcState(),a.iceConnectionState=p.getIceConnectionState(),(i||o||e&&"closed"!==e.signalingState)&&c.Registry.getCredentials().getCollectSDP()&&n===f.fabricEvent.fabricSetupFailed){var h={};h.localSDP=this.pickSDP(e,i,"localDescription"),h.remoteSDP=this.pickSDP(e,o,"remoteDescription"),c.Registry.getEventMessageBuilder().make(f.callstatsChannels.sdpSubmission,t,e,h)}}n===f.webRTCFunctions.applicationLog||n===f.webRTCFunctions.applicationError?c.Registry.getEventMessageBuilder().make(f.fabricEvent.applicationErrorLog,t,e,a):n===f.webRTCFunctions.iceConnectionFailure?this.handleIceConnectionFailure(e,t,a):(c.Registry.getEventMessageBuilder().make(f.fabricEvent.fabricSetupFailed,t,e,a),n===f.webRTCFunctions.getUserMedia&&this.handleGUMErrors(t))}},{key:"onAssociateMstWithUserID",value:function(e,t,n,r,i,o){var a=c.Registry.getConferenceManager().get(n);a&&("string"!=typeof r&&(r+=""),a.getPeerConnectionManager().getPcHandler(e).updateSSRCInfo(r,t,i,o))}},{key:"onAttachWifiStatsHandler",value:function(e){c.Registry.getWifiStatsExecutor().setGetWifiStatsMethod(e)}},{key:"onSetProxyConfig",value:function(e){u.warn("FSM onSetProxyConfig"),e.collectorURL&&p.setBaseUrl(e.collectorURL),e.authServiceURL&&p.setAuthServiceUrl(e.authServiceURL),e.csioInternalAPIURL&&p.setQmodelThresholdsAPIUrl(e.csioInternalAPIURL),e.wsURL&&p.setWsUrl(e.wsURL),e.restEventURL&&p.setRestEventUrl(e.restEventURL),e.restStatsURL&&p.setRestStatsUrl(e.restStatsURL),e.appSettingsURL&&p.setConfigServiceUrl(e.appSettingsURL)}},{key:"onSendUserFeedback",value:function(e,t,n){var r={feedback:{overallRating:t.overall}};t.video&&(r.feedback.videoQualityRating=t.video),t.audio&&(r.feedback.audioQualityRating=t.audio),t.comment&&(r.feedback.comments=t.comment),c.Registry.getEventMessageBuilder().make(f.callstatsChannels.userFeedback,e,null,r)}},{key:"onOn",value:function(e,t){c.Registry.getCallbacks().set(e,t)}},{key:"onSetIdentifiers",value:function(e,t){if(e.conferenceID&&(c.Registry.getConferenceManager().updateConferenceId(e.conferenceID),c.Registry.getTransmissionManager().updateConferenceId(e.conferenceID),c.Registry.getTransmissionManager().trySend()),e.remoteUserID&&t){var n=c.Registry.getConferenceManager().getConferenceForPc(t);if(!n)return void u.log("onSetIdentifiers conference not found");var r=n.getPeerConnectionManager().getPcHandler(t);if(!r)return void u.log("pcHandler not found");r.updateRemoteId(e.remoteUserID),c.Registry.getTransmissionManager().trySend()}}},{key:"onMakePrecallTest",value:function(e,t){var n=this,r=e,i=t||"callstats";e||(r=this.authenticator.getIceServers(),i="callstats"),n.precalltest.start(r,i,n.precalltestCallback.bind(n))}},{key:"handleIceConnectionFailure",value:function(e,t,n){if(e){var r=c.Registry.getConferenceManager().get(t),i=void 0;if(r&&(i=r.getPeerConnectionManager().getPcHandler(e)),i)if(i.isFabricSetupSent()){var o={localIceCandidates:[],remoteIceCandidates:[],iceCandidatePairs:[]};o.delay=d.getCurrent()-i.getStartTime(),o.currIceConnectionState="failed",o.prevIceConnectionState="disconnected",c.Registry.getEventMessageBuilder().make(f.internalFabricEvent.iceFailed,t,e,o)}else n.failureDelay=d.getCurrent()-i.getStartTime(),n.fabricState=i.getPcState(),n.iceConnectionState=i.getIceConnectionState(),c.Registry.getEventMessageBuilder().make(f.fabricEvent.fabricSetupFailed,t,e,n)}}},{key:"handleGUMErrors",value:function(e){var t=c.Registry.getConferenceManager().get(e);if(t||(c.Registry.getConferenceManager().add(e,c.Registry.getCredentials()),t=c.Registry.getConferenceManager().get(e)),!t.getUcId()){var n={endpointInfo:c.Registry.getEndpoint().serialize()};c.Registry.getEventMessageBuilder().make(f.internalFabricEvent.userJoined,e,null,n),t.userJoinedSent=!0}}},{key:"callFailureClassifier",value:function(e){var t=void 0;return f.webRTCFunctions.hasOwnProperty(e)?e===f.webRTCFunctions.createOffer||e===f.webRTCFunctions.createAnswer||e===f.webRTCFunctions.setRemoteDescription?t=f.callFailureReasons.negotiationFailure:e===f.webRTCFunctions.setLocalDescription?t=f.callFailureReasons.sdpError:e===f.webRTCFunctions.addIceCandidate?t=f.callFailureReasons.sdpError:e===f.webRTCFunctions.getUserMedia?t=f.callFailureReasons.mediaConfigError:e===f.webRTCFunctions.iceConnectionFailure?t=f.callFailureReasons.iceFailure:e===f.webRTCFunctions.signalingError?t=f.callFailureReasons.signalingError:(e===f.webRTCFunctions.applicationLog||f.webRTCFunctions.applicationError)&&(t=f.callFailureReasons.applicationLog):t=f.callFailureReasons.invalidWebRTCFunctionName,t}},{key:"formatDomError",value:function(e){var t={},n={};e&&(window.DOMException&&e instanceof window.DOMException?(n.message=e.message,n.name=e.name,t.messageType="domError"):"object"===(void 0===e?"undefined":o(e))?(e.message&&(n.message=e.message),e.name&&(n.name=e.name),e.constraintName&&(n.name=e.constraintName),e.stack&&(n.stack=e.stack),t.messageType="json"):(n=e,t.messageType="text"));var r=this.truncateLog(n);return"object"===(void 0===r?"undefined":o(r))?t.message=JSON.stringify(r):t.message=r,t}},{key:"pickSDP",value:function(e,t,n){return t||(e&&e[n]?e[n].sdp:"")}},{key:"truncateString",value:function(e){return e.length>2e4&&(u.log("Log exceeds 20kb, It will be truncated"),e=e.substring(0,2e4)),e}},{key:"truncateLog",value:function(e){return e?("string"==typeof e?e=this.truncateString(e):"object"===(void 0===e?"undefined":o(e))&&e.message&&(e.message=this.truncateString(e.message)),e):e}}]),t}();n.MainFSM=C},{"../config/constants":33,"../config/settings":34,"../statspipeline/statsadapter":69,"../statspipeline/statsassembler":70,"../statspipeline/statsmonitor":72,"../statspipeline/statsparser":73,"../statspipeline/statstransmitter":74,"../utility/csiologger":88,"../utility/registry":95,"../utility/timestamps":99,"../utility/utils":101,"./statemachine":37,"./utility":38}],36:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.type=t,this.args=void 0!==n?n:null}return r(e,[{key:"getType",value:function(){return this.type}},{key:"getArgs",value:function(){return this.args}}]),e}();n.ProgramEvent=i},{}],37:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.StateMachine=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./programevent"),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/csiologger")),a=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.events=[],this.state=t}return r(e,[{key:"fire",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=new i.ProgramEvent(e,n);this.events.push(o)}},{key:"proceed",value:function(e,t){o.warn("You need to overwrite the proceed function inan extended StateMachine")}},{key:"setState",value:function(e){this.state=e}},{key:"getState",value:function(){return this.state}},{key:"run",value:function(){if(!(this.events.length<1)){var e=this.events.shift();this.proceed(e.getType(),e.getArgs())}}}]),e}();n.StateMachine=a},{"../utility/csiologger":88,"./programevent":36}],38:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getPublicPrecalltestResults=function(e){var t={mediaConnectivity:!1,throughput:null,fractionalLoss:null,rtt:null};return e&&e.tests?(t.provider=e.provider,e.tests.rtt&&(t.rtt=e.tests.rtt.median,t.mediaConnectivity=!0),e.tests.throughput&&(t.throughput=e.tests.throughput.average,t.fractionalLoss=Math.max(e.tests.throughput.fractionLostBytes,0),t.mediaConnectivity=!0),e.tests.ice&&(e.tests.ice.relayTcpSuccess||e.tests.ice.relayTlsSuccess||e.tests.ice.relayUdpSuccess)&&(t.mediaConnectivity=!0),t):t}},{}],39:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.GetStatsHandler=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=r(e("../config/constants")),a=e("../statspipeline/statsadapter"),s=e("../utility/registry"),c=e("../utility/rttregistry"),u=r(e("../utility/csiologger")),l=function(){function e(t,n,r,i,o){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.pc=t,this.interval=r,this.codeBase=i,this.browserName=o,this.getStatsTimer=null,this.isPromiseBased=!0,this.pcHash=n,this.genericevent=s.Registry.getGenericEventHandler()}return i(e,[{key:"startStatsPolling",value:function(){var e=this;e.getStatsTimer||(u.log("startStatsPolling for ",e.pcHash),this.getStatsTimer=setInterval(function(){e.csioGetStats(e.statsHandler,e.pcHash)},e.interval))}},{key:"stopStatsPolling",value:function(){this.getStatsTimer&&(clearInterval(this.getStatsTimer),this.getStatsTimer=null)}},{key:"csioGetStats",value:function(e,t){var n=o.codeBaseType.firefox,r=o.codeBaseType.chrome,i=o.codeBaseType.edge,a=o.browserName.safari;if(this.pc){if("closed"===this.pc.iceConnectionState)return void this.stopStatsPolling();try{this.isTemaSys()?this.getStatsTemasys(e,t):this.codeBase===n?this.getStatsFirefox(e,t):this.browserName===a?this.getStatsSafari(e,t):this.codeBase===r?this.getStatsChrome(e,t):this.codeBase===i&&this.getStatsEdge(e,t)}catch(e){u.log("csioGetStats: Error ",e)}}}},{key:"getStatsTemasys",value:function(e,t){this.pc.getStats(null,function(n){e(n,t)},function(e){u.log("getStatsTemasys error",e)})}},{key:"getStatsFirefox",value:function(e,t){var n=this,r=this.pc;if(n.isPromiseBased)try{r.getStats().then(function(n){e(n,t)}).catch(function(i){n.isPromiseBased=!1,r.getStats(null,function(n){e(n,t)})})}catch(i){n.isPromiseBased=!1,n.genericevent.sendEvent(o.logEvents.getStatsError,{msg:"Firefox getStats reports error ",error:i.message+":"+i.stack}),r.getStats(null,function(n){e(n,t)})}else r.getStats(null,function(n){e(n,t)})}},{key:"getStatsChrome",value:function(e,t){var n=this,r=n.pc;if(window&&window.csioReactNative)r.getStats(null,function(n){e(n,t)},function(e){n.genericevent.sendEvent(o.logEvents.getStatsError,{msg:"react-native getStats reports error",error:e.message+":"+e.stack})});else if(n.isPromiseBased)try{r.getStats().then(function(n){(0,c.getRTTRegistry)().update(r),e(n,t)}).catch(function(i){u.log("Chrome getStats Error ",i),n.isPromiseBased=!1,n.genericevent.sendEvent(o.logEvents.getStatsError,{msg:"Chrome getStats reports error",error:i.message+":"+i.stack}),r.getStats(function(n){e(n,t)})})}catch(i){n.isPromiseBased=!1,n.genericevent.sendEvent(o.logEvents.getStatsError,{msg:"Chrome getStats reports error",error:i.message+":"+i.stack}),r.getStats(function(n){e(n,t)})}else r.getStats(function(n){e(n,t)})}},{key:"getStatsEdge",value:function(e,t){var n=this;n.pc.getStats().then(function(n){e(n,t)}).catch(function(r){e({},t),r?n.genericevent.sendEvent(o.logEvents.getStatsError,{msg:"Edge getStats reports error",error:r.message+":"+r.stack}):n.genericevent.sendEvent(o.logEvents.getStatsError,{msg:"Edge getStats reports error"})})}},{key:"getStatsSafari",value:function(e,t){var n=this;n.pc.getStats().then(function(n){e(n,t)}).catch(function(e){n.genericevent.sendEvent(o.logEvents.getStatsError,{msg:"Safari getStats reports error",error:e.message+":"+e.stack})})}},{key:"statsHandler",value:function(e,t){var n=s.Registry.getStatsAdapter();if(e&&n)try{n.transmit(a.StatsAdapterIO.RawStatsIn,e,t)}catch(e){u.log("statsHandler 123: Error ",e),s.Registry.getGenericEventHandler().sendEvent(o.logEvents.error,{msg:"statsHandler: Error",error:e.message+":"+e.stack})}}},{key:"iceCandidatesHandler",value:function(e,t){t(s.Registry.getStatsAdapter().getIceCandidates(e))}},{key:"getIceCandidates",value:function(){var e=this;return new Promise(function(t,n){e.csioGetStats(e.iceCandidatesHandler,function(e){t(e)})})}},{key:"isTemaSys",value:function(){return!!(window&&window.AdapterJS&&window.AdapterJS.WebRTCPlugin&&window.AdapterJS.WebRTCPlugin.plugin)}}]),e}();n.GetStatsHandler=l},{"../config/constants":33,"../statspipeline/statsadapter":69,"../utility/csiologger":88,"../utility/registry":95,"../utility/rttregistry":96}],40:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.PcCallbackHandler=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=r(e("../config/constants")),a=e("../utility/registry"),s=r(e("../utility/timestamps")),c=r(e("../config/callstatserrors")),u=r(e("../utility/csiologger")),l=function(){function e(t,n,r,i,c,l){var d=this;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),n&&(this.conferenceId=t,this.pc=n,this.getStatsHandler=r,this.userAlive=i,this.callback=l,this.remoteId=c,this.clocksync=a.Registry.getClockSync(),this.emb=a.Registry.getEventMessageBuilder(),this.precalltest=a.Registry.getPreCallTest(),this.genericevent=a.Registry.getGenericEventHandler(),this.iceCandidates=[],this.iceConnectionState=n.iceConnectionState,this.iceGatheringState=n.iceGatheringState,this.signalingState=n.signalingState,this.oldIceConnectionState="",this.oldIceGatheringState="",this.iceConnectionStateTS="",this.negotiationNeeded=0,this.pcState=o.fabricState.initializing,this.disruptedTS=0,this.connectionDisruptedTS=0,this.startTime=s.getCurrent(),this.established=!1,this.activeIceCandidatePair=null,this.prevActiveIceCandidatePair=null,this.localIceCandidates=[],this.remoteIceCandidates=[],this.iceCandidatePairs=[],this.iceConnectivityDelay=0,this.iceGatheringDelay=0,this.fabricSetupSent=!1,this.pc&&this.pc.addEventListener?(this.pc.addEventListener("icecandidate",this.iceCandidateCallback.bind(this),!1),this.pc.addEventListener("iceconnectionstatechange",this.iceConnectionStateChangeCallback.bind(this),!1),this.pc.addEventListener("signalingstatechange",this.pcSignalingStateChangeCallback.bind(this),!1),this.pc.addEventListener("negotiationneeded",this.pcNegotiationNeededCallback.bind(this),!1)):this.pc&&this.pc.attachEvent?(u.info("attachEvent"),this.pc.attachEvent("onicecandidate",this.iceCandidateCallback.bind(this)),this.pc.attachEvent("oniceconnectionstatechange",this.iceConnectionStateChangeCallback.bind(this)),this.pc.attachEvent("onsignalingstatechange",this.pcSignalingStateChangeCallback.bind(this)),this.pc.attachEvent("onnegotiationneeded",this.pcNegotiationNeededCallback.bind(this))):u.error("callstats cannot monitor or collect stats"),!n||"connected"!==n.iceConnectionState&&"completed"!==n.iceConnectionState||(this.pcState=o.fabricState.established,this.getStatsHandler.getIceCandidates().then(function(e){d.localIceCandidates=e.localIceCandidates,d.remoteIceCandidates=e.remoteIceCandidates,d.iceCandidatePairs=e.iceCandidatePairs,d.prevActiveIceCandidatePair=d.activeIceCandidatePair,d.activeIceCandidatePair=d.getActiveIceCandidatePair(),d.sendfabricSetup(),d.startStatsPolling()})))}return i(e,[{key:"iceCandidateCallback",value:function(e){if(e&&e.candidate){var t=e.candidate.candidate.split(" ");if("0"!==t[4]&&"0"!==t[5]){var n=-1!==t[4].indexOf(":"),r="1"===t[1]?"rtp":"rtcp",i={transport:t[2],protocol:r,typePreference:t[3],address:n?"["+t[4]+"]:"+t[5]:t[4]+":"+t[5],type:t[7],media:e.candidate.sdpMid};-1===this.iceCandidates.indexOf(i)&&(this.iceCandidates.push(i),u.warn("CALLBACK: ICE candidate",i))}}}},{key:"iceConnectionStateChangeCallback",value:function(e){var t=this;if(e){u.log("pc states ",this.pc.iceGatheringState,this.pc.iceConnectionState),this.iceConnectionStateTS=this.clocksync.getSynchronizedTimestamp(),this.handleIceGatheringState(),this.handleIceConnectionState(),u.log("states ",this.iceGatheringState,this.iceConnectionState),"complete"===this.iceGatheringState&&"checking"===this.iceConnectionState&&this.handleIceChecking();var n={prevIceConnectionState:this.oldIceConnectionState,currIceConnectionState:this.iceConnectionState},r=this.iceConnectionState;this.getStatsHandler.getIceCandidates().then(function(e){t.localIceCandidates=e.localIceCandidates,t.remoteIceCandidates=e.remoteIceCandidates,t.iceCandidatePairs=e.iceCandidatePairs,t.prevActiveIceCandidatePair=t.activeIceCandidatePair,t.activeIceCandidatePair=t.getActiveIceCandidatePair(),"connected"===r||"completed"===r?t.handleIceConnectedOrCompleted(n):"failed"===r?t.handleIceFailed(n):"disconnected"===r?t.handleIceDisconnected(n):"closed"===r?t.handleIceClosed(n):"new"===r&&t.handleIceRestart(n)})}}},{key:"sendFabricStateChange",value:function(e){this.emb.make(o.internalFabricEvent.fabricStateChange,this.conferenceId,this.pc,e)}},{key:"handleIceConnectionState",value:function(){this.oldIceConnectionState=this.iceConnectionState,this.iceConnectionState=this.pc.iceConnectionState,u.warn("CALLBACK: ICE connection state change",this.oldIceConnectionState,"->",this.iceConnectionState);var e={changedState:o.fabricStateChangeType.iceConnectionState,prevState:this.oldIceConnectionState,newState:this.iceConnectionState};this.sendFabricStateChange(e)}},{key:"handleIceGatheringState",value:function(){if(this.iceGatheringState!==this.pc.iceGatheringState){"complete"===this.pc.iceGatheringState&&(this.iceGatheringDelay=s.getCurrent()-this.startTime),this.oldIceGatheringState=this.iceGatheringState,this.iceGatheringState=this.pc.iceGatheringState,u.warn("CALLBACK: ICE gathering state change",this.oldIceGatheringState,"->",this.iceGatheringState);var e={changedState:o.fabricStateChangeType.iceGatheringState,prevState:this.oldIceGatheringState,newState:this.iceGatheringState};this.sendFabricStateChange(e)}}},{key:"handleIceChecking",value:function(){var e=s.getCurrent();if("disconnected"===this.oldIceConnectionState&&(this.pcState===o.fabricState.checkingDisrupted||this.pcState===o.fabricState.disrupted)){var t={prevIceConnectionState:this.oldIceConnectionState,currIceConnectionState:this.iceConnectionState,delay:e-this.connectionDisruptedTS};this.pcState===o.fabricState.disrupted&&(t.prevIceCandidatePair=this.prevActiveIceCandidatePair,t.currIceCandidatePair=this.activeIceCandidatePair,t.delay=e-this.disruptedTS,this.emb.make(o.internalFabricEvent.iceDisruptionEnd,this.conferenceId,this.pc,t)),this.pcState=o.fabricState.initializing,this.emb.make(o.internalFabricEvent.iceConnectionDisruptionEnd,this.conferenceId,this.pc,t)}}},{key:"handleIceConnectedOrCompleted",value:function(e){var t=s.getCurrent();this.pcState===o.fabricState.disrupted&&(e.prevIceCandidatePair=this.prevActiveIceCandidatePair,e.currIceCandidatePair=this.activeIceCandidatePair,e.delay=t-this.disruptedTS,this.emb.make(o.internalFabricEvent.iceDisruptionEnd,this.conferenceId,this.pc,e)),this.iceConnectivityDelay=t-this.startTime,this.established=!0,this.pcState=o.fabricState.established,this.sendfabricSetup(),this.startStatsPolling()}},{key:"sendfabricSetup",value:function(){if(this.fabricSetupSent)u.log("fabricSetup has been sent already");else{var e={delay:s.getCurrent()-this.startTime,iceGatheringDelay:this.iceGatheringDelay,iceConnectivityDelay:this.iceConnectivityDelay,localIceCandidates:this.localIceCandidates,remoteIceCandidates:this.remoteIceCandidates,iceCandidatePairs:this.iceCandidatePairs},t=this.getActiveIceCandidatePair();t&&(e.selectedCandidatePairID=t.id),this.fabricSetupSent=!0;var n=void 0;this.conferenceId&&(n=a.Registry.getConferenceManager().get(this.conferenceId).getPeerConnectionManager().getPcHandler(this.pc),e.remoteEndpointType=n.getRemoteEndpointType(),e.fabricTransmissionDirection=n.getFabricTransmissionDirection()),this.pcState=o.fabricState.established,this.emb.make(o.internalFabricEvent.fabricSetup,this.conferenceId,this.pc,e)}}},{key:"isFabricSetupSent",value:function(){return this.fabricSetupSent}},{key:"startStatsPolling",value:function(){this.getStatsHandler.startStatsPolling()}},{key:"stopStatsPolling",value:function(){this.getStatsHandler.stopStatsPolling()}},{key:"handleIceFailed",value:function(e){e.currIceCandidatePair=this.activeIceCandidatePair,e.failureDelay=s.getCurrent()-this.startTime,e.delay=s.getCurrent()-this.startTime,this.pcState=o.fabricState.failed,"checking"===e.prevIceConnectionState?this.sendIceFailed(e):"completed"===e.prevIceConnectionState||"connected"===e.prevIceConnectionState?this.emb.make(o.internalFabricEvent.fabricDropped,this.conferenceId,this.pc,e):"disconnected"===e.prevIceConnectionState&&this.established?this.emb.make(o.internalFabricEvent.fabricDropped,this.conferenceId,this.pc,e):"disconnected"===e.prevIceConnectionState&&this.sendIceFailed(e)}},{key:"getActiveIceCandidatePair",value:function(){var e=null,t=this.iceCandidatePairs;if(t&&t.length>0){var n=t.filter(function(e){return"true"===e.selected||"true"===e.googActiveConnection||!0===e.selected||!0===e.googActiveConnection});n.length>0&&(e=n[0])}return e}},{key:"sendIceFailed",value:function(e){e.localIceCandidates=this.localIceCandidates,e.remoteIceCandidates=this.remoteIceCandidates,e.iceCandidatePairs=this.iceCandidatePairs,u.log("sending icefailed ",e),this.emb.make(o.internalFabricEvent.iceFailed,this.conferenceId,this.pc,e)}},{key:"sendFabricTransportSwitch",value:function(e){var t=this,n={};n.prevIceCandidatePair=t.activeIceCandidatePair,n.relayType=e,n.currIceConnectionState=t.iceConnectionState,n.prevIceConnectionState=t.oldIceConnectionState,n.switchDelay=null,t.getStatsHandler.getIceCandidates().then(function(e){t.localIceCandidates=e.localIceCandidates,t.remoteIceCandidates=e.remoteIceCandidates,t.iceCandidatePairs=e.iceCandidatePairs,t.activeIceCandidatePair=t.getActiveIceCandidatePair(),n.currIceCandidatePair=t.activeIceCandidatePair,n.localIceCandidates=t.localIceCandidates,n.remoteIceCandidates=t.remoteIceCandidates,u.log("sending fabric transport switch ",n),"completed"!==n.currIceConnectionState&&"connected"!==n.currIceConnectionState||"completed"!==n.prevIceConnectionState&&"connected"!==n.prevIceConnectionState||t.emb.make(o.internalFabricEvent.fabricTransportSwitch,t.conferenceId,t.pc,n)})}},{key:"handleIceDisconnected",value:function(e){var t=s.getCurrent();this.startTime=t,e.prevIceConnectionStateTs=this.iceConnectionStateTS,e.currIceCandidatePair=this.activeIceCandidatePair,"connected"===e.prevIceConnectionState||"completed"===e.prevIceConnectionState?(this.pcState=o.fabricState.disrupted,this.disruptedTS=t,this.emb.make(o.internalFabricEvent.iceDisruptionStart,this.conferenceId,this.pc,e),this.callback&&this.callback(c.csError.appConnectivityError,"Connectivity check for PC object to "+this.remoteId+" failed.")):"checking"===e.prevIceConnectionState&&(this.pcState=o.fabricState.checkingDisrupted,this.connectionDisruptedTS=t,this.emb.make(o.internalFabricEvent.iceConnectionDisruptionStart,this.conferenceId,this.pc,e),this.callback&&this.callback(c.csError.appConnectivityError,"Connectivity check for PC object to "+this.remoteId+" failed."))}},{key:"handleIceClosed",value:function(e){"new"===e.prevIceConnectionState||"checking"===e.prevIceConnectionState?(e.failureDelay=s.getCurrent()-this.startTime,e.localIceCandidates=this.localIceCandidates,e.remoteIceCandidates=this.remoteIceCandidates,e.iceCandidatePairs=this.iceCandidatePairs,this.emb.make(o.internalFabricEvent.iceAborted,this.conferenceId,this.pc,e)):"connected"!==e.prevIceConnectionState&&"completed"!==e.prevIceConnectionState||(e.prevIceCandidatePair=this.activeIceCandidatePair,this.emb.make(o.internalFabricEvent.iceTerminated,this.conferenceId,this.pc,e)),this.pcState=o.fabricState.terminated,this.stopStatsPolling()}},{key:"handleIceRestart",value:function(e){e.prevIceCandidatePair=this.prevActiveIceCandidatePair,"new"!==e.prevIceConnectionState&&(u.log("iceRestarted sending"),this.established=!1,this.emb.make(o.internalFabricEvent.iceRestarted,this.conferenceId,this.pc,e))}},{key:"pcSignalingStateChangeCallback",value:function(e){var t=this;if(e){var n=this.signalingState;this.signalingState=this.pc.signalingState,u.warn("CALLBACK: signaling state change",n,"->",this.signalingState);var r={changedState:o.fabricStateChangeType.signalingState,prevState:n,newState:this.signalingState};this.sendFabricStateChange(r),"have-remote-offer"!==this.signalingState&&"stable"!==this.signalingState||(this.precalltest.callStarts(),this.genericevent.sendEvent(o.logEvents.log,{msg:"precalltest told to stop "})),"closed"===this.signalingState&&(this.emb.make(o.fabricEvent.fabricTerminated,this.conferenceId,this.pc),this.userAlive.stop(),this.precalltest.callFinished(),this.stopStatsPolling(),this.pcState=o.fabricState.terminated),"have-local-offer"!==this.signalingState&&"have-local-pranswer"!==this.signalingState&&"stable"!==this.signalingState||(u.log(this.signalingState,".. requesting sender config."),a.Registry.getConfigServiceWrapper().initiateSenderConfig(this.pc).then(function(){var e=a.Registry.getConfigServiceWrapper().getSenderConfig();u.log("Sender config:",e);var n=o.callstatsChannels.senderConfiguration;e&&a.Registry.getEventMessageBuilder().make(n,t.conferenceId,t.pc,e)}).catch(function(e){u.warn(e)}))}}},{key:"pcNegotiationNeededCallback",value:function(e){e&&(this.negotiationNeeded++,this.startTime=s.getCurrent(),u.warn("CALLBACK: negotiation needed",this.negotiationNeeded))}}]),e}();n.PcCallbackHandler=l},{"../config/callstatserrors":32,"../config/constants":33,"../utility/csiologger":88,"../utility/registry":95,"../utility/timestamps":99}],41:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.PeerConnectionHandler=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("../utility/registry"),s=e("../peerconnection/pccallbackhandler"),c=e("../browserapi/devices"),u=e("./useralivehandler"),l=e("./getstatshandler"),d=r(e("../config/constants")),f=r(e("../utility/timestamps")),p=r(e("../utility/csiologger")),h=function(){function e(t){i(this,e),this.pc=t.pc,this.remoteId=t.remoteId,this.fabricUsage=t.fabricUsage,this.callback=t.callback,this.conferenceId=t.conferenceId,this.remoteEndpointType=t.remoteEndpointType,this.fabricTransmissionDirection=t.fabricTransmissionDirection,this.clocksync=a.Registry.getClockSync(),this.startTime=this.clocksync.getSynchronizedTimestamp(),this.credentials=a.Registry.getCredentials(),this.pcHash=this.generatePcHash(),this.ssrcMap=new Map,this.localSdp=null,this.remoteSdp=null,this.transportInfo=null,this.userAliveHandler=new u.UserAliveHandler(this.conferenceId,this.pc),this.userAliveHandler.start(),this.emb=a.Registry.getEventMessageBuilder(),this.devices=new c.Devices(this.conferenceId,this.pc);var n=a.Registry.getEndpoint();this.getStatsHandler=new l.GetStatsHandler(this.pc,this.pcHash,5e3,n.getCodeBase(),n.getBrowserName()),this.pcCallbackHandler=new s.PcCallbackHandler(this.conferenceId,this.pc,this.getStatsHandler,this.userAliveHandler,this.remoteId,this.callback),this.devices.collectConnected(),this.fabricTransmissionDirection||(this.fabricTransmissionDirection="sendrecv"),this.remoteEndpointType||(this.remoteEndpointType="peer")}return o(e,[{key:"getFabricTransmissionDirection",value:function(){return this.fabricTransmissionDirection}},{key:"getRemoteEndpointType",value:function(){return this.remoteEndpointType}},{key:"stopUserAliveHandler",value:function(){this.userAliveHandler.stop()}},{key:"getPcState",value:function(){return this.pcCallbackHandler.pcState}},{key:"stopStatsPolling",value:function(){this.getStatsHandler.stopStatsPolling()}},{key:"startStatsPolling",value:function(){this.getStatsHandler.startStatsPolling()}},{key:"setPcState",value:function(e){e in d.fabricState?this.pcCallbackHandler.pcState=e:p.error("setPcState: Invalid state")}},{key:"getAppId",value:function(){return this.credentials.getAppId()}},{key:"getLocalId",value:function(){return this.credentials.getUserId()}},{key:"getConferenceId",value:function(){return this.conferenceId}},{key:"getPeerConnection",value:function(){return this.pc}},{key:"getRemoteId",value:function(){return this.remoteId}},{key:"isFabricSetupSent",value:function(){return this.pcCallbackHandler.isFabricSetupSent()}},{key:"getStartTime",value:function(){return this.startTime}},{key:"getCallback",value:function(){return this.callback}},{key:"getPcHash",value:function(){return this.pcHash}},{key:"getIceCandidates",value:function(){return this.pcCallbackHandler?this.pcCallbackHandler.iceCandidates:null}},{key:"getIceConnectionState",value:function(){return this.pcCallbackHandler?this.pcCallbackHandler.iceConnectionState:null}},{key:"getNegotiationsNumber",value:function(){return this.pcCallbackHandler?this.pcCallbackHandler.negotiationNeeded:0}},{key:"sendFabricTransportSwitch",value:function(e){this.pcCallbackHandler&&this.pcCallbackHandler.sendFabricTransportSwitch(e)}},{key:"getSdp",value:function(){return{localSdp:this.localSdp,remoteSdp:this.remoteSdp}}},{key:"setSdp",value:function(e,t){this.localSdp=e,this.remoteSdp=t}},{key:"generatePcHash",value:function(){var e=(Math.random()+1).toString(36);return e.substring(2,e.length)}},{key:"getTransportInfo",value:function(){return this.transportInfo}},{key:"setTransportInfo",value:function(e){this.transportInfo=e}},{key:"updateSDP",value:function(e){var t=this,n=void 0,r=void 0;if(this.pc&&this.pc.localDescription&&(n=this.pc.localDescription.sdp),this.pc&&this.pc.remoteDescription&&(r=this.pc.remoteDescription.sdp),n&&r&&(n!==this.localSdp||r!==this.remoteSdp)){this.parseSDP(n,d.streamType.outbound),this.parseSDP(r,d.streamType.inbound);var i={localSDP:n!==this.localSdp?n:"",remoteSDP:r!==this.remoteSdp?r:""};""===n&&""===remoteSDP||!a.Registry.getCredentials().getCollectSDP()||this.emb.make(d.internalFabricEvent.sdpSubmission,this.conferenceId,this.pc,i),e&&e.forEach(function(e){var n=String(e.data.ssrc),r=t.ssrcMap.get(n);r||(r={}),r.mediaType=e.data.mediaType,r.reportType=e.reportType,r.ssrc=n,t.ssrcMap.set(n,r)});var o=[];this.ssrcMap.forEach(function(e,t){e.msid&&e.mslabel&&e.label&&o.push(e)});for(var s={ssrcData:o},c=0;c<s.ssrcData.length;c+=1)s.ssrcData[c].userID=a.Registry.getCredentials().getUserId();this.emb.make(d.internalFabricEvent.ssrcMap,this.conferenceId,this.pc,s),this.setSdp(n,r)}}},{key:"parseSDP",value:function(e,t){var n=this,r=RegExp.prototype.test.bind(/^([a-z])=(.*)/),i=/^ssrc:(\d*) ([\w_]*):(.*)/,o=/^ssrc-group:SIM (\d*)/;e.split(/(\r\n|\r|\n)/).filter(r).forEach(function(e){var r=e[0],a=e.slice(2);if("a"===r&&i.test(a)){var s=a.match(i),c=s[1],u=s[2],l=s[3],d=n.ssrcMap.get(c);if(d||(d={}),d.ssrc=c,d[u]=l,d.localStartTime=f.getCurrent(),d.syncedStartTime=n.clocksync.getSynchronizedTimestamp(),d.streamType=t,!o.test(a))return void n.ssrcMap.set(c,d);d.ssrcGroup={},d.ssrcGroup[t]={},d.ssrcGroup[t].simulcastGroup=a.match(/\d+/g),n.ssrcMap.set(c,d)}})}},{key:"getSSRCInfo",value:function(e){return this.ssrcMap.get(e)}},{key:"setupVideoTagMethods",value:function(e,t){var n=this,r=document.getElementById(e);r&&(r.oncanplay=function(){var e={ssrc:String(t),highResTs:f.getCurrent()};n.emb.make(d.internalFabricEvent.mediaPlaybackStart,n.conferenceId,n.pc,e)},r.onsuspend=function(){var e={ssrc:String(t),highResTs:f.getCurrent()};n.emb.make(d.internalFabricEvent.mediaPlaybackSuspended,n.conferenceId,n.pc,e)})}},{key:"updateSSRCInfo",value:function(e,t,n,r){var i=this.ssrcMap.get(e);i||(i={}),i.ssrc=e,i.remoteUserID=t,i.usageLabel=n,i.associatedVideoTag=r,this.ssrcMap.set(e,i),r&&t!==this.credentials.getUserId()&&this.setupVideoTagMethods(r,e)}},{key:"updateConferenceId",value:function(e){this.conferenceId=e,this.userAliveHandler.updateConferenceId(e)}},{key:"updateRemoteId",value:function(e){this.remoteId=e}}],[{key:"Builder",get:function(){return function(){function t(){i(this,t)}return o(t,[{key:"withPc",value:function(e){return this.pc=e,this}},{key:"withRemoteId",value:function(e){return this.remoteId=e,this}},{key:"withFabricUsage",value:function(e){return this.fabricUsage=e,this}},{key:"withConferenceId",value:function(e){return this.conferenceId=e,this}},{key:"withRemoteEndpointType",value:function(e){return this.remoteEndpointType=e,this}},{key:"withFabricTransmissionDirection",value:function(e){return this.fabricTransmissionDirection=e,this}},{key:"withCallback",value:function(e){return this.callback=e,this}},{key:"make",value:function(){return new e(this)}}]),t}()}}]),e}();n.PeerConnectionHandler=h},{"../browserapi/devices":19,"../config/constants":33,"../peerconnection/pccallbackhandler":40,"../utility/csiologger":88,"../utility/registry":95,"../utility/timestamps":99,"./getstatshandler":39,"./useralivehandler":43}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PeerConnectionManager=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./peerconnectionhandler"),o=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.pcHandlers=new Map}return r(e,[{key:"removePcHandler",value:function(e){var t=this.getPcHandler(e);if(t){var n=t.getPcHash();this.pcHandlers.delete(n)}}},{key:"addPcHandler",value:function(e,t,n,r,o,a,s){if(!this.getPcHandler(e)){var c=(new i.PeerConnectionHandler.Builder).withPc(e).withRemoteId(t).withFabricUsage(n).withConferenceId(r).withRemoteEndpointType(o).withFabricTransmissionDirection(a).withCallback(s).make();this.pcHandlers.set(c.getPcHash(),c)}}},{key:"getPcHandler",value:function(e){var t=null;return e?(this.pcHandlers.forEach(function(n,r){n&&n.getPeerConnection()===e&&(t=n)}),t):t}},{key:"getPcHandlerByHash",value:function(e){return e&&this.pcHandlers.has(e)?this.pcHandlers.get(e):null}},{key:"updateConferenceId",value:function(e){this.pcHandlers.forEach(function(t,n){t.updateConferenceId(e)})}}]),e}();n.PeerConnectionManager=o},{"./peerconnectionhandler":41}],43:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.UserAliveHandler=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../config/constants")),o=e("../utility/timeoutprocess"),a=e("../utility/registry"),s=1e4,c=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,s));return r.emb=a.Registry.getEventMessageBuilder(),r.pc=n,r.conferenceId=e,r.setCallback(r.send),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.TimeoutProcess),r(t,[{key:"send",value:function(){this.conferenceId!==i.tmpConferenceId&&this.pc&&this.emb.make(i.internalFabricEvent.userAlive,this.conferenceId,this.pc)}},{key:"updateConferenceId",value:function(e){this.conferenceId=e}}]),t}();n.UserAliveHandler=c},{"../config/constants":33,"../utility/registry":95,"../utility/timeoutprocess":98}],44:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.Authenticator=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},a=e("./jwt/jwt"),s=e("./jwt/jwttoken"),c=r(e("../config/settings")),u=r(e("../utility/base64")),l=r(e("../config/callstatserrors")),d=r(e("../config/constants")),f=r(e("../browserapi/localstorage")),p=r(e("../utility/json")),h=e("./xmlhttp"),v=e("./xmlhttpservice"),m=e("../utility/registry"),g=r(e("../utility/csiologger")),y=c.authRetryTimeout,b=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Authenticator"));return e.clockSync=m.Registry.getClockSync(),e.credentials=m.Registry.getCredentials(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,v.XMLHttpService),i(t,[{key:"initiate",value:function(e,n){var r=this;return this.inProgress?(n&&n(l.csError.authOngoing,null),new Promise(function(e,t){t(new Error(r.name+": in progress"))})):this.credentials.getAppId()&&this.credentials.getUserId()?(this.initCallback=n,"function"==typeof e?(this.setTokenGenerator(e),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initiate",this).call(this)):new Promise(function(n,i){r.createTokenGenerator(e).then(function(e){r.setTokenGenerator(e),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initiate",r).call(r).then(function(){n()},function(e){i(e)})},function(e){i(new Error(r.name+": tokenGenerator creation problem ("+e+")"))})})):new Promise(function(e,t){t(new Error(r.name+": credentials not set"))})}},{key:"getToken",value:function(){var e=null;return this.token&&(e=this.token.getToken()),e}},{key:"isTokenValid",value:function(){return!!this.token&&this.token.isValid(this.credentials)}},{key:"getElapsed",value:function(){return this.isCompleted()?this.elapsed:null}},{key:"getIceServers",value:function(){return this.iceServers}},{key:"reset",value:function(){this.token=null,this.reauthTimer=null,this.renew=!1,this.credentials=null,this.jwt=new a.Jwt,this.tokenGenerator=function(e,t){t("Token generator is not set")},this.elapsed=0,this.iceServers=null,o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this)}},{key:"setupToken",value:function(e){f.store("csio_auth_data",JSON.stringify(e)),this.token=new s.JwtToken(e,this.clockSync)}},{key:"clearReauthTimer",value:function(){null!==this.reauthTimer&&(clearTimeout(this.reauthTimer),this.reauthTimer=null)}},{key:"setupReauthTimer",value:function(e){var t=this;t.clearReauthTimer(),t.reauthTimer=setTimeout(function(){t.reAuthenticate()},e)}},{key:"reAuthenticate",value:function(){this.inProgress||(this.inProgress=!0,this.token=null,this.sendRequest())}},{key:"handleErrorActions",value:function(e){if(0!==e.length){var t=e.shift();if(t.action===l.authErrorActions.RETRY){var n=t.params.timeout?t.params.timeout:c.authRetryTimeout;this.setupReauthTimer(n),this.handleErrorActions(e)}t.action===l.authErrorActions.GET_NEW_TOKEN&&(this.renew=!0,this.handleErrorActions(e)),t.action===l.authErrorActions.REPORT_ERROR&&(g.error(this.name+": "+t.params.errorReason),this.handleErrorActions(e))}}},{key:"setTokenGenerator",value:function(e){this.tokenGenerator=e}},{key:"handleResponse",value:function(e){var t=e.getXhr(),n=e.getElapsed(),r=p.parse(t.response);if(!r)return g.error(this.name+": invalid authentication response"),void this.sendNextRequest();if(r["urn:x-callstats:auth:errorActions"]&&r["urn:x-callstats:auth:errorActions"].length>0)this.handleErrorActions(r["urn:x-callstats:auth:errorActions"]);else{if(200===t.status){if("bearer"!==r.token_type)return g.error(this.name+": successful, but token type was not bearer. Scheduling retry."),void this.sendNextRequest();this.setupToken(r.access_token),r.iceServers&&(this.iceServers=r.iceServers);var i=parseInt(1e3*parseInt(r.expires_in)*.9);return this.setupReauthTimer(i),this.renew=!1,this.initCallback&&this.initCallback(l.csError.success,d.csCallBackMessages.authSuccessful),this.elapsed=n,void this.completeProcess()}g.error("Authentication failed, but no error actions were defined in response."),this.sendNextRequest()}}},{key:"request",value:function(){var e=this;this.clearReauthTimer();var t=new Promise(function(t,n){e.tempResolve=t,e.tempReject=n});return this.tokenGenerator(this.renew,function(t,n){if(null!==t)return e.initCallback&&e.initCallback(l.csError.tokenGenerationError,t.toString()),e.rejectCb(new Error(e.name+": tokenGenerationError")),g.error("tokenGenerationError ",t),null;var r=c.authServiceUrl+"authenticate",i={client_id:e.credentials.userId+"@"+e.credentials.getAppId(),code:n,grant_type:"authorization_code"};(0,h.sendPostRequest)(r,{"Content-Type":"application/x-www-form-urlencoded"},y,i).then(function(t){e.tempResolve(t)},function(t){e.tempReject(t)})}),t}},{key:"tokenGeneratorCreator",value:function(e,t){var n=this;return function(r,i){var o=null;if(!r&&null!==o)return i(null,o);var a=n.credentials,s={userID:a.getUserId(),appID:a.getAppId()};t&&(s.keyId=t),n.jwt.sign({alg:"HS256"},s,e).then(function(e){o=e,i(null,e)}).catch(function(e){i(e)})}}},{key:"createTokenGenerator",value:function(e){var t=this;return new Promise(function(n,r){var i=null;e.indexOf(":")>-1&&(i=u.strtohex(e.split(":")[0]),e=e.split(":")[1]),t.jwt.importKey(e).then(function(r){e=null;var o=t.tokenGeneratorCreator(r,i);n(o)}).catch(function(e){g.error(t.name+": could not import key ("+e+")"),r(e)})})}}]),t}();n.Authenticator=b},{"../browserapi/localstorage":20,"../config/callstatserrors":32,"../config/constants":33,"../config/settings":34,"../utility/base64":85,"../utility/csiologger":88,"../utility/json":93,"../utility/registry":95,"./jwt/jwt":52,"./jwt/jwttoken":53,"./xmlhttp":58,"./xmlhttpservice":59}],45:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.GenericEventHandler=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=r(e("../config/settings")),a=e("./xmlhttp"),s=e("../utility/registry"),c=r(e("../utility/csiologger")),u=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.credentials=s.Registry.getCredentials(),this.enabled=!1}return i(e,[{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1}},{key:"sendEvent",value:function(e,t){this.send(e,t).then(function(e){c.log("Got generic response: %o",e)}).catch(function(e){c.log("Got error for generic request",e)})}},{key:"send",value:function(e,t){if(!this.enabled)return new Promise(function(e,t){t(new Error("GenericEvent Error: not enabled"))});var n=this;return new Promise(function(r,i){var s={appID:n.credentials.appId,userID:encodeURIComponent(n.credentials.userId),version:o.version,eventType:e,data:t},c=o.baseUrl+"generics";(0,a.sendPostRequest)(c,{"Content-Type":"application/json"},5e3,s).then(function(e){r(e.getXhr().response)},function(e){i(e)})})}}]),e}();n.GenericEventHandler=u},{"../config/settings":34,"../utility/csiologger":88,"../utility/registry":95,"./xmlhttp":58}],46:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.ClockSync=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},a=r(e("../config/settings")),s=e("./xmlhttp"),c=r(e("../utility/timestamps")),u=e("./xmlhttpservice"),l=e("../utility/registry"),d=r(e("../config/constants")),f=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"ClockSync"));return e.currentOffset=0,e.completed=!1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.XMLHttpService),i(t,[{key:"initiate",value:function(){return this.startTime=c.getCurrent(),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initiate",this).call(this)}},{key:"getSynchronizedTimestamp",value:function(){return c.getCurrent()+this.currentOffset}},{key:"getElapsed",value:function(){return this.isCompleted()?this.endTime-this.startTime:null}},{key:"getOffset",value:function(){return this.currentOffset}},{key:"reset",value:function(){this.currentOffset=0,this.offsetResults=[],this.startTime=0,this.endTime=0,o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this)}},{key:"request",value:function(){var e=a.baseUrl+"clockSync";return(0,s.sendGetRequest)(e,null,5e3)}},{key:"handleResponse",value:function(e){var t=e.getXhr(),n=e.getElapsed(),r=JSON.parse(t.response),i=c.getCurrent();this.handleMessage(r,n,i)}},{key:"handleMessage",value:function(e,t,n){var r=t/2;r>6e4?this.offsetResults=[]:this.addOffset(e,r,n),this.offsetResults.length>=5?(this.calculateOffset(),this.endTime=c.getCurrent(),this.completeProcess()):this.sendRequest()}},{key:"isCompleted",value:function(){return this.completed}},{key:"addOffset",value:function(e,t,n){var r=e.now+t-n;this.offsetResults.push(r)}},{key:"calculateOffset",value:function(){var e=this.offsetResults.reduce(function(e,t){return e+t});this.currentOffset=e/this.offsetResults.length,this.currentOffset=isNaN(this.currentOffset)?0:this.currentOffset,l.Registry.getGenericEventHandler().sendEvent(d.logEvents.log,{msg:"clockSync Done, offset is: "+this.currentOffset+"results length"+this.offsetResults.length}),this.offsetResults=[],this.completed=!0}}]),t}();n.ClockSync=f},{"../config/constants":33,"../config/settings":34,"../utility/registry":95,"../utility/timestamps":99,"./xmlhttp":58,"./xmlhttpservice":59}],47:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.connected=!1,this.reconnected=!1,this.conferenceUrl={}}return r(e,[{key:"setup",value:function(){return new Promise(function(e,t){e()})}},{key:"isReady",value:function(){return this.connected}},{key:"send",value:function(e){}}]),e}();n.CollectorConnection=i},{}],48:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ConfigServiceGet=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},o=e("../xmlhttp"),a=e("../xmlhttpservice"),s=e("../../utility/registry"),c=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"ConfigService"))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.XMLHttpService),r(t,[{key:"initiate",value:function(e){var n=this;return this.url=e,this.authToken=s.Registry.getAuthenticator().getToken(),this.authToken?i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initiate",this).call(this):new Promise(function(e,t){t(new Error(n.name+": authToken has to be string"))})}},{key:"getConfig",value:function(){return this.config}},{key:"getElapsed",value:function(){return this.isCompleted()?this.elapsed:null}},{key:"reset",value:function(){this.authToken=null,this.url=null,this.config=null,this.elapsed=0,i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this)}},{key:"request",value:function(){var e={Authorization:"Bearer "+this.authToken};return(0,o.sendGetRequest)(this.url,e,2e3)}},{key:"handleResponse",value:function(e){var t=e.getXhr(),n=e.getElapsed();this.config=JSON.parse(t.response),this.elapsed=n,this.completeProcess()}}]),t}();n.ConfigServiceGet=c},{"../../utility/registry":95,"../xmlhttp":58,"../xmlhttpservice":59}],49:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ConfigServicePost=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../xmlhttp"),o=e("./configserviceget"),a=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.ConfigServiceGet),r(t,[{key:"initiate",value:function(e,n){return this.body=n,function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initiate",this).call(this,e)}},{key:"request",value:function(){var e={Authorization:"Bearer "+this.authToken,"Content-Type":"application/json"};return(0,i.sendPostRequest)(this.url,e,2e3,this.body)}}]),t}();n.ConfigServicePost=a},{"../xmlhttp":58,"./configserviceget":48}],50:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.ConfigServiceWrapper=void 0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("./configserviceget"),s=e("./configservicepost"),c=r(e("../../config/settings")),u=e("../../utility/registry"),l=r(e("../../utility/csiologger")),d=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.internalConfigService=new a.ConfigServiceGet,this.appConfigService=new a.ConfigServiceGet,this.senderConfigService=new s.ConfigServicePost,this.defaultSenderConfig=null}return o(e,[{key:"initiateInternalConfig",value:function(){var e=this,t=u.Registry.getCredentials().getAppId();if(!t)return new Promise(function(t,n){l.log("appId has to be string"),n(new Error(e.internalConfigService.name+": appId has to be string"))});var n=c.configServiceUrl+t;return this.internalConfigService.initiate(n+"/configurations/internal")}},{key:"initiateAppConfig",value:function(){var e=this,t=u.Registry.getCredentials().getAppId();if(!t)return new Promise(function(t,n){l.log("appId has to be string"),n(new Error(e.appConfigService.name+": appId has to be string"))});var n=c.configServiceUrl+t;return this.appConfigService.initiate(n+"/configurations")}},{key:"initiateSenderConfig",value:function(e){var t=this;if(this.senderConfigService.getConfig())return new Promise(function(e,n){l.log("sender config already present"),n(new Error(t.senderConfigService.name+": sender config already present"))});var n=u.Registry.getCredentials().getAppId(),r=u.Registry.getCredentials().getUserId();if(!n||!r)return new Promise(function(e,n){l.log("appId and userId have to be string"),n(new Error(t.senderConfigService.name+": appId and userId have to be string"))});if(this.defaultSenderConfig=this.getCurrentVideoSenderConfig(e),!this.defaultSenderConfig)return new Promise(function(e,n){l.log("Could not obtain a sender config"),n(new Error(t.senderConfigService.name+": Could not obtain a sender config"))});var i=c.configServiceUrl+n,o={app_id:n,local_id:r,rtc_rtp_parameters:this.defaultSenderConfig};return this.senderConfigService.initiate(i+"/configurations",o)}},{key:"getInternalConfig",value:function(){return this.internalConfigService.getConfig()}},{key:"getAppDefaultConfig",value:function(){var e=this.appConfigService.getConfig(),t={peerConnection:null,media:null};return e.default?(e.default.peerConnection&&(t.peerConnection=e.default.peerConnection),e.default.media&&(t.media=e.default.media),t):t}},{key:"getAppRecommendedConfig",value:function(){var e=this.appConfigService.getConfig(),t={};return e.recommended?(e.recommended.peerConnection&&(t.peerConnection=e.recommended.peerConnection),e.recommended.media&&(t.media=e.recommended.media),t):t}},{key:"getSenderConfig",value:function(){var e=this.senderConfigService.getConfig();return e&&e.recommended&&e.recommended.sender?e.recommended.sender:null}},{key:"getDefaultSenderConfig",value:function(){return this.defaultSenderConfig?this.defaultSenderConfig:null}},{key:"getInternalElapsed",value:function(){return this.internalConfigService.getElapsed()}},{key:"getAppElapsed",value:function(){return this.appConfigService.getElapsed()}},{key:"getSenderElapsed",value:function(){return this.senderConfigService.getElapsed()}},{key:"getCurrentVideoSenderConfig",value:function(e){var t={encodings:[{maxBitrate:0}]},n=u.Registry.getConferenceManager().getConferenceForPc(e);if(!n)return l.warn("No conference found for PC, skipping"),null;if(n.getPeerConnectionManager().pcHandlers.size>1)return l.warn("Multiple PCs found, skipping"),null;if(!e.getSenders||"function"!=typeof e.getSenders)return l.warn("Get senders error"),t;for(var r=e.getSenders(),o=void 0,a=0;a<r.length;a+=1){var s=r[a];if("object"!==(void 0===s?"undefined":i(s))||!s.track||"object"!==i(s.track)||!s.track.kind)return l.warn("Access senders error"),null;if("video"===s.track.kind){if(o)return l.warn("Multiple video sender, skipping"),null;o=s}}if(!o)return l.warn("No video sender found"),null;if(!o.getParameters||"function"!=typeof o.getParameters)return l.warn("Sender getParameters error"),t;var c=o.getParameters();return"object"!==(void 0===c?"undefined":i(c))?null:("encodings"in c||(c.encodings=[]),0===c.encodings.length&&c.encodings.push({maxBitrate:0}),c)}}]),e}();n.ConfigServiceWrapper=d},{"../../config/settings":34,"../../utility/csiologger":88,"../../utility/registry":95,"./configserviceget":48,"./configservicepost":49}],51:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ConnectionManager=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../config/constants")),o=e("./wscollectorconnection"),a=e("./restcollectorconnection"),s=e("../utility/registry"),c=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.connection=null}return r(e,[{key:"setupCollectorConnection",value:function(e){e===i.transportType.rest?this.connection=new a.RestCollectorConnection:this.connection=new o.WsCollectorConnection}},{key:"setup",value:function(){return this.connection?this.connection.setup():new Promise(function(e,t){t()})}},{key:"isReady",value:function(){return!!this.connection&&this.connection.isReady()}},{key:"send",value:function(e){this.connection?this.connection.send(e):s.Registry.getGenericEventHandler().sendEvent(i.logEvents.error,{msg:"Connection not available to the collector"})}}]),e}();n.ConnectionManager=c},{"../config/constants":33,"../utility/registry":95,"./restcollectorconnection":54,"./wscollectorconnection":57}],52:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.Jwt=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=r(e("../../utility/base64")),a=r(e("../../utility/csiologger")),s=e("../../utility/registry"),c=r(e("../../config/constants")),u=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.cryptotype=null,window.crypto&&window.crypto.subtle?(this.cryptotype="standard",this.subtlecrypto=window.crypto.subtle):window.crypto&&!window.crypto.subtle&&window.crypto.webkitSubtle?(this.cryptotype="webkit",this.subtlecrypto=window.crypto.webkitSubtle):window.msCrypto&&window.msCrypto.subtle?(this.cryptotype="ie",this.subtlecrypto=window.msCrypto.subtle):(this.subtlecrypto=null,a.info("WebCryptography API not supported in this browser.")),this.browserName=s.Registry.getEndpoint().getBrowserName()}return i(e,[{key:"sign",value:function(e,t,n){var r=this;return new Promise(function(i,s){"HS256"!==e.alg&&s("Use header.alg=HS256"),e=JSON.stringify(e),"string"!=typeof t&&(t=JSON.stringify(t));var u=o.urlencodeUnicode(e)+"."+o.urlencodeUnicode(t);window.csioReactNative&&window.csiosign(u,n,function(e,t){if(e)return a.log("Token sign error",e),void s(error);i(t)});var l=new ArrayBuffer(u.length),d=new Uint8Array(l),f={name:"HMAC"};"ie"!==r.cryptotype&&"webkit"!==r.cryptotype&&r.browserName!==c.browserName.edge||(f.hash={name:"sha-256"});for(var p=u.length-1;p>=0;p--)d[p]=u.charCodeAt(p);var h=r.subtlecrypto.sign(f,n,d);"ie"===r.cryptotype?(h.onerror=s,h.oncomplete=function(e){u=r.buildToken(e.target.result,u),i(u)}):h.then(function(e){u=r.buildToken(e,u),i(u)}).catch(function(e){s(e)})})}},{key:"buildToken",value:function(e,t){for(var n="",r=new Uint8Array(e),i=r.byteLength,a=0;a<i;a++)n+=String.fromCharCode(r[a]);return t+"."+o.urlencode(n)}},{key:"decode",value:function(e){try{var t=e.split(".")[1],n=o.decode(t);return JSON.parse(n)}catch(e){return a.error("Could not decode token. "),null}}},{key:"importKey",value:function(e){var t=this;return new Promise(function(n,r){if(window.csioReactNative)n(e);else{if("webkit"===t.cryptotype)for(;e.length<32;)e+="\0";var i={kty:"oct",k:o.urlencode(e),alg:"HS256"},a={name:"HMAC",hash:{name:"SHA-256"}};if("ie"===t.cryptotype?i.extractable=!1:i.ext=!1,"webkit"===t.cryptotype&&(a=null,i.use="sig"),"ie"===t.cryptotype||"webkit"===t.cryptotype){var s=JSON.stringify(i);i=new Uint8Array(s.length);for(var c=0;c<s.length;c++)i[c]=s.charCodeAt(c)}var u=t.subtlecrypto.importKey("jwk",i,a,!1,["sign"]);"ie"===t.cryptotype?(u.onerror=r,u.oncomplete=function(e){n(e.target.result)}):u.then(n).catch(r)}})}}]),e}();n.Jwt=u},{"../../config/constants":33,"../../utility/base64":85,"../../utility/csiologger":88,"../../utility/registry":95}],53:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.JwtToken=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./jwt"),a=e("../../utility/registry"),s=r(e("../../config/constants")),c=r(e("../../utility/csiologger")),u=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.token=t,this.statsSubmissionInterval=15e3,this.collectSDP=!1,this.appId=null,this.userId=null,this.tokenPayload=null,this.jwt=new o.Jwt,this.expires=null,this.clockSync=a.Registry.getClockSync(),this.adaptiveInterval=!1,this.transportType=s.transportType.rest,this.setupTokenPayload(),this.restApiTransport=!1}return i(e,[{key:"getToken",value:function(){return this.token}},{key:"setupTokenPayload",value:function(){var e=this.jwt.decode(this.token);if(this.statsSubmissionInterval=parseInt(e.submissionInterval,10),this.collectSDP=e.collectSDP,this.adaptiveInterval=e.adaptiveInterval,this.appId=e.appID,this.userId=e.userID,this.restApiTransport=e.restApiTransport,navigator.mozGetUserMedia){var t=e.expiry.split(" ").join("T");this.expires=Date.parse(t)}else this.expires=new Date(e.expiry);this.restApiTransport?this.transportType=s.transportType.rest:this.transportType=s.transportType.ws,c.info("transportType is ",this.transportType,this.restApiTransport),a.Registry.getCredentials().setStatsSubmissionInterval(this.statsSubmissionInterval),a.Registry.getCredentials().setCollectSDP(this.collectSDP),a.Registry.getCredentials().setTransportType(this.transportType),a.Registry.getCredentials().setAdaptiveInterval(this.adaptiveInterval)}},{key:"isValid",value:function(e){var t=this,n=!1;return null!==t.token&&t.appId===e.appId&&t.userId===encodeURIComponent(e.userId)&&new Date(this.clockSync.getSynchronizedTimestamp())<t.expires&&(n=!0),n}}]),e}();n.JwtToken=u},{"../../config/constants":33,"../../utility/csiologger":88,"../../utility/registry":95,"./jwt":52}],54:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.RestCollectorConnection=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../utility/registry"),a=e("./xmlhttp"),s=e("./collectorconnection"),c=e("./restrelays"),u=r(e("../config/constants")),l=r(e("../utility/csiologger")),d=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.relays=new c.RestRelays,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.CollectorConnection),i(t,[{key:"isReady",value:function(){return!0}},{key:"send",value:function(e){var t={"Content-Type":"application/json",Authorization:"Bearer "+o.Registry.getAuthenticator().getToken()},n=e.eventType,r=e.confID,i=e.ucID,s=this.relays,c=s.getRequestUrl(n,r,i);if(c){var d=this.getMessage(n,e);l.log("sending ",c,e),(0,a.sendPostRequest)(c,t,5e3,d).then(function(t){if(t&&t.xhr){var i=JSON.parse(t.xhr.response);i&&"success"!==i.status&&(o.Registry.getGenericEventHandler().sendEvent(u.logEvents.restResponseError,{msg:"response failure "+r+":"+n+":"+i.msg+":"+i.status+JSON.stringify(e)}),l.error("Response error:",i.msg,e)),s.handleResponse(n,i,r)}else l.log("Response for request is null")},function(e){l.error(e)})}else l.warn("No action for message type: "+n)}},{key:"getMessage",value:function(e,t){delete t.confID,delete t.channel,delete t.token,delete t.appID,delete t.action,delete t.ucID,delete t.version,delete t.timeShift;var n=decodeURIComponent(t.localID);t.localID=n;var r=decodeURIComponent(t.remoteID);return t.remoteID=r,e===u.callstatsChannels.processedStats&&(t.eventType="stats"),t}}]),t}();n.RestCollectorConnection=d},{"../config/constants":33,"../utility/csiologger":88,"../utility/registry":95,"./collectorconnection":47,"./restrelays":55,"./xmlhttp":58}],55:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(n,r,i){"success"===n.status?e&&e(n,r):t&&t(n)}}Object.defineProperty(n,"__esModule",{value:!0}),n.RestRelays=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=r(e("../config/constants")),c=r(e("../config/settings")),u=e("../utility/registry"),l=e("../utility/url"),d=r(e("../utility/csiologger")),f=function(){function e(){var t;i(this,e),this.items=(t=o(),new Map([[s.fabricEvent.fabricTerminated,new p(c.restEventUrl,"/events/fabric/terminated",t)],[s.fabricEvent.audioMute,new p(c.restEventUrl,"/events/media/actions",t)],[s.fabricEvent.audioUnmute,new p(c.restEventUrl,"/events/media/actions",t)],[s.fabricEvent.videoPause,new p(c.restEventUrl,"/events/media/actions",t)],[s.fabricEvent.videoResume,new p(c.restEventUrl,"/events/media/actions",t)],[s.fabricEvent.screenShareStart,new p(c.restEventUrl,"/events/media/actions",t)],[s.fabricEvent.screenShareStop,new p(c.restEventUrl,"/events/media/actions",t)],[s.fabricEvent.activeDeviceList,new p(c.restEventUrl,"/events/devices/list",t)],[s.fabricEvent.applicationErrorLog,new p(c.restEventUrl,"/events/app/logs",t)],[s.fabricEvent.dominantSpeaker,new p(c.restEventUrl,"/events/dominantspeaker",t)],[s.fabricEvent.fabricHold,new p(c.restEventUrl,"/events/fabric/actions",t)],[s.fabricEvent.fabricResume,new p(c.restEventUrl,"/events/fabric/actions",t)],[s.internalFabricEvent.fabricSetup,new p(c.restEventUrl,"/events/fabric/setup",t)],[s.fabricEvent.fabricSetupFailed,new p(c.restEventUrl,"/events/fabric/setupfailed",t)],[s.internalFabricEvent.userJoined,new p(c.restEventUrl,"",o(function(e,t){t=decodeURIComponent(t);var n=u.Registry.getConferenceManager().get(t);n&&(d.log("UcId is - ",e.ucID,t),n.setUcId(e.ucID),u.Registry.getTransmissionManager().trySend())}))],[s.internalFabricEvent.userLeft,new p(c.restEventUrl,"/events/user/left",t)],[s.internalFabricEvent.userAlive,new p(c.restEventUrl,"/events/user/alive",t)],[s.internalFabricEvent.fabricTransportSwitch,new p(c.restEventUrl,"/events/fabric/transportchange",t)],[s.internalFabricEvent.mediaPlaybackStart,new p(c.restEventUrl,"/events/media/pipeline",t)],[s.internalFabricEvent.mediaPlaybackSuspended,new p(c.restEventUrl,"/events/media/pipeline",t)],[s.internalFabricEvent.mediaPlaybackStalled,new p(c.restEventUrl,"/events/media/pipeline",t)],[s.internalFabricEvent.ssrcMap,new p(c.restEventUrl,"/events/ssrcmap",t)],[s.internalFabricEvent.connectedDeviceList,new p(c.restEventUrl,"/events/devices/list",t)],[s.internalFabricEvent.sdpSubmission,new p(c.restEventUrl,"/events/sdp",t)],[s.internalFabricEvent.iceDisruptionStart,new p(c.restEventUrl,"/events/ice/status",t)],[s.internalFabricEvent.iceDisruptionEnd,new p(c.restEventUrl,"/events/ice/status",t)],[s.internalFabricEvent.iceConnectionDisruptionStart,new p(c.restEventUrl,"/events/ice/status",t)],[s.internalFabricEvent.iceConnectionDisruptionEnd,new p(c.restEventUrl,"/events/ice/status",t)],[s.internalFabricEvent.iceAborted,new p(c.restEventUrl,"/events/ice/status",t)],[s.internalFabricEvent.iceTerminated,new p(c.restEventUrl,"/events/ice/status",t)],[s.internalFabricEvent.iceFailed,new p(c.restEventUrl,"/events/ice/status",t)],[s.internalFabricEvent.iceRestarted,new p(c.restEventUrl,"/events/ice/status",t)],[s.internalFabricEvent.fabricDropped,new p(c.restEventUrl,"/events/fabric/status",t)],[s.callstatsChannels.processedStats,new p(c.restStatsUrl,"/stats",t)],[s.internalFabricEvent.fabricStateChange,new p(c.restEventUrl,"/events/fabric/statechange",t)],[s.callstatsChannels.userFeedback,new p(c.restEventUrl,"/events/feedback",t)],[s.precalltestEvents.results,new p(c.restEventUrl,"/events/precall",t)],[s.precalltestEvents.associate,new p(c.restEventUrl,"/events/precall",t)],[s.internalFabricEvent.userDetails,new p(c.restEventUrl,"/events/userdetails",t)]]))}return a(e,[{key:"getRequestUrl",value:function(e,t,n){return this.items.has(e)?this.items.get(e).getRequestUrl(e,t,n):(d.warn("EventType Unsupported ",e),null)}},{key:"handleResponse",value:function(e,t,n){this.items.has(e)?this.items.get(e).handleResponse(t,n,e):d.warn("No response handler for event type "+e)}}]),e}(),p=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i(this,e),this.baseUrl=t,this.urlAppendix=n,this.responseHandler=r}return a(e,[{key:"getRequestUrl",value:function(e,t,n){return this.makeRequestUrl(e,t,n),this.requestUrl.toString()}},{key:"makeRequestUrl",value:function(e,t,n){e===s.precalltestEvents.results?this.requestUrl=new l.Url(this.baseUrl,u.Registry.getCredentials().getAppId(),this.urlAppendix):(e===s.internalFabricEvent.userJoined&&n&&(n=""),this.requestUrl=new l.Url(this.baseUrl,u.Registry.getCredentials().getAppId()+"/conferences/"+t,n,this.urlAppendix))}},{key:"handleResponse",value:function(e,t,n){this.responseHandler(e,t,n)}}]),e}();n.RestRelays=f},{"../config/constants":33,"../config/settings":34,"../utility/csiologger":88,"../utility/registry":95,"../utility/url":100}],56:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.TransmissionManager=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=r(e("../utility/timestamps")),a=e("../collections/cache"),s=e("../utility/registry"),c=r(e("../config/constants")),u=r(e("../utility/csiologger")),l=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.cache=[],this.connectionManager=s.Registry.getConnectionManager(),this.lastTS=0,this.timerStarted=!1,this.lastUserAliveTS={}}return i(e,[{key:"send",value:function(e){(e.isCachable()||e.canBeSent())&&(this.cache[e.getConferenceId()]||(this.cache[e.getConferenceId()]=new a.Cache),this.cache[e.getConferenceId()].add(e,e.isPriority()),this.trySend())}},{key:"trySend",value:function(){if(this.connectionManager.isReady())return this.timerStarted?void 0:this.timeToSend()?void(this.sendMessage()&&this.startTimer()):void(this.getCacheLength()>0&&this.startTimer());this.setupConnection()}},{key:"setupConnection",value:function(){this.connectionManager.setup().then(function(){u.log("Connected to connectionManager")}).catch(function(e){return u.log("Could not connect to connectionManager",e)})}},{key:"canSendUserAlive",value:function(e,t){return!(this.lastUserAliveTS[t]&&e-this.lastUserAliveTS[t]<9e3)}},{key:"sendMessage",value:function(){var e=void 0,t=void 0;if(0===this.getCacheLength())return!1;for(var n in this.cache)if(this.cache.hasOwnProperty(n)&&(t=n,(e=this.cache[t].peak())&&e.canBeSent()))break;if(!e||!e.canBeSent())return!1;if(e=this.cache[t].pop(),this.lastTS=o.getCurrent(),e.eventType===c.internalFabricEvent.userAlive){if(!this.canSendUserAlive(this.lastTS,t))return!0;this.lastUserAliveTS[t]=this.lastTS}return u.log("sending message type :",e.eventType,e.toJson()),this.connectionManager.send(e.toJson()),!0}},{key:"startTimer",value:function(){var e=this;this.timerStarted||0!=this.getCacheLength()&&(this.timerStarted=!0,setTimeout(function(){e.timerStarted=!1,e.trySend()},200))}},{key:"timeToSend",value:function(){return o.getCurrent()>=this.lastTS+200}},{key:"getCacheLength",value:function(){var e=0;for(var t in this.cache)this.cache.hasOwnProperty(t)&&(e+=this.cache[t].length());return e}},{key:"updateConferenceId",value:function(e){var t=c.tmpConferenceId;this.cache[t]&&this.cache[t].updateConferenceId(e)}}]),e}();n.TransmissionManager=l},{"../collections/cache":25,"../config/constants":33,"../utility/csiologger":88,"../utility/registry":95,"../utility/timestamps":99}],57:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.WsCollectorConnection=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=r(e("../config/callstatserrors")),a=r(e("../config/constants")),s=r(e("../config/settings")),c=e("../utility/registry"),u=r(e("../utility/csiologger")),l=e("./collectorconnection"),d=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.wsConnection=null,e.wsConnectionState=a.wsConnectionState.closed,e.connected=!1,e.reconnected=!1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.CollectorConnection),i(t,[{key:"onOpenHandler",value:function(){var e=this;e.wsConnectionState=a.wsConnectionState.connected,e.connected?e.reconnected=!0:e.connected=!0,e.reconnected=!1}},{key:"onCloseHandler",value:function(){var e=this;e.wsConnectionState=a.wsConnectionState.closed,u.log("**** Connection to the backend closed."),e.wsConnection&&(e.wsConnection=null)}},{key:"onErrorHandler",value:function(e){var t=this;t.wsConnectionState=a.wsConnectionState.closed,u.log("**** Connection establishment to the backend failed."),t.callback&&t.callback(o.csError.wsChannelFailure,"WebSocket establishment failed.",e)}},{key:"onMessageHandler",value:function(e){var t=e.data,n=JSON.parse(t);if("200 OK"===n.status){if("feedback"===n.event)window.localStorage.removeItem("feedback");else if(n.event===a.internalFabricEvent.userJoined){var r=c.Registry.getConferenceManager().get(decodeURIComponent(n.conferenceID));r&&r.setUcId(n.ucID),u.log("UcId =",n.ucID),c.Registry.getTransmissionManager().trySend()}}else u.error("Collector error:",n.reason)}},{key:"setup",value:function(){var e=this;return new Promise(function(t,n){if(e.wsConnectionState===a.wsConnectionState.initiated||e.wsConnectionState===a.wsConnectionState.connected)return u.log("setupWebSocketConnection is called when already connected!"),e.callback&&e.callback(o.csError.success,a.csCallBackMessages.wsConnected),void t();e.wsConnectionState=a.wsConnectionState.initiated,u.log("creating new WebSocket",s.wsUrl),e.wsConnection=new WebSocket(s.wsUrl,"echo-protocol"),e.wsConnection.onopen=function(){t(),e.onOpenHandler()},e.wsConnection.onclose=function(){e.onCloseHandler()},e.wsConnection.onerror=function(t){n(t),e.onErrorHandler(t)},e.wsConnection.onmessage=function(t){e.onMessageHandler(t)}})}},{key:"isReady",value:function(){return!(!this.wsConnection||1!==this.wsConnection.readyState)}},{key:"getState",value:function(){return this.wsConnection?this.wsConnection.readyState:-1}},{key:"send",value:function(e){this.wsConnection.send(JSON.stringify(e))}}]),t}();n.WsCollectorConnection=d},{"../config/callstatserrors":32,"../config/constants":33,"../config/settings":34,"../utility/csiologger":88,"../utility/registry":95,"./collectorconnection":47}],58:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e,t,n,r,i){return new Promise(function(o,l){var d,f=null,p=new XMLHttpRequest,h=c.Registry.getEndpoint().getBrowserName();if(p){for(var v in d=a.getCurrent(),p.open(e,t),h!==s.browserName.msie&&(p.timeout=r),n)n.hasOwnProperty(v)&&p.setRequestHeader(v,n[v]);var m=null;if("POST"===e){if("application/x-www-form-urlencoded"===n["Content-Type"]){var g=[];for(var y in i)i.hasOwnProperty(y)&&g.push(encodeURIComponent(y)+"="+encodeURIComponent(i[y]));m=g.join("&")}"application/json"===n["Content-Type"]&&(m=JSON.stringify(i))}p.onload=function(){f=a.getCurrent();var e=new u(p,f-d);o(e)},p.ontimeout=function(){l(new Error("connection timeout"))},p.onreadystatechange=function(){4===p.readyState&&0===p.status&&l(new Error("no server response received"))},p.send(m)}else l(new Error("creating instance failed"))})}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.sendGetRequest=function(e,t,n){return i("GET",e,t,n,null)},n.sendPostRequest=function(e,t,n,r){return i("POST",e,t,n,r)};var a=r(e("../utility/timestamps")),s=r(e("../config/constants")),c=e("../utility/registry"),u=function(){function e(t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.xhr=t,this.elapsed=n}return o(e,[{key:"getXhr",value:function(){return this.xhr}},{key:"getElapsed",value:function(){return this.elapsed}}]),e}()},{"../config/constants":33,"../utility/registry":95,"../utility/timestamps":99}],59:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.XMLHttpService=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../utility/sigmoid"),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/csiologger")),a=100,s=1e4,c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"XMLHttpService",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.name=t,this.minRetryTimeout=n,this.sigmoid=new i.Sigmoid(r-n,15,.5),this.reset()}return r(e,[{key:"reset",value:function(){this.inProgress=!1,this.completed=!1,this.resolveCb&&this.rejectCb(new Error(this.name+": resetting")),this.resolveCb=null,this.rejectCb=null}},{key:"initiate",value:function(){var e=this;if(this.inProgress)return new Promise(function(t,n){n(new Error(e.name+": in progress"))});var t=new Promise(function(t,n){e.resolveCb=t,e.rejectCb=n});return this.inProgress=!0,this.sendRequest(),t}},{key:"isCompleted",value:function(){return this.completed}},{key:"handleSendError",value:function(e){o.log(this.name+": send next request ("+e+")"),this.sendNextRequest()}},{key:"handleResponseProxy",value:function(e){this.handleResponse(e),this.resetTimeout()}},{key:"handleResponse",value:function(e){o.error(this.name+": handleResponse() not implemented"),this.completeProcess()}},{key:"completeProcess",value:function(){this.inProgress=!1,this.completed=!0,this.resolveCb.apply(this,arguments)}},{key:"request",value:function(){return o.error(this.name+": request() not implemented!"),new Promise(function(e,t){e()})}},{key:"sendRequest",value:function(){if(this.inProgress){var e=this.request();e&&e.then(this.handleResponseProxy.bind(this),this.handleSendError.bind(this))}}},{key:"sendNextRequest",value:function(){setTimeout(this.sendRequest.bind(this),this.getTimeout())}},{key:"resetTimeout",value:function(){this.sigmoid.reset()}},{key:"getTimeout",value:function(){return this.minRetryTimeout+this.sigmoid.getActual()}}]),e}();n.XMLHttpService=c},{"../utility/csiologger":88,"../utility/sigmoid":97}],60:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Measurement=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./resolution"),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("./validator")),a=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.pcHash=null,this.ssrc=null,this.streamType=null,this.mediaType=null,this.resolution=null,this.frameRateReceived=null,this.frameHeight=null,this.frameWidth=null,this.droppedFramesNum=null,this.framesReceived=null,this.rtt=null,this.jitter=null,this.lostPackets=-1,this.receivedPackets=-1,this.sentPackets=-1,this.discardedPackets=-1,this.sentBytes=-1,this.receivedBytes=-1,this.track=null,this.fractionLost=0}return r(e,null,[{key:"make",value:function(t,n,r,i,a,s,c,u,l,d,f,p,h,v,m,g,y,b){var S=new e,_=function(e,t){-1===[void 0,null].indexOf(t)&&(S[e]=t)};return _("pcHash",t),_("ssrc",n),_("streamType",r),_("mediaType",i),_("frameRateReceived",a),_("frameHeight",o.checkForNan(parseInt(s,10))),_("frameWidth",o.checkForNan(parseInt(c,10))),_("droppedFramesNum",u),_("framesReceived",l),_("rtt",d),_("jitter",f),_("lostPackets",p),_("receivedPackets",h),_("sentPackets",v),_("discardedPackets",m),_("sentBytes",g),_("receivedBytes",y),_("track",b),S.setFrameRateReceived(a),S}}]),r(e,[{key:"getPcHash",value:function(){return this.pcHash}},{key:"getSSRC",value:function(){return this.ssrc}},{key:"getStreamType",value:function(){return this.streamType}},{key:"getMediaType",value:function(){return this.mediaType}},{key:"getResolution",value:function(){return this.resolution?this.resolution.toString():null}},{key:"getFrameRateReceived",value:function(){return this.frameRateReceived}},{key:"getFrameHeight",value:function(){return this.frameHeight}},{key:"getFrameWidth",value:function(){return this.frameWidth}},{key:"getDroppedFramesNum",value:function(){return this.droppedFramesNum}},{key:"getFramesReceived",value:function(){return this.framesReceived}},{key:"setFrameRateReceived",value:function(e){this.frameRateReceived=e,void 0!==this.frameRateReceived&&void 0!==this.frameWidth&&void 0!==this.frameHeight&&this.frameWidth>0&&this.frameHeight>0?this.resolution=new i.Resolution(this.frameWidth,this.frameHeight,this.frameRateReceived):this.resolution=null}},{key:"getJitter",value:function(){return this.jitter}},{key:"getRTT",value:function(){return this.rtt}},{key:"getLostPackets",value:function(){return this.lostPackets}},{key:"getDiscardedPackets",value:function(){return this.discardedPackets}},{key:"getReceivedPackets",value:function(){return this.receivedPackets}},{key:"getSentPackets",value:function(){return this.sentPackets}},{key:"getSentBytes",value:function(){return this.sentBytes}},{key:"getReceivedBytes",value:function(){return this.receivedBytes}},{key:"setFractionLost",value:function(e){this.fractionLost=void 0===e?null:e}},{key:"getFractionLost",value:function(){return this.fractionLost}},{key:"extractTrack",value:function(){var e=this.track;return this.track=null,e}},{key:"toString",value:function(){return"pcHash: "+this.pcHash+", ssrc: "+this.ssrc+", streamType: "+this.streamType+", mediaType: "+this.mediaType+", frameRateReceived: "+this.frameRateReceived+", frameHeight: "+this.frameHeight+", frameWidth: "+this.frameWidth+", droppedFramesNum: "+this.droppedFramesNum+", rtt: "+this.rtt+", jitter: "+this.jitter+", lostPackets: "+this.lostPackets+", receivedPackets: "+this.receivedPackets+", sentPackets: "+this.sentPackets+", discardedPackets: "+this.discardedPackets+", sentBytes: "+this.sentBytes+", receivedBytes: "+this.receivedBytes}}]),e}();n.Measurement=a},{"./resolution":68,"./validator":83}],61:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.CPULimitationObserver=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(e("../../config/constants")),s=r(e("../../utility/timestamps")),c=function(){function e(){i(this,e),this.ewmaDiscardedPackets=0,this.ewmaLostPackets=0,this.ewmaDroppedFrames=0,this.last=0,this.noticed=0}return o(e,[{key:"test",value:function(e){var t=e.discardedPackets,n=e.lostPackets;if(!n||n<1||!t||t<1)return!1;if(0===this.last)return this.last=s.getCurrent(),this.ewmaLostPackets=n,this.ewmaDiscardedPackets=t,!1;var r=s.getCurrent(),i=Math.max(r-this.last,1),o=Math.min((5e3-i)/5e3,.9),a=e.droppedFrames;return this.ewmaLostPackets=this.ewmaLostPackets*o+n,this.ewmaDroppedFrames=this.ewmaDroppedFrames*o+a,this.ewmaDiscardedPackets=this.ewmaDiscardedPackets*o+t,!(!a||a<1||1<this.ewmaLostPackets||1<this.ewmaDiscardedPackets||r-this.noticed<1e4||this.ewmaDroppedFrames<1||(this.noticed=r,0))}}]),e}(),u=function(){function e(t){i(this,e),this.notifyCallback=t,this.inbVideoTesters=new Map}return o(e,[{key:"accept",value:function(e){for(var t=e.filter(function(e){return e.getMediaType()===a.mediaType.video&&e.getStreamType()===a.streamType.inbound}),n=0;n<t.length;++n){var r=t[n];this.checkInboundVideo(r)}}},{key:"checkInboundVideo",value:function(e){var t=e.peek(),n=e.getSSRC();if(this.inbVideoTesters.has(n)||this.inbVideoTesters.set(n,new c),this.inbVideoTesters.get(n).test(t)){var r={reason:a.limitationType.cpu,ssrc:n};this.notifyCallback(r)}}},{key:"toString",value:function(){return"CPULimitationObserver"}}]),e}();n.CPULimitationObserver=u},{"../../config/constants":33,"../../utility/timestamps":99}],62:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.OneWayMediaObserver=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=r(e("../../config/constants")),a=e("../onewaymediadisruption"),s=r(e("../../utility/timestamps")),c=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.notifierCallback=t,this.inbOneWayAudioDisruption={sent:!1,started:0,hasTrafficTs:0},this.outbOneWayAudioDisruption={sent:!1,started:0,hasTrafficTs:0}}return i(e,[{key:"accept",value:function(e){var t=e.filter(function(e){return e.getMediaType()==o.mediaType.audio&&e.getStreamType()===o.streamType.inbound}),n=e.filter(function(e){return e.getMediaType()==o.mediaType.audio&&e.getStreamType()===o.streamType.outbound}),r=[this.getInbOneWayAudioDisruption(t,n),this.getOutbOneWayAudioDisruption(t,n)].filter(function(e){return null!==e});0<r.length&&this.notifierCallback(r)}},{key:"toString",value:function(){return"DisruptionObserver"}},{key:"getInbOneWayAudioDisruption",value:function(e,t){var n=this.inbOneWayAudioDisruption;if(n.sent)return null;var r=t.filter(function(e){return 0===e.getStartTime()}).length<1,i=t.filter(function(e){return!e.hasTraffic()}).length<1;if(!r||i)return null;var c=e.filter(function(e){return!e.hasTraffic()}).length<1;return 0<e.length&&c?(n.started=0,null):0===n.started?(n.started=s.getCurrent(),null):s.getCurrent()-5e3<n.started?null:(n.sent=!0,new a.OneWayMediaDisruption(o.oneWayMediaTypes.audio))}},{key:"getOutbOneWayAudioDisruption",value:function(e,t){var n=this.outbOneWayAudioDisruption;if(n.sent)return null;var r=e.filter(function(e){return 0===e.getStartTime()}).length<1,i=e.filter(function(e){return!e.hasTraffic()}).length<1;if(!r||!i)return null;var c=t.filter(function(e){return!e.hasTraffic()}).length<1;return 0<t.length&&c?(n.started=0,null):0===n.started?(n.started=s.getCurrent(),null):s.getCurrent()-5e3<n.started?null:(n.sent=!0,new a.OneWayMediaDisruption(o.oneWayMediaTypes.audio))}}]),e}();n.OneWayMediaObserver=c},{"../../config/constants":33,"../../utility/timestamps":99,"../onewaymediadisruption":66}],63:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.QPSumObserver=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(e("../../config/constants")),s=r(e("../../utility/timestamps")),c=function(){function e(t){i(this,e),this.lastQpSum=null,this.qpAvg=null,this.noticed=0}return o(e,[{key:"test",value:function(e){var t=e.getTrack();if(!t||!t.data||!t.data.qpSum)return!1;if(!this.lastQpSum)return this.lastQpSum=t.data.qpSum,!1;var n=t.data.qpSum-this.lastQpSum;this.lastQpSum=t.data.qpSum,null===this.qpAvg?this.qpAvg=n:this.qpAvg=.2*n+.8*this.qpAvg;var r=Math.max(2*this.qpAvg,1);if(n<this.qpAvg+r)return!1;var i=s.getCurrent();return this.noticed<i-1e4}}]),e}(),u=function(){function e(t){i(this,e),this.notifyCallback=t,this.testers=new Map}return o(e,[{key:"accept",value:function(e){for(var t=0;t<e.length;++t){var n=e[t];if(n.getMediaType()===a.mediaType.video){var r=n.getSSRC();if(this.testers.has(r)||this.testers.set(r,new c(n)),this.testers.get(r).test(n)){var i={reason:a.qualityDisruptionTypes.qpchange};this.notifyCallback(i)}}}}},{key:"toString",value:function(){return"QPSumObserver"}}]),e}();n.QPSumObserver=u},{"../../config/constants":33,"../../utility/timestamps":99}],64:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.SendingTrigger=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(e("../../utility/timestamps")),s=r(e("../validator")),c=1e3,u=3e4,l=function(){function e(t,n,r){i(this,e),this.last=null,this.actual=0,this.name=t,this.alpha=n,this.supplier=r}return o(e,[{key:"update",value:function(e){if(null!==this.last){var t=Math.abs(e-this.last);this.actual=t*this.alpha+this.actual*(1-this.alpha),this.last=e}else this.last=e}},{key:"doTest",value:function(e){var t=this.last;return this.update(e),null!==t&&t+this.supplier(this.actual)<e}}]),e}(),d=function(){function e(){i(this,e);var t=this;this.marginFactor=1,this.rttTester=new l("RTT Tester",.2,function(e){return Math.max(50,e)*t.marginFactor}),this.throughputTester=new l("Throughput Tester",.1,function(e){return Math.max(100,e)*t.marginFactor}),this.FLTester=new l("FL Tester",.1,function(e){return Math.max(.2,e)*t.marginFactor}),this.lastDecreased=a.getCurrent()}return o(e,[{key:"test",value:function(e){var t=e.peek();if(!t)return!1;var n=e.getTrack().data,r=t.getRTT(),i=s.checkForNan(parseInt(n.csioIntBRKbps,10)),o=t.getFractionLost();if(this.rttTester.doTest(r)||this.throughputTester.doTest(i)||this.FLTester.doTest(o))return this.marginFactor=Math.min(2*this.marginFactor,15),!0;var c=a.getCurrent();return 3e3<c-this.lastChanged&&(this.marginFactor=Math.max(this.marginFactor-.5,1),this.lastDecreased=c),!1}}]),e}(),f=function(){function e(t){i(this,e),this.notifyCallback=t,this.minInterval=c,this.maxInterval=u,this.notified=0,this.testers=new Map}return o(e,[{key:"setup",value:function(e,t){this.minInterval=e,this.maxInterval=t}},{key:"accept",value:function(e){var t=a.getCurrent(),n=t-this.notified;if(this.minInterval!==this.maxInterval){if(!(n<this.minInterval)){if(n<this.maxInterval&&!1===this.doSend(e))return;this.notifyCallback(),this.notified=t}}else this.minInterval<=n&&(this.notifyCallback(),this.notified=t)}},{key:"setIntervals",value:function(e,t){this.minInterval=e,this.maxInterval=t}},{key:"toString",value:function(){return"SendingTrigger"}},{key:"doSend",value:function(e){for(var t=0;t<e.length;++t){var n=e[t],r=n.getSSRC();if(this.testers.has(r)||this.testers.set(r,new d),this.testers.get(r).test(n))return!0}return!1}}]),e}();n.SendingTrigger=f},{"../../utility/timestamps":99,"../validator":83}],65:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.ThroughputObserver=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=r(e("../../config/constants")),a=r(e("../../utility/timestamps")),s=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.notifierCallback=t,this.observations=new Map}return i(e,[{key:"accept",value:function(e){var t=e.filter(function(e){return e.getMediaType()===o.mediaType.video&&e.getStreamType()===o.streamType.outbound});if(!(t.length<1)){var n=this;t.forEach(function(e){n.observe(e)})}}},{key:"toString",value:function(){return"ThroughputObserver"}},{key:"getObservations",value:function(e){if(this.observations.has(e))return this.observations.get(e);return this.observations.set(e,{ssrc:0,started:0,max:0,maxTs:0,stable:0,stableTs:0,ready:!1,maxVerified:!1,stableVerified:!1}),this.observations.get(e)}},{key:"observe",value:function(e){var t=e.getSSRC(),n=this.getObservations(t),r=a.getCurrent();if(!0!==n.ready){if(0===n.started)return n.ssrc=t,void(n.started=r);var i=e.getTrack().data,o=i.csioIntBRKbps,s=Math.min(50,.05*o);if(n.max<o?(n.max=o,n.maxTs=r):1e4<r-n.maxTs&&(n.maxVerified=!0),!(r-n.started<15e3)&&(o-s<i.csioAvgBRKbps&&i.csioAvgBRKbps<o+s&&(n.stableTs=r,n.stable=o,n.stableVerified=!0),n.stableVerified&&n.maxVerified)){var c={ssrc:String(n.ssrc),maxsendingKBitrate:n.max,timeToMaxSendingKBitrate:n.maxTs-n.started,stablesendingKBitrate:n.stable,timeToStableSendingKBitrate:n.stableTs-n.started};this.notifierCallback(c),n.ready=!0}}}}]),e}();n.ThroughputObserver=s},{"../../config/constants":33,"../../utility/timestamps":99}],66:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0";(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.mediaType=t,this.ssrc=n}return r(e,[{key:"getContent",value:function(){return{mediaType:this.mediaType,ssrc:this.ssrc}}}]),e}();n.OneWayMediaDisruption=i},{}],67:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,n,r,i,o,a){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.candidatePair=t,this.codec=n,this.pcHash=r,this.trackStats=i,this.transportStats=o,this.measurements=a}return r(e,[{key:"getCandidatePair",value:function(){return this.candidatePair}},{key:"getCodec",value:function(){return this.codec}},{key:"getPcHash",value:function(){return this.pcHash}},{key:"getTrackStats",value:function(){return this.trackStats}},{key:"getTransportStats",value:function(){return this.transportStats}},{key:"getMeasurements",value:function(){return this.measurements}}]),e}();n.PcStats=i},{}],68:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,n,r){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.width=t,this.height=n,this.frameRate=r}return r(e,[{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getFrameRate",value:function(){return this.frameRate}},{key:"toString",value:function(){return this.width&&this.height&&this.frameRate?this.width.toString()+"X"+this.height.toString()+"X"+this.frameRate.toString():null}}]),e}();n.Resolution=i},{}],69:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.StatsAdapter=n.StatsAdapterIO=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=r(e("../config/constants")),a=e("../collections/component"),s=e("../utility/registry"),c=r(e("../utility/hash")),u=n.StatsAdapterIO={RawStatsIn:"RawStatsIn",RawStatsOut:"RawStatsOut",UnprocessedOut:"UnprocessedOut"},l=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"StatsAdapter"));return r.bindPort(u.RawStatsIn,r.receiveRawData,r),r.declarePort(u.RawStatsOut),r.declarePort(u.UnprocessedOut),r.codeBase=e,r.browser=n,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Component),i(t,[{key:"receiveRawData",value:function(e,t){if(e){var n=this.extractRawStats(e);if(n){window&&window.csioReactNative&&(n=this.removeValues(n)),this.isConnected(u.UnprocessedOut)&&this.transmit(u.UnprocessedOut,n,t);var r=this.processRawStats(n,t);if(r&&r.transportStats)for(var i=0;i<r.transportStats.length;i++)r.transportStats[i].hash=this.getTransportHash(r.transportStats[i]);r&&r.transportStats&&this.checkTransportStatsUpdates(r.transportStats,t),r&&r.trackStats&&(r=this.backFillTrackStats(r)),r&&r.transportStats&&r.candidatePair&&(r=this.backFillCandidatePairStats(r)),r.pcHash=t,this.transmit(u.RawStatsOut,r)}}}},{key:"removeValues",value:function(e){for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.values){for(var r=0;r<n.values.length;++r)Object.assign(n,n.values[r]);delete n.values}}return e}},{key:"getIceCandidates",value:function(e){if(!e)return{localIceCandidates:[],remoteIceCandidates:[],iceCandidatePairs:[]};var t=this.extractRawStats(e);return this.processRawStatsForIceInfo(t)}},{key:"extractRawStats",value:function(e){var t=[];if(e&&e.result)t=e.result();else if(e&&e.forEach)e.forEach(function(e){t.push(e)});else for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}},{key:"normalizeIceCandidates",value:function(e){for(var t=0;t<e.length;t+=1){var n=e[t];n.transport=n.protocol?n.protocol:"udp",n.ip=n.ip?n.ip:n.ipAddress,n.port=n.portNumber?Number(n.portNumber):n.port,"ssltcp"===n.transport&&(n.transport="tcp"),n.id||(n.id="csio"+n.port)}return e}},{key:"normalizeCanidatePairs",value:function(e){for(var t=0;t<e.length;t+=1){var n=e[t];"in-progress"===n.state&&(n.state="inprogress"),n.state||(n.state="succeeded"),n.nominated||(n.nominated="true"===n.googActiveConnection),n.priority||(n.priority=123),n.id||(n.id="csio"+n.priority)}return e}},{key:"processRawStatsForIceInfo",value:function(e){var t=[],n=[],r=[],i=void 0;if(!e)return{localIceCandidates:t,remoteIceCandidates:n,iceCandidatePairs:r};for(var o=0;o<e.length;++o){var a=this.getParsedStats(e[o]),s=this.statsClassifier(a);if(s.candidatePair)r.push(s.candidatePair);else if(s.transportStats){if("transport"===s.transportStats.type){i=s.transportStats.selectedCandidatePairId;continue}r.push(s.transportStats)}else s.localCandidate?t.push(s.localCandidate):s.remoteCandidate&&n.push(s.remoteCandidate)}if(i)for(var c=0;c<r.length;++c)r[c].id===i&&(r[c].googActiveConnection="true");return{localIceCandidates:this.normalizeIceCandidates(t),remoteIceCandidates:this.normalizeIceCandidates(n),iceCandidatePairs:this.normalizeCanidatePairs(r)}}},{key:"processRawStats",value:function(e,t){var n={},r={},i={};n.tracks=[],n.candidatePair=[],n.transportStats=[],n.trackStats=[],n.codec=[];for(var a=0;a<e.length;a++){var c=this.getParsedStats(e[a]),u=this.statsClassifier(c);u.tracks?n.tracks.push(u.tracks):u.candidatePair?n.candidatePair.push(u.candidatePair):u.transportStats?this.codeBase!==o.codeBaseType.firefox?(parseInt(u.transportStats.bytesReceived,10)>0||parseInt(u.transportStats.bytesSent,10)>0)&&(n.transportStats.push(u.transportStats),"true"!==u.transportStats.googActiveConnection&&!0!==u.transportStats.googActiveConnection||(n.activeConnectionIndex=u.transportStats.length)):"true"!==u.transportStats.selected&&!0!==u.transportStats.selected||(n.transportStats.push(u.transportStats),n.activeConnectionIndex=u.transportStats.length):u.bwe?n.bwe=u.bwe:u.trackStats?n.trackStats.push(u.trackStats):u.codec?n.codec.push(u.codec):u.localCandidate?r[u.localCandidate.id]=u.localCandidate:u.remoteCandidate&&(i[u.remoteCandidate.id]=u.remoteCandidate)}if(n.tracks){var l=s.Registry.getConferenceManager().getConferenceForPcHash(t),d=void 0;l&&(d=l.getPeerConnectionManager().getPcHandlerByHash(t)),n.tracks.forEach(function(e){var t=d.getSSRCInfo(e.data.ssrc);void 0!==t&&t.localStartTime||d&&(d.updateSDP(n.tracks),t=d.getSSRCInfo(e.data.ssrc)),t&&(e.cname=t.cname,e.msid=t.msid,e.associatedVideoTag=t.associatedVideoTag,e.usageLabel=t.usageLabel)})}return n.transportStats&&this.codeBase===o.codeBaseType.firefox&&(n.transportStats=this.getAddressInfoFromCandidates(n.transportStats,r,i)),n}},{key:"getParsedStats",value:function(e){var t={};if(e.timestamp instanceof Date&&(t.timestamp=e.timestamp.getTime().toString()),e.type&&(t.type=e.type),e.names){for(var n=e.names(),r=0;r<n.length;++r)t[n[r]]=e.stat(n[r]);e.id&&(t.id=e.id)}else Object.assign(t,e);if(t.values){for(var i=0;i<t.values.length;++i)Object.assign(t,t.values[i]);delete t.values}return t}},{key:"statsClassifier",value:function(e){var t={},n=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return-1!==n.indexOf(e.type)},r=n("inbound-rtp","inboundrtp","remote-inbound-rtp"),i=n("outbound-rtp","outboundrtp","remote-outbound-rtp"),o=e.isRemote?"true"===e.isRemote||!0===e.isRemote:null;return null===o&&(o=n("remote-inbound-rtp","remote-outbound-rtp")),r||i?(t.tracks={},t.tracks.data=e,t.tracks.ssrc=e.ssrc,t.tracks.streamType=r?"inbound":"outbound",t.tracks.reportType=o?"remote":"local"):n("candidatepair")&&e.selected?t.transportStats=e:n("localcandidate","local-candidate")?t.localCandidate=e:n("remotecandidate","remote-candidate")?t.remoteCandidate=e:n("transport","googCandidatePair")?t.transportStats=e:n("VideoBwe")?t.bwe=e:n("track")?t.trackStats=e:n("candidate-pair")?t.candidatePair=e:n("codec")?t.codec=e:n("ssrc")&&(t.tracks={},t.tracks.data=e,t.tracks.ssrc=e.ssrc,t.tracks.reportType="local",t.tracks.streamType=e.bytesSent?"outbound":"inbound"),t}},{key:"getAddressInfoFromCandidates",value:function(e,t,n){for(var r=void 0,i=void 0,o=0;o<e.length;o++)r=t[e[o].localCandidateId],i=n[e[o].remoteCandidateId],r&&i&&(e[o].localAddr=r.ipAddress+":"+r.portNumber,e[o].remoteAddr=i.ipAddress+":"+i.portNumber,e[o].localAddrType=r.candidateType,e[o].remoteAddrType=i.candidateType,e[o].transportType=r.transport);return e}},{key:"getTransportHash",value:function(e){var t=void 0;return e&&(this.codeBase===o.codeBaseType.chrome?e.googLocalAddress?(t=e.googLocalAddress).concat(":",e.googRemoteAddress):e.selectedCandidatePairId&&(t=e.selectedCandidatePairId):this.codeBase===o.codeBaseType.firefox&&(t=e.localAddr).concat(":",e.remoteAddr)),c.generateHash(t)}},{key:"backFillTrackStats",value:function(e){for(var t=e.tracks.length,n=void 0,r=void 0,i=void 0,o=0;o<t;o++)(n=e.tracks[o]).data.trackId&&(r=this.getStatsForId(e.trackStats,n.data.trackId))&&(e.tracks[o].data=this.mergeObjects(e.tracks[o].data,r)),n.data.codecId&&(i=this.getStatsForId(e.codec,n.data.codecId))&&(e.tracks[o].data=this.mergeObjects(e.tracks[o].data,i));return e}},{key:"backFillCandidatePairStats",value:function(e){for(var t=e.transportStats.length,n=void 0,r=void 0,i=0;i<t;i++)(r=e.transportStats[i]).selectedCandidatePairId&&(n=this.getStatsForId(e.candidatePair,r.selectedCandidatePairId))&&(e.transportStats[i]=this.mergeObjects(e.transportStats[i],n));return e}},{key:"mergeObjects",value:function(e,t){for(var n in t)t.hasOwnProperty(n)&&"id"!==n&&"type"!==n&&(e[n]=t[n]);return e}},{key:"getStatsForId",value:function(e,t){if(e){var n=e.filter(function(e){return e.id===t});if(n.length>0)return n[0]}}},{key:"formatRelayType",value:function(e){var t="None";switch(e){case 0:t="TURN/TLS";break;case 1:t="TURN/TCP";break;case 2:t="TURN/UDP"}return t}},{key:"getRelayType",value:function(e,t){var n=this,r=void 0;return t.getIceCandidates().some(function(t){if(t.typePreference){var i=t.typePreference>>24;return"rtp"===t.protocol&&t.address===e&&(i>=0&&i<=2&&(r=n.formatTypePreference(i)),!0)}return!1}),r}},{key:"getTransportInfo",value:function(e,t){for(var n={},r=!1,i=0;i<e.length;i++){var o=e[i];if(navigator.mozGetUserMedia&&"candidatepair"===o.type&&("true"===o.selected||!0===o.selected)){n.foundActive=!0,n.localAddr=o.localAddr,n.remoteAddr=o.remoteAddr,n.localAddrType=o.localAddrType,n.remoteAddrType=o.remoteAddrType,n.transportType=o.transportType,n.localCandidateId=o.localCandidateId,n.remoteCandidateId=o.remoteCandidateId;break}if("googCandidatePair"===o.type&&("true"===o.googActiveConnection||!0===o.googActiveConnection)){n.foundActive=!0,n.localAddr=o.googLocalAddress,n.remoteAddr=o.googRemoteAddress,n.localAddrType=o.googLocalCandidateType,n.remoteAddrType=o.googRemoteCandidateType,n.transportType=o.googTransportType;break}if("transport"===o.type){r=!0,o.selectedCandidatePairId&&(n.selectedCandidatePairId=o.selectedCandidatePairId);break}}return r&&n.localAddr&&(n.ipv6=0===n.localAddr.indexOf("["),n.relayType=getRelayType(n.localAddr,t)),n}},{key:"sendFabricTransportSwitch",value:function(e,t){e.sendFabricTransportSwitch(t)}},{key:"checkTransportStatsUpdates",value:function(e,t){var n=s.Registry.getConferenceManager().getConferenceForPcHash(t);if(n){var r=n.getPeerConnectionManager().getPcHandlerByHash(t);if(r){var i=this.getTransportInfo(e,r),o=r.getTransportInfo();o&&(o.localAddr===i.localAddr&&o.remoteAddr===i.remoteAddr&&o.transportType===i.transportType&&o.selectedCandidatePairId===i.selectedCandidatePairId&&o.localCandidateId===i.localCandidateId&&o.remoteCandidateId===i.remoteCandidateId||(r.setTransportInfo(i),this.sendFabricTransportSwitch(r,i.relayType)))}}}}]),t}();n.StatsAdapter=l},{"../collections/component":26,"../config/constants":33,"../utility/hash":92,"../utility/registry":95}],70:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.StatsAssembler=n.StatsAssemblerIO=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../collections/component"),o=n.StatsAssemblerIO={StatsTupleIn:"StatsTupleIn",CallstatsOut:"CallstatsOut"},a=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"StatsAssembler"));return e.pcHashes=[],e.bindPort(o.StatsTupleIn,e.receiveStats,e),e.declarePort(o.CallstatsOut),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),r(t,[{key:"receiveStats",value:function(e){for(var t=this,n=0;n<e.tracks.length;n++)!function(n){var r=e.tracks[n];if(t.pcHashes.find(function(e){return e===r.pcHash}))return"continue";t.pcHashes.push(r.pcHash)}(n);var r=e.getTransportStats();for(n=0;n<this.pcHashes.length;n++){var i=this.pcHashes[n],a={};a.codec=e.getCodec(),a.trackStats=e.getTrackStats(),a.tracks=[];for(var s=0;s<e.tracks.length;s++){var c=e.tracks[s];c.pcHash===i&&a.tracks.push(c)}var u=r.get(i);1==u.length?a.Transport=u[0]:a.Transport=u,this.transmit(o.CallstatsOut,i,a)}}}]),t}();n.StatsAssembler=a},{"../collections/component":26}],71:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.StatsCallbackBuilder=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../utility/registry"),o=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.callback=null}return r(e,[{key:"setCallback",value:function(e){this.callback=e}},{key:"buildStats",value:function(e,t){this.callback&&this.buildFromUnifiedFormat(e,t)}},{key:"getConnectionState",value:function(){return!0===navigator.onLine?"online":"offline"}},{key:"buildConferenceUrl",value:function(e){var t=e.getConferenceId(),n=i.Registry.getConferenceManager().get(t);return n?n.getUrl():null}},{key:"buildFromUnifiedFormat",value:function(e,t){var n={};n.connectionState=this.getConnectionState(),n.conferenceURL=this.buildConferenceUrl(t),n.fabricState=t.getPcState(),n.streams={},n.mediaStreamTracks=[];for(var r=0;r<e.length;r++){var i=e[r];if("inbound-rtp"===i.type||"outbound-rtp"===i.type||"ssrc"===i.type||"inboundrtp"===i.type||"outboundrtp"===i.type){var o={ssrc:i.ssrc,statsType:i.type,fractionLoss:i.csioIntFL,bitrate:i.csioIntBRKbps,quality:i.csioMark,mediaType:i.csioMediaType,jitter:i.jitter,audioOutputLevel:i.audioOutputLevel,audioIntputLevel:i.audioInputLevel,audioLevel:i.audioLevel,averageRTT:i.csioAvgRtt,averageJitter:i.csioAvgJitter,packetLossPercentage:i.csioPktLossPercentage,rtt:i.roundTripTime,packetRate:i.csioIntPR,remoteUserID:t.getRemoteId()},a=t.getSSRCInfo(i.ssrc+"");if(a&&(o.cname=a.cname,o.msid=a.msid,o.usageLabel=a.usageLabel,o.associatedVideoTag=a.associatedVideoTag),i.hasOwnProperty("googRtt")&&(o.rtt=i.googRtt),i.hasOwnProperty("mozRtt")&&(o.rtt=i.mozRtt),i.hasOwnProperty("googJitterReceived")&&(o.jitter=i.googJitterReceived),"inboundrtp"===o.statsType)o.statsType="inbound-rtp";else if("outboundrtp"===o.statsType)o.statsType="outbound-rtp";else if("ssrc"===o.statsType){i.id.indexOf("send")>0?o.statsType="outbound-rtp":o.statsType="inbound-rtp"}"remote-inbound-rtp"!==o.statsType&&"remote-outbound-rtp"!==o.statsType&&(!0!==i.isRemote&&"true"!==i.isRemote||(o.statsType="remote-"+o.statsType)),n.streams[i.ssrc]=o,n.mediaStreamTracks.push(o)}}this.callback(n)}}]),e}();n.StatsCallbackBuilder=o},{"../utility/registry":95}],72:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.StatsMonitor=n.StatsMonitorIO=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../collections/component"),a=e("./tracksmonitor"),s=e("./transportsmonitor"),c=e("./statstuple"),u=e("../utility/registry"),l=e("./monitorhooks/sendingtrigger"),d=e("./monitorhooks/onewaymediaobserver"),f=e("./monitorhooks/throughputobserver"),p=e("./monitorhooks/cpulimitationobserver"),h=e("./monitorhooks/qpsumobserver"),v=r(e("../config/constants")),m=r(e("../utility/csiologger")),g=n.StatsMonitorIO={PcStatsTupleIn:"PcStatsTupleIn",StatsTupleOut:"StatsTupleOut"},y=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"StatsMonitor"));return n.bindPort(g.PcStatsTupleIn,n.receive,n),n.declarePort(g.StatsTupleOut),n.lastPcStats=null,n.lastPcHash=null,n.tracksmonitor=new a.TracksMonitor,n.transportsmonitor=new s.TransportsMonitor(e),n.candidatepairs=new Map,n.monitorhooks=[],n.sendingTrigger=new l.SendingTrigger(n.sendStatsTuple.bind(n)),n.oneWayMediaObserver=new d.OneWayMediaObserver(n.sendDisruptions.bind(n)),n.throughputObserver=new f.ThroughputObserver(n.sendThroughputObservations.bind(n)),n.cpuLimitationObserver=new p.CPULimitationObserver(n.sendCPULimitationObservations.bind(n)),n.qpSumObserver=new h.QPSumObserver(n.sendQPSumDistortions.bind(n)),n.setupHooks(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),i(t,[{key:"setupHooks",value:function(){this.monitorhooks.push(this.sendingTrigger.accept.bind(this.sendingTrigger)),this.monitorhooks.push(this.oneWayMediaObserver.accept.bind(this.oneWayMediaObserver)),this.monitorhooks.push(this.throughputObserver.accept.bind(this.throughputObserver)),this.monitorhooks.push(this.cpuLimitationObserver.accept.bind(this.cpuLimitationObserver)),this.monitorhooks.push(this.qpSumObserver.accept.bind(this.qpSumObserver))}},{key:"setIntervals",value:function(e,t){this.sendingTrigger.setup(e,t)}},{key:"receive",value:function(e){var t=e.getPcHash(),n=e.getMeasurements();this.candidatepairs.set(t,e.getCandidatePair()),this.transportsmonitor.set(t,e.getTransportStats());for(var r=0;r<n.length;r++){var i=n[r],o=this.tracksmonitor.getMonitor(i);o?o.add(i):m.warn("No monitor for ssrc "+i.getSSRC())}this.lastPcStats=e,this.lastPcHash=t;for(var a=this.tracksmonitor.getMonitors(),s=this.monitorhooks,c=0;c<s.length;c++)(0,s[c])(a)}},{key:"getCandidatePairs",value:function(){var e=[];return this.candidatepairs.forEach(function(t,n){var r=[n,t];e.push(r)}),e}},{key:"sendStatsTuple",value:function(){var e=new c.StatsTuple(this.getCandidatePairs(),this.lastPcStats.getCodec(),this.lastPcStats.getTrackStats(),this.transportsmonitor.getIntervalStats(),this.tracksmonitor.extractTracks());this.transmit(g.StatsTupleOut,e)}},{key:"sendDisruptions",value:function(e){var t=this;e.forEach(function(e){t.sendEventMsg(v.internalFabricEvent.oneWayMedia,e.getContent())})}},{key:"sendCPULimitationObservations",value:function(e){}},{key:"sendQPSumDistortions",value:function(e){}},{key:"sendThroughputObservations",value:function(e){this.sendEventMsg(v.internalFabricEvent.sendingThroughputObservations,e)}},{key:"sendEventMsg",value:function(e,t){if(this.lastPcHash){var n=u.Registry.getConferenceManager().getConferenceForPcHash(this.lastPcHash);if(n){var r=n.getPeerConnectionManager().getPcHandlerByHash(this.lastPcHash),i=r.getPeerConnection(),o=r.getConferenceId();u.Registry.getEventMessageBuilder().make(e,o,i,t)}}}}]),t}();n.StatsMonitor=y},{"../collections/component":26,"../config/constants":33,"../utility/csiologger":88,"../utility/registry":95,"./monitorhooks/cpulimitationobserver":61,"./monitorhooks/onewaymediaobserver":62,"./monitorhooks/qpsumobserver":63,"./monitorhooks/sendingtrigger":64,"./monitorhooks/throughputobserver":65,"./statstuple":75,"./tracksmonitor":81,"./transportsmonitor":82}],73:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.StatsParser=n.StatsParserIO=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../collections/component"),a=e("./measurement"),s=e("./pcstats"),c=e("../utility/rttregistry"),u=r(e("./validator")),l=r(e("../config/constants")),d=r(e("../utility/csiologger")),f=n.StatsParserIO={RawStatsIn:"RawStatsIn",PcStatsTupleOut:"PcStatsTupleOut"},p=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"StatsParser"));return e.bindPort(f.RawStatsIn,e.receive,e),e.declarePort(f.PcStatsTupleOut),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),i(t,[{key:"receive",value:function(e){if(null!==e){for(var t=e.tracks,n=[],r=0;r<t.length;++r){var i=t[r];if(i&&i.data){var o=a.Measurement.make(e.pcHash,this.getSSRC(i),this.getStreamType(i),this.getMediaType(i),this.getFrameRateReceived(i),this.getFrameHeight(i),this.getFrameWidth(i),this.getDroppedFramesNum(i),this.getFramesReceived(i),this.getRTT(i),this.getJitter(i),this.getLostPackets(i),this.getReceivedPackets(i),this.getSentPackets(i),this.getDiscardedPackets(i),this.getSentBytes(i),this.getReceivedBytes(i),i);n.push(o)}else d.log("No track or track.data.")}var c=new s.PcStats(e.candidatePair,e.codec,e.pcHash,e.trackStats,e.transportStats,n);this.transmit(f.PcStatsTupleOut,c)}else d.warn("Stats object can not be null")}},{key:"getSSRC",value:function(e){return e.ssrc}},{key:"getStreamType",value:function(e){return e.streamType===l.streamType.inbound?l.streamType.inbound:e.streamType===l.streamType.outbound?l.streamType.outbound:void 0}},{key:"getSentBytes",value:function(e){if(void 0===e.data.bytesSent)return-1;var t=u.checkForNan(parseInt(e.data.bytesSent,10));return null!==t?t:-1}},{key:"getReceivedBytes",value:function(e){if(void 0===e.data.bytesReceived)return-1;var t=u.checkForNan(parseInt(e.data.bytesReceived,10));return null!==t?t:-1}},{key:"getReceivedPackets",value:function(e){if(void 0===e.data.packetsReceived)return-1;var t=u.checkForNegativeValue(parseInt(e.data.packetsReceived,10));return null!==t?t:-1}},{key:"getSentPackets",value:function(e){if(void 0===e.data.packetsSent)return-1;var t=u.checkForNegativeValue(parseInt(e.data.packetsSent,10));return null!==t?t:-1}},{key:"getDiscardedPackets",value:function(e){if(void 0===e.data.discardedPackets)return-1;var t=u.checkForNan(parseInt(e.data.discardedPackets,10));return null!==t?t:-1}},{key:"getLostPackets",value:function(e){if(void 0===e.data.packetsLost)return-1;var t=u.checkForNegativeValue(parseInt(e.data.packetsLost,10));return null!==t?t:-1}},{key:"getDroppedFramesNum",value:function(e){if(void 0===e.data.droppedFrames)return-1;var t=u.checkForNegativeValue(parseInt(e.data.droppedFrames,10));return null!==t?t:-1}},{key:"getFramesReceived",value:function(e){if(void 0===e.data.framesReceived)return-1;var t=u.checkForNegativeValue(parseInt(e.data.framesReceived,10));return null!==t?t:-1}},{key:"getFrameRateReceived",value:function(e){var t=null;return void 0!==e.data.googFrameRateOutput?t=parseInt(e.data.googFrameRateOutput,10):void 0!==e.data.googFrameRateDecoded?t=parseInt(e.data.googFrameRateDecoded,10):void 0!==e.data.googFrameRateReceived?t=parseInt(e.data.googFrameRateReceived,10):void 0!==e.data.googFrameRateSent?t=parseInt(e.data.googFrameRateSent,10):void 0!==e.data.framerateMean?t=parseInt(e.data.framerateMean,10):void 0!==e.data.framesPerSecond&&(t=parseInt(e.data.framesPerSecond,10)),void 0!==t&&(t=u.checkForNegativeValue(t)),t}},{key:"getFrameHeight",value:function(e){var t=void 0;return void 0!==e.data.googFrameHeightReceived?t=e.data.googFrameHeightReceived:void 0!==e.data.googFrameHeightSent?t=e.data.googFrameHeightSent:void 0!==e.data.frameHeight&&(t=e.data.frameHeight),t}},{key:"getJitter",value:function(e){return void 0!==e.data.googJitterReceived?u.checkForNan(parseFloat(e.data.googJitterReceived,10)):void 0!==e.data.jitter?u.checkForNan(parseFloat(e.data.jitter,10)):void 0}},{key:"getFrameWidth",value:function(e){return void 0!==e.data.googFrameWidthReceived?e.data.googFrameWidthReceived:void 0!==e.data.googFrameWidthSent?e.data.googFrameWidthSent:void 0!==e.data.frameWidth?e.data.frameWidth:void 0}},{key:"getRTT",value:function(e){var t=function(e){return isNaN(e)||e<0?null:e};if(void 0!==e.data.googRtt)return t(parseFloat(e.data.googRtt,10));if(void 0!==e.data.mozRtt)return t(parseFloat(e.data.mozRtt,10));if(e.data.roundTripTime)return t(parseFloat(e.data.roundTripTime,10));var n=this.getSSRC(e),r=(0,c.getRTTRegistry)().getRTT(n);return r&&(e.data.roundTripTime=r),r}},{key:"getMediaType",value:function(e){var t=l.mediaType.unknown;return e.data&&void 0!==e.data.mediaType?e.data.mediaType:(void 0!==e.data.googFrameRateReceived||void 0!==e.data.googFrameRateSent?t=l.mediaType.video:void 0!==e.data.audioInputLevel||void 0!==e.data.audioOutputLevel?t=l.mediaType.audio:e.data.mediaType?t=e.data.mediaType:void 0!==e.data.framerateMean&&(t=l.mediaType.video),t)}}]),t}();n.StatsParser=p},{"../collections/component":26,"../config/constants":33,"../utility/csiologger":88,"../utility/rttregistry":96,"./measurement":60,"./pcstats":67,"./validator":83}],74:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.StatsTransmitter=n.StatsTransmitterIO=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../collections/component"),a=e("../utility/registry"),s=r(e("../config/constants")),c=r(e("../utility/csiologger")),u=n.StatsTransmitterIO={CallstatsIn:"CallstatsIn",UnprocessedIn:"UnprocessedIn"},l=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"StatsTransmitter"));return e.battery=a.Registry.getBattery(),e.lastUnprocessedStats={},e.bindPort(u.CallstatsIn,e.receiveCallstats,e),e.bindPort(u.UnprocessedIn,e.receiveUnprocessed,e),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),i(t,[{key:"receiveUnprocessed",value:function(e,t){this.lastUnprocessedStats[t]=e}},{key:"receiveCallstats",value:function(e,t){var n;(n=this.getUnifiedFormat(t,e))?this.send(e,n):c.warn("Content can not be sent")}},{key:"send",value:function(e,t){var n=a.Registry.getConferenceManager().getConferenceForPcHash(e);if(n){var r=n.getPeerConnectionManager().getPcHandlerByHash(e);if(r){var i=r.getPcState();i!==s.fabricState.terminated&&i!==s.fabricState.hold&&(a.Registry.getEventMessageBuilder().make(s.callstatsChannels.processedStats,r.getConferenceId(),r.getPeerConnection(),t),this.sendToStatsCallback(t.stats,r))}}}},{key:"sendToStatsCallback",value:function(e,t){var n=a.Registry.getStatsCallbackBuilder();n&&n.buildStats(e,t)}},{key:"getUnifiedFormat",value:function(e,t){for(var n=this.lastUnprocessedStats[t],r=[],i=0;i<n.length;i++){var o=n[i],s={};if(o.id&&(s.id=o.id),o.timestamp&&(s.timestamp=o.timestamp),o.type&&(s.type=o.type),o.names)for(var c=o.names(),u=0;u<c.length;++u)s[c[u]]=o.stat(c[u]);else Object.assign(s,o);if(s.values){for(var l=0;l<s.values.length;++l)Object.assign(s,s.values[l]);delete s.values}var d=function(t){for(var n=0;n<e.tracks.length;n++){var r=e.tracks[n];if(r.data.id===t.id&&r.data.type===t.type)return r.data}return t.id===e.Transport.id&&t.type===e.Transport.type?e.Transport:null}(o);if(d){for(var f in d)if(d.hasOwnProperty(f)){if("id"===f||"type"===f||"timestamp"===f)continue;s[f]=d[f]}r.push(s)}else r.push(s)}var p={stats:r};return p.wifiStats=a.Registry.getWifiStatsExecutor().getWifiStats(),p.batteryStatus={},p.batteryStatus.batteryLevel=this.battery.getLevel(),p.batteryStatus.isBatteryCharging=this.battery.getCharging(),p}}]),t}();n.StatsTransmitter=l},{"../collections/component":26,"../config/constants":33,"../utility/csiologger":88,"../utility/registry":95}],75:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,n,r,i,o){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.candidatePairs=t,this.codec=n,this.trackStats=r,this.transportStats=i,this.tracks=o}return r(e,[{key:"getCandidatePairs",value:function(){return this.candidatePairs}},{key:"getCodec",value:function(){return this.codec}},{key:"getTrackStats",value:function(){return this.trackStats}},{key:"getTransportStats",value:function(){return this.transportStats}},{key:"getTracks",value:function(){return this.tracks}}]),e}();n.StatsTuple=i},{}],76:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SWAvg=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./swplugin"),o=function(e){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));return i.sum=0,i.counter=0,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.SWPlugin),r(t,[{key:"add",value:function(e){this.filter(e)&&(this.sum+=this.extract(e),++this.counter,this.calculate())}},{key:"remove",value:function(e){this.filter(e)&&(this.sum-=this.extract(e),--this.counter,this.calculate())}},{key:"calculate",value:function(){var e=0;this.counter<1?this.notify(e):(e=this.sum/this.counter,this.notify(e))}}]),t}();n.SWAvg=o},{"./swplugin":79}],77:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SWBTreePercentile=void 0;var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./swplugin"),a=e("../../collections/binarytree"),s=function(e){function t(e,n,r,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r,i,s));if(99<e||e<1)throw new RangeError("Percentile parameter must be between 1 and 99");return u.comparator=n,u.percentile=e,u.meanCalcer=c,u.estimator=o,u.ratio=e/(100-e),u.maxtree=new a.BinaryTree(n),u.mintree=new a.BinaryTree(n),u.ratio<1?u.required=1/u.ratio+1:1<u.ratio?u.required=u.ratio+1:u.required=2,u.result=null,u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.SWPlugin),i(t,[{key:"add",value:function(e){if(this.filter(e)){if(this.maxtree.getNodeCounter()<1)return this.maxtree.insert(e),void this.calculate();this.comparator(e,this.maxtree.getTopValue())<=0?this.maxtree.insert(e):this.mintree.insert(e),this.balancing(),this.calculate()}}},{key:"remove",value:function(e){if(this.filter(e)){var t=this.mintree.getNodeCounter();this.maxtree.getNodeCounter()<1?this.mintree.delete(e):t<1?this.maxtree.delete(e):this.comparator(e,this.maxtree.getTopValue())<=0?this.maxtree.delete(e):this.mintree.delete(e),this.calculate()}}},{key:"getThresholds",value:function(){var e=this.mintree.getSize(),t=this.maxtree.getSize(),n=e+1,r=t+1;return 1<this.ratio?(n=Math.ceil(e*this.ratio),r=Math.floor(t/this.ratio)+1):this.ratio<1&&(n=Math.floor(e*this.ratio)+1,r=Math.ceil(t/this.ratio)),[n,r]}},{key:"balancing",value:function(){var e=this.mintree,t=this.maxtree,n=e.getSize(),i=t.getSize();if(!(i+n<this.required)){if(n<1)return void e.insertNodeAtBottom(t.popTopNode());for(i<1&&t.insertNodeAtTop(e.popBottomNode());;){var o=1<e.getNodeCounter(),a=1<t.getNodeCounter(),s=e.getBottomNode().getLength(),c=t.getTopNode().getLength();if(e.getNodeCounter()<1||t.getNodeCounter()<1)break;var u=this.getThresholds(),l=r(u,2),d=l[0],f=l[1];if(a&=n+c<=f,o&=i+s<=d,n=e.getSize(),d<(i=t.getSize())&&a)e.insertNodeAtBottom(t.popTopNode());else{if(!(f<n&&o))break;t.insertNodeAtTop(e.popBottomNode())}}}}},{key:"getMean",value:function(e,t){return this.meanCalcer?this.meanCalcer(e,t):e}},{key:"estimate",value:function(e,t){return this.estimator?this.estimator(e,t):null}},{key:"calculate",value:function(){var e=null,t=this.mintree,n=this.maxtree,r=t.getSize(),i=n.getSize(),o=i+r;if(!(o<1)){if(o<this.required||r<1||i<1){if(0==o)return;var a=void 0,s=void 0;r<1?(a=this.maxtree.getBottomValue(),s=this.maxtree.getTopValue()):i<1?(a=this.mintree.getBottomValue(),s=this.mintree.getTopValue()):(s=this.mintree.getTopValue(),a=this.maxtree.getBottomValue());var c=this.estimate(a,s);return void this.notify(c)}var u=n.getTopNode(),l=t.getBottomNode();if(u||l){if(!u){var d=this.extract(l);return void this.notify(d)}if(!l){var f=this.extract(u);return void this.notify(f)}var p=o*(this.percentile/100);if(Number.isInteger(p)){var h=Math.floor(p);e=Math.ceil(p+1)<=i?u.peek():h<=i?this.getMean(u.peek(),l.peek()):l.peek()}else{var v=i/r;e=this.ratio<v?u.peek():v<this.ratio?l.peek():this.ratio<1?l.peek():u.peek()}var m=this.extract(e);this.notify(m)}}}}]),t}();n.SWBTreePercentile=s},{"../../collections/binarytree":23,"./swplugin":79}],78:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SWFunctor=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./swplugin"),o=function(e){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,null,null,r));return i.addFunc=e,i.remFunc=n,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.SWPlugin),r(t,[{key:"add",value:function(e){this.filter(e)&&this.addFunc&&this.addFunc(e)}},{key:"remove",value:function(e){this.filter(e)&&this.remFunc&&this.remFunc(e)}},{key:"toString",value:function(){return"SWFuncPlugin"}}]),t}();n.SWFunctor=o},{"./swplugin":79}],79:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SWPlugin=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../../utility/csiologger")),o=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.extractorFnc=t,this.notifierFnc=n,this.filterFunc=r}return r(e,[{key:"notify",value:function(e){this.notifierFnc?this.notifierFnc(e):i.warn("Failed notification for "+this.toString())}},{key:"extract",value:function(e){return this.extractorFnc?this.extractorFnc(e):(i.warn(this.toString()+" tried to extract without extractorFnc"),null)}},{key:"filter",value:function(e){return!this.filterFunc||this.filterFunc(e)}},{key:"add",value:function(e){i.log("Abstract method is called width value: "+e)}},{key:"remove",value:function(e){i.log("Abstract method is called with value: "+e)}},{key:"toString",value:function(){return"SWPlugin"}}]),e}();n.SWPlugin=o},{"../../utility/csiologger":88}],80:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){return t.green<=e?v.avQualityRatings.excellent:t.red<e?v.avQualityRatings.fair:v.avQualityRatings.bad}function a(e,t){return t.red<e?v.avQualityRatings.bad:t.green<=e?v.avQualityRatings.fair:v.avQualityRatings.excellent}Object.defineProperty(n,"__esModule",{value:!0}),n.TrackMonitor=void 0;var s=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("../utility/registry"),l=e("../collections/slidingwindow"),d=e("../statspipeline/swplugins/swavg"),f=e("../statspipeline/swplugins/swbtreepercentile"),p=e("../statspipeline/swplugins/swfunctor"),h=r(e("../utility/timestamps")),v=r(e("../config/constants")),m=r(e("../utility/csiologger")),g=e("../utility/rttregistry"),y=function(){function e(){i(this,e),this.evaluators=[]}return c(e,[{key:"addEvaluator",value:function(e){var t={processFnc:e,weight:arguments.length>1&&void 0!==arguments[1]?arguments[1]:1};this.evaluators.push(t)}},{key:"getQuality",value:function(e){for(var t=0,n=[],r=0,i=0;i<this.evaluators.length;i++){var o=this.evaluators[i],a=0,s=o.processFnc?o.processFnc(e):0;if(s){if(s===v.avQualityRatings.bad)a=v.qualityRating.bad;else if(s===v.avQualityRatings.fair)a=v.qualityRating.fair;else if(s===v.avQualityRatings.excellent)a=v.qualityRating.excellent;else if(s===v.avQualityRatings.unknown)continue;t+=o.weight,n.push({result:a,weight:o.weight})}}for(var c=0;c<n.length;c++){var u=n[c];r+=u.result*(u.weight/t)}return(r=Math.floor(r))===v.qualityRating.excellent?v.avQualityRatings.excellent:r===v.qualityRating.good?v.avQualityRatings.fair:r===v.qualityRating.fair?v.avQualityRatings.fair:r===v.qualityRating.poor?v.avQualityRatings.fair:r===v.qualityRating.bad?v.avQualityRatings.bad:void 0}}]),e}(),b=function(e){function t(e,n,r,o){i(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return a.thresholds=[],a.enableThresholds=!1,a.requestTime=0,a.started=0,a.created=h.getCurrent(),a.mediaType=o,a.streamType=r,a.qualityHelper=new y,a.metrics=a.makeTrack(),a.lastTrack={},a.prevFrameRateMean=null,a.ssrc=null,a.scsHelper={total:0,above:0,ccDriven:0,sumMaxBitrateDiff:0,sumThroughputDiff:0,prevCsioAvgBRKbps:0},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.SlidingWindow),c(t,null,[{key:"make",value:function(e,n,r,i){var o=new t(e,n,r,i),a=o.metrics;return o.attach(new d.SWAvg(function(e){return e.getJitter()},function(e){a.csioAvgJitter=e},function(e){var t=e.getJitter();return null!=t})),o.attach(new d.SWAvg(function(e){return e.getRTT()},function(e){a.csioAvgRtt=e},function(e){var t=e.getRTT();return null!=t})),o.attach(new f.SWBTreePercentile(95,function(e,t){var n=e.getJitter(),r=t.getJitter();return n==r?0:n<r?-1:1},function(e){return e.getJitter()},function(e){a.csioPercentileJitter=e},function(e,t){return t?t.getJitter():e?e.getJitter():void 0},function(e){var t=e.getJitter();return null!=t},function(e,t){return e})),o.attach(new f.SWBTreePercentile(95,function(e,t){var n=e.getRTT(),r=t.getRTT();return n==r?0:n<r?-1:1},function(e){return e.getRTT()},function(e){a.csioSig2Latency=e,a.csioeM=e+40},function(e,t){return t?t.getRTT():e?e.getRTT():void 0},function(e){var t=e.getRTT();return null!=t},function(e,t){return e})),r===v.streamType.inbound?t.setupInboundMonitor(o):r===v.streamType.outbound?t.setupOutboundMonitor(o):m.warn("Unrecognized streamType ("+r+") at TrackMonitor"),i===v.mediaType.audio?t.setupAudioMonitor(o):i===v.mediaType.video?t.setupVideoMonitor(o):m.warn("Unrecognized mediaType ("+i+") at TrackMonitor"),r===v.streamType.inbound&&i===v.mediaType.audio?t.setupInbAudioQualityEvaluator(o):r===v.streamType.inbound&&i===v.mediaType.video?t.setupInbVideoQualityEvaluator(o):r===v.streamType.outbound&&i===v.mediaType.audio?t.setupOutbAudioQualityEvaluator(o):r===v.streamType.outbound&&i===v.mediaType.video&&(t.setupOutbVideoQualityEvaluator(o),t.setupSCSValidator(o)),o.addPostProcess(function(e){a.csioMark=o.getQuality(e)}),o}},{key:"setupInbAudioQualityEvaluator",value:function(e){var t=e.metrics;e.addQualityEvaluator(function(e){return void 0===t.csioIntBRKbps||null===t.csioIntBRKbps||t.csioIntBRKbps<0?v.avQualityRatings.unknown:o(t.csioIntBRKbps,v.throughputThreshold.audio)}),e.addQualityEvaluator(function(e){return void 0===t.csioIntFL||null===t.csioIntFL||t.csioIntFL<0?v.avQualityRatings.unknown:a(t.csioIntFL,v.fractionalLossThreshold.audio)}),e.addQualityEvaluator(function(e){return void 0===t.csioeM||null===t.csioeM?v.avQualityRatings.unknown:a(t.csioeM,v.eModelThreshold.audio)})}},{key:"setupOutbAudioQualityEvaluator",value:function(e){var t=e.metrics;e.addQualityEvaluator(function(e){return void 0===t.csioIntBRKbps||null===t.csioIntBRKbps||t.csioIntBRKbps<0?v.avQualityRatings.unknown:o(t.csioIntBRKbps,v.throughputThreshold.audio)}),e.addQualityEvaluator(function(e){return void 0===t.csioeM||null===t.csioeM?v.avQualityRatings.unknown:a(t.csioeM,v.eModelThreshold.audio)})}},{key:"setupInbVideoQualityEvaluator",value:function(e){var t=e.metrics;e.addQualityEvaluator(function(e){return void 0===t.csioIntBRKbps||null===t.csioIntBRKbps||t.csioIntBRKbps<0?v.avQualityRatings.unknown:o(t.csioIntBRKbps,v.throughputThreshold.video)}),e.addQualityEvaluator(function(n){return void 0===t.csioFrameRateMean||null===t.csioFrameRateMean?v.avQualityRatings.unknown:t.csioFrameRateMean&&e.prevFrameRateMean?o(t.csioFrameRateMean/e.prevFrameRateMean,v.currOverPrevFrameRateThreshold.video):v.avQualityRatings.bad}),e.addQualityEvaluator(function(e){return void 0===t.csioSig2Latency||null===t.csioSig2Latency?v.avQualityRatings.unknown:a(t.csioSig2Latency,v.rttThreshold.video)})}},{key:"setupOutbVideoQualityEvaluator",value:function(e){var t=e.metrics;e.addQualityEvaluator(function(e){return null==t.csioIntBRKbps||null==t.csioIntBRKbps?v.avQualityRatings.unknown:o(t.csioIntBRKbps,v.throughputThreshold.video)}),e.addQualityEvaluator(function(n){return void 0===t.csioFrameRateMean||null===t.csioFrameRateMean?v.avQualityRatings.unknown:t.csioFrameRateMean&&e.prevFrameRateMean?o(t.csioFrameRateMean/e.prevFrameRateMean,v.currOverPrevFrameRateThreshold.video):v.avQualityRatings.bad}),e.addQualityEvaluator(function(e){return void 0===t.csioSig2Latency||null===t.csioSig2Latency?v.avQualityRatings.unknown:a(t.csioSig2Latency,v.rttThreshold.video)})}},{key:"setupInboundMonitor",value:function(e){var t=e.metrics;e.addPreProcess(function(n){var r=n.getLostPackets(),i=n.getReceivedPackets(),o=e.getRequestedMeasurement(),a=0,s=0;o?(a=r-o.getLostPackets(),s=i-o.getReceivedPackets()):(a=r,s=i);var c=0;if((0<a||0<s)&&(c=a/(s+a)),t.csioIntPktLoss=a,t.csioIntFL=c,n.setFractionLost(c),!n.getFrameRateReceived()&&n.getFramesReceived()&&0<e.started){var u=n.getFramesReceived(),l=h.getCurrent()-e.started;t.csioEstFrameRatePerSecond=1e3*u/l;var d=n.getSSRC(),f=(0,g.getRTTRegistry)().getFrameRate(d);f&&(t.legacyFrameRatePerSecond=f)}}),e.attach(new p.SWFunctor(function(n){var r=h.getCurrent(),i=n.getResolution(),o=e.getRequestedMeasurement(),a=e.getRequestTime(),s=n.getLostPackets(),c=8*n.getReceivedBytes(),l=n.getReceivedPackets(),d=r-e.getStartTime(),f=0,p=0,v=0,m=0,g=1e3,y=Math.max(r-e.getStartTime(),g);o?(m=l-o.getReceivedPackets(),f=c-8*o.getReceivedBytes(),p=s-o.getLostPackets(),v=Math.max(r-a,g)):(u.Registry.getCredentials().getAdaptiveInterval(),g=u.Registry.getCredentials().getStatsSubmissionInterval(),y=Math.max(r-e.getStartTime(),g),m=l,f=c,p=s,v=Math.max(y,g)),t.csioIntPktRcv=m,t.csioIntPR=m/(v/1e3),t.csioAvgBRKbps=c/y,t.csioIntBRKbps=f/v,t.csioAvgPacketSize=n.getReceivedBytes()/l,t.csioIntMs=d,t.csioTimeElapseMs=v,t.csiores=i,t.csioPktLostPercentage=p/f*100},null,null)),e.attach(new f.SWBTreePercentile(95,function(e,t){var n=e.getFractionLost(),r=t.getFractionLost();return n==r?0:n<r?-1:1},function(e){return e.getFractionLost()},function(e){t.csioPercentileFl=e},function(e,t){return t?t.getFractionLost():e?e.getFractionLost():void 0},function(e){var t=e.getFractionLost();return null!=t},function(e,t){return e}))}},{key:"setupOutboundMonitor",value:function(e){var t=e.metrics;e.addPreProcess(function(n){var r=n.getLostPackets(),i=n.getSentPackets(),o=e.getRequestedMeasurement(),a=0,s=0;o?(a=r-o.getLostPackets(),s=i-o.getSentPackets()):(a=r,s=i);var c=0;(0<a||0<s)&&(c=a/(s+a)),t.csioIntPktLoss=a,t.csioIntFL=c,n.setFractionLost(c)}),e.attach(new p.SWFunctor(function(n){var r=h.getCurrent(),i=n.getResolution(),o=e.getRequestedMeasurement(),a=e.getRequestTime(),s=n.getLostPackets(),c=8*n.getSentBytes(),l=n.getSentPackets(),d=r-e.getStartTime(),f=0,p=0,v=0,m=0,g=1e3,y=Math.max(r-e.getStartTime(),g);o?(m=l-o.getSentPackets(),f=c-8*o.getSentBytes(),p=s-o.getLostPackets(),v=Math.max(r-a,g)):(u.Registry.getCredentials().getAdaptiveInterval(),g=u.Registry.getCredentials().getStatsSubmissionInterval(),y=Math.max(r-e.getStartTime(),g),m=l,f=c,p=s,v=Math.max(y,g)),t.csioIntPktRcv=m,t.csioAvgBRKbps=c/y,t.csioIntBRKbps=f/v,t.csioIntPR=m/(v/1e3),t.csioAvgPacketSize=n.getSentBytes()/l,t.csioIntMs=d,t.csioTimeElapseMs=v,t.csiores=i,t.csioPktLostPercentage=p/f*100},null,null)),e.attach(new f.SWBTreePercentile(95,function(e,t){var n=e.getFractionLost(),r=t.getFractionLost();return n==r?0:n<r?-1:1},function(e){return e.getFractionLost()},function(e){t.csioPercentileFl=e},function(e,t){return t?t.getFractionLost():e?e.getFractionLost():void 0},function(e){var t=e.getFractionLost();return null!=t},function(e,t){return e}))}},{key:"setupAudioMonitor",value:function(e){var t=e.metrics;e.attach(new p.SWFunctor(function(e){t.csioMediaType=v.mediaType.audio},null,null))}},{key:"setupVideoMonitor",value:function(e){var t=e.metrics;e.attach(new d.SWAvg(function(e){return e.getFrameRateReceived()},function(n){e.prevFrameRateMean=t.csioFrameRateMean,t.csioFrameRateMean=n},function(e){var t=e.getFrameRateReceived();return null!=t})),e.attach(new d.SWAvg(function(e){return e.getFrameHeight()},function(e){t.csioFrameHeightMean=e},function(e){var t=e.getFrameHeight();return null!=t})),e.attach(new d.SWAvg(function(e){return e.getFrameWidth()},function(e){t.csioFrameWidthMean=e},function(e){var t=e.getFrameWidth();return null!=t})),e.attach(new f.SWBTreePercentile(95,function(e,t){var n=e.getFrameRateReceived(),r=t.getFrameRateReceived();return n==r?0:n<r?-1:1},function(e){return e.getFrameRateReceived()},function(e){t.csioFrameRate95Percentile=e},function(e,t){return t?t.getFrameRateReceived():e?e.getFrameRateReceived():void 0},function(e){var t=e.getFrameRateReceived();return null!=t},function(e,t){return e})),e.attach(new f.SWBTreePercentile(50,function(e,t){var n=e.getFrameRateReceived(),r=t.getFrameRateReceived();return n==r?0:n<r?-1:1},function(e){return e.getFrameRateReceived()},function(e){t.csioFrameRate50Percentile=e},function(e,t){return t?t.getFrameRateReceived():e?e.getFrameRateReceived():void 0},function(e){var t=e.getFrameRateReceived();return null!=t},function(e,t){return e})),e.attach(new f.SWBTreePercentile(95,function(e,t){var n=e.getFrameHeight(),r=t.getFrameHeight();return n==r?0:n<r?-1:1},function(e){return e.getFrameHeight()},function(e){t.csioFrameHeight95Percentile=e},function(e,t){return t?t.getFrameHeight():e?e.getFrameHeight():void 0},function(e){var t=e.getFrameHeight();return null!=t},function(e,t){return e})),e.attach(new f.SWBTreePercentile(50,function(e,t){var n=e.getFrameHeight(),r=t.getFrameHeight();return n==r?0:n<r?-1:1},function(e){return e.getFrameHeight()},function(e){t.csioFrameHeight50Percentile=e},function(e,t){return t?t.getFrameHeight():e?e.getFrameHeight():void 0},function(e){var t=e.getFrameHeight();return null!=t},function(e,t){return e})),e.attach(new f.SWBTreePercentile(95,function(e,t){var n=e.getFrameWidth(),r=t.getFrameWidth();return n==r?0:n<r?-1:1},function(e){return e.getFrameWidth()},function(e){t.csioFrameWidth95Percentile=e},function(e,t){return t?t.getFrameWidth():e?e.getFrameWidth():void 0},function(e){var t=e.getFrameWidth();return null!=t},function(e,t){return e})),e.attach(new f.SWBTreePercentile(50,function(e,t){var n=e.getFrameWidth(),r=t.getFrameWidth();return n==r?0:n<r?-1:1},function(e){return e.getFrameWidth()},function(e){t.csioFrameWidth50Percentile=e},function(e,t){return t?t.getFrameWidth():e?e.getFrameWidth():void 0},function(e){var t=e.getFrameWidth();return null!=t},function(e,t){return e})),e.attach(new p.SWFunctor(function(e){t.csioMediaType=v.mediaType.video},null,null))}},{key:"setupSCSValidator",value:function(e){var t=e.metrics;e.attach(new p.SWFunctor(function(n){var r=u.Registry.getConfigServiceWrapper().getSenderConfig();if(!r||!r.rtc_rtp_parameters||!r.rtc_rtp_parameters.encodings)return t.csioSCSValidationSampleCount=null,t.csioAvgMaxBitrateDiff=null,t.csioAvgDeltaThroughput=null,t.csioMaxBitrateAboveRatio=null,void(t.csioCCDrivenRatio=null);var i=0;r.rtc_rtp_parameters.encodings.forEach(function(e){e&&(i=Math.max(i,e.maxBitrate))});var o=0,a=u.Registry.getConfigServiceWrapper().getDefaultSenderConfig();if(a&&a.encodings){a.encodings.forEach(function(e){o=Math.max(o,e.maxBitrate)});var s,c,l=0,d=null,f=e.getSCSHelper();0<o&&.9*o<1e3*t.csioAvgBRKbps?(l=i-o,d=!1):(l=i-1e3*t.csioAvgBRKbps,d=!0),c=0<l,s=t.csioAvgBRKbps-t.prevCsioAvgBRKbps,f.prevCsioAvgBRKbps=t.csioAvgBRKbps,t.csioSCSValidationSampleCount=++f.total,f.sumMaxBitrateDiff+=l,t.csioAvgMaxBitrateDiff=f.sumMaxBitrateDiff/f.total,f.sumThroughputDiff+=s,t.csioAvgDeltaThroughput=f.sumThroughputDiff/f.total,c&&(f.above+=1),t.csioMaxBitrateAboveRatio=f.above/f.total,d&&(f.ccDriven+=1),t.csioCCDrivenRatio=f.ccDriven/f.total}},null,null))}}]),c(t,[{key:"makeTrack",value:function(){var e={csioMediaType:void 0,csioMark:void 0,csioIntBRKbps:void 0,csioAvgBRKbps:void 0,csioIntFL:void 0,csioIntMs:void 0,csioIntPR:void 0,csioPercentileFl:void 0,csioAvgJitter:void 0,csioAvgRtt:void 0,csioPercentileJitter:void 0,csioSig2Latency:void 0,csioTimeElapseMs:void 0,csioeM:void 0,csiores:void 0,csioFrameWidth95Percentile:void 0,csioFrameWidth50Percentile:void 0,csioFrameHeight95Percentile:void 0,csioFrameHeight50Percentile:void 0,csioFrameRate95Percentile:void 0,csioFrameRate50Percentile:void 0,csioFrameWidthMean:void 0,csioFrameHeightMean:void 0,csioFrameRateMean:void 0,csioIntPktRcv:void 0,csioSCSValidationSampleCount:null,csioAvgMaxBitrateDiff:null,csioAvgDeltaThroughput:null,csioMaxBitrateAboveRatio:null,csioCCDrivenRatio:null};return e}},{key:"getSSRC",value:function(){return this.ssrc}},{key:"add",value:function(e){this.ssrc=e.getSSRC(),this.lastTrack=e.extractTrack(),this.lastTrack.pcHash=e.getPcHash(),0===this.started&&(this.started=h.getCurrent()),s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",this).call(this,e)}},{key:"hasTraffic",value:function(){return 0<this.metrics.csioIntBRKbps}},{key:"getTrack",value:function(){var e=this.lastTrack;return Object.assign(e.data,this.metrics),e}},{key:"extractTrack",value:function(){var e=this.lastTrack;return Object.assign(e.data,this.metrics),this.requestTime=h.getCurrent(),this.requestedMeasurement=this.peek(),e}},{key:"getMediaType",value:function(){return this.mediaType}},{key:"getStreamType",value:function(){return this.streamType}},{key:"getStartTime",value:function(){return this.started}},{key:"getCreationTime",value:function(){return this.created}},{key:"getRequestTime",value:function(){return Math.max(this.started,this.requestTime)}},{key:"getRequestedMeasurement",value:function(){return this.requestedMeasurement}},{key:"getSCSHelper",value:function(){return this.scsHelper}},{key:"addQualityEvaluator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.qualityHelper.addEvaluator(e,t)}},{key:"getQuality",value:function(e){return this.qualityHelper.getQuality(e)}},{key:"addPreProcess",value:function(e){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addPreProcess",this).call(this,e)}},{key:"addPostProcess",value:function(e){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addPostProcess",this).call(this,e)}}]),t}();n.TrackMonitor=b},{"../collections/slidingwindow":28,"../config/constants":33,"../statspipeline/swplugins/swavg":76,"../statspipeline/swplugins/swbtreepercentile":77,"../statspipeline/swplugins/swfunctor":78,"../utility/csiologger":88,"../utility/registry":95,"../utility/rttregistry":96,"../utility/timestamps":99}],81:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TracksMonitor=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./trackmonitor"),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../config/constants")),a=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.inbMonitors=new Map,this.outbMonitors=new Map}return r(e,[{key:"getMonitor",value:function(e){var t=e.getStreamType(),n=e.getMediaType(),r=e.getSSRC(),i=null;return t===o.streamType.inbound?n===o.mediaType.audio?i=this.getInbAudioMonitor(r):n===o.mediaType.video&&(i=this.getInbVideoMonitor(r)):t===o.streamType.outbound&&(n===o.mediaType.audio?i=this.getOutbAudioMonitor(r):n===o.mediaType.video&&(i=this.getOutbVideoMonitor(r))),i}},{key:"extractTracks",value:function(){var e=[];return this.outbMonitors.forEach(function(t,n){e.push(t.extractTrack())}),this.inbMonitors.forEach(function(t,n){e.push(t.extractTrack())}),e}},{key:"getTracks",value:function(){var e=[];return this.outbMonitors.forEach(function(t,n){e.push(t.getTrack())}),this.inbMonitors.forEach(function(t,n){e.push(t.getTrack())}),e}},{key:"getMonitors",value:function(){var e=[];return this.outbMonitors.forEach(function(t,n){e.push(t)}),this.inbMonitors.forEach(function(t,n){e.push(t)}),e}},{key:"getInbAudioMonitor",value:function(e){var t=this.inbMonitors.get(e);return t||(t=i.TrackMonitor.make(1e3,3e4,o.streamType.inbound,o.mediaType.audio),this.inbMonitors.set(e,t)),t}},{key:"getInbVideoMonitor",value:function(e){var t=this.inbMonitors.get(e);return t||(t=i.TrackMonitor.make(1e3,3e4,o.streamType.inbound,o.mediaType.video),this.inbMonitors.set(e,t)),t}},{key:"getOutbAudioMonitor",value:function(e){var t=this.outbMonitors.get(e);return t||(t=i.TrackMonitor.make(1e3,3e4,o.streamType.outbound,o.mediaType.audio),this.outbMonitors.set(e,t)),t}},{key:"getOutbVideoMonitor",value:function(e){var t=this.outbMonitors.get(e);return t||(t=i.TrackMonitor.make(1e3,3e4,o.streamType.outbound,o.mediaType.video),this.outbMonitors.set(e,t)),t}}]),e}();n.TracksMonitor=a},{"../config/constants":33,"./trackmonitor":80}],82:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.TransportsMonitor=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(e("../config/constants")),s=r(e("../utility/timestamps")),c=e("../utility/rttregistry"),u=function(){function e(t){i(this,e),this.previous=t,this.actual=t,this.outdated=s.getCurrent()}return o(e,[{key:"setActual",value:function(e){this.actual=e}},{key:"outdate",value:function(){this.previous=this.actual,this.outdated=s.getCurrent()}},{key:"getActual",value:function(){return this.actual}},{key:"getPrevious",value:function(){return this.previous}},{key:"getElapsedTime",value:function(){return s.getCurrent()-this.outdated}}]),e}(),l=function(){function e(t){i(this,e),this.stats=new Map,this.codeBase=t}return o(e,[{key:"set",value:function(e,t){var n=this.stats.get(e);n?n.setActual(t):this.stats.set(e,new u(t))}},{key:"getIntervalStats",value:function(){var e=this,t=new Map;return this.stats.forEach(function(n,r){t.set(r,e.getIntervalStat(n)),n.outdate()}),t}},{key:"getIntervalStat",value:function(e){var t=null;switch(this.codeBase){case a.codeBaseType.chrome:t=this.getIntervalStatForChrome(e);break;default:t=e.getActual()}return t}},{key:"getIntervalStatForChrome",value:function(e){var t=e.getActual(),n=e.getPrevious(),r=e.getElapsedTime();if(!n)return actual;for(var i=0;i<t.length;++i){var o=t[i],s=n[i];if(!s||!o)return t;var u=parseInt(s.bytesReceived,10),l=parseInt(s.bytesSent,10);o.csioReceivedBwKbps=8*(parseInt(o.bytesReceived,10)-u)/r,o.csioSentBwKbps=8*(parseInt(o.bytesSent,10)-l)/r,o.csioIntBytesReceived=parseInt(o.bytesReceived,10)-u,o.csioIntBytesSent=parseInt(o.bytesSent,10)-l,void 0!==s.packetsSent&&void 0!==o.packetsSent&&(o.csioSentPacketRate=(parseInt(o.packetsSent,10)-parseInt(s.packetsSent,10))/(r/1e3),o.csioIntPacketsSent=parseInt(o.packetsSent,10)-parseInt(s.packetsSent,10)),void 0!==s.packetsReceived&&void 0!==o.packetsReceived&&(o.csioReceivedPacketRate=(parseInt(o.packetsReceived,10)-parseInt(s.packetsReceived,10))/(r/1e3),o.csioIntPacketsReceived=parseInt(o.packetsReceived,10)-parseInt(s.packetsReceived,10)),this.codeBase==a.codeBaseType.chrome&&(o.currentRoundTripTime=(0,c.getRTTRegistry)().getTransportRTT())}return t}}]),e}();n.TransportsMonitor=l},{"../config/constants":33,"../utility/rttregistry":96,"../utility/timestamps":99}],83:[function(e,t,n){"use strict";function r(e){return isNaN(e)?null:e}Object.defineProperty(n,"__esModule",{value:!0}),n.checkForNan=r,n.checkForNegativeValue=function(e){return null!==r(e)&&0<e?e:null}},{}],84:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.getWifiStatsMethod=null,this.wifiStats=null,this.interval=1e4}return r(e,[{key:"setGetWifiStatsMethod",value:function(e){this.getWifiStatsMethod=e,this.wifiStatsHandler()}},{key:"getWifiStats",value:function(){return this.wifiStats}},{key:"wifiStatsHandler",value:function(){var e=this;e.getWifiStatsMethod&&e.getWifiStatsMethod().then(function(t){e.wifiStats=JSON.parse(t),setTimeout(function(){e.wifiStatsHandler()},e.interval)}).catch(function(){setTimeout(function(){e.wifiStatsHandler()},e.interval)})}}]),e}();n.WifiStatsExecutor=i},{}],85:[function(e,t,n){"use strict";function r(e){return window.btoa(e)}function i(e){return window.atob(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.encode=r,n.decode=i,n.urlencode=function(e){return r(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")},n.urlencodeUnicode=function(e){return function(e){return r(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))}(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")},n.strtohex=function(e){for(var t=i(e.replace(/[ \r\n]+$/,"")),n=[],r=0;r<t.length;++r){var o=t.charCodeAt(r).toString(16);1===o.length&&(o="0"+o),n.push(o)}return n.join("")}},{}],86:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.Callbacks=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=r(e("../config/constants")),a=e("./registry"),s=r(e("./csiologger")),c=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.callbacks={}}return i(e,[{key:"set",value:function(e,t){if("function"==typeof t)return o.callbackFunctions.hasOwnProperty(e)?(this.callbacks[e]=t,void(e===o.callbackFunctions.stats&&a.Registry.getStatsCallbackBuilder().setCallback(t))):void s.error("Couldn't set callback: "+e)}},{key:"get",value:function(e){return this.callbacks.hasOwnProperty(e)?this.callbacks[e]:null}}]),e}();n.Callbacks=c},{"../config/constants":33,"./csiologger":88,"./registry":95}],87:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.Credentials=void 0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(e("../config/constants")),s=r(e("./csiologger")),c=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.appId=null,this.userId=null,this.userIdObject=null,this.deviceId=null,this.statsSubmissionInterval=15e3,this.collectSDP=!1,this.transportType=a.transportType.rest,this.adaptiveInterval=!1}return o(e,[{key:"getAppId",value:function(){return this.appId}},{key:"setAppId",value:function(e){this.appId="string"==typeof e?parseInt(e,10):e}},{key:"getUserId",value:function(){return this.userId}},{key:"setUserId",value:function(e){"object"===(void 0===e?"undefined":i(e))?(this.userId=e.aliasName,this.setUserIdObject(e)):this.userId=e}},{key:"getUserIdObject",value:function(){return this.userIdObject}},{key:"setUserIdObject",value:function(e){this.userIdObject=e}},{key:"getStatsSubmissionInterval",value:function(){return this.statsSubmissionInterval}},{key:"setStatsSubmissionInterval",value:function(e){s.log("setStatsSubmissionInterval is ",e),this.statsSubmissionInterval=e}},{key:"getCollectSDP",value:function(){return this.collectSDP}},{key:"setCollectSDP",value:function(e){this.collectSDP=e}},{key:"getTransportType",value:function(){return this.transportType}},{key:"setTransportType",value:function(e){this.transportType=e}},{key:"getAdaptiveInterval",value:function(){return this.adaptiveInterval}},{key:"setAdaptiveInterval",value:function(e){this.adaptiveInterval=e}}]),e}();n.Credentials=c},{"../config/constants":33,"./csiologger":88}],88:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.info=function(){var e;"true"===r.csioDebug&&(e=console).info.apply(e,arguments)},n.log=function(){var e;"true"===r.csioDebug&&(e=console).log.apply(e,arguments)},n.warn=function(){var e;"true"===r.csioDebug&&(e=console).warn.apply(e,arguments)},n.error=function(){var e;(e=console).warn.apply(e,arguments)};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../config/settings"))},{"../config/settings":34}],89:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.Endpoint=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=r(e("../browserapi/localstorage")),a=r(e("../browserapi/detectbrowser")),s=r(e("../utility/timestamps")),c=r(e("../utility/hash")),u=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.id=null,this.appversion=null,this.magicKey=Math.floor(4294967296*Math.random()),this.browserName=null,this.browserVersion=null,this.osName=null,this.osVersion=null,this.codeBase=null,this.userAgent=null,this.retrieveId()}return i(e,[{key:"setup",value:function(){var e=a.detect();this.browserName=e.browserName,this.browserVersion=e.browserVersion,this.osName=e.os,this.osVersion=e.osVersion,this.codeBase=e.codeBase,this.userAgent=e.userAgent}},{key:"retrieveId",value:function(){var e=this,t=o.get("endpointID");if(null===t){var n=s.getCurrent(),r=Math.random()*n;c.generateSHA256(r.toString(),function(t){e.id=t,o.store("endpointID",t)})}else this.id=t}},{key:"getId",value:function(){return this.id}},{key:"getAppVersion",value:function(){return this.appversion}},{key:"setAppVersion",value:function(e){this.appversion=e}},{key:"getMagicKey",value:function(){return this.magicKey}},{key:"getBrowserName",value:function(){return this.browserName}},{key:"getBrowserVersion",value:function(){return this.browserVersion}},{key:"getOsName",value:function(){return this.osName}},{key:"getOsVersion",value:function(){return this.osVersion}},{key:"getCodeBase",value:function(){return this.codeBase}},{key:"getUserAgent",value:function(){return this.userAgent}},{key:"serialize",value:function(){return{type:"browser",buildName:this.browserName,buildVersion:this.browserVersion,appVersion:this.appversion,os:this.osName,osVersion:this.osVersion,userAgent:this.userAgent}}}]),e}();n.Endpoint=u},{"../browserapi/detectbrowser":18,"../browserapi/localstorage":20,"../utility/hash":92,"../utility/timestamps":99}],90:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.EventMessage=void 0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(e("../config/constants")),s=r(e("../config/settings")),c=e("./registry"),u=r(e("./csiologger")),l=function(){function e(t,n,r,i){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.eventType=t,this.customEntries=r,this.pcHandler=i,this.auth=c.Registry.getAuthenticator(),this.clocksync=c.Registry.getClockSync(),this.timestamp=this.clocksync.getSynchronizedTimestamp(),this.conferenceId=n,this.clockUnSynced=!this.clocksync.isCompleted()}return o(e,[{key:"updateConferenceId",value:function(e){u.log("updating conferenceId to ",this.eventType,this.conferenceId,e),this.conferenceId=e}},{key:"toJson",value:function(){if(!this.canBeSent())return null;var e=this.getCommonHeader();return Object.assign(e,this.customEntries),this.eventType===a.internalFabricEvent.userJoined&&delete e.connectionID,e}},{key:"getCallback",value:function(){return this.pcHandler?this.pcHandler.getCallback():null}},{key:"canBeSent",value:function(){var e=void 0,t=a.tmpConferenceId;if(this.conferenceId===t)return!1;if(this.pcHandler&&!this.pcHandler.getRemoteId())return!1;if(this.eventType!==a.precalltestEvents.results){var n=c.Registry.getConferenceManager().get(this.conferenceId);if(!n)return!1;e=n.getUcId()}return!(!this.auth.getToken()||(this.auth.isTokenValid()?!(this.isPriority()||this.clocksync.isCompleted()&&e)||this.eventType===a.internalFabricEvent.userAlive&&!e:(this.auth.reAuthenticate(),1)))}},{key:"isCachable",value:function(){return-1===[a.internalFabricEvent.userAlive].indexOf(this.eventType)}},{key:"isPriority",value:function(){var e=!1;return this.eventType!==a.internalFabricEvent.userJoined&&this.eventType!==a.precalltestEvents.results&&this.eventType!==a.internalFabricEvent.userAlive||(e=!0),e}},{key:"getConferenceId",value:function(){return this.conferenceId}},{key:"getCommonHeader",value:function(){var e={version:s.version,callstatsVersion:s.version,channel:this.decideChannel(),timestamp:this.timestamp,action:this.eventType,eventType:this.eventType,localID:encodeURIComponent(c.Registry.getCredentials().getUserId()),timeShift:0,appID:c.Registry.getCredentials().getAppId(),deviceID:c.Registry.getEndpoint().getId(),token:this.auth.getToken(),confID:encodeURIComponent(this.conferenceId)};this.clockUnSynced&&(e.timestamp+=this.clocksync.getOffset());var t=c.Registry.getConferenceManager().get(this.conferenceId);return e.ucID=t?t.getUcId():null,this.pcHandler?(e.remoteID=encodeURIComponent(this.pcHandler.getRemoteId()),e.connectionID=this.pcHandler.getPcHash()):(e.remoteID=encodeURIComponent(c.Registry.getCredentials().getUserId()),e.connectionID=encodeURIComponent(c.Registry.getCredentials().getUserId())),e.remoteID||(e.remoteID=encodeURIComponent(c.Registry.getCredentials().getUserId())),e}},{key:"decideChannel",value:function(){if(this.eventType==a.callstatsChannels.sdpSubmission)return a.callstatsChannels.sdpSubmission;if(this.eventType==a.callstatsChannels.userFeedback)return a.callstatsChannels.userFeedback;if(this.eventType==a.callstatsChannels.processedStats)return a.callstatsChannels.processedStats;for(var e in a.precalltestEvents)if(this.eventType==a.precalltestEvents[e])return a.callstatsChannels.preCallTest;return a.callstatsChannels.callstatsEvent}}],[{key:"checkCustomEntries",value:function(e,t){if(!d[e])return u.error("eventType not recognized:",e),!1;var n=d[e];for(var r in n)if(!t.hasOwnProperty(r)||i(t[r])!==n[r])return u.error("customEntries for",e,"should have",r,"of type",n[r]),!1;return!0}}]),e}(),d={};d[a.internalFabricEvent.userJoined]={endpointInfo:"object"},d[a.internalFabricEvent.userLeft]={},d[a.internalFabricEvent.userAlive]={},d[a.internalFabricEvent.userDetails]={userName:"string"},d[a.internalFabricEvent.connectedDeviceList]={mediaDeviceList:"object"},d[a.fabricEvent.activeDeviceList]={mediaDeviceList:"object"},d[a.fabricEvent.audioMute]={},d[a.fabricEvent.audioUnmute]={},d[a.fabricEvent.videoPause]={},d[a.fabricEvent.videoResume]={},d[a.fabricEvent.screenShareStart]={},d[a.fabricEvent.screenShareStop]={},d[a.internalFabricEvent.mediaPlaybackStart]={ssrc:"string"},d[a.internalFabricEvent.mediaPlaybackSuspended]={ssrc:"string"},d[a.internalFabricEvent.mediaPlaybackStalled]={ssrc:"string"},d[a.internalFabricEvent.oneWayMedia]={mediaType:"string",ssrc:"string"},d[a.internalFabricEvent.fabricSetup]={localIceCandidates:"object",remoteIceCandidates:"object",iceCandidatePairs:"object"},d[a.fabricEvent.fabricSetupFailed]={failureDelay:"number",reason:"string",function:"string",endpoint:"object"},d[a.internalFabricEvent.fabricStateChange]={changedState:"string",prevState:"string",newState:"string"},d[a.internalFabricEvent.fabricDropped]={prevIceConnectionState:"string",currIceConnectionState:"string",currIceCandidatePair:"object",failureDelay:"number"},d[a.internalFabricEvent.iceConnectionDisruptionStart]={prevIceConnectionState:"string",currIceConnectionState:"string",prevIceConnectionStateTs:"number",currIceCandidatePair:"object"},d[a.internalFabricEvent.iceConnectionDisruptionEnd]={prevIceConnectionState:"string",currIceConnectionState:"string",delay:"number"},d[a.internalFabricEvent.iceDisruptionStart]={prevIceConnectionState:"string",currIceConnectionState:"string",prevIceConnectionStateTs:"number",currIceCandidatePair:"object"},d[a.internalFabricEvent.iceDisruptionEnd]={prevIceConnectionState:"string",currIceConnectionState:"string",prevIceCandidatePair:"object"},d[a.internalFabricEvent.iceFailed]={localIceCandidates:"object",prevIceConnectionState:"string",currIceConnectionState:"string",currIceCandidatePair:"object",failureDelay:"number"},d[a.internalFabricEvent.iceAborted]={prevIceConnectionState:"string",currIceConnectionState:"string"},d[a.internalFabricEvent.iceRestarted]={prevIceConnectionState:"string",currIceConnectionState:"string",prevIceCandidatePair:"object"},d[a.internalFabricEvent.fabricTransportSwitch]={prevIceCandidatePair:"object",currIceCandidatePair:"object"},d[a.internalFabricEvent.iceTerminated]={prevIceConnectionState:"string",currIceConnectionState:"string"},d[a.fabricEvent.fabricTerminated]={},d[a.fabricEvent.fabricHold]={},d[a.fabricEvent.fabricResume]={},d[a.callstatsChannels.sdpSubmission]={localSDP:"string",remoteSDP:"string"},d[a.internalFabricEvent.ssrcMap]={ssrcData:"object"},d[a.callstatsChannels.userFeedback]={feedback:"object"},d[a.internalFabricEvent.sendingThroughputObservations]={ssrc:"string",maxsendingKBitrate:"number",timeToMaxSendingKBitrate:"number",stablesendingKBitrate:"number",timeToStableSendingKBitrate:"number"},d[a.fabricEvent.dominantSpeaker]={},d[a.fabricEvent.applicationErrorLog]={message:"string",messageType:"string"},d[a.callstatsChannels.processedStats]={stats:"object"},d[a.callstatsChannels.senderConfiguration]={rtc_rtp_parameters:"object"},d[a.internalFabricEvent.limitationObservations]={reason:"string"},d[a.qualityDisruptionTypes.qpchange]={reason:"string"},d[a.precalltestEvents.results]={results:"object"},d[a.precalltestEvents.associate]={ids:"object"},n.EventMessage=l},{"../config/constants":33,"../config/settings":34,"./csiologger":88,"./registry":95}],91:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.EventMessageBuilder=void 0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("./eventmessage"),s=r(e("../config/constants")),c=e("./registry"),u=r(e("./csiologger")),l=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.transmissionmanager=c.Registry.getTransmissionManager()}return o(e,[{key:"make",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if("string"!=typeof e||null===r||"object"!==(void 0===r?"undefined":i(r)))return u.error("failed typeof checks:",e,void 0===e?"undefined":i(e),void 0===r?"undefined":i(r),r),c.Registry.getGenericEventHandler().sendEvent(s.logEvents.error,{msg:"failed typeof checks:"+e+":"+(void 0===r?"undefined":i(r))+":"+(void 0===e?"undefined":i(e))}),!1;if(null===t&&e!==s.precalltestEvents.results)return u.error("failed conferenceId checks:",e,t),c.Registry.getGenericEventHandler().sendEvent(s.logEvents.error,{msg:"failed conferenceId checks:"+e}),!1;if(!n&&e!==s.callstatsChannels.userFeedback&&e!==s.fabricEvent.applicationErrorLog&&e!==s.fabricEvent.fabricSetupFailed&&e!==s.internalFabricEvent.userJoined&&e!==s.precalltestEvents.results)return u.error("peerconnection cannot be null",e),c.Registry.getGenericEventHandler().sendEvent(s.logEvents.error,{msg:"peerconnection cannot be null"+e}),!1;if(!a.EventMessage.checkCustomEntries(e,r))return u.error("failed checks:",e,r),c.Registry.getGenericEventHandler().sendEvent(s.logEvents.error,{msg:"failed customEntries checks:"+e}),!1;var o=void 0;if(t){var l=c.Registry.getConferenceManager().get(t);l&&n&&(o=l.getPeerConnectionManager().getPcHandler(n))}var d=new a.EventMessage(e,t,r,o);return this.transmissionmanager.send(d),!0}}]),e}();n.EventMessageBuilder=l},{"../config/constants":33,"./csiologger":88,"./eventmessage":90,"./registry":95}],92:[function(e,t,n){"use strict";function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=0;if(!e)return n;for(var r=0,i=e.length;r<i;r++)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t&&t(n+""),n+""}function i(e){for(var t=[],n=0;n<e.length;++n){var r=e.charCodeAt(n);r<128?t[t.length]=r:r>127&&r<2048?(t[t.length]=r>>6|192,t[t.length]=63&r|128):(t[t.length]=r>>12|224,t[t.length]=r>>6&63|128,t[t.length]=63&r|128)}return new Uint8Array(t).buffer}function o(e){for(var t=new DataView(e),n="",r=void 0,i=0;i<t.byteLength;i++)(r=t.getUint8(i).toString(16)).length<2&&(r="0"+r),n+=r;return n}Object.defineProperty(n,"__esModule",{value:!0}),n.generateSHA256=function(e,t){var n={name:"SHA-256"};if(window.crypto){var a=window.crypto.subtle||window.crypto.webkitSubtle;if(!a)return void r(e,t);a.digest(n,i(e)).then(function(e){t(o(e))}).catch(function(){r(e,t)})}else if(window.msCrypto){if(!window.msCrypto.subtle)return void r(e,t);var s=window.msCrypto.subtle.digest(n,i(e));s.oncomplete=function(e){e.target&&t(o(e.target.result))},s.onerror=function(){r(e,t)}}else r(e,t)},n.generateHash=r},{}],93:[function(e,t,n){"use strict";function r(e){return!!/^[\],:{}\s]*$/.test(e.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))}Object.defineProperty(n,"__esModule",{value:!0}),n.isValid=r,n.parse=function(e){var t=null;return null===e?t:(r(e)&&(t=JSON.parse(e)),t)}},{}],94:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.setErrorEventListener=function(){window&&window.addEventListener&&window.addEventListener("error",function(e){var t=i.Registry.getGenericEventHandler();if(e&&e.filename&&e.filename.indexOf("callstats")>-1){for(var n=!1,r={fileName:e.filename,line:e.lineno,col:e.colno,jsVersion:o.version,eventType:"error",message:e.message,pageURL:window.location.href},s=i.Registry.getConferenceManager().getConferenceIds(),c=0;c<s.length;c++)r.conferenceID=s[c],t.sendEvent(a.logEvents.error,r),n=!0;n||t.sendEvent(a.logEvents.error,r)}})};var i=e("./registry"),o=r(e("../config/settings")),a=r(e("../config/constants"))},{"../config/constants":33,"../config/settings":34,"./registry":95}],95:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Registry=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../services/clocksync"),o=e("../services/configservice/configservicewrapper"),a=e("../services/authenticator"),s=e("../services/backendlog"),c=e("../services/transmissionmanager"),u=e("./eventmessagebuilder"),l=e("../conference/conferencemanager"),d=e("../utility/credentials"),f=e("../statspipeline/statsadapter"),p=e("../statspipeline/statsparser"),h=e("../statspipeline/statsmonitor"),v=e("../statspipeline/statstransmitter"),m=e("../statspipeline/statsassembler"),g=e("../utility/endpoint"),y=e("../browserapi/battery"),b=e("precalltest"),S=e("../statspipeline/wifistatsexecutor"),_=e("./callbacks"),E=e("../statspipeline/statscallbackbuilder"),C=e("../services/connectionmanager"),T=null,w=null,k=null,R=null,P=null,I=null,O=null,A=null,M=null,D=null,N=null,x=null,L=null,j=null,F=null,U=null,H=null,B=null,G=null,J=null,V=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"getConferenceManager",value:function(){return U||(U=new l.ConferenceManager),U}},{key:"getStatsCallbackBuilder",value:function(){return G||(G=new E.StatsCallbackBuilder),G}},{key:"getClockSync",value:function(){return w||(w=new i.ClockSync),w}},{key:"getWifiStatsExecutor",value:function(){return H||(H=new S.WifiStatsExecutor),H}},{key:"getAuthenticator",value:function(){return k||(k=new a.Authenticator),k}},{key:"getConfigServiceWrapper",value:function(){return R||(R=new o.ConfigServiceWrapper),R}},{key:"getGenericEventHandler",value:function(){return P||(P=new s.GenericEventHandler).enable(),P}},{key:"getConnectionManager",value:function(){return J||(J=new C.ConnectionManager),J}},{key:"getTransmissionManager",value:function(){return I||(I=new c.TransmissionManager),I}},{key:"getEventMessageBuilder",value:function(){return O||(O=new u.EventMessageBuilder),O}},{key:"getCredentials",value:function(){return A||(A=new d.Credentials),A}},{key:"getEndpoint",value:function(){return M||(M=new g.Endpoint),M}},{key:"getStatsAdapter",value:function(){if(!D){var t=e.getEndpoint().getCodeBase(),n=e.getEndpoint().getBrowserName();D=new f.StatsAdapter(t,n)}return D}},{key:"getPreCallTest",value:function(){return T||(T=new b.PreCallTest),T}},{key:"getStatsParser",value:function(){return N||(N=new p.StatsParser),N}},{key:"getStatsMonitor",value:function(){if(!x){var t=e.getEndpoint().getCodeBase();x=new h.StatsMonitor(t)}return x}},{key:"getStatsTransmitter",value:function(){return L||(L=new v.StatsTransmitter),L}},{key:"getStatsAssembler",value:function(){return j||(j=new m.StatsAssembler),j}},{key:"getBattery",value:function(){return F||(F=new y.Battery),F}},{key:"getCallbacks",value:function(){return B||(B=new _.Callbacks),B}}]),e}();n.Registry=V},{"../browserapi/battery":17,"../conference/conferencemanager":31,"../services/authenticator":44,"../services/backendlog":45,"../services/clocksync":46,"../services/configservice/configservicewrapper":50,"../services/connectionmanager":51,"../services/transmissionmanager":56,"../statspipeline/statsadapter":69,"../statspipeline/statsassembler":70,"../statspipeline/statscallbackbuilder":71,"../statspipeline/statsmonitor":72,"../statspipeline/statsparser":73,"../statspipeline/statstransmitter":74,"../statspipeline/wifistatsexecutor":84,"../utility/credentials":87,"../utility/endpoint":89,"./callbacks":86,"./eventmessagebuilder":91,precalltest:2}],96:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.getRTTRegistry=function(){return null===o&&(o=new a),o};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../statspipeline/validator")),o=null,a=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.rtts=new Map,this.frameRates=new Map,this.transportRTT=null}return r(e,[{key:"getFrameRateReceived",value:function(e){for(var t=null,n=["googFrameRateOutput","googFrameRateDecoded","googFrameRateReceived","googFrameRateSent","framerateMean","framesPerSecond"],r=0,i=n.length;r<i;r++){var o=n[r];if(void 0!==(t=e.stat(o)))break}return t}},{key:"update",value:function(e){var t=this;e.getStats(function(e){for(var n=[],r=e.result(),o=0;o<r.length;++o){var a=r[o];if("googCandidatePair"!==a.type){if("ssrc"===a.type){var s=t.getFrameRateReceived(a),c=a.stat("googRtt"),u=a.stat("ssrc");c&&t.rtts.set(i.checkForNan(parseInt(u,10)),i.checkForNan(parseInt(c,10))),s&&t.frameRates.set(i.checkForNan(parseInt(u,10)),i.checkForNan(parseInt(s,10)))}}else{var l=a.stat("googRtt");n.push(l)}}t.transportRTT=Math.max.apply(Math,n)})}},{key:"getTransportRTT",value:function(){return this.transportRTT}},{key:"getRTT",value:function(e){var t=i.checkForNan(parseInt(e,10));return this.rtts.has(t)?this.rtts.get(t):null}},{key:"getFrameRate",value:function(e){var t=i.checkForNan(parseInt(e,10));return this.frameRates.has(t)?this.frameRates.get(t):null}}]),e}()},{"../statspipeline/validator":83}],97:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,n,r){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.max=t,this.midpoint=n,this.stepness=r,this.actualStep=0,this.reset()}return r(e,[{key:"reset",value:function(){this.actualStep=0}},{key:"setMidpoint",value:function(e){this.midpoint=e}},{key:"setMax",value:function(e){this.max=e}},{key:"setStepness",value:function(e){this.stepness=e}},{key:"increaseActualStep",value:function(e){this.actualStep+=e}},{key:"getActual",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.actualStep+=e,this.max/(1+Math.exp(-1*this.stepness*(this.actualStep-this.midpoint)))}}]),e}();n.Sigmoid=i},{}],98:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TimeoutProcess=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("./csiologger")),o=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.interval=t,this.timerId=null,this.callback=function(){i.warn("no callback function set",this)}}return r(e,[{key:"setCallback",value:function(e){this.callback=e}},{key:"start",value:function(){var e=this;this.timerId=setInterval(function(){e.callback()},this.interval)}},{key:"stop",value:function(){clearInterval(this.timerId),this.timerId=null}},{key:"isStarted",value:function(){return null!==this.timerId}}]),e}();n.TimeoutProcess=o},{"./csiologger":88}],99:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getCurrent=function(){return window&&window.performance&&window.performance.now&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.now()+window.performance.timing.navigationStart:Date.now()},n.getSinceOrigin=function(){return window&&window.performance&&window.performance.now?window.performance.now():null}},{}],100:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.base=t;for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];this.appendixes=r}return i(e,null,[{key:"concat",value:function(e,t){if(!t)return e;if(!e)return t;var n="/"===e.substr(e.length-1),r="/"===t.substring(0,1);return n||r?n&&r?e+t.substring(1):e+t:e+"/"+t}}]),i(e,[{key:"append",value:function(e){this.appendixes.push(e)}},{key:"toString",value:function(){var t=this.getString(this.base),n=this;return this.appendixes.forEach(function(r){if(null!=r){var i=n.getString(r);t=e.concat(t,i)}}),t}},{key:"getString",value:function(e){switch(void 0===e?"undefined":r(e)){case"function":return this.getString(e());case"number":return e+"";case"string":default:return e}}}]),e}();n.Url=o},{}],101:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.normalizeMediaDeviceList=function(e){var t=[];if(!e)return t;for(var n=0;n<e.length;n++){var r={};r.mediaDeviceID=e[n].deviceId,r.groupID=e[n].groupId,r.kind=e[n].kind,r.label=e[n].label,t.push(r)}return t},n.isIntegerPollyfill=function(){Number.isInteger||(Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e})},n.assignPollyfill=function(){"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},writable:!0,configurable:!0})}},{}]},{},[22])}).call(this,n(42))},function(e,t,n){var r,i,o;
/*!
 * currentExecutingScript
 * Get the currently executing script, regardless of its source/trigger/synchronicity. Similar to HTML5's `document.currentScript` but arguably much more useful!
 * Copyright (c) 2015 James M. Greene
 * Licensed MIT
 * https://github.com/JamesMGreene/currentExecutingScript
 * v0.1.3
 */this||window,i=[],void 0===(o="function"==typeof(r=function(){var e=/^(interactive|loaded|complete)$/,t=window.location?window.location.href:null,n=t&&t.replace(/#.*$/,"").replace(/\?.*$/,"")||null,r=document.getElementsByTagName("script"),i="readyState"in(r[0]||document.createElement("script")),o=!window.opera||"[object Opera]"!==window.opera.toString(),a="currentScript"in document;"stackTraceLimit"in Error&&Error.stackTraceLimit!==1/0&&(Error.stackTraceLimit,Error.stackTraceLimit=1/0);var s=!1,c=!1;function u(){if(0===r.length)return null;var t,l,d,f,p,h=[],v=u.skipStackDepth||1;for(t=0;t<r.length;t++)o&&i?e.test(r[t].readyState)&&h.push(r[t]):h.push(r[t]);if(l=new Error,s&&(d=l.stack),!d&&c)try{throw l}catch(e){d=e.stack}if(d&&(f=function e(t,n){var r,i,o=null,a="number"==typeof n;return n=a?Math.round(n):0,"string"==typeof t&&t&&(a?r=t.match(/(data:text\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/):(r=t.match(/^(?:|[^:@]*@|.+\)@(?=data:text\/javascript|blob|http[s]?|file)|.+?\s+(?: at |@)(?:[^:\(]+ )*[\(]?)(data:text\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/))&&r[1]||(r=t.match(/\)@(data:text\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/)),r&&r[1]&&(n>0?(i=t.slice(t.indexOf(r[0])+r[0].length),o=e(i,n-1)):o=r[1])),o}(d,v),!(p=function(e,t){var n,i=null;if(t=t||r,"string"==typeof e&&e)for(n=t.length;n--;)if(t[n].src===e){i=t[n];break}return i}(f,h))&&n&&f===n&&(p=function(e){var t,n,i=null;for(t=0,n=(e=e||r).length;t<n;t++)if(!e[t].hasAttribute("src")){if(i){i=null;break}i=e[t]}return i}(h))),p||1===h.length&&(p=h[0]),p||a&&(p=document.currentScript),!p&&o&&i)for(t=h.length;t--;)if("interactive"===h[t].readyState){p=h[t];break}return p||(p=h[h.length-1]||null),p}(function(){try{var e=new Error;throw s="string"==typeof e.stack&&!!e.stack,e}catch(e){c="string"==typeof e.stack&&!!e.stack}})(),u.skipStackDepth=1;var l=u;return l.near=u,l.far=function(){return null},l.origin=function(){return null},l})?r.apply(t,i):r)||(e.exports=o)},function(e,t){e.exports={LOCAL_JID:"local"}},function(e,t,n){!function(e){"use strict";e.Strophe.addConnectionPlugin("disco",{_connection:null,_identities:[],_features:[],_items:[],init:function(t){this._connection=t,this._identities=[],this._features=[],this._items=[],t.addHandler(this._onDiscoInfo.bind(this),e.Strophe.NS.DISCO_INFO,"iq","get",null,null),t.addHandler(this._onDiscoItems.bind(this),e.Strophe.NS.DISCO_ITEMS,"iq","get",null,null)},addIdentity:function(e,t,n,r){for(var i=0;i<this._identities.length;i++)if(this._identities[i].category==e&&this._identities[i].type==t&&this._identities[i].name==n&&this._identities[i].lang==r)return!1;return this._identities.push({category:e,type:t,name:n,lang:r}),!0},addFeature:function(e){for(var t=0;t<this._features.length;t++)if(this._features[t]==e)return!1;return this._features.push(e),!0},removeFeature:function(e){for(var t=0;t<this._features.length;t++)if(this._features[t]===e)return this._features.splice(t,1),!0;return!1},addItem:function(e,t,n,r){return!(n&&!r||(this._items.push({jid:e,name:t,node:n,call_back:r}),0))},info:function(t,n,r,i,o){var a={xmlns:e.Strophe.NS.DISCO_INFO};n&&(a.node=n);var s=e.$iq({from:this._connection.jid,to:t,type:"get"}).c("query",a);this._connection.sendIQ(s,r,i,o)},items:function(t,n,r,i,o){var a={xmlns:e.Strophe.NS.DISCO_ITEMS};n&&(a.node=n);var s=e.$iq({from:this._connection.jid,to:t,type:"get"}).c("query",a);this._connection.sendIQ(s,r,i,o)},_buildIQResult:function(t,n){var r=t.getAttribute("id"),i=t.getAttribute("from"),o=e.$iq({type:"result",id:r});return null!==i&&o.attrs({to:i}),o.c("query",n)},_onDiscoInfo:function(t){var n,r=t.getElementsByTagName("query")[0].getAttribute("node"),i={xmlns:e.Strophe.NS.DISCO_INFO};r&&(i.node=r);var o=this._buildIQResult(t,i);for(n=0;n<this._identities.length;n++)i={category:this._identities[n].category,type:this._identities[n].type},this._identities[n].name&&(i.name=this._identities[n].name),this._identities[n].lang&&(i["xml:lang"]=this._identities[n].lang),o.c("identity",i).up();for(n=0;n<this._features.length;n++)o.c("feature",{var:this._features[n]}).up();return this._connection.send(o.tree()),!0},_onDiscoItems:function(t){var n,r,i={xmlns:e.Strophe.NS.DISCO_ITEMS},o=t.getElementsByTagName("query")[0].getAttribute("node");if(o){for(i.node=o,n=[],r=0;r<this._items.length;r++)if(this._items[r].node==o){n=this._items[r].call_back(t);break}}else n=this._items;var a=this._buildIQResult(t,i);for(r=0;r<n.length;r++){var s={jid:n[r].jid};n[r].name&&(s.name=n[r].name),n[r].node&&(s.node=n[r].node),a.c("item",s).up()}return this._connection.send(a.tree()),!0}})}(n(1))},function(e,t,n){(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(i.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new o(i.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(127),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(42))},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,i,o,a,s,c=1,u={},l=!1,d=e.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(e);f=f&&f.setTimeout?f:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick(function(){h(e)})}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((o=new MessageChannel).port1.onmessage=function(e){h(e.data)},r=function(e){o.port2.postMessage(e)}):d&&"onreadystatechange"in d.createElement("script")?(i=d.documentElement,r=function(e){var t=d.createElement("script");t.onreadystatechange=function(){h(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):r=function(e){setTimeout(h,0,e)}:(a="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(a)&&h(+t.data.slice(a.length))},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),r=function(t){e.postMessage(a+t,"*")}),f.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return u[c]=i,r(c),c++},f.clearImmediate=p}function p(e){delete u[e]}function h(e){if(l)setTimeout(h,0,e);else{var t=u[e];if(t){l=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}(t)}finally{p(e),l=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(42),n(49))},function(e,t){function n(){this._listeners={}}Object.defineProperties(n.prototype,{listeners:{get:function(){return this._listeners}}}),n.prototype.addEventListener=function(e,t){var n,r,i;if(e&&t){for(void 0===(n=this._listeners[e])&&(this._listeners[e]=n=[]),r=0;i=n[r];r++)if(i===t)return;n.push(t)}},n.prototype.removeEventListener=function(e,t){var n,r,i;if(e&&t&&void 0!==(n=this._listeners[e])){for(r=0;i=n[r];r++)if(i===t){n.splice(r,1);break}0===n.length&&delete this._listeners[e]}},n.prototype.dispatchEvent=function(e){var t,n,r,i,o,a=!1;if(!e||"string"!=typeof e.type)throw new Error("`event` must have a valid `type` property");e._yaeti&&(e.target=this,e.cancelable=!0);try{e.stopImmediatePropagation=function(){a=!0}}catch(e){}if(t=e.type,n=this._listeners[t]||[],"function"==typeof(r=this["on"+t]))try{r.call(this,e)}catch(e){console.error(e)}for(i=0;(o=n[i])&&!a;i++)try{o.call(this,e)}catch(e){console.error(e)}return!e.defaultPrevented},e.exports=n},function(e,t,n){(function(t){e.exports=t.Event}).call(this,n(42))},function(e,t,n){var r=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,n){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:i?t[e.name]:t;!function(e,t,n,i){if(i&&!n)t[i]=r(e[1]);else for(var o=0;o<n.length;o+=1)null!=e[o+1]&&(t[n[o]]=r(e[o+1]))}(n.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},o=n(64),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},n=[],r=t;return e.split(/(\r\n|\r|\n)/).filter(a).forEach(function(e){var t=e[0],a=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),r=n[n.length-1]);for(var s=0;s<(o[t]||[]).length;s+=1){var c=o[t][s];if(c.reg.test(a))return i(c,r,a)}}),t.media=n,t};var s=function(e,t){var n=t.split(/=(.+)/,2);return 2===n.length&&(e[n[0]]=r(n[1])),e};t.parseParams=function(e){return e.split(/\;\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(r),i=0;i<n.length;i+=3)t.push({component:n[i],ip:n[i+1],port:n[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})})},t.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,n=!1;return"~"!==e[0]?t=r(e):(t=r(e.substring(1,e.length)),n=!0),{scid:t,paused:n}})})}},function(e,t,n){var r=n(64),i=/%[sdv%]/g,o=function(e,t,n){var r=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var a=t.names[o];t.name?r.push(n[t.name][a]):r.push(n[t.names[o]])}else r.push(n[t.name]);return function(e){var t=1,n=arguments,r=n.length;return e.replace(i,function(e){if(t>=r)return e;var i=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}})}.apply(null,r)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var n=t.outerOrder||a,i=t.innerOrder||s,c=[];return n.forEach(function(t){r[t].forEach(function(n){n.name in e&&null!=e[n.name]?c.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){c.push(o(t,n,e))})})}),e.media.forEach(function(e){c.push(o("m",r.m[0],e)),i.forEach(function(t){r[t].forEach(function(n){n.name in e&&null!=e[n.name]?c.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){c.push(o(t,n,e))})})})}),c.join("\r\n")+"\r\n"}},function(e,t,n){"use strict";(function(t){var r=n(133);e.exports=r({window:t.window})}).call(this,n(42))},function(e,t,n){"use strict";var r=n(40);e.exports=function(e,t){var i=e&&e.window,o={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var a in t)hasOwnProperty.call(t,a)&&(o[a]=t[a]);var s=r.log,c=r.detectBrowser(i),u={browserDetails:c,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings},l=n(134)||null,d=n(136)||null,f=n(139)||null,p=n(141)||null,h=n(142)||null;switch(c.browser){case"chrome":if(!l||!l.shimPeerConnection||!o.shimChrome)return s("Chrome shim is not included in this adapter release."),u;s("adapter.js shimming chrome."),u.browserShim=l,h.shimCreateObjectURL(i),l.shimGetUserMedia(i),l.shimMediaStream(i),l.shimSourceObject(i),l.shimPeerConnection(i),l.shimOnTrack(i),l.shimAddTrackRemoveTrack(i),l.shimGetSendersWithDtmf(i),h.shimRTCIceCandidate(i);break;case"firefox":if(!f||!f.shimPeerConnection||!o.shimFirefox)return s("Firefox shim is not included in this adapter release."),u;s("adapter.js shimming firefox."),u.browserShim=f,h.shimCreateObjectURL(i),f.shimGetUserMedia(i),f.shimSourceObject(i),f.shimPeerConnection(i),f.shimOnTrack(i),h.shimRTCIceCandidate(i);break;case"edge":if(!d||!d.shimPeerConnection||!o.shimEdge)return s("MS edge shim is not included in this adapter release."),u;s("adapter.js shimming edge."),u.browserShim=d,h.shimCreateObjectURL(i),d.shimGetUserMedia(i),d.shimPeerConnection(i),d.shimReplaceTrack(i);break;case"safari":if(!p||!o.shimSafari)return s("Safari shim is not included in this adapter release."),u;s("adapter.js shimming safari."),u.browserShim=p,h.shimCreateObjectURL(i),p.shimRTCIceServerUrls(i),p.shimCallbacksAPI(i),p.shimLocalStreamsAPI(i),p.shimRemoteStreamsAPI(i),p.shimTrackEventTransceiver(i),p.shimGetUserMedia(i),p.shimCreateOfferLegacy(i),h.shimRTCIceCandidate(i);break;default:s("Unsupported browser!")}return u}},function(e,t,n){"use strict";var r=n(40),i=r.log,o={shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return n._ontrackpoly||(n._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.track.id}):{track:r.track};var o=new Event("track");o.track=r.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)}),t.stream.getTracks().forEach(function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.id}):{track:r};var o=new Event("track");o.track=r,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)})},n.addEventListener("addstream",n._ontrackpoly)),t.apply(n,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;n._senders=n._senders||[],i.apply(n,[e]),e.getTracks().forEach(function(e){n._senders.push(t(n,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],o.apply(t,[e]),e.getTracks().forEach(function(e){var n=t._senders.find(function(t){return t.track===e});n&&t._senders.splice(t._senders.indexOf(n),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var n=this;this._srcObject=e,this.src&&t.revokeObjectURL(this.src),e?(this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)})):this.src=""}}))},shimAddTrackRemoveTrack:function(e){var t=r.detectBrowser(e);if(!(e.RTCPeerConnection.prototype.addTrack&&t.version>=63)){var n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=n.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{},t.getTracks().forEach(function(e){if(n.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!n._reverseStreams[t.id]){var r=new e.MediaStream(t.getTracks());n._streams[t.id]=r,n._reverseStreams[r.id]=t,t=r}i.apply(n,[t])};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},o.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===r.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(r.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{};var o=r._streams[n.id];if(o)o.addTrack(t),Promise.resolve().then(function(){r.dispatchEvent(new Event("negotiationneeded"))});else{var a=new e.MediaStream([t]);r._streams[n.id]=a,r._reverseStreams[a.id]=n,r.addStream(a)}return r.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(e,[function(n){var r=c(e,n);t[0].apply(null,[r])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):n.apply(e,arguments).then(function(t){return c(e,t)})}});var a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};var s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=s.get.apply(this);return""===e.type?e:c(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===n))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");n._streams=n._streams||{},Object.keys(n._streams).forEach(function(r){n._streams[r].getTracks().find(function(t){return e.track===t})&&(t=n._streams[r])}),t&&(1===t.getTracks().length?n.removeStream(n._reverseStreams[t.id]):t.removeTrack(e.track),n.dispatchEvent(new Event("negotiationneeded")))}}function c(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}},shimPeerConnection:function(e){var t=r.detectBrowser(e);if(e.RTCPeerConnection){var n=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,i.push(a)):i.push(e.iceServers[o])}e.iceServers=i}return new n(e,t)},e.RTCPeerConnection.prototype=n.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return n.generateCertificate}})}else e.RTCPeerConnection=function(t,n){return i("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,n)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}});var o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,n){var r=this,i=arguments;if(arguments.length>0&&"function"==typeof e)return o.apply(this,arguments);if(0===o.length&&(0===arguments.length||"function"!=typeof arguments[0]))return o.apply(this,[]);var a=function(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){return o.apply(this,[function(e){i[1](s(a(e)))},arguments[0]])}return new Promise(function(e,t){o.apply(r,[function(t){e(s(a(t)))},t])}).then(t,n)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,r=new Promise(function(r,i){n.apply(t,[e[0],r,i])});return e.length<2?r:r.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,i){n.apply(e,[r,i,t])})}return n.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var a=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?a.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};e.exports={shimMediaStream:o.shimMediaStream,shimOnTrack:o.shimOnTrack,shimAddTrackRemoveTrack:o.shimAddTrackRemoveTrack,shimGetSendersWithDtmf:o.shimGetSendersWithDtmf,shimSourceObject:o.shimSourceObject,shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:n(135)}},function(e,t,n){"use strict";var r=n(40),i=r.log;e.exports=function(e){var t=r.detectBrowser(e),n=e&&e.navigator,o=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var o={};"number"==typeof r.ideal?(o[i("min",n)]=r.ideal,t.optional.push(o),(o={})[i("max",n)]=r.ideal,t.optional.push(o)):(o[i("",n)]=r.ideal,t.optional.push(o))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=o(e.audio)}if(e&&"object"==typeof e.video){var s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});var c,u=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||u))if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?c=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(c=["front"]),c)return n.mediaDevices.enumerateDevices().then(function(t){var n=(t=t.filter(function(e){return"videoinput"===e.kind})).find(function(e){return c.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!n&&t.length&&-1!==c.indexOf("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=s.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=o(e.video),i("chrome: "+JSON.stringify(e)),r(e)});e.video=o(e.video)}return i("chrome: "+JSON.stringify(e)),r(e)},s=function(e){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};n.getUserMedia=function(e,t,r){a(e,function(e){n.webkitGetUserMedia(e,t,function(e){r&&r(s(e))})})};var c=function(e){return new Promise(function(t,r){n.getUserMedia(e,t,r)})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:c,enumerateDevices:function(){return new Promise(function(t){var n={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),n.mediaDevices.getUserMedia){var u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return a(e,function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(s(e))})})}}else n.mediaDevices.getUserMedia=function(e){return c(e)};void 0===n.mediaDevices.addEventListener&&(n.mediaDevices.addEventListener=function(){i("Dummy mediaDevices.addEventListener called.")}),void 0===n.mediaDevices.removeEventListener&&(n.mediaDevices.removeEventListener=function(){i("Dummy mediaDevices.removeEventListener called.")})}},function(e,t,n){"use strict";var r=n(40),i=n(137);e.exports={shimGetUserMedia:n(138),shimPeerConnection:function(e){var t=r.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCPeerConnection=i(e,t.version)},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},function(e,t,n){"use strict";var r=n(65);function i(e,t,n,i,o){var a=r.writeRtpDescription(e.kind,t);if(a+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":o||"active"),a+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var s="msid:"+(i?i.id:"-")+" "+e.rtpSender.track.id+"\r\n";a+="a="+s,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),a}function o(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var o=r(e.parameters.apt,n),a=r(t.parameters.apt,i);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach(function(r){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&a.parameters.apt&&!i(r,a,e.codecs,t.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(r.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n}function a(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function s(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}function c(e,t){var n=new Error(t);return n.name=e,n}e.exports=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function u(t,n,r,i){var o=new Event("track");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=i,e.setTimeout(function(){t._dispatchEvent("track",o)})}var l=function(n){var i=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=o[e].bind(o)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this.localDescription=null,this.remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(n=!0,!0)}),delete e.url,e.urls=i?r[0]:r,!!r.length}})}(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var a=n.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=r.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};l.prototype.onicecandidate=null,l.prototype.onaddstream=null,l.prototype.ontrack=null,l.prototype.onremovestream=null,l.prototype.onsignalingstatechange=null,l.prototype.oniceconnectionstatechange=null,l.prototype.onicegatheringstatechange=null,l.prototype.onnegotiationneeded=null,l.prototype.ondatachannel=null,l.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},l.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},l.prototype.getConfiguration=function(){return this._config},l.prototype.getLocalStreams=function(){return this.localStreams},l.prototype.getRemoteStreams=function(){return this.remoteStreams},l.prototype._createTransceiver=function(e){var t=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&t)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var r=this._createIceAndDtlsTransports();n.iceTransport=r.iceTransport,n.dtlsTransport=r.dtlsTransport}return this.transceivers.push(n),n},l.prototype.addTrack=function(t,n){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find(function(e){return e.track===t}))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(r=this.transceivers[i]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},l.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach(function(t){n.addTrack(t,e)});else{var r=e.clone();e.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),r.getTracks().forEach(function(e){n.addTrack(e,r)})}},l.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find(function(e){return e.rtpSender===t});if(!n)throw c("InvalidAccessError","Sender was not created by this connection.");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},l.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var n=t.getSenders().find(function(t){return t.track===e});n&&t.removeTrack(n)})},l.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},l.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},l.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},l.prototype._gather=function(t,n){var i=this,o=this.transceivers[n].iceGatherer;if(!o.onlocalcandidate){var a=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,o.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),o.onlocalcandidate=function(e){if(!(i.usingBundle&&n>0)){var a=new Event("icecandidate");a.candidate={sdpMid:t,sdpMLineIndex:n};var s=e.candidate,c=!s||0===Object.keys(s).length;if(c)"new"!==o.state&&"gathering"!==o.state||(o.state="completed");else{"new"===o.state&&(o.state="gathering"),s.component=1;var u=r.writeCandidate(s);a.candidate=Object.assign(a.candidate,r.parseCandidate(u)),a.candidate.candidate=u}var l=r.splitSections(i.localDescription.sdp);l[a.candidate.sdpMLineIndex+1]+=c?"a=end-of-candidates\r\n":"a="+a.candidate.candidate+"\r\n",i.localDescription.sdp=l.join("");var d=i.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",a),d&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout(function(){a.forEach(function(e){o.onlocalcandidate(e)})},0)}},l.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},l.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},l.prototype._transceive=function(e,n,i){var a=o(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(a.encodings=e.sendEncodingParameters,a.rtcp={cname:r.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(a.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(a)),i&&e.rtpReceiver&&a.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length&&(a.encodings=e.recvEncodingParameters),a.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(a.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(a.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(a))},l.prototype.setLocalDescription=function(e){var t,n,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!a("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=r.splitSections(e.sdp),n=t.shift(),t.forEach(function(e,t){var n=r.parseRtpParameters(e);i.transceivers[t].localCapabilities=n}),i.transceivers.forEach(function(e,t){i._gather(e.mid,t)});else if("answer"===e.type){t=r.splitSections(i.remoteDescription.sdp),n=t.shift();var s=r.matchPrefix(n,"a=ice-lite").length>0;t.forEach(function(e,t){var a=i.transceivers[t],c=a.iceGatherer,u=a.iceTransport,l=a.dtlsTransport,d=a.localCapabilities,f=a.remoteCapabilities;if(!(r.isRejected(e)&&0===r.matchPrefix(e,"a=bundle-only").length)&&!a.isDatachannel){var p=r.getIceParameters(e,n),h=r.getDtlsParameters(e,n);s&&(h.role="server"),i.usingBundle&&0!==t||(i._gather(a.mid,t),"new"===u.state&&u.start(c,p,s?"controlling":"controlled"),"new"===l.state&&l.start(h));var v=o(d,f);i._transceive(a,v.codecs.length>0,!1)}})}return i.localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},l.prototype.setRemoteDescription=function(i){var o=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!a("setRemoteDescription",i.type,o.signalingState)||o._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+o.signalingState));var l={};o.remoteStreams.forEach(function(e){l[e.id]=e});var d=[],f=r.splitSections(i.sdp),p=f.shift(),h=r.matchPrefix(p,"a=ice-lite").length>0,v=r.matchPrefix(p,"a=group:BUNDLE ").length>0;o.usingBundle=v;var m=r.matchPrefix(p,"a=ice-options:")[0];return o.canTrickleIceCandidates=!!m&&m.substr(14).split(" ").indexOf("trickle")>=0,f.forEach(function(a,c){var u=r.splitLines(a),f=r.getKind(a),m=r.isRejected(a)&&0===r.matchPrefix(a,"a=bundle-only").length,g=u[0].substr(2).split(" ")[2],y=r.getDirection(a,p),b=r.parseMsid(a),S=r.getMid(a)||r.generateIdentifier();if("application"!==f||"DTLS/SCTP"!==g){var _,E,C,T,w,k,R,P,I,O,A,M=r.parseRtpParameters(a);m||(O=r.getIceParameters(a,p),(A=r.getDtlsParameters(a,p)).role="client"),R=r.parseRtpEncodingParameters(a);var D=r.parseRtcpParameters(a),N=r.matchPrefix(a,"a=end-of-candidates",p).length>0,x=r.matchPrefix(a,"a=candidate:").map(function(e){return r.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===i.type||"answer"===i.type)&&!m&&v&&c>0&&o.transceivers[c]&&(o._disposeIceAndDtlsTransports(c),o.transceivers[c].iceGatherer=o.transceivers[0].iceGatherer,o.transceivers[c].iceTransport=o.transceivers[0].iceTransport,o.transceivers[c].dtlsTransport=o.transceivers[0].dtlsTransport,o.transceivers[c].rtpSender&&o.transceivers[c].rtpSender.setTransport(o.transceivers[0].dtlsTransport),o.transceivers[c].rtpReceiver&&o.transceivers[c].rtpReceiver.setTransport(o.transceivers[0].dtlsTransport)),"offer"!==i.type||m)"answer"!==i.type||m||(E=(_=o.transceivers[c]).iceGatherer,C=_.iceTransport,T=_.dtlsTransport,w=_.rtpReceiver,k=_.sendEncodingParameters,P=_.localCapabilities,o.transceivers[c].recvEncodingParameters=R,o.transceivers[c].remoteCapabilities=M,o.transceivers[c].rtcpParameters=D,x.length&&"new"===C.state&&(!h&&!N||v&&0!==c?x.forEach(function(e){s(_.iceTransport,e)}):C.setRemoteCandidates(x)),v&&0!==c||("new"===C.state&&C.start(E,O,"controlling"),"new"===T.state&&T.start(A)),o._transceive(_,"sendrecv"===y||"recvonly"===y,"sendrecv"===y||"sendonly"===y),!w||"sendrecv"!==y&&"sendonly"!==y?delete _.rtpReceiver:(I=w.track,b?(l[b.stream]||(l[b.stream]=new e.MediaStream),n(I,l[b.stream]),d.push([I,w,l[b.stream]])):(l.default||(l.default=new e.MediaStream),n(I,l.default),d.push([I,w,l.default]))));else{(_=o.transceivers[c]||o._createTransceiver(f)).mid=S,_.iceGatherer||(_.iceGatherer=o._createIceGatherer(c,v)),x.length&&"new"===_.iceTransport.state&&(!N||v&&0!==c?x.forEach(function(e){s(_.iceTransport,e)}):_.iceTransport.setRemoteCandidates(x)),P=e.RTCRtpReceiver.getCapabilities(f),t<15019&&(P.codecs=P.codecs.filter(function(e){return"rtx"!==e.name})),k=_.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var L,j=!1;if("sendrecv"===y||"sendonly"===y){if(j=!_.rtpReceiver,w=_.rtpReceiver||new e.RTCRtpReceiver(_.dtlsTransport,f),j)I=w.track,b&&"-"===b.stream||(b?(l[b.stream]||(l[b.stream]=new e.MediaStream,Object.defineProperty(l[b.stream],"id",{get:function(){return b.stream}})),Object.defineProperty(I,"id",{get:function(){return b.track}}),L=l[b.stream]):(l.default||(l.default=new e.MediaStream),L=l.default)),L&&(n(I,L),_.associatedRemoteMediaStreams.push(L)),d.push([I,w,L])}else _.rtpReceiver&&_.rtpReceiver.track&&(_.associatedRemoteMediaStreams.forEach(function(t){var n,r,i=t.getTracks().find(function(e){return e.id===_.rtpReceiver.track.id});i&&(n=i,(r=t).removeTrack(n),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:n})))}),_.associatedRemoteMediaStreams=[]);_.localCapabilities=P,_.remoteCapabilities=M,_.rtpReceiver=w,_.rtcpParameters=D,_.sendEncodingParameters=k,_.recvEncodingParameters=R,o._transceive(o.transceivers[c],!1,j)}}else o.transceivers[c]={mid:S,isDatachannel:!0}}),void 0===o._dtlsRole&&(o._dtlsRole="offer"===i.type?"active":"passive"),o.remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?o._updateSignalingState("have-remote-offer"):o._updateSignalingState("stable"),Object.keys(l).forEach(function(t){var n=l[t];if(n.getTracks().length){if(-1===o.remoteStreams.indexOf(n)){o.remoteStreams.push(n);var r=new Event("addstream");r.stream=n,e.setTimeout(function(){o._dispatchEvent("addstream",r)})}d.forEach(function(e){var t=e[0],r=e[1];n.id===e[2].id&&u(o,t,r,[n])})}}),d.forEach(function(e){e[2]||u(o,e[0],e[1],[])}),e.setTimeout(function(){o&&o.transceivers&&o.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},l.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},l.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},l.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},l.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0||t.checking>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":(t.connected>0||t.completed>0)&&(e="connected"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},l.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var o=n.transceivers.filter(function(e){return"audio"===e.kind}).length,a=n.transceivers.filter(function(e){return"video"===e.kind}).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(o=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(a=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(n.transceivers.forEach(function(e){"audio"===e.kind?--o<0&&(e.wantReceive=!1):"video"===e.kind&&--a<0&&(e.wantReceive=!1)});o>0||a>0;)o>0&&(n._createTransceiver("audio"),o--),a>0&&(n._createTransceiver("video"),a--);var u=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach(function(i,o){var a=i.track,s=i.kind,c=i.mid||r.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=n._createIceGatherer(o,n.usingBundle));var u=e.RTCRtpSender.getCapabilities(s);t<15019&&(u.codecs=u.codecs.filter(function(e){return"rtx"!==e.name})),u.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1")});var l=i.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];a&&t>=15019&&"video"===s&&!l[0].rtx&&(l[0].rtx={ssrc:l[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,s)),i.localCapabilities=u,i.sendEncodingParameters=l}),"max-compat"!==n._config.bundlePolicy&&(u+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),u+="a=ice-options:trickle\r\n",n.transceivers.forEach(function(e,t){u+=i(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),u+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,u+="a="+r.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(u+="a=end-of-candidates\r\n"))});var l=new e.RTCSessionDescription({type:"offer",sdp:u});return Promise.resolve(l)},l.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));var a=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(a+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var s=r.splitSections(n.remoteDescription.sdp).length-1;n.transceivers.forEach(function(e,r){if(!(r+1>s))if(e.isDatachannel)a+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+e.mid+"\r\n";else{var c;if(e.stream)"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var u=o(e.localCapabilities,e.remoteCapabilities);!u.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,a+=i(e,u,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(a+="a=rtcp-rsize\r\n")}});var u=new e.RTCSessionDescription({type:"answer",sdp:a});return Promise.resolve(u)},l.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(i,o){if(!n.remoteDescription)return o(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var a=e.sdpMLineIndex;if(e.sdpMid)for(var u=0;u<n.transceivers.length;u++)if(n.transceivers[u].mid===e.sdpMid){a=u;break}var l=n.transceivers[a];if(!l)return o(c("OperationError","Can not add ICE candidate"));if(l.isDatachannel)return i();var d=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if("tcp"===d.protocol&&(0===d.port||9===d.port))return i();if(d.component&&1!==d.component)return i();if((0===a||a>0&&l.iceTransport!==n.transceivers[0].iceTransport)&&!s(l.iceTransport,d))return o(c("OperationError","Can not add ICE candidate"));var f=e.candidate.trim();0===f.indexOf("a=")&&(f=f.substr(2)),(t=r.splitSections(n.remoteDescription.sdp))[a+1]+="a="+(d.type?f:"end-of-candidates")+"\r\n",n.remoteDescription.sdp=t.join("")}else for(var p=0;p<n.transceivers.length&&(n.transceivers[p].isDatachannel||(n.transceivers[p].iceTransport.addRemoteCandidate({}),(t=r.splitSections(n.remoteDescription.sdp))[p+1]+="a=end-of-candidates\r\n",n.remoteDescription.sdp=t.join(""),!n.usingBundle));p++);i()})},l.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){t[n]&&e.push(t[n].getStats())})});return new Promise(function(t){var n=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){var r;e[t].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(r=e[t]).type]||r.type,n.set(t,e[t])})}),t(n)})})};var d=["createOffer","createAnswer"];return d.forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(d=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),l}},function(e,t,n){"use strict";e.exports=function(e){var t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch(function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))})}}},function(e,t,n){"use strict";var r=n(40),i={shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.transceiver={receiver:n.receiver},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=r.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(n,r){if(t.version<38&&n&&n.iceServers){for(var i=[],o=0;o<n.iceServers.length;o++){var a=n.iceServers[o];if(a.hasOwnProperty("urls"))for(var s=0;s<a.urls.length;s++){var c={url:a.urls[s]};0===a.urls[s].indexOf("turn")&&(c.username=a.username,c.credential=a.credential),i.push(c)}else i.push(n.iceServers[o])}n.iceServers=i}return new e.mozRTCPeerConnection(n,r)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,n,r){return o.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t}(e)),t.version<53&&!n)try{e.forEach(function(e){e.type=i[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:i[t.type]||t.type}))})}return e}).then(n,r)}}}};e.exports={shimOnTrack:i.shimOnTrack,shimSourceObject:i.shimSourceObject,shimPeerConnection:i.shimPeerConnection,shimGetUserMedia:n(140)}},function(e,t,n){"use strict";var r=n(40),i=r.log;e.exports=function(e){var t=r.detectBrowser(e),n=e&&e.navigator,o=e&&e.MediaStreamTrack,a=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(e,r,o){var s=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||t.push(n),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[n]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof r.ideal?i[n]={min:r.ideal,max:r.ideal}:i[n]=r.ideal,e.advanced.push(i),delete r.ideal,Object.keys(r).length||delete e[n]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(i("spec: "+JSON.stringify(e)),e.audio&&(e.audio=s(e.audio)),e.video&&(e.video=s(e.video)),i("ff37: "+JSON.stringify(e))),n.mozGetUserMedia(e,r,function(e){o(a(e))})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:function(e){return new Promise(function(t,n){s(e,t,n)})},addEventListener:function(){},removeEventListener:function(){}}),n.mediaDevices.enumerateDevices=n.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var c=n.mediaDevices.enumerateDevices.bind(n.mediaDevices);n.mediaDevices.enumerateDevices=function(){return c().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(a(e))})}}if(!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var l=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),l(e.audio,"autoGainControl","mozAutoGainControl"),l(e.audio,"noiseSuppression","mozNoiseSuppression")),d(e)},o&&o.prototype.getSettings){var f=o.prototype.getSettings;o.prototype.getSettings=function(){var e=f.apply(this,arguments);return l(e,"mozAutoGainControl","autoGainControl"),l(e,"mozNoiseSuppression","noiseSuppression"),e}}if(o&&o.prototype.applyConstraints){var p=o.prototype.applyConstraints;o.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),l(e,"autoGainControl","mozAutoGainControl"),l(e,"noiseSuppression","mozNoiseSuppression")),p.apply(this,[e])}}}n.getUserMedia=function(e,i,o){if(t.version<44)return s(e,i,o);r.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(i,o)}}},function(e,t,n){"use strict";var r=n(40),i={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(n){n.id===e&&(t=n)}),this._remoteStreams&&this._remoteStreams.forEach(function(n){n.id===e&&(t=n)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var n=this;e.getTracks().forEach(function(r){t.call(n,r,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,n){n&&(this._localStreams?-1===this._localStreams.indexOf(n)&&this._localStreams.push(n):this._localStreams=[n]),t.call(this,e,n)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var n=this,r=e.getTracks();this.getSenders().forEach(function(e){-1!==r.indexOf(e.track)&&n.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){"object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];if(this._remoteStreams||(this._remoteStreams=[]),!(this._remoteStreams.indexOf(t)>=0)){this._remoteStreams.push(t);var n=new Event("addstream");n.stream=e.streams[0],this.dispatchEvent(n)}}.bind(this))}}))},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};var s=function(e,t,n){var r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){var r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){var r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=s}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,i.push(a)):i.push(e.iceServers[o])}e.iceServers=i}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var n=this;if(e){var r=n.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection("sendonly"):"recvonly"===r.direction&&r.setDirection("inactive"):!0!==e.offerToReceiveAudio||r||n.addTransceiver("audio");var i=n.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection("sendonly"):"recvonly"===i.direction&&i.setDirection("inactive"):!0!==e.offerToReceiveVideo||i||n.addTransceiver("video")}return t.apply(n,arguments)}}};e.exports={shimCallbacksAPI:i.shimCallbacksAPI,shimLocalStreamsAPI:i.shimLocalStreamsAPI,shimRemoteStreamsAPI:i.shimRemoteStreamsAPI,shimGetUserMedia:i.shimGetUserMedia,shimRTCIceServerUrls:i.shimRTCIceServerUrls,shimTrackEventTransceiver:i.shimTrackEventTransceiver,shimCreateOfferLegacy:i.shimCreateOfferLegacy}},function(e,t,n){"use strict";var r=n(65),i=n(40);e.exports={shimRTCIceCandidate:function(e){if(!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){"object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2));var n=new t(e),i=r.parseCandidate(e.candidate),o=Object.assign(n,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o},function(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);var o=function(e){r(n(e))};return this._eventMap=this._eventMap||{},this._eventMap[r]=o,i.apply(this,[e,o])};var o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n])return o.apply(this,arguments);var r=this._eventMap[n];return delete this._eventMap[n],o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)}})}}(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var n=t.createObjectURL.bind(t),r=t.revokeObjectURL.bind(t),o=new Map,a=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++a;return o.set(t,e),i.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return n(e)},t.revokeObjectURL=function(e){r(e),o.delete(e)};var s=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return s.get.apply(this)},set:function(e){return this.srcObject=o.get(e)||null,s.set.apply(this,[e])}});var c=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=o.get(arguments[1])||null),c.apply(this,arguments)}}}}},function(e,t,n){t.Interop=n(144)},function(e,t,n){"use strict";var r=n(145),i=n(146);function o(){this.cache={mlB2UMap:{},mlU2BMap:{}}}e.exports=o,o.prototype.candidateToUnifiedPlan=function(e){var t=new RTCIceCandidate(e);return t.sdpMLineIndex=this.cache.mlB2UMap[t.sdpMLineIndex],t},o.prototype.candidateToPlanB=function(e){var t=new RTCIceCandidate(e);if(0===t.sdpMid.indexOf("audio"))t.sdpMid="audio";else{if(0!==t.sdpMid.indexOf("video"))throw new Error("candidate with "+t.sdpMid+" not allowed");t.sdpMid="video"}return t.sdpMLineIndex=this.cache.mlU2BMap[t.sdpMLineIndex],t},o.prototype.getFirstSendingIndexFromAnswer=function(e){if(!this.cache.answer)return null;var t=r.parse(this.cache.answer);if(t&&t.media&&Array.isArray(t.media))for(var n=0;n<t.media.length;n++)if(t.media[n].type==e&&(!t.media[n].direction||"sendrecv"===t.media[n].direction||"sendonly"===t.media[n].direction))return n;return null},o.prototype.toPlanB=function(e){var t=this;if("object"!=typeof e||null===e||"string"!=typeof e.sdp)return console.warn("An empty description was passed as an argument."),e;var n=r.parse(e.sdp);if(void 0===n.media||!Array.isArray(n.media)||0===n.media.length)return console.warn("The description has no media."),e;if(n.media.length<=3&&n.media.every(function(e){return-1!==["video","audio","data"].indexOf(e.mid)}))return console.warn("This description does not look like Unified Plan."),e;for(var i=e.sdp,o=!1,s=0;s<n.media.length;s++){n.media[s].rtp.forEach(function(e){if("NULL"===e.codec){o=!0;var n=r.parse(t.cache.offer);e.codec=n.media[s].rtp[0].codec}})}o&&(i=r.write(n)),this.cache[e.type]=i;var c=n.media;n.media=[];var u={},l=[],d={};c.forEach(function(e){if(("string"!=typeof e.rtcpMux||"rtcp-mux"!==e.rtcpMux)&&"inactive"!==e.direction)throw new Error("Cannot convert to Plan B because m-lines without the rtcp-mux attribute were found.");void 0!==u[e.type]&&"inactive"!==u[e.type].direction||(u[e.type]=e)}),c.forEach(function(e){var t=e.type;if("application"===t)return n.media.push(e),void l.push(e.mid);"object"==typeof e.sources&&Object.keys(e.sources).forEach(function(n){"object"!=typeof u[t].sources&&(u[t].sources={}),u[t].sources[n]=e.sources[n],void 0!==e.msid&&(u[t].sources[n].msid=e.msid)}),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&(void 0!==u[t].ssrcGroups&&Array.isArray(u[t].ssrcGroups)||(u[t].ssrcGroups=[]),u[t].ssrcGroups=u[t].ssrcGroups.concat(e.ssrcGroups));var r=e.direction;d[t]=(d[t]||0)|a[r||"inactive"],u[t]===e&&(e.mid=t,delete e.bundleOnly,delete e.msid,"inactive"!==r&&l.push(t),n.media.push(e))}),n.groups.some(function(e){if("BUNDLE"===e.type)return e.mids=l.join(" "),!0}),n.msidSemantic={semantic:"WMS",token:"*"};var f=r.write(n);return new RTCSessionDescription({type:e.type,sdp:f})},o.prototype.toUnifiedPlan=function(e){var t=this;if("object"!=typeof e||null===e||"string"!=typeof e.sdp)return console.warn("An empty description was passed as an argument."),e;var n=r.parse(e.sdp);if(void 0===n.media||!Array.isArray(n.media)||0===n.media.length)return console.warn("The description has no media."),e;if(n.media.length>3||!n.media.every(function(e){return-1!==["video","audio","data"].indexOf(e.mid)}))return console.warn("This description does not look like Plan B."),e;var o=[];n.media.forEach(function(e){o.push(e.mid)});var a,s=!1;if(void 0!==n.groups&&Array.isArray(n.groups)&&(s=n.groups.every(function(e){return"BUNDLE"!==e.type||i.apply(e.mids.sort(),[o.sort()])})),!s)throw new Error("Cannot convert to Unified Plan because m-lines that are not bundled were found.");void 0!==this.cache[e.type]&&(a=r.parse(this.cache[e.type]));var c={audio:{},video:{}},u={},l=0,d=0;if(n.media.forEach(function(n){if(("string"!=typeof n.rtcpMux||"rtcp-mux"!==n.rtcpMux)&&"inactive"!==n.direction)throw new Error("Cannot convert to Unified Plan because m-lines without the rtcp-mux attribute were found.");if("application"!==n.type){var r=n.sources,i=n.ssrcGroups,o=n.candidates,s=n.iceUfrag,f=n.icePwd,p=n.fingerprint,h=n.port;delete n.sources,delete n.ssrcGroups,delete n.candidates,delete n.iceUfrag,delete n.icePwd,delete n.fingerprint,delete n.port,delete n.mid;var v={};void 0!==i&&Array.isArray(i)&&i.forEach(function(e){"SIM"!==e.semantics&&void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&e.ssrcs.forEach(function(t){void 0===v[t]&&(v[t]=[]),v[t].push(e)})});var m={};"object"==typeof r&&Object.keys(r).forEach(function(i){var g;if("offer"!==e.type||r[i].msid)if(void 0!==v[i]&&Array.isArray(v[i])&&v[i].some(function(e){return e.ssrcs.some(function(e){if("object"==typeof m[e])return g=m[e],!0})}),"object"==typeof g)g.sources[i]=r[i],delete r[i].msid;else{if(g=Object.create(n),m[i]=g,void 0!==r[i].msid&&(g.msid=r[i].msid,delete r[i].msid),g.sources={},g.sources[i]=r[i],g.ssrcGroups=v[i],void 0!==a&&void 0!==a.media&&Array.isArray(a.media)&&a.media.forEach(function(e){"object"==typeof e.sources&&Object.keys(e.sources).forEach(function(t){t===i&&(g.mid=e.mid)})}),void 0===g.mid){if("answer"===e.type)throw new Error("An unmapped SSRC was found.");g.mid=[n.type,"-",i].join("")}g.candidates=o,g.iceUfrag=s,g.icePwd=f,g.fingerprint=p,g.port=h,u[g.mid]=g,t.cache.mlU2BMap[d]=l,void 0===t.cache.mlB2UMap[l]&&(t.cache.mlB2UMap[l]=d),d++}else c[n.type][i]=r[i]}),l++}else u[n.mid]=n}),n.media=[],o=[],"answer"===e.type)for(var f=0;f<a.media.length;f++){var p=a.media[f];void 0===u[p.mid]&&(delete p.msid,delete p.sources,delete p.ssrcGroups,p.direction&&"sendrecv"!==p.direction?"sendonly"===p.direction&&(p.direction="inactive"):p.direction="recvonly"),n.media.push(p),"string"==typeof p.mid&&o.push(p.mid)}else void 0!==a&&void 0!==a.media&&Array.isArray(a.media)&&a.media.forEach(function(e){o.push(e.mid),void 0!==u[e.mid]?n.media.push(u[e.mid]):(delete e.msid,delete e.sources,delete e.ssrcGroups,e.direction&&"sendrecv"!==e.direction||(e.direction="recvonly"),e.direction&&"sendonly"!==e.direction||(e.direction="inactive"),n.media.push(e))}),Object.keys(u).forEach(function(e){-1===o.indexOf(e)&&(o.push(e),"recvonly"===u[e].direction?n.media.some(function(t){if(("sendrecv"===t.direction||"sendonly"===t.direction)&&t.type===u[e].type)return Object.keys(u[e].sources).forEach(function(n){t.sources[n]=u[e].sources[n]}),!0}):n.media.push(u[e]))});["audio","video"].forEach(function(e){if(n&&n.media&&Array.isArray(n.media)){var r=null;if(Object.keys(c[e]).length>0&&null===(r=t.getFirstSendingIndexFromAnswer(e)))for(var i=0;i<n.media.length;i++)if(n.media[i].type===e){r=i;break}if(r&&n.media.length>r){var o=n.media[r];Object.keys(c[e]).forEach(function(t){o.sources&&o.sources[t]&&console.warn("Replacing an existing SSRC."),o.sources||(o.sources={}),o.sources[t]=c[e][t]})}}}),n.groups.some(function(e){if("BUNDLE"===e.type)return e.mids=o.join(" "),!0}),n.msidSemantic={semantic:"WMS",token:"*"};var h=r.write(n);return this.cache[e.type]=h,new RTCSessionDescription({type:e.type,sdp:h})};var a={inactive:0,recvonly:1,sendonly:2,sendrecv:3}},function(e,t,n){var r=n(16);t.write=function(e,t){return void 0!==e&&void 0!==e.media&&Array.isArray(e.media)&&e.media.forEach(function(e){void 0!==e.sources&&0!==Object.keys(e.sources).length&&(e.ssrcs=[],Object.keys(e.sources).forEach(function(t){var n=e.sources[t];Object.keys(n).forEach(function(r){e.ssrcs.push({id:t,attribute:r,value:n[r]})})}),delete e.sources),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&e.ssrcGroups.forEach(function(e){void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&(e.ssrcs=e.ssrcs.join(" "))})}),void 0!==e&&void 0!==e.groups&&Array.isArray(e.groups)&&e.groups.forEach(function(e){void 0!==e.mids&&Array.isArray(e.mids)&&(e.mids=e.mids.join(" "))}),r.write(e,t)},t.parse=function(e){var t=r.parse(e);return void 0!==t&&void 0!==t.media&&Array.isArray(t.media)&&t.media.forEach(function(e){void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&(e.sources={},e.ssrcs.forEach(function(t){e.sources[t.id]||(e.sources[t.id]={}),e.sources[t.id][t.attribute]=t.value}),delete e.ssrcs),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&e.ssrcGroups.forEach(function(e){"string"==typeof e.ssrcs&&(e.ssrcs=e.ssrcs.split(" "))})}),void 0!==t&&void 0!==t.groups&&Array.isArray(t.groups)&&t.groups.forEach(function(e){"string"==typeof e.mids&&(e.mids=e.mids.split(" "))}),t}},function(e,t){e.exports=function e(t){if(!t)return!1;if(this.length!=t.length)return!1;for(var n=0,r=this.length;n<r;n++)if(this[n]instanceof Array&&t[n]instanceof Array){if(!e.apply(this[n],[t[n]]))return!1}else if(this[n]!=t[n])return!1;return!0}},function(e,t,n){var r=n(16),i=n(148),o=i.parseSsrcs,a=i.writeSsrcs,s=3;function c(e,t,n){return e.ssrcs.filter(function(e){return e.id===t}).filter(function(e){return e.attribute===n}).map(function(e){return e.value})[0]}function u(e){this.options=e||{},this.options.numOfLayers||(this.options.numOfLayers=s),console.log("SdpSimulcast: using "+this.options.numOfLayers+" layers"),this.ssrcCache=[]}function l(e,t){null!=e&&Array.isArray(e.media)&&e.media.forEach(function(e){"video"===e.type&&t(e)})}function d(e){return e&&null!=e&&e.type&&""!=e.type&&e.sdp&&""!=e.sdp}u.prototype.clearSsrcCache=function(){this.ssrcCache=[]},u.prototype.setSsrcCache=function(e){this.ssrcCache=e},u.prototype._parseSimLayers=function(e){var t=e.ssrcGroups&&e.ssrcGroups.find(function(e){return"SIM"===e.semantics});return t?t.ssrcs.split(" ").map(function(e){return parseInt(e)}):[e.ssrcs[0].id]},u.prototype._buildNewToOldSsrcMap=function(e,t){for(var n={},r=0;r<e.length;++r){var i=e[r],o=t[r]||null;n[i]=o}return n},u.prototype._fillInSourceDataFromCache=function(e){console.log("SdpSimulcast restoring from cache: ",this.ssrcCache);var t=this._parseSimLayers(e);console.log("SdpSimulcast Parsed new sim ssrcs: ",t);var n=c(e,t[0],"msid"),r=c(e,t[0],"cname"),i=this._buildNewToOldSsrcMap(t,this.ssrcCache);console.log("SdpSimulcast built replacement map: ",i);var o=this.ssrcCache.filter(function(e){return-1===Object.values(i).indexOf(e)});return console.log("SdpSimulcast built ssrcs to add: ",o),e.ssrcs.forEach(function(e){i[e.id]&&(e.id=i[e.id])}),o.forEach(function(t){e.ssrcs.push({id:t,attribute:"msid",value:n}),e.ssrcs.push({id:t,attribute:"cname",value:r})}),e.ssrcGroups=e.ssrcGroups||[],e.ssrcGroups.push({semantics:"SIM",ssrcs:this.ssrcCache.join(" ")}),e},u.prototype._generateSourceData=function(e,t){for(var n=function(e,t){e.ssrcs.push({id:t,attribute:"cname",value:i}),e.ssrcs.push({id:t,attribute:"msid",value:r})},r=c(e,t,"msid"),i=c(e,t,"cname"),o=[],a=0;a<this.options.numOfLayers-1;++a){var s=Math.floor(4294967295*Math.random())+0;n(e,s),o.push(s)}return e.ssrcGroups=e.ssrcGroups||[],e.ssrcGroups.push({semantics:"SIM",ssrcs:t+" "+o.join(" ")}),e},u.prototype._restoreSimulcast=function(e){var t,n=e.ssrcs&&e.ssrcs.map(function(e){return e.id}).filter(function(e,t,n){return n.indexOf(e)===t}).length||0,r=e.ssrcGroups&&e.ssrcGroups.length||0;if(0===n||n>2)return e;if(2==n&&0===r)return e;if(1===n)t=e.ssrcs[0].id;else{var i=e.ssrcGroups.filter(function(e){return"FID"===e.semantics})[0];if(!i)return e;t=parseInt(i.ssrcs.split(" ")[0])}return console.log("SdpSimulcast: current ssrc cache: ",this.ssrcCache),console.log("SdpSimulcast: parsed primary ssrc "+t),-1!==this.ssrcCache.indexOf(t)?(console.log("SdpSimulcast: Have seen primary ssrc before, filling in data from cache"),e=this._fillInSourceDataFromCache(e)):(console.log("SdpSimulcast: Have not seen primary ssrc before, generating source data"),e=this._generateSourceData(e,t)),this.ssrcCache=this._parseSimLayers(e),e},u.prototype.mungeRemoteDescription=function(e){if(!d(e))return e;var t=r.parse(e.sdp),n=this;return l(t,function(e){n.options.explodeRemoteSimulcast?function(e){if(e&&Array.isArray(e.ssrcGroups))for(var t=o(e),n=[],r=e.ssrcGroups.length;r--;)if("SIM"===e.ssrcGroups[r].semantics){for(var i=e.ssrcGroups[r].ssrcs.split(" "),s=0;s<i.length;s++){var c=i[s];n.push(c);var u=t[c].msid.split(" ");t[c].msid=[u[0],"/",s," ",u[1],"/",s].join(""),t[c].cname=[t[c].cname,"/",s].join(""),e.ssrcGroups.forEach(function(e){if("SIM"!==e.semantics){var r=e.ssrcs.split(" ");-1!==r.indexOf(c)&&r.forEach(function(e){t[e].msid=t[c].msid,t[e].cname=t[c].cname,e!==c&&n.push(e)})}})}e.ssrcs=a(t,n),e.ssrcGroups.splice(r,1)}}(e):function(e){if(e&&Array.isArray(e.ssrcGroups)){var t=o(e);e.ssrcGroups.forEach(function(n){if("SIM"===n.semantics){console.info("Imploding SIM group: "+n.ssrcs),n.nuke=!0;for(var r=n.ssrcs.split(" "),i=1;i<r.length;i++){var o=r[i];delete t[o],e.ssrcGroups.forEach(function(e){if("SIM"!==e.semantics){var n=e.ssrcs.split(" ");-1!==n.indexOf(o)&&(n.forEach(function(e){delete t[e]}),e.nuke=!0)}})}}}),e.ssrcs=a(t);for(var n=e.ssrcGroups.length;n--;)e.ssrcGroups[n].nuke&&e.ssrcGroups.splice(n,1)}else console.info("Halt: There are no SSRC groups in the remote description.")}(e),n.ssrcCache.length<1?function(e){if(e&&Array.isArray(e.invalid))for(var t=e.invalid.length;t--;)"x-google-flag:conference"==e.invalid[t].value&&e.invalid.splice(t,1)}(e):function(e){e&&(Array.isArray(e.invalid)||(e.invalid=[]),e.invalid.some(function(e){return"x-google-flag:conference"===e.value})||e.invalid.push({value:"x-google-flag:conference"}))}(e)}),new RTCSessionDescription({type:e.type,sdp:r.write(t)})},u.prototype.mungeLocalDescription=function(e){if(!d(e))return e;var t=r.parse(e.sdp),n=this;return l(t,function(e){"recvonly"!=e.direction&&"inactive"!=e.direction&&n._restoreSimulcast(e)}),new RTCSessionDescription({type:e.type,sdp:r.write(t)})},e.exports=u},function(e,t){t.writeSsrcs=function(e,t){var n=[];if(void 0!==e&&0!==Object.keys(e).length){Array.isArray(t)||(t=[]);for(var r=0;r<t.length;r++){var i=t[r],o=e[i];Object.keys(o).forEach(function(e){n.push({id:i,attribute:e,value:o[e]})})}Object.keys(e).forEach(function(r){if(r=parseInt(r),!(t.indexOf(r)>=0)){var i=e[r];Object.keys(i).forEach(function(e){n.push({id:r,attribute:e,value:i[e]})})}})}return n},t.parseSsrcs=function(e){var t={};return void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&e.ssrcs.forEach(function(e){t[e.id]||(t[e.id]={}),t[e.id][e.attribute]=e.value}),t}},function(e,t){e.exports=function(e,t,n,r){this.blob=e,this.name=t,this.startTime=n,this.wordArray=r}},function(e,t,n){var r=n(151),i=n(152),o=n(66),a=function(){this.url=function(){var e="config does not contain an url to a Sphinx4 https server";if(void 0===config.sphinxURL)console.log(e);else{var t=config.sphinxURL;if(void 0!==t.includes&&t.includes("https://"))return t;console.log(e)}}()};a.prototype=Object.create(r.prototype),a.constructor=a,a.prototype.sendRequest=function(e,t){console.log("sending an audio file  to ".concat(this.url)),console.log("the audio file being sent: ".concat(e));var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE&&200===n.status)t(n.responseText);else if(n.readyState===XMLHttpRequest.DONE)throw new Error("unable to accept response from sphinx server. status: ".concat(n.status))},n.open("POST",this.url),n.setRequestHeader("Content-Type",o.determineCorrectFileType()),n.send(e),console.log("send ".concat(e))},a.prototype.formatResponse=function(e){var t=JSON.parse(e).objects;t.shift();var n=[];return t.forEach(function(e){return e.filler||n.push(new i(e.word,e.start,e.end))}),n},a.prototype.verify=function(e){if(console.log("response from server:".concat(e.toString())),"string"!=typeof e)return!1;var t;try{t=JSON.parse(e)}catch(e){return console.log(e),!1}if(void 0===t.objects)return!1;var n=t.objects;return!(!n[0]||!n[0]["session-id"])},e.exports=a},function(e,t){var n=function(){throw new Error("TranscriptionService is abstract and cannot becreated")};n.prototype.send=function(e,t){var n=this;this.sendRequest(e.blob,function(r){n.verify(r)?e.wordArray=n.formatResponse(r):(console.log("the retrieved response from the server is not valid!"),e.wordArray=[]),t(e)})},n.prototype.sendRequest=function(e,t){throw new Error("TranscriptionService.sendRequest is abstract")},n.prototype.formatResponse=function(e){throw new Error("TranscriptionService.format is abstract")},n.prototype.verify=function(e){throw new Error("TranscriptionService.verify is abstract")},e.exports=n},function(e,t){var n=function(e,t,n){this.word=e,this.begin=t,this.end=n};n.prototype.getWord=function(){return this.word},n.prototype.getBeginTime=function(){return this.begin},n.prototype.getEndTime=function(){return this.end},e.exports=n}])});
//# sourceMappingURL=lib-jitsi-meet.min.map